{"timestamp": "2026-01-08T09:01:14.324402Z", "level": "INFO", "logger": "app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-08T09:01:14.324452Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-08T09:01:14.324475Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-08T09:01:14.324554Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-08T09:01:14.339087Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-08T09:01:14.339130Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-08T09:01:15.888142Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-08T09:01:15.888192Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-08T09:01:15.888216Z", "level": "INFO", "logger": "app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-08T09:01:15.888234Z", "level": "INFO", "logger": "app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-08T09:01:51.041116Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login attempt for user: admin", "module": "auth", "function": "login", "line": 27}
{"timestamp": "2026-01-08T09:01:51.041522Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login successful for user: admin", "module": "auth", "function": "login", "line": 50}
{"timestamp": "2026-01-08T09:02:09.249641Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=36", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:02:09.249756Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Initializing AgentService", "module": "agent_service", "function": "__init__", "line": 121}
{"timestamp": "2026-01-08T09:02:09.249848Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Connecting to database at postgresql://admin:admin@127.0.0.1:5432/Spice_BD", "module": "sql_service", "function": "__init__", "line": 26}
{"timestamp": "2026-01-08T09:02:09.432908Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Database connection established", "module": "sql_service", "function": "__init__", "line": 31}
{"timestamp": "2026-01-08T09:02:09.494203Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Cached schema for 37 relevant tables out of 112 total", "module": "sql_service", "function": "_cache_schema", "line": 215}
{"timestamp": "2026-01-08T09:02:09.494251Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Relevant tables: bp_log, current_medication, diagnosis, glucose_log, lab_test, lab_test_result, lab_test_result_range, medical_compliance, medication_country_detail, patient...", "module": "sql_service", "function": "_cache_schema", "line": 216}
{"timestamp": "2026-01-08T09:02:09.607646Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "SQL agent initialized successfully with 37 cached tables", "module": "sql_service", "function": "__init__", "line": 63}
{"timestamp": "2026-01-08T09:02:09.612307Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "AgentService initialized successfully", "module": "agent_service", "function": "__init__", "line": 184}
{"timestamp": "2026-01-08T09:02:09.612357Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=ab45416a-33b4-4e49-b687-b7cf503ea22e): 'count of patients with hypertension....'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:02:10.978209Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:02:11.530241Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Count of patients with hypertension (systolic >= 140 OR diastolic >= 90)...'", "module": "sql_service", "function": "query", "line": 381}
{"timestamp": "2026-01-08T09:02:11.530357Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udd0d Analyzing natural language query", "module": "sql_service", "function": "_is_simple_query", "line": 323}
{"timestamp": "2026-01-08T09:02:11.530619Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query classified as COMPLEX (pattern=True, complexity=True, multi_table=False)", "module": "sql_service", "function": "_is_simple_query", "line": 366}
{"timestamp": "2026-01-08T09:02:11.530669Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Complex query detected - using full agent", "module": "sql_service", "function": "query", "line": 388}
{"timestamp": "2026-01-08T09:02:11.530713Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 524}
{"timestamp": "2026-01-08T09:02:11.530752Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL AGENT EXECUTION TRACE:", "module": "sql_service", "function": "_execute_with_agent", "line": 525}
{"timestamp": "2026-01-08T09:02:11.530791Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 526}
{"timestamp": "2026-01-08T09:02:12.881951Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:02:14.007490Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:02:15.134272Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:02:16.666406Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:02:19.332969Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:02:21.582785Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:02:24.140307Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 552}
{"timestamp": "2026-01-08T09:02:24.140410Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL query completed. Result length: 152 chars", "module": "sql_service", "function": "_execute_with_agent", "line": 553}
{"timestamp": "2026-01-08T09:02:24.140460Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: There are 6,298 patients with hypertension, defined as having a systolic blood pressure of 140 or higher, or a diastolic blood pressure of 90 or higher....", "module": "sql_service", "function": "_execute_with_agent", "line": 555}
{"timestamp": "2026-01-08T09:02:24.140498Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 556}
{"timestamp": "2026-01-08T09:02:24.759612Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:02:28.338002Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=ab45416a-33b4-4e49-b687-b7cf503ea22e, duration=18.73s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:03:27.684431Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Initializing vector store service", "module": "vector_store", "function": "__init__", "line": 30}
{"timestamp": "2026-01-08T09:03:27.685478Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Looking for RAG config at: /Users/adityanbhatt/fhir_rag/backend/config/embedding_config.yaml", "module": "vector_store", "function": "__init__", "line": 41}
{"timestamp": "2026-01-08T09:03:27.685513Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Loading RAG config from /Users/adityanbhatt/fhir_rag/backend/config/embedding_config.yaml", "module": "vector_store", "function": "__init__", "line": 46}
{"timestamp": "2026-01-08T09:03:27.688271Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Loaded RAG config successfully", "module": "vector_store", "function": "__init__", "line": 51}
{"timestamp": "2026-01-08T09:03:27.688425Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Resolved chroma_path to: /Users/adityanbhatt/fhir_rag/backend/data/indexes/chroma_db_advanced", "module": "retrieve", "function": "_resolve_config_paths", "line": 155}
{"timestamp": "2026-01-08T09:03:27.688493Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Resolved model_path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "retrieve", "function": "_resolve_config_paths", "line": 162}
{"timestamp": "2026-01-08T09:03:27.752263Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Loading docstore from /Users/adityanbhatt/fhir_rag/backend/data/indexes/chroma_db_advanced/parent_docstore.pkl with module remapping", "module": "retrieve", "function": "_load_docstore", "line": 284}
{"timestamp": "2026-01-08T09:03:28.222730Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Successfully loaded docstore with module remapping", "module": "retrieve", "function": "_load_docstore", "line": 286}
{"timestamp": "2026-01-08T09:03:28.224067Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Loading 154161 parent documents for BM25...", "module": "retrieve", "function": "_setup_retrievers", "line": 175}
{"timestamp": "2026-01-08T09:03:28.246694Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Filtered to 59572 documents from relevant tables for BM25 index.", "module": "retrieve", "function": "_setup_retrievers", "line": 185}
{"timestamp": "2026-01-08T09:03:29.296786Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "BM25Retriever initialized on relevant tables.", "module": "retrieve", "function": "_setup_retrievers", "line": 196}
{"timestamp": "2026-01-08T09:03:29.297745Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Initializing reranker: BAAI/bge-reranker-base", "module": "retrieve", "function": "__init__", "line": 137}
{"timestamp": "2026-01-08T09:03:31.167095Z", "level": "INFO", "logger": "sentence_transformers.cross_encoder.CrossEncoder", "message": "Use pytorch device: mps", "module": "CrossEncoder", "function": "__init__", "line": 222}
{"timestamp": "2026-01-08T09:03:32.146072Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Advanced RAG Retriever initialized successfully.", "module": "retrieve", "function": "__init__", "line": 143}
{"timestamp": "2026-01-08T09:03:32.146346Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Vector store initialized successfully", "module": "vector_store", "function": "__init__", "line": 55}
{"timestamp": "2026-01-08T09:03:32.146512Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Searching vector store for query: 'test health check...' (top_k=1)", "module": "vector_store", "function": "search", "line": 69}
{"timestamp": "2026-01-08T09:03:32.147363Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Executing query: test health check", "module": "retrieve", "function": "_get_relevant_documents", "line": 223}
{"timestamp": "2026-01-08T09:03:35.238428Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Reranking 82 documents for query: 'test health check'", "module": "retrieve", "function": "_get_relevant_documents", "line": 257}
{"timestamp": "2026-01-08T09:03:36.788992Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Returning 10 reranked documents.", "module": "retrieve", "function": "_get_relevant_documents", "line": 267}
{"timestamp": "2026-01-08T09:03:36.789232Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Retrieved 10 documents from vector store", "module": "vector_store", "function": "search", "line": 84}
{"timestamp": "2026-01-08T09:03:46.022954Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=42", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:03:46.023612Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=e9019fec-a240-4c14-a27e-a17ff0c95115): 'total count of patients with hypertension....'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:03:46.956154Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:03:47.261599Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Count the total number of patients with hypertension....'", "module": "sql_service", "function": "query", "line": 381}
{"timestamp": "2026-01-08T09:03:47.261806Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udd0d Analyzing natural language query", "module": "sql_service", "function": "_is_simple_query", "line": 323}
{"timestamp": "2026-01-08T09:03:47.261944Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query classified as COMPLEX (pattern=True, complexity=True, multi_table=False)", "module": "sql_service", "function": "_is_simple_query", "line": 366}
{"timestamp": "2026-01-08T09:03:47.262019Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Complex query detected - using full agent", "module": "sql_service", "function": "query", "line": 388}
{"timestamp": "2026-01-08T09:03:47.262117Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 524}
{"timestamp": "2026-01-08T09:03:47.262160Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL AGENT EXECUTION TRACE:", "module": "sql_service", "function": "_execute_with_agent", "line": 525}
{"timestamp": "2026-01-08T09:03:47.262192Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 526}
{"timestamp": "2026-01-08T09:03:47.926636Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:03:48.592705Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:03:49.691387Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:03:51.443344Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:03:52.175452Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:03:53.286932Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:03:53.564297Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 552}
{"timestamp": "2026-01-08T09:03:53.564515Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL query completed. Result length: 56 chars", "module": "sql_service", "function": "_execute_with_agent", "line": 553}
{"timestamp": "2026-01-08T09:03:53.564569Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: The total number of patients with hypertension is 1,130....", "module": "sql_service", "function": "_execute_with_agent", "line": 555}
{"timestamp": "2026-01-08T09:03:53.564611Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 556}
{"timestamp": "2026-01-08T09:03:54.091835Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:03:57.323582Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=e9019fec-a240-4c14-a27e-a17ff0c95115, duration=11.30s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:04:09.337443Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=36", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:04:09.337862Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=a7fa526e-a91d-42f2-8dae-3177f1a86c42): 'count of patients with hypertension....'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:04:10.134095Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:04:10.659973Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Count of patients with hypertension....'", "module": "sql_service", "function": "query", "line": 381}
{"timestamp": "2026-01-08T09:04:10.660060Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udd0d Analyzing natural language query", "module": "sql_service", "function": "_is_simple_query", "line": 323}
{"timestamp": "2026-01-08T09:04:10.660131Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query classified as COMPLEX (pattern=True, complexity=True, multi_table=False)", "module": "sql_service", "function": "_is_simple_query", "line": 366}
{"timestamp": "2026-01-08T09:04:10.660170Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Complex query detected - using full agent", "module": "sql_service", "function": "query", "line": 388}
{"timestamp": "2026-01-08T09:04:10.660205Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 524}
{"timestamp": "2026-01-08T09:04:10.660239Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL AGENT EXECUTION TRACE:", "module": "sql_service", "function": "_execute_with_agent", "line": 525}
{"timestamp": "2026-01-08T09:04:10.660271Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 526}
{"timestamp": "2026-01-08T09:04:11.570976Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:04:12.283157Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:04:13.307392Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:04:14.844059Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:04:16.077799Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:04:17.303489Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:04:17.444756Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 552}
{"timestamp": "2026-01-08T09:04:17.444847Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL query completed. Result length: 53 chars", "module": "sql_service", "function": "_execute_with_agent", "line": 553}
{"timestamp": "2026-01-08T09:04:17.444886Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: There are 1,130 patients diagnosed with hypertension....", "module": "sql_service", "function": "_execute_with_agent", "line": 555}
{"timestamp": "2026-01-08T09:04:17.444923Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 556}
{"timestamp": "2026-01-08T09:04:18.020662Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:04:22.654470Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=a7fa526e-a91d-42f2-8dae-3177f1a86c42, duration=13.32s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:04:22.656859Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login attempt for user: admin", "module": "auth", "function": "login", "line": 27}
{"timestamp": "2026-01-08T09:04:22.657147Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login successful for user: admin", "module": "auth", "function": "login", "line": 50}
{"timestamp": "2026-01-08T09:04:22.877124Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=51", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:04:22.877198Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=bc4c6849-d1e7-4c8e-ade7-028f82647103): 'How many patients were screened for blood pressure?...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:04:23.555041Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:04:24.502471Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Count the number of patients who were screened for blood pressure using v_analytics_screening where ...'", "module": "sql_service", "function": "query", "line": 381}
{"timestamp": "2026-01-08T09:04:24.502605Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udd0d Analyzing natural language query", "module": "sql_service", "function": "_is_simple_query", "line": 323}
{"timestamp": "2026-01-08T09:04:24.502731Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query classified as SIMPLE (natural language)", "module": "sql_service", "function": "_is_simple_query", "line": 364}
{"timestamp": "2026-01-08T09:04:24.502794Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Detected simple query - using optimized execution path", "module": "sql_service", "function": "query", "line": 385}
{"timestamp": "2026-01-08T09:04:24.502855Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_optimized", "line": 397}
{"timestamp": "2026-01-08T09:04:24.502903Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 OPTIMIZED SQL EXECUTION:", "module": "sql_service", "function": "_execute_optimized", "line": 398}
{"timestamp": "2026-01-08T09:04:24.502941Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_optimized", "line": 399}
{"timestamp": "2026-01-08T09:04:24.502992Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " API Call 1: Generate SQL query with targeted schema", "module": "sql_service", "function": "_execute_optimized", "line": 414}
{"timestamp": "2026-01-08T09:04:24.503076Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udccb Selected relevant tables for query: patient, bp_log, patient_tracker", "module": "sql_service", "function": "_get_relevant_schema", "line": 266}
{"timestamp": "2026-01-08T09:04:26.025403Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:04:26.028835Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL to execute: SELECT COUNT(DISTINCT patient_id) \nFROM v_analytics_screening \nWHERE workflow_status = 'NCD' \nAND has_bp_reading = TRUE;...", "module": "sql_service", "function": "_execute_optimized", "line": 448}
{"timestamp": "2026-01-08T09:04:26.029025Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Executing query against database (no API call)", "module": "sql_service", "function": "_execute_optimized", "line": 456}
{"timestamp": "2026-01-08T09:04:26.038988Z", "level": "WARNING", "logger": "backend.services.sql_service", "message": "  Optimized execution failed: (psycopg2.errors.UndefinedColumn) column \"patient_id\" does not exist\nLINE 1: SELECT COUNT(DISTINCT patient_id) \n                              ^\n\n[SQL: SELECT COUNT(DISTINCT patient_id) \nFROM v_analytics_screening \nWHERE workflow_status = 'NCD' \nAND has_bp_reading = TRUE;]\n(Background on this error at: https://sqlalche.me/e/20/f405). Falling back to full agent.", "module": "sql_service", "function": "_execute_optimized", "line": 484}
{"timestamp": "2026-01-08T09:04:26.045800Z", "level": "ERROR", "logger": "backend.services.sql_service", "message": "Error details: (psycopg2.errors.UndefinedColumn) column \"patient_id\" does not exist\nLINE 1: SELECT COUNT(DISTINCT patient_id) \n                              ^\n\n[SQL: SELECT COUNT(DISTINCT patient_id) \nFROM v_analytics_screening \nWHERE workflow_status = 'NCD' \nAND has_bp_reading = TRUE;]\n(Background on this error at: https://sqlalche.me/e/20/f405)", "module": "sql_service", "function": "_execute_optimized", "line": 485, "exception": "Traceback (most recent call last):\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/base.py\", line 1971, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/default.py\", line 919, in do_execute\n    cursor.execute(statement, parameters)\npsycopg2.errors.UndefinedColumn: column \"patient_id\" does not exist\nLINE 1: SELECT COUNT(DISTINCT patient_id) \n                              ^\n\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/Users/adityanbhatt/fhir_rag/backend/services/sql_service.py\", line 457, in _execute_optimized\n    result = self.db.run(sql_query)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_community/utilities/sql_database.py\", line 578, in run\n    result = self._execute(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_community/utilities/sql_database.py\", line 543, in _execute\n    cursor = connection.execute(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/base.py\", line 1422, in execute\n    return meth(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/sql/elements.py\", line 514, in _execute_on_connection\n    return connection._execute_clauseelement(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/base.py\", line 1644, in _execute_clauseelement\n    ret = self._execute_context(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/base.py\", line 1850, in _execute_context\n    return self._exec_single_context(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/base.py\", line 1990, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/base.py\", line 2357, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/base.py\", line 1971, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/default.py\", line 919, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column \"patient_id\" does not exist\nLINE 1: SELECT COUNT(DISTINCT patient_id) \n                              ^\n\n[SQL: SELECT COUNT(DISTINCT patient_id) \nFROM v_analytics_screening \nWHERE workflow_status = 'NCD' \nAND has_bp_reading = TRUE;]\n(Background on this error at: https://sqlalche.me/e/20/f405)"}
{"timestamp": "2026-01-08T09:04:26.046149Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 524}
{"timestamp": "2026-01-08T09:04:26.046198Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL AGENT EXECUTION TRACE:", "module": "sql_service", "function": "_execute_with_agent", "line": 525}
{"timestamp": "2026-01-08T09:04:26.046235Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 526}
{"timestamp": "2026-01-08T09:04:26.871302Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:04:27.645506Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:04:28.507621Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:04:28.807578Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 552}
{"timestamp": "2026-01-08T09:04:28.807615Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL query completed. Result length: 183 chars", "module": "sql_service", "function": "_execute_with_agent", "line": 553}
{"timestamp": "2026-01-08T09:04:28.807637Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: It seems that the table `v_analytics_screening` does not exist in the database. Please check if the table name is correct or if there is another table that contains the relevant data....", "module": "sql_service", "function": "_execute_with_agent", "line": 555}
{"timestamp": "2026-01-08T09:04:28.807654Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 556}
{"timestamp": "2026-01-08T09:04:29.588701Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:04:31.505956Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Count the number of screened patients for blood pressure from v_analytics_screening where workflow_s...'", "module": "sql_service", "function": "query", "line": 381}
{"timestamp": "2026-01-08T09:04:31.506011Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udd0d Analyzing natural language query", "module": "sql_service", "function": "_is_simple_query", "line": 323}
{"timestamp": "2026-01-08T09:04:31.506054Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query classified as SIMPLE (natural language)", "module": "sql_service", "function": "_is_simple_query", "line": 364}
{"timestamp": "2026-01-08T09:04:31.506077Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Detected simple query - using optimized execution path", "module": "sql_service", "function": "query", "line": 385}
{"timestamp": "2026-01-08T09:04:31.506098Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_optimized", "line": 397}
{"timestamp": "2026-01-08T09:04:31.506118Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 OPTIMIZED SQL EXECUTION:", "module": "sql_service", "function": "_execute_optimized", "line": 398}
{"timestamp": "2026-01-08T09:04:31.506136Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_optimized", "line": 399}
{"timestamp": "2026-01-08T09:04:31.506155Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " API Call 1: Generate SQL query with targeted schema", "module": "sql_service", "function": "_execute_optimized", "line": 414}
{"timestamp": "2026-01-08T09:04:31.506185Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udccb Selected relevant tables for query: patient, bp_log, patient_tracker", "module": "sql_service", "function": "_get_relevant_schema", "line": 266}
{"timestamp": "2026-01-08T09:04:32.338720Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:04:32.340917Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL to execute: SELECT COUNT(*) \nFROM v_analytics_screening \nWHERE workflow_status = 'NCD' \nAND has_bp_reading = TRUE;...", "module": "sql_service", "function": "_execute_optimized", "line": 448}
{"timestamp": "2026-01-08T09:04:32.341106Z", "level": "WARNING", "logger": "backend.services.sql_service", "message": "Query doesn't reference any known tables", "module": "sql_service", "function": "_validate_sql_query", "line": 509}
{"timestamp": "2026-01-08T09:04:32.341215Z", "level": "WARNING", "logger": "backend.services.sql_service", "message": "  SQL validation failed, falling back to agent", "module": "sql_service", "function": "_execute_optimized", "line": 452}
{"timestamp": "2026-01-08T09:04:32.341297Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 524}
{"timestamp": "2026-01-08T09:04:32.341514Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL AGENT EXECUTION TRACE:", "module": "sql_service", "function": "_execute_with_agent", "line": 525}
{"timestamp": "2026-01-08T09:04:32.341665Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 526}
{"timestamp": "2026-01-08T09:04:33.016074Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:04:33.740320Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:04:34.606406Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:04:35.290892Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 552}
{"timestamp": "2026-01-08T09:04:35.292146Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL query completed. Result length: 143 chars", "module": "sql_service", "function": "_execute_with_agent", "line": 553}
{"timestamp": "2026-01-08T09:04:35.292254Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: It seems that the table `v_analytics_screening` does not exist in the database. Could you please verify the table name or provide more details?...", "module": "sql_service", "function": "_execute_with_agent", "line": 555}
{"timestamp": "2026-01-08T09:04:35.292396Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 556}
{"timestamp": "2026-01-08T09:04:35.629859Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 429 Too Many Requests\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:04:35.630600Z", "level": "INFO", "logger": "openai._base_client", "message": "Retrying request to /chat/completions in 1.508000 seconds", "module": "_base_client", "function": "_sleep_for_retry", "line": 1071}
{"timestamp": "2026-01-08T09:04:37.784604Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:04:42.859289Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=bc4c6849-d1e7-4c8e-ade7-028f82647103, duration=19.98s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:04:42.861797Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login attempt for user: admin", "module": "auth", "function": "login", "line": 27}
{"timestamp": "2026-01-08T09:04:42.862341Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login successful for user: admin", "module": "auth", "function": "login", "line": 50}
{"timestamp": "2026-01-08T09:05:46.323376Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=36", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:05:46.323957Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=9fa4ce49-d4da-4e2f-8b76-e16ad0bbfa9f): 'count of patients with hypertension....'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:05:47.294196Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:05:47.719721Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Count of patients with hypertension (systolic >= 140 OR diastolic >= 90)...'", "module": "sql_service", "function": "query", "line": 381}
{"timestamp": "2026-01-08T09:05:47.719947Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udd0d Analyzing natural language query", "module": "sql_service", "function": "_is_simple_query", "line": 323}
{"timestamp": "2026-01-08T09:05:47.720181Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query classified as COMPLEX (pattern=True, complexity=True, multi_table=False)", "module": "sql_service", "function": "_is_simple_query", "line": 366}
{"timestamp": "2026-01-08T09:05:47.720271Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Complex query detected - using full agent", "module": "sql_service", "function": "query", "line": 388}
{"timestamp": "2026-01-08T09:05:47.720349Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 524}
{"timestamp": "2026-01-08T09:05:47.720412Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL AGENT EXECUTION TRACE:", "module": "sql_service", "function": "_execute_with_agent", "line": 525}
{"timestamp": "2026-01-08T09:05:47.720465Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 526}
{"timestamp": "2026-01-08T09:05:48.785843Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:05:49.569755Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:05:50.491718Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:05:51.827391Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:05:52.693415Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:05:53.665931Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:05:53.993843Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 552}
{"timestamp": "2026-01-08T09:05:53.994067Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL query completed. Result length: 152 chars", "module": "sql_service", "function": "_execute_with_agent", "line": 553}
{"timestamp": "2026-01-08T09:05:53.994177Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: There are 6,298 patients with hypertension, defined as having a systolic blood pressure of 140 or higher, or a diastolic blood pressure of 90 or higher....", "module": "sql_service", "function": "_execute_with_agent", "line": 555}
{"timestamp": "2026-01-08T09:05:53.994305Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 556}
{"timestamp": "2026-01-08T09:05:54.599280Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:05:57.640922Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=9fa4ce49-d4da-4e2f-8b76-e16ad0bbfa9f, duration=11.32s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:06:24.454443Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=36", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:06:24.454796Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=937626bd-d9b6-43a7-9ed9-4ac180ab55d0): 'count of patients with hypertension....'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:06:25.153892Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:06:25.435894Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Count of patients with hypertension....'", "module": "sql_service", "function": "query", "line": 381}
{"timestamp": "2026-01-08T09:06:25.435961Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udd0d Analyzing natural language query", "module": "sql_service", "function": "_is_simple_query", "line": 323}
{"timestamp": "2026-01-08T09:06:25.436017Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query classified as COMPLEX (pattern=True, complexity=True, multi_table=False)", "module": "sql_service", "function": "_is_simple_query", "line": 366}
{"timestamp": "2026-01-08T09:06:25.436049Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Complex query detected - using full agent", "module": "sql_service", "function": "query", "line": 388}
{"timestamp": "2026-01-08T09:06:25.436074Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 524}
{"timestamp": "2026-01-08T09:06:25.436100Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL AGENT EXECUTION TRACE:", "module": "sql_service", "function": "_execute_with_agent", "line": 525}
{"timestamp": "2026-01-08T09:06:25.436122Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 526}
{"timestamp": "2026-01-08T09:06:26.058328Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:06:26.716471Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:06:27.675987Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:06:28.732993Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:06:29.392067Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:06:31.244565Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:06:31.740142Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 552}
{"timestamp": "2026-01-08T09:06:31.740374Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL query completed. Result length: 53 chars", "module": "sql_service", "function": "_execute_with_agent", "line": 553}
{"timestamp": "2026-01-08T09:06:31.740526Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: There are 1,130 patients diagnosed with hypertension....", "module": "sql_service", "function": "_execute_with_agent", "line": 555}
{"timestamp": "2026-01-08T09:06:31.740605Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 556}
{"timestamp": "2026-01-08T09:06:32.780636Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:06:37.634143Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=937626bd-d9b6-43a7-9ed9-4ac180ab55d0, duration=13.18s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:06:48.809491Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=56", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:06:48.809666Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=ab2e87e6-a13e-431a-bda3-c3958e3e8d9e): 'What is the average blood pressure among these patients?...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:06:49.597202Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:06:50.176416Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Calculate the average systolic and diastolic blood pressure for patients in the database....'", "module": "sql_service", "function": "query", "line": 381}
{"timestamp": "2026-01-08T09:06:50.176635Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udd0d Analyzing natural language query", "module": "sql_service", "function": "_is_simple_query", "line": 323}
{"timestamp": "2026-01-08T09:06:50.177902Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query classified as SIMPLE (natural language)", "module": "sql_service", "function": "_is_simple_query", "line": 364}
{"timestamp": "2026-01-08T09:06:50.178063Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Detected simple query - using optimized execution path", "module": "sql_service", "function": "query", "line": 385}
{"timestamp": "2026-01-08T09:06:50.178153Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_optimized", "line": 397}
{"timestamp": "2026-01-08T09:06:50.178217Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 OPTIMIZED SQL EXECUTION:", "module": "sql_service", "function": "_execute_optimized", "line": 398}
{"timestamp": "2026-01-08T09:06:50.178259Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_optimized", "line": 399}
{"timestamp": "2026-01-08T09:06:50.178329Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " API Call 1: Generate SQL query with targeted schema", "module": "sql_service", "function": "_execute_optimized", "line": 414}
{"timestamp": "2026-01-08T09:06:50.178450Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udccb Selected relevant tables for query: patient, bp_log, patient_tracker", "module": "sql_service", "function": "_get_relevant_schema", "line": 266}
{"timestamp": "2026-01-08T09:06:50.975099Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:06:50.980466Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL to execute: SELECT AVG(avg_systolic) AS avg_systolic, AVG(avg_diastolic) AS avg_diastolic FROM bp_log;...", "module": "sql_service", "function": "_execute_optimized", "line": 448}
{"timestamp": "2026-01-08T09:06:50.980640Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Executing query against database (no API call)", "module": "sql_service", "function": "_execute_optimized", "line": 456}
{"timestamp": "2026-01-08T09:06:50.993030Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query result: [(Decimal('137.2907228678353358'), Decimal('90.9827654126452630'))]", "module": "sql_service", "function": "_execute_optimized", "line": 458}
{"timestamp": "2026-01-08T09:06:50.993127Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " API Call 2: Format natural language response", "module": "sql_service", "function": "_execute_optimized", "line": 461}
{"timestamp": "2026-01-08T09:06:51.887524Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:06:51.892537Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_optimized", "line": 476}
{"timestamp": "2026-01-08T09:06:51.892631Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Optimized execution completed with 2 API call(s) (vs 7 with agent)", "module": "sql_service", "function": "_execute_optimized", "line": 477}
{"timestamp": "2026-01-08T09:06:51.892685Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: The average systolic blood pressure for patients in the database is approximately 137.29 mmHg, and the average diastolic blood pressure is approximately 90.98 mmHg....", "module": "sql_service", "function": "_execute_optimized", "line": 478}
{"timestamp": "2026-01-08T09:06:51.892729Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_optimized", "line": 479}
{"timestamp": "2026-01-08T09:06:52.392643Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:06:55.262933Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=ab2e87e6-a13e-431a-bda3-c3958e3e8d9e, duration=6.45s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:07:13.576877Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=154", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:07:13.577045Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=82403202-ccc6-490d-93ce-747a1040e251): 'The count of patients with hypertension, defined as having a systolic blood pressure of 140 or highe...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:07:14.516016Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:07:14.900009Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Count patients with systolic BP >= 140 or diastolic BP >= 90...'", "module": "sql_service", "function": "query", "line": 381}
{"timestamp": "2026-01-08T09:07:14.900086Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udd0d Analyzing natural language query", "module": "sql_service", "function": "_is_simple_query", "line": 323}
{"timestamp": "2026-01-08T09:07:14.900152Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query classified as SIMPLE (natural language)", "module": "sql_service", "function": "_is_simple_query", "line": 364}
{"timestamp": "2026-01-08T09:07:14.900183Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Detected simple query - using optimized execution path", "module": "sql_service", "function": "query", "line": 385}
{"timestamp": "2026-01-08T09:07:14.900213Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_optimized", "line": 397}
{"timestamp": "2026-01-08T09:07:14.900248Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 OPTIMIZED SQL EXECUTION:", "module": "sql_service", "function": "_execute_optimized", "line": 398}
{"timestamp": "2026-01-08T09:07:14.900269Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_optimized", "line": 399}
{"timestamp": "2026-01-08T09:07:14.900295Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " API Call 1: Generate SQL query with targeted schema", "module": "sql_service", "function": "_execute_optimized", "line": 414}
{"timestamp": "2026-01-08T09:07:14.900345Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udccb Selected relevant tables for query: patient, bp_log, patient_tracker", "module": "sql_service", "function": "_get_relevant_schema", "line": 266}
{"timestamp": "2026-01-08T09:07:16.434008Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:07:16.439587Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL to execute: SELECT COUNT(DISTINCT pt.patient_id)\nFROM bp_log bp\nJOIN patient_tracker pt ON bp.patient_track_id = pt.id\nWHERE bp.avg_systolic >= 140 OR bp.avg_diastolic >= 90;...", "module": "sql_service", "function": "_execute_optimized", "line": 448}
{"timestamp": "2026-01-08T09:07:16.439683Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Executing query against database (no API call)", "module": "sql_service", "function": "_execute_optimized", "line": 456}
{"timestamp": "2026-01-08T09:07:16.457610Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query result: [(1263,)]", "module": "sql_service", "function": "_execute_optimized", "line": 458}
{"timestamp": "2026-01-08T09:07:16.457669Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " API Call 2: Format natural language response", "module": "sql_service", "function": "_execute_optimized", "line": 461}
{"timestamp": "2026-01-08T09:07:17.839749Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:07:17.840371Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_optimized", "line": 476}
{"timestamp": "2026-01-08T09:07:17.840442Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Optimized execution completed with 2 API call(s) (vs 7 with agent)", "module": "sql_service", "function": "_execute_optimized", "line": 477}
{"timestamp": "2026-01-08T09:07:17.840475Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: There are 1,263 distinct patients with either an average systolic blood pressure of 140 or higher, or an average diastolic blood pressure of 90 or higher....", "module": "sql_service", "function": "_execute_optimized", "line": 478}
{"timestamp": "2026-01-08T09:07:17.840497Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_optimized", "line": 479}
{"timestamp": "2026-01-08T09:07:18.380681Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:07:22.010438Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=82403202-ccc6-490d-93ce-747a1040e251, duration=8.43s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:09:25.486486Z", "level": "INFO", "logger": "app", "message": "Shutting down application", "module": "app", "function": "lifespan", "line": 34}
{"timestamp": "2026-01-08T09:09:30.038305Z", "level": "INFO", "logger": "app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-08T09:09:30.038348Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-08T09:09:30.038370Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-08T09:09:30.038445Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-08T09:09:30.052242Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-08T09:09:30.052287Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-08T09:09:31.578804Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-08T09:09:31.578867Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-08T09:09:31.578915Z", "level": "INFO", "logger": "app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-08T09:09:31.578937Z", "level": "INFO", "logger": "app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-08T09:10:25.189093Z", "level": "INFO", "logger": "app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-08T09:10:25.189143Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-08T09:10:25.189170Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-08T09:10:25.189246Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-08T09:10:25.202508Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-08T09:10:25.202546Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-08T09:10:25.932949Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-08T09:10:25.933009Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-08T09:10:25.933035Z", "level": "INFO", "logger": "app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-08T09:10:25.933056Z", "level": "INFO", "logger": "app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-08T09:11:00.820181Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login attempt for user: admin", "module": "auth", "function": "login", "line": 27}
{"timestamp": "2026-01-08T09:11:00.821269Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login successful for user: admin", "module": "auth", "function": "login", "line": 50}
{"timestamp": "2026-01-08T09:11:00.822820Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=51", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:11:00.822861Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Initializing AgentService", "module": "agent_service", "function": "__init__", "line": 121}
{"timestamp": "2026-01-08T09:11:00.822911Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Connecting to database at postgresql://admin:admin@127.0.0.1:5432/Spice_BD", "module": "sql_service", "function": "__init__", "line": 26}
{"timestamp": "2026-01-08T09:11:01.179682Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Database connection established with view support", "module": "sql_service", "function": "__init__", "line": 46}
{"timestamp": "2026-01-08T09:11:01.387085Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Cached schema for 39 relevant tables out of 114 total", "module": "sql_service", "function": "_cache_schema", "line": 230}
{"timestamp": "2026-01-08T09:11:01.387151Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Relevant tables: bp_log, current_medication, diagnosis, glucose_log, lab_test, lab_test_result, lab_test_result_range, medical_compliance, medication_country_detail, patient...", "module": "sql_service", "function": "_cache_schema", "line": 231}
{"timestamp": "2026-01-08T09:11:01.489596Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "SQL agent initialized successfully with 39 cached tables", "module": "sql_service", "function": "__init__", "line": 78}
{"timestamp": "2026-01-08T09:11:01.494267Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "AgentService initialized successfully", "module": "agent_service", "function": "__init__", "line": 184}
{"timestamp": "2026-01-08T09:11:01.494322Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=73e939f3-085f-45cb-b2ae-8c9c0aa90b5e): 'How many patients were screened for blood pressure?...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:11:02.503373Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:11:03.589938Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Count the number of patients who were screened for blood pressure using v_analytics_screening where ...'", "module": "sql_service", "function": "query", "line": 396}
{"timestamp": "2026-01-08T09:11:03.590109Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udd0d Analyzing natural language query", "module": "sql_service", "function": "_is_simple_query", "line": 338}
{"timestamp": "2026-01-08T09:11:03.590447Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query classified as COMPLEX (pattern=True, complexity=False, multi_table=True)", "module": "sql_service", "function": "_is_simple_query", "line": 381}
{"timestamp": "2026-01-08T09:11:03.590506Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Complex query detected - using full agent", "module": "sql_service", "function": "query", "line": 403}
{"timestamp": "2026-01-08T09:11:03.590561Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 539}
{"timestamp": "2026-01-08T09:11:03.590604Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL AGENT EXECUTION TRACE:", "module": "sql_service", "function": "_execute_with_agent", "line": 540}
{"timestamp": "2026-01-08T09:11:03.590646Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 541}
{"timestamp": "2026-01-08T09:11:04.333939Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:11:05.712208Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:11:07.321850Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:11:08.660386Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:11:09.269719Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:11:10.225106Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:11:11.056427Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 567}
{"timestamp": "2026-01-08T09:11:11.056638Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL query completed. Result length: 135 chars", "module": "sql_service", "function": "_execute_with_agent", "line": 568}
{"timestamp": "2026-01-08T09:11:11.056764Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: The number of patients who were screened for blood pressure with a workflow status of 'NCD' and have a blood pressure reading is 5,332....", "module": "sql_service", "function": "_execute_with_agent", "line": 570}
{"timestamp": "2026-01-08T09:11:11.056976Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 571}
{"timestamp": "2026-01-08T09:11:11.535103Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:11:14.770329Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=73e939f3-085f-45cb-b2ae-8c9c0aa90b5e, duration=13.28s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:11:56.024643Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login attempt for user: admin", "module": "auth", "function": "login", "line": 27}
{"timestamp": "2026-01-08T09:11:56.024825Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login successful for user: admin", "module": "auth", "function": "login", "line": 50}
{"timestamp": "2026-01-08T09:11:56.025916Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=36", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:11:56.025968Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=143e6919-d3f9-4fb5-8c18-d94ed59ed997): 'How many crisis referrals are there?...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:11:56.699257Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:11:57.612599Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Count the number of crisis referrals from v_analytics_screening where crisis_referral_status = 'Cris...'", "module": "sql_service", "function": "query", "line": 396}
{"timestamp": "2026-01-08T09:11:57.612726Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udd0d Analyzing natural language query", "module": "sql_service", "function": "_is_simple_query", "line": 338}
{"timestamp": "2026-01-08T09:11:57.613736Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query classified as COMPLEX (pattern=False, complexity=False, multi_table=False)", "module": "sql_service", "function": "_is_simple_query", "line": 381}
{"timestamp": "2026-01-08T09:11:57.613784Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Complex query detected - using full agent", "module": "sql_service", "function": "query", "line": 403}
{"timestamp": "2026-01-08T09:11:57.613826Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 539}
{"timestamp": "2026-01-08T09:11:57.613862Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL AGENT EXECUTION TRACE:", "module": "sql_service", "function": "_execute_with_agent", "line": 540}
{"timestamp": "2026-01-08T09:11:57.613896Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 541}
{"timestamp": "2026-01-08T09:11:58.291921Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:11:59.034592Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:12:00.162908Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:12:01.388984Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:12:02.712071Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:12:03.666731Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:12:03.989799Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 567}
{"timestamp": "2026-01-08T09:12:03.990034Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL query completed. Result length: 126 chars", "module": "sql_service", "function": "_execute_with_agent", "line": 568}
{"timestamp": "2026-01-08T09:12:03.990129Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: There are 1,219 crisis referrals in the `v_analytics_screening` table where the `crisis_referral_status` is 'Crisis Referral'....", "module": "sql_service", "function": "_execute_with_agent", "line": 570}
{"timestamp": "2026-01-08T09:12:03.990197Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 571}
{"timestamp": "2026-01-08T09:12:04.528593Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:12:08.673280Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=143e6919-d3f9-4fb5-8c18-d94ed59ed997, duration=12.65s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:12:08.680159Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=46", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:12:08.680313Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=a243e345-2a21-4b3c-b344-758a64b534ce): 'What is the total number of enrolled patients?...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:12:09.296769Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:12:09.643132Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Total number of enrolled patients from v_analytics_enrollment...'", "module": "sql_service", "function": "query", "line": 396}
{"timestamp": "2026-01-08T09:12:09.643315Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udd0d Analyzing natural language query", "module": "sql_service", "function": "_is_simple_query", "line": 338}
{"timestamp": "2026-01-08T09:12:09.643550Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query classified as COMPLEX (pattern=True, complexity=False, multi_table=True)", "module": "sql_service", "function": "_is_simple_query", "line": 381}
{"timestamp": "2026-01-08T09:12:09.643680Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Complex query detected - using full agent", "module": "sql_service", "function": "query", "line": 403}
{"timestamp": "2026-01-08T09:12:09.643761Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 539}
{"timestamp": "2026-01-08T09:12:09.643824Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL AGENT EXECUTION TRACE:", "module": "sql_service", "function": "_execute_with_agent", "line": 540}
{"timestamp": "2026-01-08T09:12:09.643881Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 541}
{"timestamp": "2026-01-08T09:12:10.852169Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:12:11.837194Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:12:14.928830Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:12:16.313919Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:12:16.943734Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 567}
{"timestamp": "2026-01-08T09:12:16.944065Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL query completed. Result length: 47 chars", "module": "sql_service", "function": "_execute_with_agent", "line": 568}
{"timestamp": "2026-01-08T09:12:16.944222Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: The total number of enrolled patients is 2,566....", "module": "sql_service", "function": "_execute_with_agent", "line": 570}
{"timestamp": "2026-01-08T09:12:16.944376Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 571}
{"timestamp": "2026-01-08T09:12:17.672563Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:12:18.815793Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=a243e345-2a21-4b3c-b344-758a64b534ce, duration=10.14s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:12:18.821310Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=45", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:12:18.821441Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=9068a705-edd9-4ac1-99ff-bf1b02640a12): 'How many patients are enrolled with diabetes?...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:12:19.519033Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:12:19.835610Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Count the number of patients enrolled with diabetes from v_analytics_enrollment....'", "module": "sql_service", "function": "query", "line": 396}
{"timestamp": "2026-01-08T09:12:19.835724Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udd0d Analyzing natural language query", "module": "sql_service", "function": "_is_simple_query", "line": 338}
{"timestamp": "2026-01-08T09:12:19.835854Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query classified as COMPLEX (pattern=True, complexity=False, multi_table=True)", "module": "sql_service", "function": "_is_simple_query", "line": 381}
{"timestamp": "2026-01-08T09:12:19.835900Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Complex query detected - using full agent", "module": "sql_service", "function": "query", "line": 403}
{"timestamp": "2026-01-08T09:12:19.835940Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 539}
{"timestamp": "2026-01-08T09:12:19.835979Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL AGENT EXECUTION TRACE:", "module": "sql_service", "function": "_execute_with_agent", "line": 540}
{"timestamp": "2026-01-08T09:12:19.836016Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 541}
{"timestamp": "2026-01-08T09:12:20.498097Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:12:22.075143Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:12:22.996404Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:12:25.146135Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:12:26.173341Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:12:26.992006Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:12:27.122472Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 567}
{"timestamp": "2026-01-08T09:12:27.122537Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL query completed. Result length: 64 chars", "module": "sql_service", "function": "_execute_with_agent", "line": 568}
{"timestamp": "2026-01-08T09:12:27.122612Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: There are 2,733 patients enrolled with diabetes in the database....", "module": "sql_service", "function": "_execute_with_agent", "line": 570}
{"timestamp": "2026-01-08T09:12:27.122638Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 571}
{"timestamp": "2026-01-08T09:12:28.117184Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:12:32.517338Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=9068a705-edd9-4ac1-99ff-bf1b02640a12, duration=13.70s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:13:52.535416Z", "level": "INFO", "logger": "app", "message": "Shutting down application", "module": "app", "function": "lifespan", "line": 34}
{"timestamp": "2026-01-08T09:13:56.363089Z", "level": "INFO", "logger": "app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-08T09:13:56.363126Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-08T09:13:56.363146Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-08T09:13:56.363223Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-08T09:13:56.379190Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-08T09:13:56.379226Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-08T09:13:57.621974Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-08T09:13:57.622080Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-08T09:13:57.622162Z", "level": "INFO", "logger": "app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-08T09:13:57.622185Z", "level": "INFO", "logger": "app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-08T09:18:19.568887Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=53", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:18:19.569228Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Initializing AgentService", "module": "agent_service", "function": "__init__", "line": 121}
{"timestamp": "2026-01-08T09:18:19.569369Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Connecting to database at postgresql://admin:admin@127.0.0.1:5432/Spice_BD", "module": "sql_service", "function": "__init__", "line": 26}
{"timestamp": "2026-01-08T09:18:19.857207Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Database connection established with view support", "module": "sql_service", "function": "__init__", "line": 46}
{"timestamp": "2026-01-08T09:18:20.051893Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Cached schema for 39 relevant tables out of 114 total", "module": "sql_service", "function": "_cache_schema", "line": 230}
{"timestamp": "2026-01-08T09:18:20.051945Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Relevant tables: bp_log, current_medication, diagnosis, glucose_log, lab_test, lab_test_result, lab_test_result_range, medical_compliance, medication_country_detail, patient...", "module": "sql_service", "function": "_cache_schema", "line": 231}
{"timestamp": "2026-01-08T09:18:20.163266Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "SQL agent initialized successfully with 39 cached tables", "module": "sql_service", "function": "__init__", "line": 78}
{"timestamp": "2026-01-08T09:18:20.167674Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "AgentService initialized successfully", "module": "agent_service", "function": "__init__", "line": 184}
{"timestamp": "2026-01-08T09:18:20.167732Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=d7e7076c-0a55-488f-aed3-b8c7acf9ef7d): '\"How many patients were screened for blood pressure?\"...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:18:21.618064Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:18:22.493995Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Count the number of patients who were screened for blood pressure using the v_analytics_screening ta...'", "module": "sql_service", "function": "query", "line": 396}
{"timestamp": "2026-01-08T09:18:22.494087Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udd0d Analyzing natural language query", "module": "sql_service", "function": "_is_simple_query", "line": 338}
{"timestamp": "2026-01-08T09:18:22.494458Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query classified as COMPLEX (pattern=True, complexity=False, multi_table=True)", "module": "sql_service", "function": "_is_simple_query", "line": 381}
{"timestamp": "2026-01-08T09:18:22.494538Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Complex query detected - using full agent", "module": "sql_service", "function": "query", "line": 403}
{"timestamp": "2026-01-08T09:18:22.494592Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 539}
{"timestamp": "2026-01-08T09:18:22.494684Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL AGENT EXECUTION TRACE:", "module": "sql_service", "function": "_execute_with_agent", "line": 540}
{"timestamp": "2026-01-08T09:18:22.494758Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 541}
{"timestamp": "2026-01-08T09:18:23.561452Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:18:24.374950Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:18:26.088299Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:18:27.246073Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:18:28.063658Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:18:28.985587Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:18:29.364533Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 567}
{"timestamp": "2026-01-08T09:18:29.364670Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL query completed. Result length: 135 chars", "module": "sql_service", "function": "_execute_with_agent", "line": 568}
{"timestamp": "2026-01-08T09:18:29.364728Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: The number of patients who were screened for blood pressure with a workflow status of 'NCD' and have a blood pressure reading is 5,332....", "module": "sql_service", "function": "_execute_with_agent", "line": 570}
{"timestamp": "2026-01-08T09:18:29.364775Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 571}
{"timestamp": "2026-01-08T09:18:30.135145Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:18:33.165961Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=d7e7076c-0a55-488f-aed3-b8c7acf9ef7d, duration=13.00s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:19:01.678699Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=53", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:19:01.679739Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=1cd08133-d805-4a68-9fa3-10940ccf5a73): '\"What percentage of screened patients were referred?\"...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:19:02.453792Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:19:03.010255Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Calculate the percentage of screened patients who were referred using the v_analytics_screening tabl...'", "module": "sql_service", "function": "query", "line": 396}
{"timestamp": "2026-01-08T09:19:03.010311Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udd0d Analyzing natural language query", "module": "sql_service", "function": "_is_simple_query", "line": 338}
{"timestamp": "2026-01-08T09:19:03.010858Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query classified as COMPLEX (pattern=False, complexity=True, multi_table=True)", "module": "sql_service", "function": "_is_simple_query", "line": 381}
{"timestamp": "2026-01-08T09:19:03.010890Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Complex query detected - using full agent", "module": "sql_service", "function": "query", "line": 403}
{"timestamp": "2026-01-08T09:19:03.010915Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 539}
{"timestamp": "2026-01-08T09:19:03.010940Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL AGENT EXECUTION TRACE:", "module": "sql_service", "function": "_execute_with_agent", "line": 540}
{"timestamp": "2026-01-08T09:19:03.010963Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 541}
{"timestamp": "2026-01-08T09:19:04.108975Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:19:04.933825Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:19:05.851650Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:19:07.489799Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:19:08.721127Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:19:09.640947Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:19:09.896321Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 567}
{"timestamp": "2026-01-08T09:19:09.896615Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL query completed. Result length: 115 chars", "module": "sql_service", "function": "_execute_with_agent", "line": 568}
{"timestamp": "2026-01-08T09:19:09.896758Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: Approximately 66.58% of screened patients were referred according to the data in the `v_analytics_screening` table....", "module": "sql_service", "function": "_execute_with_agent", "line": 570}
{"timestamp": "2026-01-08T09:19:09.896851Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 571}
{"timestamp": "2026-01-08T09:19:10.679703Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:19:14.378297Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=1cd08133-d805-4a68-9fa3-10940ccf5a73, duration=12.70s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:19:18.348697Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=34", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:19:18.348887Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=4dd5ac61-1cba-4b75-bbb6-1dae308ae147): '\"What is the DBM prevalence rate?\"...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:19:19.369343Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:19:20.279403Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Calculate the DBM prevalence rate using the formula: (Elevated BG Referrals / Screened for BG) * 100...'", "module": "sql_service", "function": "query", "line": 396}
{"timestamp": "2026-01-08T09:19:20.279491Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udd0d Analyzing natural language query", "module": "sql_service", "function": "_is_simple_query", "line": 338}
{"timestamp": "2026-01-08T09:19:20.279590Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query classified as COMPLEX (pattern=False, complexity=False, multi_table=False)", "module": "sql_service", "function": "_is_simple_query", "line": 381}
{"timestamp": "2026-01-08T09:19:20.279638Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Complex query detected - using full agent", "module": "sql_service", "function": "query", "line": 403}
{"timestamp": "2026-01-08T09:19:20.279670Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 539}
{"timestamp": "2026-01-08T09:19:20.279704Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL AGENT EXECUTION TRACE:", "module": "sql_service", "function": "_execute_with_agent", "line": 540}
{"timestamp": "2026-01-08T09:19:20.279735Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 541}
{"timestamp": "2026-01-08T09:19:21.113215Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:19:21.827237Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:19:22.851211Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:19:28.643044Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:19:29.405524Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:19:30.883421Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:19:32.805930Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 567}
{"timestamp": "2026-01-08T09:19:32.806011Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL query completed. Result length: 305 chars", "module": "sql_service", "function": "_execute_with_agent", "line": 568}
{"timestamp": "2026-01-08T09:19:32.806053Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: The DBM prevalence rate, calculated as the percentage of elevated blood glucose referrals out of those screened for blood glucose, is approximately 213.10%. This value suggests that there might be multiple referrals per individual or data inconsistencies, as prevalence rates typically do not exceed ...", "module": "sql_service", "function": "_execute_with_agent", "line": 570}
{"timestamp": "2026-01-08T09:19:32.806087Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 571}
{"timestamp": "2026-01-08T09:19:33.603477Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:19:35.494486Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=4dd5ac61-1cba-4b75-bbb6-1dae308ae147, duration=17.15s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:19:58.338413Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=45", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:19:58.339402Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=cf338cab-906c-4ef0-9b24-8215b162a091): '\"What symptoms indicate hypertensive crisis?\"...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:19:59.105581Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:20:07.123450Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=cf338cab-906c-4ef0-9b24-8215b162a091, duration=8.78s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:20:28.149161Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=52", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:20:28.149244Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=0b1c3e74-4261-40bc-8359-ce9bbbcaec78): '\"Find patients with poor medication adherence notes\"...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:20:28.902640Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:20:29.077302Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "\u26a1 Lazy loading vector store on first use...", "module": "agent_service", "function": "vector_store", "line": 190}
{"timestamp": "2026-01-08T09:20:29.077630Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Initializing vector store service", "module": "vector_store", "function": "__init__", "line": 30}
{"timestamp": "2026-01-08T09:20:29.078122Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Looking for RAG config at: /Users/adityanbhatt/fhir_rag/backend/config/embedding_config.yaml", "module": "vector_store", "function": "__init__", "line": 41}
{"timestamp": "2026-01-08T09:20:29.078274Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Loading RAG config from /Users/adityanbhatt/fhir_rag/backend/config/embedding_config.yaml", "module": "vector_store", "function": "__init__", "line": 46}
{"timestamp": "2026-01-08T09:20:29.086147Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Loaded RAG config successfully", "module": "vector_store", "function": "__init__", "line": 51}
{"timestamp": "2026-01-08T09:20:29.086509Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Resolved chroma_path to: /Users/adityanbhatt/fhir_rag/backend/data/indexes/chroma_db_advanced", "module": "retrieve", "function": "_resolve_config_paths", "line": 155}
{"timestamp": "2026-01-08T09:20:29.086612Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Resolved model_path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "retrieve", "function": "_resolve_config_paths", "line": 162}
{"timestamp": "2026-01-08T09:20:29.170600Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Loading docstore from /Users/adityanbhatt/fhir_rag/backend/data/indexes/chroma_db_advanced/parent_docstore.pkl with module remapping", "module": "retrieve", "function": "_load_docstore", "line": 284}
{"timestamp": "2026-01-08T09:20:29.692246Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Successfully loaded docstore with module remapping", "module": "retrieve", "function": "_load_docstore", "line": 286}
{"timestamp": "2026-01-08T09:20:29.694583Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Loading 154161 parent documents for BM25...", "module": "retrieve", "function": "_setup_retrievers", "line": 175}
{"timestamp": "2026-01-08T09:20:29.718120Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Filtered to 59572 documents from relevant tables for BM25 index.", "module": "retrieve", "function": "_setup_retrievers", "line": 185}
{"timestamp": "2026-01-08T09:20:30.549977Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "BM25Retriever initialized on relevant tables.", "module": "retrieve", "function": "_setup_retrievers", "line": 196}
{"timestamp": "2026-01-08T09:20:30.550990Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Initializing reranker: BAAI/bge-reranker-base", "module": "retrieve", "function": "__init__", "line": 137}
{"timestamp": "2026-01-08T09:20:32.807375Z", "level": "INFO", "logger": "sentence_transformers.cross_encoder.CrossEncoder", "message": "Use pytorch device: mps", "module": "CrossEncoder", "function": "__init__", "line": 222}
{"timestamp": "2026-01-08T09:20:34.035326Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Advanced RAG Retriever initialized successfully.", "module": "retrieve", "function": "__init__", "line": 143}
{"timestamp": "2026-01-08T09:20:34.035463Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Vector store initialized successfully", "module": "vector_store", "function": "__init__", "line": 55}
{"timestamp": "2026-01-08T09:20:34.035533Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "\u2705 Vector store loaded", "module": "agent_service", "function": "vector_store", "line": 192}
{"timestamp": "2026-01-08T09:20:34.035583Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Searching vector store for query: 'Find patients with poor medication adherence notes...' (top_k=5)", "module": "vector_store", "function": "search", "line": 69}
{"timestamp": "2026-01-08T09:20:34.035927Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Executing query: Find patients with poor medication adherence notes", "module": "retrieve", "function": "_get_relevant_documents", "line": 223}
{"timestamp": "2026-01-08T09:20:37.053073Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Reranking 79 documents for query: 'Find patients with poor medication adherence notes'", "module": "retrieve", "function": "_get_relevant_documents", "line": 257}
{"timestamp": "2026-01-08T09:20:38.525308Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Returning 10 reranked documents.", "module": "retrieve", "function": "_get_relevant_documents", "line": 267}
{"timestamp": "2026-01-08T09:20:38.525638Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Retrieved 10 documents from vector store", "module": "vector_store", "function": "search", "line": 84}
{"timestamp": "2026-01-08T09:20:39.069374Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:20:46.255045Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=0b1c3e74-4261-40bc-8359-ce9bbbcaec78, duration=18.11s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:21:05.724212Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=54", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:21:05.724600Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=460ab2e4-639a-42db-a6d7-30942418bfd9): '\"Find patients who were referred but not yet enrolled\"...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:21:06.786307Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:21:06.963639Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Find patients who were referred but not yet enrolled...'", "module": "sql_service", "function": "query", "line": 396}
{"timestamp": "2026-01-08T09:21:06.963869Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udd0d Analyzing natural language query", "module": "sql_service", "function": "_is_simple_query", "line": 338}
{"timestamp": "2026-01-08T09:21:06.964187Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query classified as COMPLEX (pattern=False, complexity=False, multi_table=False)", "module": "sql_service", "function": "_is_simple_query", "line": 381}
{"timestamp": "2026-01-08T09:21:06.964278Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Complex query detected - using full agent", "module": "sql_service", "function": "query", "line": 403}
{"timestamp": "2026-01-08T09:21:06.964352Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 539}
{"timestamp": "2026-01-08T09:21:06.964414Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL AGENT EXECUTION TRACE:", "module": "sql_service", "function": "_execute_with_agent", "line": 540}
{"timestamp": "2026-01-08T09:21:06.964469Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 541}
{"timestamp": "2026-01-08T09:21:07.608578Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:21:08.324654Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:21:09.246037Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:21:12.421271Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:21:14.876580Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:21:20.524904Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:21:25.861410Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 567}
{"timestamp": "2026-01-08T09:21:25.861592Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL query completed. Result length: 338 chars", "module": "sql_service", "function": "_execute_with_agent", "line": 568}
{"timestamp": "2026-01-08T09:21:25.861688Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: Here are some patients who were referred but not yet enrolled:\n\n1. **Patient ID:** 4342, **Name:** HANK G, **Source Refer:** Y\n2. **Patient ID:** 4348, **Name:** KUBY H, **Source Refer:** Y\n3. **Patient ID:** 4351, **Name:** TOM J, **Source Refer:** Y\n\nThese patients have a source of referral but do...", "module": "sql_service", "function": "_execute_with_agent", "line": 570}
{"timestamp": "2026-01-08T09:21:25.861743Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 571}
{"timestamp": "2026-01-08T09:21:26.447814Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:21:29.101796Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=460ab2e4-639a-42db-a6d7-30942418bfd9, duration=23.38s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:22:11.646296Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=68", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:22:11.647338Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=437b1e9b-2f45-4dab-a828-ef21f1e04874): '\"Find cases where treatment plans were modified due to side effects\"...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:22:12.331492Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:22:12.571943Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Searching vector store for query: 'treatment plans modified due to side effects...' (top_k=5)", "module": "vector_store", "function": "search", "line": 69}
{"timestamp": "2026-01-08T09:22:12.572303Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Executing query: treatment plans modified due to side effects", "module": "retrieve", "function": "_get_relevant_documents", "line": 223}
{"timestamp": "2026-01-08T09:22:13.148572Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Reranking 53 documents for query: 'treatment plans modified due to side effects'", "module": "retrieve", "function": "_get_relevant_documents", "line": 257}
{"timestamp": "2026-01-08T09:22:13.939280Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Returning 10 reranked documents.", "module": "retrieve", "function": "_get_relevant_documents", "line": 267}
{"timestamp": "2026-01-08T09:22:13.939423Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Retrieved 10 documents from vector store", "module": "vector_store", "function": "search", "line": 84}
{"timestamp": "2026-01-08T09:22:14.901682Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:22:19.816619Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=437b1e9b-2f45-4dab-a828-ef21f1e04874, duration=8.17s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:22:30.368350Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=64", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:22:30.368575Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=306fb1c5-01f9-4991-95d2-063faf850acd): '\"How many smokers have uncontrolled hypertension (BP > 140/90)?\"...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:22:32.136721Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:22:32.341075Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Count patients with systolic BP > 140 or diastolic BP > 90....'", "module": "sql_service", "function": "query", "line": 396}
{"timestamp": "2026-01-08T09:22:32.341266Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udd0d Analyzing natural language query", "module": "sql_service", "function": "_is_simple_query", "line": 338}
{"timestamp": "2026-01-08T09:22:32.341414Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query classified as SIMPLE (natural language)", "module": "sql_service", "function": "_is_simple_query", "line": 379}
{"timestamp": "2026-01-08T09:22:32.341490Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Detected simple query - using optimized execution path", "module": "sql_service", "function": "query", "line": 400}
{"timestamp": "2026-01-08T09:22:32.341558Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_optimized", "line": 412}
{"timestamp": "2026-01-08T09:22:32.341616Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 OPTIMIZED SQL EXECUTION:", "module": "sql_service", "function": "_execute_optimized", "line": 413}
{"timestamp": "2026-01-08T09:22:32.341666Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_optimized", "line": 414}
{"timestamp": "2026-01-08T09:22:32.341720Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " API Call 1: Generate SQL query with targeted schema", "module": "sql_service", "function": "_execute_optimized", "line": 429}
{"timestamp": "2026-01-08T09:22:32.341845Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udccb Selected relevant tables for query: patient, bp_log, patient_tracker", "module": "sql_service", "function": "_get_relevant_schema", "line": 281}
{"timestamp": "2026-01-08T09:22:34.034166Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:22:34.037025Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL to execute: SELECT COUNT(DISTINCT pt.patient_id)\nFROM bp_log bp\nJOIN patient_tracker pt ON bp.patient_track_id = pt.id\nWHERE bp.avg_systolic > 140 OR bp.avg_diastolic > 90;...", "module": "sql_service", "function": "_execute_optimized", "line": 463}
{"timestamp": "2026-01-08T09:22:34.037191Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Executing query against database (no API call)", "module": "sql_service", "function": "_execute_optimized", "line": 471}
{"timestamp": "2026-01-08T09:22:34.059770Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query result: [(1115,)]", "module": "sql_service", "function": "_execute_optimized", "line": 473}
{"timestamp": "2026-01-08T09:22:34.059884Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " API Call 2: Format natural language response", "module": "sql_service", "function": "_execute_optimized", "line": 476}
{"timestamp": "2026-01-08T09:22:34.798469Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:22:34.813412Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_optimized", "line": 491}
{"timestamp": "2026-01-08T09:22:34.813698Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Optimized execution completed with 2 API call(s) (vs 7 with agent)", "module": "sql_service", "function": "_execute_optimized", "line": 492}
{"timestamp": "2026-01-08T09:22:34.815153Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: There are 1,115 patients with either an average systolic blood pressure greater than 140 or an average diastolic blood pressure greater than 90....", "module": "sql_service", "function": "_execute_optimized", "line": 493}
{"timestamp": "2026-01-08T09:22:34.815258Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_optimized", "line": 494}
{"timestamp": "2026-01-08T09:22:34.816066Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Searching vector store for query: 'Find patients who are smokers....' (top_k=5)", "module": "vector_store", "function": "search", "line": 69}
{"timestamp": "2026-01-08T09:22:34.816250Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Executing query: Find patients who are smokers.", "module": "retrieve", "function": "_get_relevant_documents", "line": 223}
{"timestamp": "2026-01-08T09:22:35.003637Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Reranking 76 documents for query: 'Find patients who are smokers.'", "module": "retrieve", "function": "_get_relevant_documents", "line": 257}
{"timestamp": "2026-01-08T09:22:36.060750Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Returning 10 reranked documents.", "module": "retrieve", "function": "_get_relevant_documents", "line": 267}
{"timestamp": "2026-01-08T09:22:36.060853Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Retrieved 10 documents from vector store", "module": "vector_store", "function": "search", "line": 84}
{"timestamp": "2026-01-08T09:22:36.680078Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:22:43.047825Z", "level": "WARNING", "logger": "backend.services.agent_service", "message": "Failed to parse agent JSON output: Expecting ',' delimiter: line 7 column 34 (char 216)", "module": "agent_service", "function": "_parse_agent_output", "line": 310}
{"timestamp": "2026-01-08T09:22:43.048188Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=306fb1c5-01f9-4991-95d2-063faf850acd, duration=12.68s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:23:05.081394Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=83", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:23:05.082351Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=1edbb359-4027-463b-8255-d83d88cc5f49): '\"Which sites have both high screening volumes and high patient satisfaction notes?\"...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:23:06.599722Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:23:06.715613Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'List sites with the highest screening volumes from v_analytics_screening....'", "module": "sql_service", "function": "query", "line": 396}
{"timestamp": "2026-01-08T09:23:06.715694Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udd0d Analyzing natural language query", "module": "sql_service", "function": "_is_simple_query", "line": 338}
{"timestamp": "2026-01-08T09:23:06.715834Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query classified as COMPLEX (pattern=False, complexity=False, multi_table=False)", "module": "sql_service", "function": "_is_simple_query", "line": 381}
{"timestamp": "2026-01-08T09:23:06.715877Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Complex query detected - using full agent", "module": "sql_service", "function": "query", "line": 403}
{"timestamp": "2026-01-08T09:23:06.715916Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 539}
{"timestamp": "2026-01-08T09:23:06.715953Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL AGENT EXECUTION TRACE:", "module": "sql_service", "function": "_execute_with_agent", "line": 540}
{"timestamp": "2026-01-08T09:23:06.715985Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 541}
{"timestamp": "2026-01-08T09:23:07.698549Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:23:08.375225Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:23:09.408072Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:23:12.296299Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:23:13.257752Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:23:14.790163Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:23:15.956994Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 567}
{"timestamp": "2026-01-08T09:23:15.957177Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL query completed. Result length: 452 chars", "module": "sql_service", "function": "_execute_with_agent", "line": 568}
{"timestamp": "2026-01-08T09:23:15.957292Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: Here are the sites with the highest screening volumes:\n\n1. AutoSiteBangladesh5One - 1,274 screenings\n2. Nilphamari Sadar Upazila Health Complex - 425 screenings\n3. AutoSitescreeningbangladesh9One - 412 screenings\n4. Patgram UHC - 259 screenings\n5. Hatibandha UHC - 223 screenings\n6. Debiganj UHC - 21...", "module": "sql_service", "function": "_execute_with_agent", "line": 570}
{"timestamp": "2026-01-08T09:23:15.957369Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 571}
{"timestamp": "2026-01-08T09:23:15.958231Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Searching vector store for query: 'Find sites with high patient satisfaction notes....' (top_k=5)", "module": "vector_store", "function": "search", "line": 69}
{"timestamp": "2026-01-08T09:23:15.958735Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Executing query: Find sites with high patient satisfaction notes.", "module": "retrieve", "function": "_get_relevant_documents", "line": 223}
{"timestamp": "2026-01-08T09:23:16.316552Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Reranking 75 documents for query: 'Find sites with high patient satisfaction notes.'", "module": "retrieve", "function": "_get_relevant_documents", "line": 257}
{"timestamp": "2026-01-08T09:23:17.253241Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Returning 10 reranked documents.", "module": "retrieve", "function": "_get_relevant_documents", "line": 267}
{"timestamp": "2026-01-08T09:23:17.253414Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Retrieved 10 documents from vector store", "module": "vector_store", "function": "search", "line": 84}
{"timestamp": "2026-01-08T09:23:17.826213Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:23:24.965602Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=1edbb359-4027-463b-8255-d83d88cc5f49, duration=19.88s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:24:12.662065Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=79", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:24:12.662834Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=b6b5b50a-f724-4c91-b5b5-840117f8f73a): 'What are the doctor's observations for patients with uncontrolled hypertension?...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:24:13.660602Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:24:13.898601Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Searching vector store for query: 'doctor's observations for patients with uncontrolled hypertension...' (top_k=5)", "module": "vector_store", "function": "search", "line": 69}
{"timestamp": "2026-01-08T09:24:13.899113Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Executing query: doctor's observations for patients with uncontrolled hypertension", "module": "retrieve", "function": "_get_relevant_documents", "line": 223}
{"timestamp": "2026-01-08T09:24:14.501661Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Reranking 76 documents for query: 'doctor's observations for patients with uncontrolled hypertension'", "module": "retrieve", "function": "_get_relevant_documents", "line": 257}
{"timestamp": "2026-01-08T09:24:15.795913Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Returning 10 reranked documents.", "module": "retrieve", "function": "_get_relevant_documents", "line": 267}
{"timestamp": "2026-01-08T09:24:15.796043Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Retrieved 10 documents from vector store", "module": "vector_store", "function": "search", "line": 84}
{"timestamp": "2026-01-08T09:24:16.331921Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:24:22.878250Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=b6b5b50a-f724-4c91-b5b5-840117f8f73a, duration=10.22s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:24:34.449831Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=69", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:24:34.450107Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=13e9c8d4-3925-4eca-a2a3-027cc81db75e): 'List the latest BP readings for patients who have 'refused medication...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:24:35.784008Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:24:36.113711Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Searching vector store for query: 'Find patients who have 'refused medication' in their clinical notes....' (top_k=5)", "module": "vector_store", "function": "search", "line": 69}
{"timestamp": "2026-01-08T09:24:36.114216Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Executing query: Find patients who have 'refused medication' in their clinical notes.", "module": "retrieve", "function": "_get_relevant_documents", "line": 223}
{"timestamp": "2026-01-08T09:24:36.316311Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Reranking 75 documents for query: 'Find patients who have 'refused medication' in their clinical notes.'", "module": "retrieve", "function": "_get_relevant_documents", "line": 257}
{"timestamp": "2026-01-08T09:24:37.077577Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Returning 10 reranked documents.", "module": "retrieve", "function": "_get_relevant_documents", "line": 267}
{"timestamp": "2026-01-08T09:24:37.077689Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Retrieved 10 documents from vector store", "module": "vector_store", "function": "search", "line": 84}
{"timestamp": "2026-01-08T09:24:37.078015Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'List the latest BP readings for patients....'", "module": "sql_service", "function": "query", "line": 396}
{"timestamp": "2026-01-08T09:24:37.078056Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udd0d Analyzing natural language query", "module": "sql_service", "function": "_is_simple_query", "line": 338}
{"timestamp": "2026-01-08T09:24:37.078145Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query classified as COMPLEX (pattern=False, complexity=False, multi_table=False)", "module": "sql_service", "function": "_is_simple_query", "line": 381}
{"timestamp": "2026-01-08T09:24:37.078165Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Complex query detected - using full agent", "module": "sql_service", "function": "query", "line": 403}
{"timestamp": "2026-01-08T09:24:37.078186Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 539}
{"timestamp": "2026-01-08T09:24:37.078204Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL AGENT EXECUTION TRACE:", "module": "sql_service", "function": "_execute_with_agent", "line": 540}
{"timestamp": "2026-01-08T09:24:37.078222Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 541}
{"timestamp": "2026-01-08T09:24:37.838888Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:24:38.966102Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:24:39.747072Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:24:41.228469Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:24:41.932573Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:24:42.960458Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:24:45.076394Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 567}
{"timestamp": "2026-01-08T09:24:45.076682Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL query completed. Result length: 703 chars", "module": "sql_service", "function": "_execute_with_agent", "line": 568}
{"timestamp": "2026-01-08T09:24:45.076821Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: Here are the latest blood pressure readings for patients:\n\n1. Systolic: 143, Diastolic: 115, Date: 2025-10-24 09:31:38\n2. Systolic: 218, Diastolic: 167, Date: 2025-10-24 09:28:54\n3. Systolic: 193, Diastolic: 145, Date: 2025-10-24 08:09:10\n4. Systolic: 140, Diastolic: 90, Date: 2025-10-13 07:16:34\n5....", "module": "sql_service", "function": "_execute_with_agent", "line": 570}
{"timestamp": "2026-01-08T09:24:45.076964Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 571}
{"timestamp": "2026-01-08T09:24:45.727572Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:24:50.835630Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=13e9c8d4-3925-4eca-a2a3-027cc81db75e, duration=16.39s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:29:00.125373Z", "level": "INFO", "logger": "app", "message": "Shutting down application", "module": "app", "function": "lifespan", "line": 34}
{"timestamp": "2026-01-08T09:29:04.786240Z", "level": "INFO", "logger": "app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-08T09:29:04.786282Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-08T09:29:04.786304Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-08T09:29:04.786372Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-08T09:29:04.801495Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-08T09:29:04.801538Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-08T09:29:06.294904Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-08T09:29:06.294956Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-08T09:29:06.294981Z", "level": "INFO", "logger": "app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-08T09:29:06.294999Z", "level": "INFO", "logger": "app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-08T09:29:35.568099Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login attempt for user: admin", "module": "auth", "function": "login", "line": 27}
{"timestamp": "2026-01-08T09:29:35.569101Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login successful for user: admin", "module": "auth", "function": "login", "line": 50}
{"timestamp": "2026-01-08T09:29:35.570327Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=51", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:29:35.570359Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Initializing AgentService", "module": "agent_service", "function": "__init__", "line": 121}
{"timestamp": "2026-01-08T09:29:35.570384Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Connecting to database at postgresql://admin:admin@127.0.0.1:5432/Spice_BD", "module": "sql_service", "function": "__init__", "line": 26}
{"timestamp": "2026-01-08T09:29:35.914116Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Database connection established with view support", "module": "sql_service", "function": "__init__", "line": 46}
{"timestamp": "2026-01-08T09:29:36.115066Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Cached schema for 39 relevant tables out of 114 total", "module": "sql_service", "function": "_cache_schema", "line": 230}
{"timestamp": "2026-01-08T09:29:36.115123Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Relevant tables: bp_log, current_medication, diagnosis, glucose_log, lab_test, lab_test_result, lab_test_result_range, medical_compliance, medication_country_detail, patient...", "module": "sql_service", "function": "_cache_schema", "line": 231}
{"timestamp": "2026-01-08T09:29:36.229645Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "SQL agent initialized successfully with 39 cached tables", "module": "sql_service", "function": "__init__", "line": 78}
{"timestamp": "2026-01-08T09:29:36.234102Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "AgentService initialized successfully", "module": "agent_service", "function": "__init__", "line": 184}
{"timestamp": "2026-01-08T09:29:36.234163Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=b364d952-3b78-47a2-886f-d9c271a9e546): 'How many patients were screened for blood pressure?...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:29:37.044640Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:29:38.363893Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Count the number of patients who were screened for blood pressure using the v_analytics_screening ta...'", "module": "sql_service", "function": "query", "line": 396}
{"timestamp": "2026-01-08T09:29:38.363963Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udd0d Analyzing natural language query", "module": "sql_service", "function": "_is_simple_query", "line": 338}
{"timestamp": "2026-01-08T09:29:38.364153Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query classified as COMPLEX (pattern=True, complexity=False, multi_table=True)", "module": "sql_service", "function": "_is_simple_query", "line": 381}
{"timestamp": "2026-01-08T09:29:38.364362Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Complex query detected - using full agent", "module": "sql_service", "function": "query", "line": 403}
{"timestamp": "2026-01-08T09:29:38.364430Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 539}
{"timestamp": "2026-01-08T09:29:38.364460Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL AGENT EXECUTION TRACE:", "module": "sql_service", "function": "_execute_with_agent", "line": 540}
{"timestamp": "2026-01-08T09:29:38.364484Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 541}
{"timestamp": "2026-01-08T09:29:39.129386Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:29:39.761134Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:29:40.565141Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:29:41.625562Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:29:43.111419Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:29:44.041750Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:29:44.632733Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 567}
{"timestamp": "2026-01-08T09:29:44.632819Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL query completed. Result length: 135 chars", "module": "sql_service", "function": "_execute_with_agent", "line": 568}
{"timestamp": "2026-01-08T09:29:44.632868Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: The number of patients who were screened for blood pressure with a workflow status of 'NCD' and have a blood pressure reading is 5,332....", "module": "sql_service", "function": "_execute_with_agent", "line": 570}
{"timestamp": "2026-01-08T09:29:44.632906Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 571}
{"timestamp": "2026-01-08T09:29:45.113403Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:29:47.583540Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=b364d952-3b78-47a2-886f-d9c271a9e546, duration=11.35s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:29:47.590303Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=45", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:29:47.590476Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=52289a5e-8d6d-45f9-a438-80b92438bf93): 'What is the total number of crisis referrals?...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:29:48.221626Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:29:48.534310Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Count the total number of crisis referrals from v_analytics_screening where crisis_referral_status =...'", "module": "sql_service", "function": "query", "line": 396}
{"timestamp": "2026-01-08T09:29:48.534505Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udd0d Analyzing natural language query", "module": "sql_service", "function": "_is_simple_query", "line": 338}
{"timestamp": "2026-01-08T09:29:48.535065Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query classified as SIMPLE (natural language)", "module": "sql_service", "function": "_is_simple_query", "line": 379}
{"timestamp": "2026-01-08T09:29:48.535213Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Detected simple query - using optimized execution path", "module": "sql_service", "function": "query", "line": 400}
{"timestamp": "2026-01-08T09:29:48.535294Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_optimized", "line": 412}
{"timestamp": "2026-01-08T09:29:48.535356Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 OPTIMIZED SQL EXECUTION:", "module": "sql_service", "function": "_execute_optimized", "line": 413}
{"timestamp": "2026-01-08T09:29:48.535454Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_optimized", "line": 414}
{"timestamp": "2026-01-08T09:29:48.535589Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " API Call 1: Generate SQL query with targeted schema", "module": "sql_service", "function": "_execute_optimized", "line": 429}
{"timestamp": "2026-01-08T09:29:48.535725Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udccb Selected relevant tables for query: v_analytics_screening", "module": "sql_service", "function": "_get_relevant_schema", "line": 281}
{"timestamp": "2026-01-08T09:29:49.345439Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:29:49.348418Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL to execute: SELECT COUNT(*) \nFROM v_analytics_screening \nWHERE crisis_referral_status = 'Crisis Referral';...", "module": "sql_service", "function": "_execute_optimized", "line": 463}
{"timestamp": "2026-01-08T09:29:49.348618Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Executing query against database (no API call)", "module": "sql_service", "function": "_execute_optimized", "line": 471}
{"timestamp": "2026-01-08T09:29:49.367710Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query result: [(1219,)]", "module": "sql_service", "function": "_execute_optimized", "line": 473}
{"timestamp": "2026-01-08T09:29:49.367877Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " API Call 2: Format natural language response", "module": "sql_service", "function": "_execute_optimized", "line": 476}
{"timestamp": "2026-01-08T09:29:50.371446Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:29:50.374484Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_optimized", "line": 491}
{"timestamp": "2026-01-08T09:29:50.374644Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Optimized execution completed with 2 API call(s) (vs 7 with agent)", "module": "sql_service", "function": "_execute_optimized", "line": 492}
{"timestamp": "2026-01-08T09:29:50.374745Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: There are a total of 1,219 crisis referrals recorded in the v_analytics_screening database....", "module": "sql_service", "function": "_execute_optimized", "line": 493}
{"timestamp": "2026-01-08T09:29:50.374822Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_optimized", "line": 494}
{"timestamp": "2026-01-08T09:29:50.987094Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:29:52.726540Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=52289a5e-8d6d-45f9-a438-80b92438bf93, duration=5.14s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:29:52.731936Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=63", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:29:52.732084Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=b7a6ba5f-d664-42d7-860b-aac88542b432): 'How many patients were referred due to elevated blood pressure?...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:29:53.301595Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:29:53.656290Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Count the number of patients referred due to elevated blood pressure from v_analytics_screening wher...'", "module": "sql_service", "function": "query", "line": 396}
{"timestamp": "2026-01-08T09:29:53.656439Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udd0d Analyzing natural language query", "module": "sql_service", "function": "_is_simple_query", "line": 338}
{"timestamp": "2026-01-08T09:29:53.656545Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query classified as COMPLEX (pattern=True, complexity=False, multi_table=True)", "module": "sql_service", "function": "_is_simple_query", "line": 381}
{"timestamp": "2026-01-08T09:29:53.656588Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Complex query detected - using full agent", "module": "sql_service", "function": "query", "line": 403}
{"timestamp": "2026-01-08T09:29:53.656630Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 539}
{"timestamp": "2026-01-08T09:29:53.656669Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL AGENT EXECUTION TRACE:", "module": "sql_service", "function": "_execute_with_agent", "line": 540}
{"timestamp": "2026-01-08T09:29:53.656711Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 541}
{"timestamp": "2026-01-08T09:29:54.291819Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:29:55.081356Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:29:56.514523Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:29:57.436234Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:29:58.154387Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:29:58.974942Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:29:59.104003Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 567}
{"timestamp": "2026-01-08T09:29:59.104119Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL query completed. Result length: 102 chars", "module": "sql_service", "function": "_execute_with_agent", "line": 568}
{"timestamp": "2026-01-08T09:29:59.104169Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: There are 2,139 patients referred due to elevated blood pressure in the `v_analytics_screening` table....", "module": "sql_service", "function": "_execute_with_agent", "line": 570}
{"timestamp": "2026-01-08T09:29:59.104217Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 571}
{"timestamp": "2026-01-08T09:29:59.580478Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:30:01.544078Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=b7a6ba5f-d664-42d7-860b-aac88542b432, duration=8.81s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:30:01.545610Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=55", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:30:01.545661Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=2f923627-3f83-4f11-8fda-61dc452a4982): 'Show me the breakdown of enrolled patients by condition...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:30:02.352560Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:30:02.559206Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Show the breakdown of enrolled patients by condition using the v_analytics_enrollment table....'", "module": "sql_service", "function": "query", "line": 396}
{"timestamp": "2026-01-08T09:30:02.559303Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udd0d Analyzing natural language query", "module": "sql_service", "function": "_is_simple_query", "line": 338}
{"timestamp": "2026-01-08T09:30:02.560110Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query classified as COMPLEX (pattern=False, complexity=False, multi_table=True)", "module": "sql_service", "function": "_is_simple_query", "line": 381}
{"timestamp": "2026-01-08T09:30:02.560154Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Complex query detected - using full agent", "module": "sql_service", "function": "query", "line": 403}
{"timestamp": "2026-01-08T09:30:02.560191Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 539}
{"timestamp": "2026-01-08T09:30:02.560226Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL AGENT EXECUTION TRACE:", "module": "sql_service", "function": "_execute_with_agent", "line": 540}
{"timestamp": "2026-01-08T09:30:02.560257Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 541}
{"timestamp": "2026-01-08T09:30:03.482172Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:30:04.651536Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:30:06.447567Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:30:07.680790Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:30:08.600303Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:30:09.518979Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:30:09.860151Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 567}
{"timestamp": "2026-01-08T09:30:09.860230Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL query completed. Result length: 193 chars", "module": "sql_service", "function": "_execute_with_agent", "line": 568}
{"timestamp": "2026-01-08T09:30:09.860274Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: Here is the breakdown of enrolled patients by condition:\n\n1. Provisional Diagnosis: 6,666 patients\n2. Co-morbid (DBM + HTN): 734 patients\n3. Hypertension: 368 patients\n4. Diabetes: 138 patients...", "module": "sql_service", "function": "_execute_with_agent", "line": 570}
{"timestamp": "2026-01-08T09:30:09.860317Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 571}
{"timestamp": "2026-01-08T09:30:10.416961Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:30:15.186037Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=2f923627-3f83-4f11-8fda-61dc452a4982, duration=13.64s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:30:15.191486Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=32", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:30:15.191636Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=341e3c29-69e9-426c-b797-ded854e4c247): 'What is the HTN prevalence rate?...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:30:16.072546Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:30:16.842512Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Calculate the HTN prevalence rate using the formula: (Elevated BP Referrals / Screened for BP) * 100...'", "module": "sql_service", "function": "query", "line": 396}
{"timestamp": "2026-01-08T09:30:16.842734Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udd0d Analyzing natural language query", "module": "sql_service", "function": "_is_simple_query", "line": 338}
{"timestamp": "2026-01-08T09:30:16.842884Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query classified as COMPLEX (pattern=False, complexity=False, multi_table=False)", "module": "sql_service", "function": "_is_simple_query", "line": 381}
{"timestamp": "2026-01-08T09:30:16.842950Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Complex query detected - using full agent", "module": "sql_service", "function": "query", "line": 403}
{"timestamp": "2026-01-08T09:30:16.843003Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 539}
{"timestamp": "2026-01-08T09:30:16.843049Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL AGENT EXECUTION TRACE:", "module": "sql_service", "function": "_execute_with_agent", "line": 540}
{"timestamp": "2026-01-08T09:30:16.843093Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 541}
{"timestamp": "2026-01-08T09:30:20.477843Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:30:24.986942Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:30:26.214016Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:30:32.253566Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:30:33.277740Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:30:34.628807Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:30:34.910181Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 567}
{"timestamp": "2026-01-08T09:30:34.910367Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL query completed. Result length: 114 chars", "module": "sql_service", "function": "_execute_with_agent", "line": 568}
{"timestamp": "2026-01-08T09:30:34.910493Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: The HTN prevalence rate, calculated as the percentage of elevated BP referrals among those screened for BP, is 0%....", "module": "sql_service", "function": "_execute_with_agent", "line": 570}
{"timestamp": "2026-01-08T09:30:34.910595Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 571}
{"timestamp": "2026-01-08T09:30:35.428655Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:30:38.025607Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=341e3c29-69e9-426c-b797-ded854e4c247, duration=22.83s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:30:38.030814Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=32", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:30:38.030943Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=a7bba373-0eaf-4f2e-a053-88c0ec635001): 'What is the DBM prevalence rate?...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:30:38.667344Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:30:39.219767Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Calculate the DBM prevalence rate using the formula: (Elevated BG Referrals / Screened for BG) * 100...'", "module": "sql_service", "function": "query", "line": 396}
{"timestamp": "2026-01-08T09:30:39.219936Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udd0d Analyzing natural language query", "module": "sql_service", "function": "_is_simple_query", "line": 338}
{"timestamp": "2026-01-08T09:30:39.220117Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query classified as COMPLEX (pattern=False, complexity=False, multi_table=False)", "module": "sql_service", "function": "_is_simple_query", "line": 381}
{"timestamp": "2026-01-08T09:30:39.220247Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Complex query detected - using full agent", "module": "sql_service", "function": "query", "line": 403}
{"timestamp": "2026-01-08T09:30:39.220338Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 539}
{"timestamp": "2026-01-08T09:30:39.220400Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL AGENT EXECUTION TRACE:", "module": "sql_service", "function": "_execute_with_agent", "line": 540}
{"timestamp": "2026-01-08T09:30:39.220454Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 541}
{"timestamp": "2026-01-08T09:30:39.894275Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:30:40.653839Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:30:41.572932Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:30:43.723569Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:30:44.545197Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:30:45.976078Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:30:46.072484Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 567}
{"timestamp": "2026-01-08T09:30:46.072557Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL query completed. Result length: 48 chars", "module": "sql_service", "function": "_execute_with_agent", "line": 568}
{"timestamp": "2026-01-08T09:30:46.072599Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: The DBM prevalence rate is approximately 89.97%....", "module": "sql_service", "function": "_execute_with_agent", "line": 570}
{"timestamp": "2026-01-08T09:30:46.072632Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 571}
{"timestamp": "2026-01-08T09:30:46.553955Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:30:49.385733Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=a7bba373-0eaf-4f2e-a053-88c0ec635001, duration=11.35s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:30:49.391246Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=43", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:30:49.391392Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=6ea62b80-34e6-438c-a501-8d662b098d59): 'What symptoms indicate hypertensive crisis?...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:30:49.870145Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:30:52.913015Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=6ea62b80-34e6-438c-a501-8d662b098d59, duration=3.52s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:30:52.917301Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=34", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:30:52.917421Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=401706b9-6183-4cfd-9acc-f31b8073e0f8): 'What does PHQ-9 screening measure?...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:30:53.437270Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:30:55.512260Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=401706b9-6183-4cfd-9acc-f31b8073e0f8, duration=2.59s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:30:55.514589Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=50", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:30:55.514673Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=349b14e4-4051-4403-aa42-910fe9251f3a): 'Find patients with poor medication adherence notes...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:30:57.139539Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:30:57.596383Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "\u26a1 Lazy loading vector store on first use...", "module": "agent_service", "function": "vector_store", "line": 190}
{"timestamp": "2026-01-08T09:30:57.596624Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Initializing vector store service", "module": "vector_store", "function": "__init__", "line": 30}
{"timestamp": "2026-01-08T09:30:57.597210Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Looking for RAG config at: /Users/adityanbhatt/fhir_rag/backend/config/embedding_config.yaml", "module": "vector_store", "function": "__init__", "line": 41}
{"timestamp": "2026-01-08T09:30:57.597364Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Loading RAG config from /Users/adityanbhatt/fhir_rag/backend/config/embedding_config.yaml", "module": "vector_store", "function": "__init__", "line": 46}
{"timestamp": "2026-01-08T09:30:57.604974Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Loaded RAG config successfully", "module": "vector_store", "function": "__init__", "line": 51}
{"timestamp": "2026-01-08T09:30:57.605423Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Resolved chroma_path to: /Users/adityanbhatt/fhir_rag/backend/data/indexes/chroma_db_advanced", "module": "retrieve", "function": "_resolve_config_paths", "line": 155}
{"timestamp": "2026-01-08T09:30:57.605566Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Resolved model_path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "retrieve", "function": "_resolve_config_paths", "line": 162}
{"timestamp": "2026-01-08T09:30:57.673804Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Loading docstore from /Users/adityanbhatt/fhir_rag/backend/data/indexes/chroma_db_advanced/parent_docstore.pkl with module remapping", "module": "retrieve", "function": "_load_docstore", "line": 284}
{"timestamp": "2026-01-08T09:30:58.167072Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Successfully loaded docstore with module remapping", "module": "retrieve", "function": "_load_docstore", "line": 286}
{"timestamp": "2026-01-08T09:30:58.168405Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Loading 154161 parent documents for BM25...", "module": "retrieve", "function": "_setup_retrievers", "line": 175}
{"timestamp": "2026-01-08T09:30:58.191091Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Filtered to 59572 documents from relevant tables for BM25 index.", "module": "retrieve", "function": "_setup_retrievers", "line": 185}
{"timestamp": "2026-01-08T09:30:59.019256Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "BM25Retriever initialized on relevant tables.", "module": "retrieve", "function": "_setup_retrievers", "line": 196}
{"timestamp": "2026-01-08T09:30:59.020639Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Initializing reranker: BAAI/bge-reranker-base", "module": "retrieve", "function": "__init__", "line": 137}
{"timestamp": "2026-01-08T09:31:01.149223Z", "level": "INFO", "logger": "sentence_transformers.cross_encoder.CrossEncoder", "message": "Use pytorch device: mps", "module": "CrossEncoder", "function": "__init__", "line": 222}
{"timestamp": "2026-01-08T09:31:02.265634Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Advanced RAG Retriever initialized successfully.", "module": "retrieve", "function": "__init__", "line": 143}
{"timestamp": "2026-01-08T09:31:02.265857Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Vector store initialized successfully", "module": "vector_store", "function": "__init__", "line": 55}
{"timestamp": "2026-01-08T09:31:02.266033Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "\u2705 Vector store loaded", "module": "agent_service", "function": "vector_store", "line": 192}
{"timestamp": "2026-01-08T09:31:02.266141Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Searching vector store for query: 'Find patients with poor medication adherence notes...' (top_k=5)", "module": "vector_store", "function": "search", "line": 69}
{"timestamp": "2026-01-08T09:31:02.266618Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Executing query: Find patients with poor medication adherence notes", "module": "retrieve", "function": "_get_relevant_documents", "line": 223}
{"timestamp": "2026-01-08T09:31:04.812722Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Reranking 79 documents for query: 'Find patients with poor medication adherence notes'", "module": "retrieve", "function": "_get_relevant_documents", "line": 257}
{"timestamp": "2026-01-08T09:31:05.969634Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Returning 10 reranked documents.", "module": "retrieve", "function": "_get_relevant_documents", "line": 267}
{"timestamp": "2026-01-08T09:31:05.969795Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Retrieved 10 documents from vector store", "module": "vector_store", "function": "search", "line": 84}
{"timestamp": "2026-01-08T09:31:06.663461Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:31:12.522406Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=349b14e4-4051-4403-aa42-910fe9251f3a, duration=17.01s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:31:12.525974Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=59", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:31:12.526040Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=29713d69-e07d-42ab-bd5c-bfb91206ba3b): 'Which patients have documented dizziness or blurred vision?...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:31:13.256509Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:31:13.808708Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Searching vector store for query: 'Find patients with documented dizziness or blurred vision in their clinical notes....' (top_k=5)", "module": "vector_store", "function": "search", "line": 69}
{"timestamp": "2026-01-08T09:31:13.809135Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Executing query: Find patients with documented dizziness or blurred vision in their clinical notes.", "module": "retrieve", "function": "_get_relevant_documents", "line": 223}
{"timestamp": "2026-01-08T09:31:14.007648Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Reranking 75 documents for query: 'Find patients with documented dizziness or blurred vision in their clinical notes.'", "module": "retrieve", "function": "_get_relevant_documents", "line": 257}
{"timestamp": "2026-01-08T09:31:14.869518Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Returning 10 reranked documents.", "module": "retrieve", "function": "_get_relevant_documents", "line": 267}
{"timestamp": "2026-01-08T09:31:14.869640Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Retrieved 10 documents from vector store", "module": "vector_store", "function": "search", "line": 84}
{"timestamp": "2026-01-08T09:31:15.397794Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:31:21.484846Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=29713d69-e07d-42ab-bd5c-bfb91206ba3b, duration=8.96s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:31:21.486627Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=78", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:31:21.486687Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=4939115b-04d6-43b0-a821-a961cb30e753): 'Find high-risk patients with multiple comorbidities and poor lifestyle factors...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:31:23.869932Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:31:23.895393Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Find patients with comorbid conditions of both Hypertension and Diabetes....'", "module": "sql_service", "function": "query", "line": 396}
{"timestamp": "2026-01-08T09:31:23.895463Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udd0d Analyzing natural language query", "module": "sql_service", "function": "_is_simple_query", "line": 338}
{"timestamp": "2026-01-08T09:31:23.895568Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query classified as COMPLEX (pattern=False, complexity=True, multi_table=False)", "module": "sql_service", "function": "_is_simple_query", "line": 381}
{"timestamp": "2026-01-08T09:31:23.895594Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Complex query detected - using full agent", "module": "sql_service", "function": "query", "line": 403}
{"timestamp": "2026-01-08T09:31:23.895618Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 539}
{"timestamp": "2026-01-08T09:31:23.895639Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL AGENT EXECUTION TRACE:", "module": "sql_service", "function": "_execute_with_agent", "line": 540}
{"timestamp": "2026-01-08T09:31:23.895660Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 541}
{"timestamp": "2026-01-08T09:31:25.199403Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:31:26.019209Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:31:27.145923Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:31:29.951807Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:31:33.596649Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:31:37.080299Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:31:37.404228Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 567}
{"timestamp": "2026-01-08T09:31:37.404436Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL query completed. Result length: 97 chars", "module": "sql_service", "function": "_execute_with_agent", "line": 568}
{"timestamp": "2026-01-08T09:31:37.404566Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: There are no patients in the database with comorbid conditions of both Hypertension and Diabetes....", "module": "sql_service", "function": "_execute_with_agent", "line": 570}
{"timestamp": "2026-01-08T09:31:37.404655Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 571}
{"timestamp": "2026-01-08T09:31:37.405436Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Searching vector store for query: 'Find patients with poor lifestyle factors such as smoking, poor diet, or lack of exercise....' (top_k=5)", "module": "vector_store", "function": "search", "line": 69}
{"timestamp": "2026-01-08T09:31:37.405718Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Executing query: Find patients with poor lifestyle factors such as smoking, poor diet, or lack of exercise.", "module": "retrieve", "function": "_get_relevant_documents", "line": 223}
{"timestamp": "2026-01-08T09:31:37.648581Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Reranking 87 documents for query: 'Find patients with poor lifestyle factors such as smoking, poor diet, or lack of exercise.'", "module": "retrieve", "function": "_get_relevant_documents", "line": 257}
{"timestamp": "2026-01-08T09:31:38.834693Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Returning 10 reranked documents.", "module": "retrieve", "function": "_get_relevant_documents", "line": 267}
{"timestamp": "2026-01-08T09:31:38.835090Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Retrieved 10 documents from vector store", "module": "vector_store", "function": "search", "line": 84}
{"timestamp": "2026-01-08T09:31:41.686756Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:31:45.212792Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=4939115b-04d6-43b0-a821-a961cb30e753, duration=23.73s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:31:45.214741Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=72", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:31:45.214800Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=fe778e2d-6506-41ca-af38-b204be4e67ba): 'Identify patients who may need intensive counseling based on their notes...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:31:45.990152Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:31:47.016691Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Searching vector store for query: 'Find patients with notes indicating need for intensive counseling, such as mentions of 'non-complian...' (top_k=5)", "module": "vector_store", "function": "search", "line": 69}
{"timestamp": "2026-01-08T09:31:47.017725Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Executing query: Find patients with notes indicating need for intensive counseling, such as mentions of 'non-compliance', 'refused medication', 'poor adherence', or 'lifestyle issues'.", "module": "retrieve", "function": "_get_relevant_documents", "line": 223}
{"timestamp": "2026-01-08T09:31:47.719822Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Reranking 93 documents for query: 'Find patients with notes indicating need for intensive counseling, such as mentions of 'non-compliance', 'refused medication', 'poor adherence', or 'lifestyle issues'.'", "module": "retrieve", "function": "_get_relevant_documents", "line": 257}
{"timestamp": "2026-01-08T09:31:49.061431Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Returning 10 reranked documents.", "module": "retrieve", "function": "_get_relevant_documents", "line": 267}
{"timestamp": "2026-01-08T09:31:49.061528Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Retrieved 10 documents from vector store", "module": "vector_store", "function": "search", "line": 84}
{"timestamp": "2026-01-08T09:31:49.588885Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:31:55.728501Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=fe778e2d-6506-41ca-af38-b204be4e67ba, duration=10.51s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:31:55.730365Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=48", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:31:55.730425Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=8dfaa475-efde-4c3c-8ef9-902db69e0893): 'How many smokers have uncontrolled hypertension?...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:31:56.946214Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:31:56.958542Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Count patients with uncontrolled hypertension....'", "module": "sql_service", "function": "query", "line": 396}
{"timestamp": "2026-01-08T09:31:56.958637Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udd0d Analyzing natural language query", "module": "sql_service", "function": "_is_simple_query", "line": 338}
{"timestamp": "2026-01-08T09:31:56.958722Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query classified as COMPLEX (pattern=True, complexity=True, multi_table=False)", "module": "sql_service", "function": "_is_simple_query", "line": 381}
{"timestamp": "2026-01-08T09:31:56.958762Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Complex query detected - using full agent", "module": "sql_service", "function": "query", "line": 403}
{"timestamp": "2026-01-08T09:31:56.958820Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 539}
{"timestamp": "2026-01-08T09:31:56.958856Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL AGENT EXECUTION TRACE:", "module": "sql_service", "function": "_execute_with_agent", "line": 540}
{"timestamp": "2026-01-08T09:31:56.958888Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 541}
{"timestamp": "2026-01-08T09:31:57.765442Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:31:58.685867Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:32:00.221291Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:32:02.374895Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:32:02.782249Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 429 Too Many Requests\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:32:02.783824Z", "level": "INFO", "logger": "openai._base_client", "message": "Retrying request to /chat/completions in 1.752000 seconds", "module": "_base_client", "function": "_sleep_for_retry", "line": 1071}
{"timestamp": "2026-01-08T09:32:05.618186Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:32:06.877583Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 429 Too Many Requests\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:32:06.878635Z", "level": "INFO", "logger": "openai._base_client", "message": "Retrying request to /chat/completions in 4.616000 seconds", "module": "_base_client", "function": "_sleep_for_retry", "line": 1071}
{"timestamp": "2026-01-08T09:32:11.895191Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 429 Too Many Requests\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:32:11.896225Z", "level": "INFO", "logger": "openai._base_client", "message": "Retrying request to /chat/completions in 1.602000 seconds", "module": "_base_client", "function": "_sleep_for_retry", "line": 1071}
{"timestamp": "2026-01-08T09:32:14.254665Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:32:14.291916Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 567}
{"timestamp": "2026-01-08T09:32:14.292083Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL query completed. Result length: 54 chars", "module": "sql_service", "function": "_execute_with_agent", "line": 568}
{"timestamp": "2026-01-08T09:32:14.292186Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: There are 879 patients with uncontrolled hypertension....", "module": "sql_service", "function": "_execute_with_agent", "line": 570}
{"timestamp": "2026-01-08T09:32:14.292264Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 571}
{"timestamp": "2026-01-08T09:32:14.293023Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Searching vector store for query: 'Find patients who are smokers....' (top_k=5)", "module": "vector_store", "function": "search", "line": 69}
{"timestamp": "2026-01-08T09:32:14.293291Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Executing query: Find patients who are smokers.", "module": "retrieve", "function": "_get_relevant_documents", "line": 223}
{"timestamp": "2026-01-08T09:32:14.630786Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Reranking 76 documents for query: 'Find patients who are smokers.'", "module": "retrieve", "function": "_get_relevant_documents", "line": 257}
{"timestamp": "2026-01-08T09:32:15.660839Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Returning 10 reranked documents.", "module": "retrieve", "function": "_get_relevant_documents", "line": 267}
{"timestamp": "2026-01-08T09:32:15.661253Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Retrieved 10 documents from vector store", "module": "vector_store", "function": "search", "line": 84}
{"timestamp": "2026-01-08T09:32:16.299979Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 429 Too Many Requests\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:32:16.301027Z", "level": "INFO", "logger": "openai._base_client", "message": "Retrying request to /chat/completions in 2.322000 seconds", "module": "_base_client", "function": "_sleep_for_retry", "line": 1071}
{"timestamp": "2026-01-08T09:32:19.676028Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:32:25.652219Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=8dfaa475-efde-4c3c-8ef9-902db69e0893, duration=29.92s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:32:25.656257Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=67", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:32:25.656323Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=966dfc84-ad0e-414d-bd2b-2cc724dd407b): 'Count crisis referrals and describe the typical symptoms documented...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:32:27.053042Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:32:27.068879Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Count the number of crisis referrals from v_analytics_screening....'", "module": "sql_service", "function": "query", "line": 396}
{"timestamp": "2026-01-08T09:32:27.068976Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udd0d Analyzing natural language query", "module": "sql_service", "function": "_is_simple_query", "line": 338}
{"timestamp": "2026-01-08T09:32:27.069077Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query classified as COMPLEX (pattern=False, complexity=False, multi_table=False)", "module": "sql_service", "function": "_is_simple_query", "line": 381}
{"timestamp": "2026-01-08T09:32:27.069121Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Complex query detected - using full agent", "module": "sql_service", "function": "query", "line": 403}
{"timestamp": "2026-01-08T09:32:27.069158Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 539}
{"timestamp": "2026-01-08T09:32:27.069194Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL AGENT EXECUTION TRACE:", "module": "sql_service", "function": "_execute_with_agent", "line": 540}
{"timestamp": "2026-01-08T09:32:27.069227Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 541}
{"timestamp": "2026-01-08T09:32:27.768527Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:32:28.385844Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:32:28.894264Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 429 Too Many Requests\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:32:28.895350Z", "level": "INFO", "logger": "openai._base_client", "message": "Retrying request to /chat/completions in 0.600000 seconds", "module": "_base_client", "function": "_sleep_for_retry", "line": 1071}
{"timestamp": "2026-01-08T09:32:29.897120Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 429 Too Many Requests\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:32:29.897397Z", "level": "INFO", "logger": "openai._base_client", "message": "Retrying request to /chat/completions in 0.487000 seconds", "module": "_base_client", "function": "_sleep_for_retry", "line": 1071}
{"timestamp": "2026-01-08T09:32:31.352118Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:32:32.474202Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:32:32.785710Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 429 Too Many Requests\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:32:32.786845Z", "level": "INFO", "logger": "openai._base_client", "message": "Retrying request to /chat/completions in 0.414000 seconds", "module": "_base_client", "function": "_sleep_for_retry", "line": 1071}
{"timestamp": "2026-01-08T09:32:34.099889Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:32:35.243619Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:32:35.368430Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 567}
{"timestamp": "2026-01-08T09:32:35.368613Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL query completed. Result length: 70 chars", "module": "sql_service", "function": "_execute_with_agent", "line": 568}
{"timestamp": "2026-01-08T09:32:35.368725Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: There are 7,906 crisis referrals in the `v_analytics_screening` table....", "module": "sql_service", "function": "_execute_with_agent", "line": 570}
{"timestamp": "2026-01-08T09:32:35.368810Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 571}
{"timestamp": "2026-01-08T09:32:35.369635Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Searching vector store for query: 'Find typical symptoms documented in crisis referrals....' (top_k=5)", "module": "vector_store", "function": "search", "line": 69}
{"timestamp": "2026-01-08T09:32:35.369938Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Executing query: Find typical symptoms documented in crisis referrals.", "module": "retrieve", "function": "_get_relevant_documents", "line": 223}
{"timestamp": "2026-01-08T09:32:35.550584Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Reranking 75 documents for query: 'Find typical symptoms documented in crisis referrals.'", "module": "retrieve", "function": "_get_relevant_documents", "line": 257}
{"timestamp": "2026-01-08T09:32:36.642474Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Returning 10 reranked documents.", "module": "retrieve", "function": "_get_relevant_documents", "line": 267}
{"timestamp": "2026-01-08T09:32:36.642899Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Retrieved 10 documents from vector store", "module": "vector_store", "function": "search", "line": 84}
{"timestamp": "2026-01-08T09:32:36.983646Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 429 Too Many Requests\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:32:36.984600Z", "level": "INFO", "logger": "openai._base_client", "message": "Retrying request to /chat/completions in 3.142000 seconds", "module": "_base_client", "function": "_sleep_for_retry", "line": 1071}
{"timestamp": "2026-01-08T09:32:40.466051Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 429 Too Many Requests\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:32:40.467063Z", "level": "INFO", "logger": "openai._base_client", "message": "Retrying request to /chat/completions in 1.660000 seconds", "module": "_base_client", "function": "_sleep_for_retry", "line": 1071}
{"timestamp": "2026-01-08T09:32:42.721881Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:32:46.765951Z", "level": "WARNING", "logger": "backend.services.agent_service", "message": "Failed to parse agent JSON output: Expecting ',' delimiter: line 7 column 34 (char 218)", "module": "agent_service", "function": "_parse_agent_output", "line": 310}
{"timestamp": "2026-01-08T09:32:46.766056Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=966dfc84-ad0e-414d-bd2b-2cc724dd407b, duration=21.11s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:32:46.767840Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=66", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:32:46.767898Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=ef226ad3-ca89-4a5d-b3e9-0223a5a51b06): 'Identify high-risk patients and summarize their clinical histories...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:32:47.326052Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:32:49.987354Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Identify patients with comorbid hypertension and diabetes....'", "module": "sql_service", "function": "query", "line": 396}
{"timestamp": "2026-01-08T09:32:49.987499Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udd0d Analyzing natural language query", "module": "sql_service", "function": "_is_simple_query", "line": 338}
{"timestamp": "2026-01-08T09:32:49.987640Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query classified as COMPLEX (pattern=False, complexity=True, multi_table=False)", "module": "sql_service", "function": "_is_simple_query", "line": 381}
{"timestamp": "2026-01-08T09:32:49.987690Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Complex query detected - using full agent", "module": "sql_service", "function": "query", "line": 403}
{"timestamp": "2026-01-08T09:32:49.987734Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 539}
{"timestamp": "2026-01-08T09:32:49.987775Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL AGENT EXECUTION TRACE:", "module": "sql_service", "function": "_execute_with_agent", "line": 540}
{"timestamp": "2026-01-08T09:32:49.987816Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 541}
{"timestamp": "2026-01-08T09:32:50.807390Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:32:51.794611Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:32:52.356796Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 429 Too Many Requests\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:32:52.357029Z", "level": "INFO", "logger": "openai._base_client", "message": "Retrying request to /chat/completions in 4.288000 seconds", "module": "_base_client", "function": "_sleep_for_retry", "line": 1071}
{"timestamp": "2026-01-08T09:32:57.772195Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:33:02.969259Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:33:03.506681Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 429 Too Many Requests\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:33:03.507784Z", "level": "INFO", "logger": "openai._base_client", "message": "Retrying request to /chat/completions in 0.112000 seconds", "module": "_base_client", "function": "_sleep_for_retry", "line": 1071}
{"timestamp": "2026-01-08T09:33:04.306232Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:33:05.348262Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 429 Too Many Requests\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:33:05.348655Z", "level": "INFO", "logger": "openai._base_client", "message": "Retrying request to /chat/completions in 5.326000 seconds", "module": "_base_client", "function": "_sleep_for_retry", "line": 1071}
{"timestamp": "2026-01-08T09:33:10.956389Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 429 Too Many Requests\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:33:10.956692Z", "level": "INFO", "logger": "openai._base_client", "message": "Retrying request to /chat/completions in 0.002000 seconds", "module": "_base_client", "function": "_sleep_for_retry", "line": 1071}
{"timestamp": "2026-01-08T09:33:11.262946Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 429 Too Many Requests\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:33:11.272227Z", "level": "ERROR", "logger": "backend.services.sql_service", "message": " SQL query failed: Error code: 429 - {'error': {'message': 'Rate limit reached for gpt-4o in organization org-lIshM8Wztmovd0NtwBOdGn9Y on tokens per min (TPM): Limit 30000, Used 27394, Requested 2663. Please try again in 114ms. Visit https://platform.openai.com/account/rate-limits to learn more.', 'type': 'tokens', 'param': None, 'code': 'rate_limit_exceeded'}}", "module": "sql_service", "function": "_execute_with_agent", "line": 576, "exception": "Traceback (most recent call last):\n  File \"/Users/adityanbhatt/fhir_rag/backend/services/sql_service.py\", line 545, in _execute_with_agent\n    result = self.sql_agent.invoke({\"input\": question})\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain/chains/base.py\", line 165, in invoke\n    self._call(inputs, run_manager=run_manager)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain/agents/agent.py\", line 1625, in _call\n    next_step_output = self._take_next_step(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain/agents/agent.py\", line 1325, in _take_next_step\n    list(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain/agents/agent.py\", line 1352, in _iter_next_step\n    output = self._action_agent.plan(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain/agents/agent.py\", line 573, in plan\n    for chunk in self.runnable.stream(inputs, config={\"callbacks\": callbacks}):\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_core/runnables/base.py\", line 3650, in stream\n    yield from self.transform(iter([input]), config, **kwargs)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_core/runnables/base.py\", line 3636, in transform\n    yield from self._transform_stream_with_config(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_core/runnables/base.py\", line 2372, in _transform_stream_with_config\n    chunk: Output = context.run(next, iterator)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_core/runnables/base.py\", line 3595, in _transform\n    yield from final_pipeline\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_core/runnables/base.py\", line 1571, in transform\n    for ichunk in input:\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_core/runnables/base.py\", line 5927, in transform\n    yield from self.bound.transform(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_core/runnables/base.py\", line 1589, in transform\n    yield from self.stream(final, config, **kwargs)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_core/language_models/chat_models.py\", line 522, in stream\n    for chunk in self._stream(input_messages, stop=stop, **kwargs):\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_openai/chat_models/base.py\", line 1123, in _stream\n    response = self.client.create(**payload)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/openai/_utils/_utils.py\", line 286, in wrapper\n    return func(*args, **kwargs)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/openai/resources/chat/completions/completions.py\", line 1156, in create\n    return self._post(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/openai/_base_client.py\", line 1259, in post\n    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/openai/_base_client.py\", line 1047, in request\n    raise self._make_status_error_from_response(err.response) from None\nopenai.RateLimitError: Error code: 429 - {'error': {'message': 'Rate limit reached for gpt-4o in organization org-lIshM8Wztmovd0NtwBOdGn9Y on tokens per min (TPM): Limit 30000, Used 27394, Requested 2663. Please try again in 114ms. Visit https://platform.openai.com/account/rate-limits to learn more.', 'type': 'tokens', 'param': None, 'code': 'rate_limit_exceeded'}}"}
{"timestamp": "2026-01-08T09:33:11.273508Z", "level": "ERROR", "logger": "backend.services.agent_service", "message": "Query processing failed (trace_id=ef226ad3-ca89-4a5d-b3e9-0223a5a51b06): Error code: 429 - {'error': {'message': 'Rate limit reached for gpt-4o in organization org-lIshM8Wztmovd0NtwBOdGn9Y on tokens per min (TPM): Limit 30000, Used 27394, Requested 2663. Please try again in 114ms. Visit https://platform.openai.com/account/rate-limits to learn more.', 'type': 'tokens', 'param': None, 'code': 'rate_limit_exceeded'}}", "module": "agent_service", "function": "process_query", "line": 274, "exception": "Traceback (most recent call last):\n  File \"/Users/adityanbhatt/fhir_rag/backend/services/agent_service.py\", line 227, in process_query\n    result = self.agent_executor.invoke({\"input\": query})\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain/chains/base.py\", line 165, in invoke\n    self._call(inputs, run_manager=run_manager)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain/agents/agent.py\", line 1625, in _call\n    next_step_output = self._take_next_step(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain/agents/agent.py\", line 1325, in _take_next_step\n    list(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain/agents/agent.py\", line 1408, in _iter_next_step\n    yield self._perform_agent_action(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain/agents/agent.py\", line 1433, in _perform_agent_action\n    observation = tool.run(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_core/tools/base.py\", line 895, in run\n    raise error_to_raise\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_core/tools/base.py\", line 864, in run\n    response = context.run(self._run, *tool_args, **tool_kwargs)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_core/tools/simple.py\", line 123, in _run\n    return self.func(*args, **kwargs)\n  File \"/Users/adityanbhatt/fhir_rag/backend/services/sql_service.py\", line 404, in query\n    return self._execute_with_agent(question)\n  File \"/Users/adityanbhatt/fhir_rag/backend/services/sql_service.py\", line 545, in _execute_with_agent\n    result = self.sql_agent.invoke({\"input\": question})\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain/chains/base.py\", line 165, in invoke\n    self._call(inputs, run_manager=run_manager)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain/agents/agent.py\", line 1625, in _call\n    next_step_output = self._take_next_step(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain/agents/agent.py\", line 1325, in _take_next_step\n    list(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain/agents/agent.py\", line 1352, in _iter_next_step\n    output = self._action_agent.plan(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain/agents/agent.py\", line 573, in plan\n    for chunk in self.runnable.stream(inputs, config={\"callbacks\": callbacks}):\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_core/runnables/base.py\", line 3650, in stream\n    yield from self.transform(iter([input]), config, **kwargs)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_core/runnables/base.py\", line 3636, in transform\n    yield from self._transform_stream_with_config(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_core/runnables/base.py\", line 2372, in _transform_stream_with_config\n    chunk: Output = context.run(next, iterator)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_core/runnables/base.py\", line 3595, in _transform\n    yield from final_pipeline\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_core/runnables/base.py\", line 1571, in transform\n    for ichunk in input:\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_core/runnables/base.py\", line 5927, in transform\n    yield from self.bound.transform(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_core/runnables/base.py\", line 1589, in transform\n    yield from self.stream(final, config, **kwargs)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_core/language_models/chat_models.py\", line 522, in stream\n    for chunk in self._stream(input_messages, stop=stop, **kwargs):\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_openai/chat_models/base.py\", line 1123, in _stream\n    response = self.client.create(**payload)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/openai/_utils/_utils.py\", line 286, in wrapper\n    return func(*args, **kwargs)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/openai/resources/chat/completions/completions.py\", line 1156, in create\n    return self._post(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/openai/_base_client.py\", line 1259, in post\n    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/openai/_base_client.py\", line 1047, in request\n    raise self._make_status_error_from_response(err.response) from None\nopenai.RateLimitError: Error code: 429 - {'error': {'message': 'Rate limit reached for gpt-4o in organization org-lIshM8Wztmovd0NtwBOdGn9Y on tokens per min (TPM): Limit 30000, Used 27394, Requested 2663. Please try again in 114ms. Visit https://platform.openai.com/account/rate-limits to learn more.', 'type': 'tokens', 'param': None, 'code': 'rate_limit_exceeded'}}"}
{"timestamp": "2026-01-08T09:33:11.273994Z", "level": "ERROR", "logger": "backend.api.routes.chat", "message": "Chat request failed for user=admin: Error code: 429 - {'error': {'message': 'Rate limit reached for gpt-4o in organization org-lIshM8Wztmovd0NtwBOdGn9Y on tokens per min (TPM): Limit 30000, Used 27394, Requested 2663. Please try again in 114ms. Visit https://platform.openai.com/account/rate-limits to learn more.', 'type': 'tokens', 'param': None, 'code': 'rate_limit_exceeded'}}", "module": "chat", "function": "chat", "line": 51, "exception": "Traceback (most recent call last):\n  File \"/Users/adityanbhatt/fhir_rag/backend/api/routes/chat.py\", line 43, in chat\n    result = await agent_service.process_query(\n  File \"/Users/adityanbhatt/fhir_rag/backend/services/agent_service.py\", line 227, in process_query\n    result = self.agent_executor.invoke({\"input\": query})\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain/chains/base.py\", line 165, in invoke\n    self._call(inputs, run_manager=run_manager)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain/agents/agent.py\", line 1625, in _call\n    next_step_output = self._take_next_step(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain/agents/agent.py\", line 1325, in _take_next_step\n    list(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain/agents/agent.py\", line 1408, in _iter_next_step\n    yield self._perform_agent_action(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain/agents/agent.py\", line 1433, in _perform_agent_action\n    observation = tool.run(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_core/tools/base.py\", line 895, in run\n    raise error_to_raise\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_core/tools/base.py\", line 864, in run\n    response = context.run(self._run, *tool_args, **tool_kwargs)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_core/tools/simple.py\", line 123, in _run\n    return self.func(*args, **kwargs)\n  File \"/Users/adityanbhatt/fhir_rag/backend/services/sql_service.py\", line 404, in query\n    return self._execute_with_agent(question)\n  File \"/Users/adityanbhatt/fhir_rag/backend/services/sql_service.py\", line 545, in _execute_with_agent\n    result = self.sql_agent.invoke({\"input\": question})\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain/chains/base.py\", line 165, in invoke\n    self._call(inputs, run_manager=run_manager)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain/agents/agent.py\", line 1625, in _call\n    next_step_output = self._take_next_step(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain/agents/agent.py\", line 1325, in _take_next_step\n    list(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain/agents/agent.py\", line 1352, in _iter_next_step\n    output = self._action_agent.plan(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain/agents/agent.py\", line 573, in plan\n    for chunk in self.runnable.stream(inputs, config={\"callbacks\": callbacks}):\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_core/runnables/base.py\", line 3650, in stream\n    yield from self.transform(iter([input]), config, **kwargs)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_core/runnables/base.py\", line 3636, in transform\n    yield from self._transform_stream_with_config(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_core/runnables/base.py\", line 2372, in _transform_stream_with_config\n    chunk: Output = context.run(next, iterator)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_core/runnables/base.py\", line 3595, in _transform\n    yield from final_pipeline\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_core/runnables/base.py\", line 1571, in transform\n    for ichunk in input:\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_core/runnables/base.py\", line 5927, in transform\n    yield from self.bound.transform(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_core/runnables/base.py\", line 1589, in transform\n    yield from self.stream(final, config, **kwargs)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_core/language_models/chat_models.py\", line 522, in stream\n    for chunk in self._stream(input_messages, stop=stop, **kwargs):\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_openai/chat_models/base.py\", line 1123, in _stream\n    response = self.client.create(**payload)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/openai/_utils/_utils.py\", line 286, in wrapper\n    return func(*args, **kwargs)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/openai/resources/chat/completions/completions.py\", line 1156, in create\n    return self._post(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/openai/_base_client.py\", line 1259, in post\n    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/openai/_base_client.py\", line 1047, in request\n    raise self._make_status_error_from_response(err.response) from None\nopenai.RateLimitError: Error code: 429 - {'error': {'message': 'Rate limit reached for gpt-4o in organization org-lIshM8Wztmovd0NtwBOdGn9Y on tokens per min (TPM): Limit 30000, Used 27394, Requested 2663. Please try again in 114ms. Visit https://platform.openai.com/account/rate-limits to learn more.', 'type': 'tokens', 'param': None, 'code': 'rate_limit_exceeded'}}", "user_id": "admin"}
{"timestamp": "2026-01-08T09:33:11.276014Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=85", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:33:11.276080Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=65e70e1b-4736-4161-9396-d6678243c73d): 'Analyze patients who were crisis referrals and describe their follow-up care patterns...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:33:12.111702Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:33:12.293000Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Searching vector store for query: 'Crisis referrals follow-up care patterns...' (top_k=5)", "module": "vector_store", "function": "search", "line": 69}
{"timestamp": "2026-01-08T09:33:12.293239Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Executing query: Crisis referrals follow-up care patterns", "module": "retrieve", "function": "_get_relevant_documents", "line": 223}
{"timestamp": "2026-01-08T09:33:12.781162Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Reranking 77 documents for query: 'Crisis referrals follow-up care patterns'", "module": "retrieve", "function": "_get_relevant_documents", "line": 257}
{"timestamp": "2026-01-08T09:33:13.829550Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Returning 10 reranked documents.", "module": "retrieve", "function": "_get_relevant_documents", "line": 267}
{"timestamp": "2026-01-08T09:33:13.829673Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Retrieved 10 documents from vector store", "module": "vector_store", "function": "search", "line": 84}
{"timestamp": "2026-01-08T09:33:14.360886Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:33:20.723060Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=65e70e1b-4736-4161-9396-d6678243c73d, duration=9.45s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:33:26.043549Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login attempt for user: admin", "module": "auth", "function": "login", "line": 27}
{"timestamp": "2026-01-08T09:33:26.043699Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login successful for user: admin", "module": "auth", "function": "login", "line": 50}
{"timestamp": "2026-01-08T09:33:26.045463Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=51", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:33:26.045523Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=ea379dc5-6ffc-4ac5-93bf-d112d53e20fb): 'How many patients were screened for blood pressure?...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:33:28.434808Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:33:29.000953Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Count the number of patients who were screened for blood pressure using the v_analytics_screening ta...'", "module": "sql_service", "function": "query", "line": 396}
{"timestamp": "2026-01-08T09:33:29.001239Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udd0d Analyzing natural language query", "module": "sql_service", "function": "_is_simple_query", "line": 338}
{"timestamp": "2026-01-08T09:33:29.001420Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query classified as COMPLEX (pattern=True, complexity=False, multi_table=True)", "module": "sql_service", "function": "_is_simple_query", "line": 381}
{"timestamp": "2026-01-08T09:33:29.001509Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Complex query detected - using full agent", "module": "sql_service", "function": "query", "line": 403}
{"timestamp": "2026-01-08T09:33:29.001629Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 539}
{"timestamp": "2026-01-08T09:33:29.001703Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL AGENT EXECUTION TRACE:", "module": "sql_service", "function": "_execute_with_agent", "line": 540}
{"timestamp": "2026-01-08T09:33:29.001765Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 541}
{"timestamp": "2026-01-08T09:33:30.336021Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:33:31.157262Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:33:31.952005Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:33:33.203882Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:33:34.819364Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:33:36.171956Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:33:36.417726Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 567}
{"timestamp": "2026-01-08T09:33:36.417921Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL query completed. Result length: 135 chars", "module": "sql_service", "function": "_execute_with_agent", "line": 568}
{"timestamp": "2026-01-08T09:33:36.418036Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: The number of patients who were screened for blood pressure with a workflow status of 'NCD' and have a blood pressure reading is 5,332....", "module": "sql_service", "function": "_execute_with_agent", "line": 570}
{"timestamp": "2026-01-08T09:33:36.418383Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 571}
{"timestamp": "2026-01-08T09:33:37.096565Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:33:39.442870Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=ea379dc5-6ffc-4ac5-93bf-d112d53e20fb, duration=13.40s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:33:39.448727Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=45", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:33:39.448865Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=a45a1c34-cf91-4c27-bbe2-c08da393b2fa): 'What is the total number of crisis referrals?...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:33:40.064007Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:33:40.406928Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Count the total number of crisis referrals from v_analytics_screening where crisis_referral_status =...'", "module": "sql_service", "function": "query", "line": 396}
{"timestamp": "2026-01-08T09:33:40.407182Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udd0d Analyzing natural language query", "module": "sql_service", "function": "_is_simple_query", "line": 338}
{"timestamp": "2026-01-08T09:33:40.407395Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query classified as SIMPLE (natural language)", "module": "sql_service", "function": "_is_simple_query", "line": 379}
{"timestamp": "2026-01-08T09:33:40.407517Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Detected simple query - using optimized execution path", "module": "sql_service", "function": "query", "line": 400}
{"timestamp": "2026-01-08T09:33:40.407622Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_optimized", "line": 412}
{"timestamp": "2026-01-08T09:33:40.407686Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 OPTIMIZED SQL EXECUTION:", "module": "sql_service", "function": "_execute_optimized", "line": 413}
{"timestamp": "2026-01-08T09:33:40.407739Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_optimized", "line": 414}
{"timestamp": "2026-01-08T09:33:40.408021Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " API Call 1: Generate SQL query with targeted schema", "module": "sql_service", "function": "_execute_optimized", "line": 429}
{"timestamp": "2026-01-08T09:33:40.408233Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udccb Selected relevant tables for query: v_analytics_screening", "module": "sql_service", "function": "_get_relevant_schema", "line": 281}
{"timestamp": "2026-01-08T09:33:41.396499Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:33:41.399743Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL to execute: SELECT COUNT(*) \nFROM v_analytics_screening \nWHERE crisis_referral_status = 'Crisis Referral';...", "module": "sql_service", "function": "_execute_optimized", "line": 463}
{"timestamp": "2026-01-08T09:33:41.399983Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Executing query against database (no API call)", "module": "sql_service", "function": "_execute_optimized", "line": 471}
{"timestamp": "2026-01-08T09:33:41.419559Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query result: [(1219,)]", "module": "sql_service", "function": "_execute_optimized", "line": 473}
{"timestamp": "2026-01-08T09:33:41.419739Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " API Call 2: Format natural language response", "module": "sql_service", "function": "_execute_optimized", "line": 476}
{"timestamp": "2026-01-08T09:33:42.429871Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:33:42.435521Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_optimized", "line": 491}
{"timestamp": "2026-01-08T09:33:42.435677Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Optimized execution completed with 2 API call(s) (vs 7 with agent)", "module": "sql_service", "function": "_execute_optimized", "line": 492}
{"timestamp": "2026-01-08T09:33:42.435786Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: There are a total of 1,219 crisis referrals recorded in the v_analytics_screening database....", "module": "sql_service", "function": "_execute_optimized", "line": 493}
{"timestamp": "2026-01-08T09:33:42.436103Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_optimized", "line": 494}
{"timestamp": "2026-01-08T09:33:43.049364Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:33:45.067093Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=a45a1c34-cf91-4c27-bbe2-c08da393b2fa, duration=5.62s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:33:45.072373Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=63", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:33:45.072496Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=68aea736-c2a0-4e5e-b8d1-d618535b7571): 'How many patients were referred due to elevated blood pressure?...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:33:45.908883Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:33:46.278040Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Count the number of patients referred due to elevated blood pressure from v_analytics_screening wher...'", "module": "sql_service", "function": "query", "line": 396}
{"timestamp": "2026-01-08T09:33:46.278098Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udd0d Analyzing natural language query", "module": "sql_service", "function": "_is_simple_query", "line": 338}
{"timestamp": "2026-01-08T09:33:46.278158Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query classified as COMPLEX (pattern=True, complexity=False, multi_table=True)", "module": "sql_service", "function": "_is_simple_query", "line": 381}
{"timestamp": "2026-01-08T09:33:46.278184Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Complex query detected - using full agent", "module": "sql_service", "function": "query", "line": 403}
{"timestamp": "2026-01-08T09:33:46.278209Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 539}
{"timestamp": "2026-01-08T09:33:46.278235Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL AGENT EXECUTION TRACE:", "module": "sql_service", "function": "_execute_with_agent", "line": 540}
{"timestamp": "2026-01-08T09:33:46.278258Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 541}
{"timestamp": "2026-01-08T09:33:46.617668Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 429 Too Many Requests\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:33:46.618846Z", "level": "INFO", "logger": "openai._base_client", "message": "Retrying request to /chat/completions in 0.192000 seconds", "module": "_base_client", "function": "_sleep_for_retry", "line": 1071}
{"timestamp": "2026-01-08T09:33:47.538897Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:33:47.847557Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 429 Too Many Requests\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:33:47.848442Z", "level": "INFO", "logger": "openai._base_client", "message": "Retrying request to /chat/completions in 0.928000 seconds", "module": "_base_client", "function": "_sleep_for_retry", "line": 1071}
{"timestamp": "2026-01-08T09:33:49.178346Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 429 Too Many Requests\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:33:49.178648Z", "level": "INFO", "logger": "openai._base_client", "message": "Retrying request to /chat/completions in 0.852000 seconds", "module": "_base_client", "function": "_sleep_for_retry", "line": 1071}
{"timestamp": "2026-01-08T09:33:50.817926Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:33:51.629167Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:33:52.710434Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:33:53.069731Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 429 Too Many Requests\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:33:53.070646Z", "level": "INFO", "logger": "openai._base_client", "message": "Retrying request to /chat/completions in 2.878000 seconds", "module": "_base_client", "function": "_sleep_for_retry", "line": 1071}
{"timestamp": "2026-01-08T09:33:56.254744Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 429 Too Many Requests\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:33:56.256080Z", "level": "INFO", "logger": "openai._base_client", "message": "Retrying request to /chat/completions in 0.958000 seconds", "module": "_base_client", "function": "_sleep_for_retry", "line": 1071}
{"timestamp": "2026-01-08T09:33:57.986580Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:33:59.120077Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:33:59.295702Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 567}
{"timestamp": "2026-01-08T09:33:59.295833Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL query completed. Result length: 72 chars", "module": "sql_service", "function": "_execute_with_agent", "line": 568}
{"timestamp": "2026-01-08T09:33:59.295886Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: The number of patients referred due to elevated blood pressure is 2,139....", "module": "sql_service", "function": "_execute_with_agent", "line": 570}
{"timestamp": "2026-01-08T09:33:59.295931Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 571}
{"timestamp": "2026-01-08T09:33:59.623439Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 429 Too Many Requests\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:33:59.624300Z", "level": "INFO", "logger": "openai._base_client", "message": "Retrying request to /chat/completions in 2.486000 seconds", "module": "_base_client", "function": "_sleep_for_retry", "line": 1071}
{"timestamp": "2026-01-08T09:34:02.490356Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 429 Too Many Requests\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:34:02.495343Z", "level": "INFO", "logger": "openai._base_client", "message": "Retrying request to /chat/completions in 2.342000 seconds", "module": "_base_client", "function": "_sleep_for_retry", "line": 1071}
{"timestamp": "2026-01-08T09:34:05.666013Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:34:08.305723Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=68aea736-c2a0-4e5e-b8d1-d618535b7571, duration=23.23s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:34:08.310091Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=32", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:34:08.310211Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=37661349-d18c-4466-bb63-c67d94b20598): 'What is the HTN prevalence rate?...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:34:09.139583Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:34:09.820950Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Calculate the HTN prevalence rate using the formula: (Elevated BP Referrals / Screened for BP) * 100...'", "module": "sql_service", "function": "query", "line": 396}
{"timestamp": "2026-01-08T09:34:09.821070Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udd0d Analyzing natural language query", "module": "sql_service", "function": "_is_simple_query", "line": 338}
{"timestamp": "2026-01-08T09:34:09.821176Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query classified as COMPLEX (pattern=False, complexity=False, multi_table=False)", "module": "sql_service", "function": "_is_simple_query", "line": 381}
{"timestamp": "2026-01-08T09:34:09.821220Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Complex query detected - using full agent", "module": "sql_service", "function": "query", "line": 403}
{"timestamp": "2026-01-08T09:34:09.821258Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 539}
{"timestamp": "2026-01-08T09:34:09.821292Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL AGENT EXECUTION TRACE:", "module": "sql_service", "function": "_execute_with_agent", "line": 540}
{"timestamp": "2026-01-08T09:34:09.821326Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 541}
{"timestamp": "2026-01-08T09:34:10.589719Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:34:11.300842Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:34:12.038430Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 429 Too Many Requests\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:34:12.039520Z", "level": "INFO", "logger": "openai._base_client", "message": "Retrying request to /chat/completions in 4.126000 seconds", "module": "_base_client", "function": "_sleep_for_retry", "line": 1071}
{"timestamp": "2026-01-08T09:34:16.447445Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 429 Too Many Requests\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:34:16.448382Z", "level": "INFO", "logger": "openai._base_client", "message": "Retrying request to /chat/completions in 0.124000 seconds", "module": "_base_client", "function": "_sleep_for_retry", "line": 1071}
{"timestamp": "2026-01-08T09:34:17.339353Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:34:19.694607Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:34:20.001294Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 429 Too Many Requests\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:34:20.002720Z", "level": "INFO", "logger": "openai._base_client", "message": "Retrying request to /chat/completions in 2.496000 seconds", "module": "_base_client", "function": "_sleep_for_retry", "line": 1071}
{"timestamp": "2026-01-08T09:34:23.308902Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:34:24.096740Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 429 Too Many Requests\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:34:24.097725Z", "level": "INFO", "logger": "openai._base_client", "message": "Retrying request to /chat/completions in 4.120000 seconds", "module": "_base_client", "function": "_sleep_for_retry", "line": 1071}
{"timestamp": "2026-01-08T09:34:29.016151Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:34:29.024703Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 567}
{"timestamp": "2026-01-08T09:34:29.024817Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL query completed. Result length: 48 chars", "module": "sql_service", "function": "_execute_with_agent", "line": 568}
{"timestamp": "2026-01-08T09:34:29.024875Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: The HTN prevalence rate is approximately 90.87%....", "module": "sql_service", "function": "_execute_with_agent", "line": 570}
{"timestamp": "2026-01-08T09:34:29.024922Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 571}
{"timestamp": "2026-01-08T09:34:29.628299Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:34:32.078253Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=37661349-d18c-4466-bb63-c67d94b20598, duration=23.77s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:34:32.085940Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=43", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:34:32.086087Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=c68656ba-28e6-458d-b741-c101b6aaa943): 'What symptoms indicate hypertensive crisis?...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:34:32.373251Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 429 Too Many Requests\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:34:32.374281Z", "level": "INFO", "logger": "openai._base_client", "message": "Retrying request to /chat/completions in 2.210000 seconds", "module": "_base_client", "function": "_sleep_for_retry", "line": 1071}
{"timestamp": "2026-01-08T09:34:34.962781Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 429 Too Many Requests\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:34:34.963711Z", "level": "INFO", "logger": "openai._base_client", "message": "Retrying request to /chat/completions in 1.038000 seconds", "module": "_base_client", "function": "_sleep_for_retry", "line": 1071}
{"timestamp": "2026-01-08T09:34:36.511538Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:34:39.665445Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=c68656ba-28e6-458d-b741-c101b6aaa943, duration=7.58s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:34:39.669110Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=54", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:34:39.669220Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=cceb15f7-559e-4ba6-ab26-147ec0f53128): 'Find patients who are smokers with high blood pressure...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:34:41.098543Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:34:41.261194Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Searching vector store for query: 'Find patients who are smokers...' (top_k=5)", "module": "vector_store", "function": "search", "line": 69}
{"timestamp": "2026-01-08T09:34:41.261372Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Executing query: Find patients who are smokers", "module": "retrieve", "function": "_get_relevant_documents", "line": 223}
{"timestamp": "2026-01-08T09:34:41.760667Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Reranking 61 documents for query: 'Find patients who are smokers'", "module": "retrieve", "function": "_get_relevant_documents", "line": 257}
{"timestamp": "2026-01-08T09:34:42.947836Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Returning 10 reranked documents.", "module": "retrieve", "function": "_get_relevant_documents", "line": 267}
{"timestamp": "2026-01-08T09:34:42.948030Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Retrieved 10 documents from vector store", "module": "vector_store", "function": "search", "line": 84}
{"timestamp": "2026-01-08T09:34:42.948366Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Count patients with systolic BP >= 140 or diastolic BP >= 90...'", "module": "sql_service", "function": "query", "line": 396}
{"timestamp": "2026-01-08T09:34:42.948394Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udd0d Analyzing natural language query", "module": "sql_service", "function": "_is_simple_query", "line": 338}
{"timestamp": "2026-01-08T09:34:42.948478Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query classified as SIMPLE (natural language)", "module": "sql_service", "function": "_is_simple_query", "line": 379}
{"timestamp": "2026-01-08T09:34:42.948500Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Detected simple query - using optimized execution path", "module": "sql_service", "function": "query", "line": 400}
{"timestamp": "2026-01-08T09:34:42.948519Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_optimized", "line": 412}
{"timestamp": "2026-01-08T09:34:42.948538Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 OPTIMIZED SQL EXECUTION:", "module": "sql_service", "function": "_execute_optimized", "line": 413}
{"timestamp": "2026-01-08T09:34:42.948556Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_optimized", "line": 414}
{"timestamp": "2026-01-08T09:34:42.948575Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " API Call 1: Generate SQL query with targeted schema", "module": "sql_service", "function": "_execute_optimized", "line": 429}
{"timestamp": "2026-01-08T09:34:42.948616Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udccb Selected relevant tables for query: patient, bp_log, patient_tracker", "module": "sql_service", "function": "_get_relevant_schema", "line": 281}
{"timestamp": "2026-01-08T09:34:43.950077Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:34:43.953329Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL to execute: SELECT COUNT(DISTINCT pt.patient_id)\nFROM bp_log bp\nJOIN patient_tracker pt ON bp.patient_track_id = pt.id\nWHERE bp.avg_systolic >= 140 OR bp.avg_diastolic >= 90;...", "module": "sql_service", "function": "_execute_optimized", "line": 463}
{"timestamp": "2026-01-08T09:34:43.953396Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Executing query against database (no API call)", "module": "sql_service", "function": "_execute_optimized", "line": 471}
{"timestamp": "2026-01-08T09:34:43.974285Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query result: [(1263,)]", "module": "sql_service", "function": "_execute_optimized", "line": 473}
{"timestamp": "2026-01-08T09:34:43.974361Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " API Call 2: Format natural language response", "module": "sql_service", "function": "_execute_optimized", "line": 476}
{"timestamp": "2026-01-08T09:34:44.884129Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:34:44.885034Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_optimized", "line": 491}
{"timestamp": "2026-01-08T09:34:44.885094Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Optimized execution completed with 2 API call(s) (vs 7 with agent)", "module": "sql_service", "function": "_execute_optimized", "line": 492}
{"timestamp": "2026-01-08T09:34:44.885135Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: There are 1,263 distinct patients with either an average systolic blood pressure of 140 or higher, or an average diastolic blood pressure of 90 or higher....", "module": "sql_service", "function": "_execute_optimized", "line": 493}
{"timestamp": "2026-01-08T09:34:44.885166Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_optimized", "line": 494}
{"timestamp": "2026-01-08T09:34:45.401725Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:34:49.726101Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=cceb15f7-559e-4ba6-ab26-147ec0f53128, duration=10.06s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:34:49.730050Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=50", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:34:49.730103Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=c2c461b5-b606-4a78-ae38-321d4c17ebaf): 'Is a blood pressure of 145/92 considered elevated?...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:34:50.287084Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:34:51.149764Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=c2c461b5-b606-4a78-ae38-321d4c17ebaf, duration=1.42s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:34:51.156023Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=74", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:34:51.156179Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=a9e140b9-103b-44df-a72a-ad2a64ac5a43): 'A patient has BP 150/95 and glucose 12 mmol/L RBS. What referral category?...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:34:51.635753Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:34:55.163713Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=a9e140b9-103b-44df-a72a-ad2a64ac5a43, duration=4.01s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:35:42.427711Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login attempt for user: admin", "module": "auth", "function": "login", "line": 27}
{"timestamp": "2026-01-08T09:35:42.427956Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login successful for user: admin", "module": "auth", "function": "login", "line": 50}
{"timestamp": "2026-01-08T09:35:42.429242Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=51", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:35:42.429304Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=1b424212-d9f0-442e-902a-b43e381b1fc3): 'How many patients were screened for blood pressure?...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:35:43.394578Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:35:44.003070Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Count the number of patients who were screened for blood pressure using v_analytics_screening where ...'", "module": "sql_service", "function": "query", "line": 396}
{"timestamp": "2026-01-08T09:35:44.003430Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udd0d Analyzing natural language query", "module": "sql_service", "function": "_is_simple_query", "line": 338}
{"timestamp": "2026-01-08T09:35:44.003722Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query classified as COMPLEX (pattern=True, complexity=False, multi_table=True)", "module": "sql_service", "function": "_is_simple_query", "line": 381}
{"timestamp": "2026-01-08T09:35:44.003788Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Complex query detected - using full agent", "module": "sql_service", "function": "query", "line": 403}
{"timestamp": "2026-01-08T09:35:44.003853Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 539}
{"timestamp": "2026-01-08T09:35:44.003898Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL AGENT EXECUTION TRACE:", "module": "sql_service", "function": "_execute_with_agent", "line": 540}
{"timestamp": "2026-01-08T09:35:44.003958Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 541}
{"timestamp": "2026-01-08T09:35:45.030444Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:35:45.816845Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:35:47.864898Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:35:49.090959Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:35:49.912896Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:35:50.832001Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:35:51.347197Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 567}
{"timestamp": "2026-01-08T09:35:51.347280Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL query completed. Result length: 135 chars", "module": "sql_service", "function": "_execute_with_agent", "line": 568}
{"timestamp": "2026-01-08T09:35:51.347325Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: The number of patients who were screened for blood pressure with a workflow status of 'NCD' and have a blood pressure reading is 5,332....", "module": "sql_service", "function": "_execute_with_agent", "line": 570}
{"timestamp": "2026-01-08T09:35:51.347362Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 571}
{"timestamp": "2026-01-08T09:35:52.106935Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:35:54.662016Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=1b424212-d9f0-442e-902a-b43e381b1fc3, duration=12.23s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:45:19.981493Z", "level": "INFO", "logger": "app", "message": "Shutting down application", "module": "app", "function": "lifespan", "line": 34}
{"timestamp": "2026-01-08T09:45:24.885856Z", "level": "INFO", "logger": "app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-08T09:45:24.885899Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-08T09:45:24.885921Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-08T09:45:24.886001Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-08T09:45:24.902906Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-08T09:45:24.902948Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-08T09:45:26.537344Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-08T09:45:26.537397Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-08T09:45:26.537423Z", "level": "INFO", "logger": "app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-08T09:45:26.537442Z", "level": "INFO", "logger": "app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-08T09:46:49.113453Z", "level": "INFO", "logger": "app", "message": "Shutting down application", "module": "app", "function": "lifespan", "line": 34}
{"timestamp": "2026-01-08T09:46:52.634457Z", "level": "INFO", "logger": "app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-08T09:46:52.634496Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-08T09:46:52.634518Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-08T09:46:52.634585Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-08T09:46:52.648195Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-08T09:46:52.648241Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-08T09:46:53.782557Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-08T09:46:53.782671Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-08T09:46:53.782745Z", "level": "INFO", "logger": "app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-08T09:46:53.782768Z", "level": "INFO", "logger": "app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-08T09:48:19.573506Z", "level": "INFO", "logger": "app", "message": "Shutting down application", "module": "app", "function": "lifespan", "line": 34}
{"timestamp": "2026-01-08T09:48:22.355320Z", "level": "INFO", "logger": "app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-08T09:48:22.355368Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-08T09:48:22.355396Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-08T09:48:22.355488Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-08T09:48:22.369023Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-08T09:48:22.369069Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-08T09:48:23.339969Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-08T09:48:23.340041Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-08T09:48:23.340084Z", "level": "INFO", "logger": "app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-08T09:48:23.340102Z", "level": "INFO", "logger": "app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-08T09:53:36.302109Z", "level": "INFO", "logger": "app", "message": "Shutting down application", "module": "app", "function": "lifespan", "line": 34}
{"timestamp": "2026-01-08T09:53:39.105999Z", "level": "INFO", "logger": "app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-08T09:53:39.106050Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-08T09:53:39.106077Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-08T09:53:39.106164Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-08T09:53:39.120574Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-08T09:53:39.120618Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-08T09:53:40.275581Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-08T09:53:40.275660Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-08T09:53:40.275706Z", "level": "INFO", "logger": "app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-08T09:53:40.275726Z", "level": "INFO", "logger": "app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-08T09:55:29.713556Z", "level": "INFO", "logger": "app", "message": "Shutting down application", "module": "app", "function": "lifespan", "line": 34}
{"timestamp": "2026-01-08T09:55:32.551343Z", "level": "INFO", "logger": "app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-08T09:55:32.551396Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-08T09:55:32.551420Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-08T09:55:32.551498Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-08T09:55:32.564509Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-08T09:55:32.564558Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-08T09:55:33.760981Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-08T09:55:33.761210Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-08T09:55:33.761418Z", "level": "INFO", "logger": "app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-08T09:55:33.761476Z", "level": "INFO", "logger": "app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-08T10:04:20.100959Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login attempt for user: admin", "module": "auth", "function": "login", "line": 27}
{"timestamp": "2026-01-08T10:04:20.101581Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login successful for user: admin", "module": "auth", "function": "login", "line": 50}
{"timestamp": "2026-01-08T10:04:29.344323Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=32", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T10:04:29.344529Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Initializing AgentService", "module": "agent_service", "function": "__init__", "line": 121}
{"timestamp": "2026-01-08T10:04:29.344653Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Connecting to database at postgresql://admin:admin@127.0.0.1:5432/Spice_BD", "module": "sql_service", "function": "__init__", "line": 258}
{"timestamp": "2026-01-08T10:04:29.725258Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Database connection established with view support", "module": "sql_service", "function": "__init__", "line": 275}
{"timestamp": "2026-01-08T10:04:29.946618Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Cached schema for 39 relevant tables out of 114 total", "module": "sql_service", "function": "_cache_schema", "line": 340}
{"timestamp": "2026-01-08T10:04:29.946670Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Relevant tables: bp_log, current_medication, diagnosis, glucose_log, lab_test, lab_test_result, lab_test_result_range, medical_compliance, medication_country_detail, patient...", "module": "sql_service", "function": "_cache_schema", "line": 341}
{"timestamp": "2026-01-08T10:04:30.060881Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "SQL agent initialized successfully with 39 cached tables", "module": "sql_service", "function": "__init__", "line": 302}
{"timestamp": "2026-01-08T10:04:30.065173Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "AgentService initialized successfully", "module": "agent_service", "function": "__init__", "line": 184}
{"timestamp": "2026-01-08T10:04:30.065228Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=7a5168dd-8ef2-4523-9110-6e38e4a161aa): 'What is the HTN prevalence rate?...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T10:04:31.356652Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T10:04:32.028804Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Calculate the HTN prevalence rate using the formula: (Elevated BP Referrals / Screened for BP) * 100...'", "module": "sql_service", "function": "query", "line": 482}
{"timestamp": "2026-01-08T10:04:32.029136Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI Template Match: 'screened for bp' -> patients screened for blood pressure", "module": "sql_service", "function": "_check_dashboard_kpi", "line": 415}
{"timestamp": "2026-01-08T10:04:32.029378Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 Using pre-defined KPI template for: patients screened for blood pressure", "module": "sql_service", "function": "query", "line": 487}
{"timestamp": "2026-01-08T10:04:32.029687Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 498}
{"timestamp": "2026-01-08T10:04:32.029775Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI TEMPLATE EXECUTION (1 API call):", "module": "sql_service", "function": "_execute_kpi_template", "line": 499}
{"timestamp": "2026-01-08T10:04:32.029826Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 500}
{"timestamp": "2026-01-08T10:04:32.029873Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Template: patients screened for blood pressure", "module": "sql_service", "function": "_execute_kpi_template", "line": 501}
{"timestamp": "2026-01-08T10:04:32.029926Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL: SELECT COUNT(DISTINCT patient_track_id) as count\n        FROM v_analytics_screening \n        WHERE workflow_status = 'NCD' \n        AND has_bp_reading = TRUE...", "module": "sql_service", "function": "_execute_kpi_template", "line": 502}
{"timestamp": "2026-01-08T10:04:32.057431Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query result: [(5332,)]", "module": "sql_service", "function": "_execute_kpi_template", "line": 506}
{"timestamp": "2026-01-08T10:04:40.082444Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T10:04:40.091771Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 521}
{"timestamp": "2026-01-08T10:04:40.091881Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u2705 KPI template execution completed with 1 API call", "module": "sql_service", "function": "_execute_kpi_template", "line": 522}
{"timestamp": "2026-01-08T10:04:40.091938Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: The total number of patients screened for blood pressure in the NCD program is 5,332. This figure represents the distinct count of individuals who have undergone blood pressure screening and have a recorded blood pressure reading. To calculate the hypertension (HTN) prevalence rate, you would need t...", "module": "sql_service", "function": "_execute_kpi_template", "line": 523}
{"timestamp": "2026-01-08T10:04:40.091979Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 524}
{"timestamp": "2026-01-08T10:04:40.841858Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T10:04:44.578974Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=7a5168dd-8ef2-4523-9110-6e38e4a161aa, duration=14.51s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T10:04:59.276525Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=45", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T10:04:59.276652Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=5dc6fc0e-9501-4816-9c06-4c537c18ab7c): 'What is the total number of crisis referrals?...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T10:05:00.336216Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T10:05:00.922147Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Count the total number of crisis referrals from v_analytics_screening where crisis_referral_status =...'", "module": "sql_service", "function": "query", "line": 482}
{"timestamp": "2026-01-08T10:05:00.922464Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI Template Match: 'crisis referral' -> crisis referrals", "module": "sql_service", "function": "_check_dashboard_kpi", "line": 415}
{"timestamp": "2026-01-08T10:05:00.922528Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 Using pre-defined KPI template for: crisis referrals", "module": "sql_service", "function": "query", "line": 487}
{"timestamp": "2026-01-08T10:05:00.922603Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 498}
{"timestamp": "2026-01-08T10:05:00.922650Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI TEMPLATE EXECUTION (1 API call):", "module": "sql_service", "function": "_execute_kpi_template", "line": 499}
{"timestamp": "2026-01-08T10:05:00.922690Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 500}
{"timestamp": "2026-01-08T10:05:00.922729Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Template: crisis referrals", "module": "sql_service", "function": "_execute_kpi_template", "line": 501}
{"timestamp": "2026-01-08T10:05:00.922770Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL: SELECT COUNT(DISTINCT patient_track_id) as count\n        FROM v_analytics_screening \n        WHERE crisis_referral_status = 'Crisis Referral'...", "module": "sql_service", "function": "_execute_kpi_template", "line": 502}
{"timestamp": "2026-01-08T10:05:00.942438Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query result: [(1219,)]", "module": "sql_service", "function": "_execute_kpi_template", "line": 506}
{"timestamp": "2026-01-08T10:05:03.307794Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T10:05:03.318096Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 521}
{"timestamp": "2026-01-08T10:05:03.318218Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u2705 KPI template execution completed with 1 API call", "module": "sql_service", "function": "_execute_kpi_template", "line": 522}
{"timestamp": "2026-01-08T10:05:03.318338Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: The total number of crisis referrals recorded in the v_analytics_screening database, where the crisis_referral_status is 'Crisis Referral', is 1,219. This figure represents the distinct instances where patients were identified and referred for crisis intervention, highlighting the volume of urgent c...", "module": "sql_service", "function": "_execute_kpi_template", "line": 523}
{"timestamp": "2026-01-08T10:05:03.318415Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 524}
{"timestamp": "2026-01-08T10:05:04.065644Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T10:05:07.772791Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=5dc6fc0e-9501-4816-9c06-4c537c18ab7c, duration=8.50s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T10:06:46.600797Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=49", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T10:06:46.601089Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=814c48e6-fe10-46ea-a8d7-ccef78561312): 'What are the common reasons for crisis referrals?...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T10:06:47.448773Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T10:06:47.960717Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'What are the common reasons for crisis referrals in v_analytics_screening?...'", "module": "sql_service", "function": "query", "line": 482}
{"timestamp": "2026-01-08T10:06:47.960883Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI Template Match: 'crisis referral' -> crisis referrals", "module": "sql_service", "function": "_check_dashboard_kpi", "line": 415}
{"timestamp": "2026-01-08T10:06:47.960930Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 Using pre-defined KPI template for: crisis referrals", "module": "sql_service", "function": "query", "line": 487}
{"timestamp": "2026-01-08T10:06:47.960974Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 498}
{"timestamp": "2026-01-08T10:06:47.961013Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI TEMPLATE EXECUTION (1 API call):", "module": "sql_service", "function": "_execute_kpi_template", "line": 499}
{"timestamp": "2026-01-08T10:06:47.961051Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 500}
{"timestamp": "2026-01-08T10:06:47.961089Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Template: crisis referrals", "module": "sql_service", "function": "_execute_kpi_template", "line": 501}
{"timestamp": "2026-01-08T10:06:47.961129Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL: SELECT COUNT(DISTINCT patient_track_id) as count\n        FROM v_analytics_screening \n        WHERE crisis_referral_status = 'Crisis Referral'...", "module": "sql_service", "function": "_execute_kpi_template", "line": 502}
{"timestamp": "2026-01-08T10:06:47.981313Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query result: [(1219,)]", "module": "sql_service", "function": "_execute_kpi_template", "line": 506}
{"timestamp": "2026-01-08T10:06:51.443684Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T10:06:51.446564Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 521}
{"timestamp": "2026-01-08T10:06:51.446714Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u2705 KPI template execution completed with 1 API call", "module": "sql_service", "function": "_execute_kpi_template", "line": 522}
{"timestamp": "2026-01-08T10:06:51.446816Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: In the context of the NCD (Non-Communicable Diseases) program, the database query indicates that there have been 1,219 distinct crisis referrals recorded. This number represents the total count of unique patient cases that have been identified as requiring immediate attention due to a crisis situati...", "module": "sql_service", "function": "_execute_kpi_template", "line": 523}
{"timestamp": "2026-01-08T10:06:51.446891Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 524}
{"timestamp": "2026-01-08T10:06:52.057302Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T10:06:53.973432Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=814c48e6-fe10-46ea-a8d7-ccef78561312, duration=7.37s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T10:07:11.694434Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=26", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T10:07:11.694671Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=7949870a-198f-46b4-97a8-d254cf1327ca): 'explore the clinical notes...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T10:07:12.741897Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T10:07:14.346911Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=7949870a-198f-46b4-97a8-d254cf1327ca, duration=2.65s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T10:11:04.485140Z", "level": "INFO", "logger": "app", "message": "Shutting down application", "module": "app", "function": "lifespan", "line": 34}
{"timestamp": "2026-01-08T10:11:08.266984Z", "level": "INFO", "logger": "app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-08T10:11:08.267027Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-08T10:11:08.267049Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-08T10:11:08.267125Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-08T10:11:08.281610Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-08T10:11:08.281653Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-08T10:11:09.874091Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-08T10:11:09.874187Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-08T10:11:09.874226Z", "level": "INFO", "logger": "app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-08T10:11:09.874249Z", "level": "INFO", "logger": "app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-08T10:11:12.680076Z", "level": "INFO", "logger": "app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-08T10:11:12.680126Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-08T10:11:12.680152Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-08T10:11:12.680234Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-08T10:11:12.694077Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-08T10:11:12.694123Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-08T10:11:13.465980Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-08T10:11:13.466040Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-08T10:11:13.466064Z", "level": "INFO", "logger": "app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-08T10:11:13.466086Z", "level": "INFO", "logger": "app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-08T10:15:23.548694Z", "level": "INFO", "logger": "app", "message": "Shutting down application", "module": "app", "function": "lifespan", "line": 34}
{"timestamp": "2026-01-08T10:15:27.069151Z", "level": "INFO", "logger": "app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-08T10:15:27.069190Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-08T10:15:27.069211Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-08T10:15:27.069283Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-08T10:15:27.083439Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-08T10:15:27.083479Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-08T10:15:28.467075Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-08T10:15:28.467152Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-08T10:15:28.467199Z", "level": "INFO", "logger": "app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-08T10:15:28.467218Z", "level": "INFO", "logger": "app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-08T10:15:58.780301Z", "level": "INFO", "logger": "app", "message": "Shutting down application", "module": "app", "function": "lifespan", "line": 34}
{"timestamp": "2026-01-08T10:16:01.531614Z", "level": "INFO", "logger": "app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-08T10:16:01.531666Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-08T10:16:01.531692Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-08T10:16:01.531769Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-08T10:16:01.545333Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-08T10:16:01.545375Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-08T10:16:02.594877Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-08T10:16:02.594966Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-08T10:16:02.595014Z", "level": "INFO", "logger": "app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-08T10:16:02.595034Z", "level": "INFO", "logger": "app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-08T10:16:11.094456Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=32", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T10:16:11.094604Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Initializing AgentService", "module": "agent_service", "function": "__init__", "line": 121}
{"timestamp": "2026-01-08T10:16:11.094699Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Connecting to database at postgresql://admin:admin@127.0.0.1:5432/Spice_BD", "module": "sql_service", "function": "__init__", "line": 229}
{"timestamp": "2026-01-08T10:16:11.398268Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Database connection established with view support", "module": "sql_service", "function": "__init__", "line": 246}
{"timestamp": "2026-01-08T10:16:11.614531Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Cached schema for 39 relevant tables out of 114 total", "module": "sql_service", "function": "_cache_schema", "line": 311}
{"timestamp": "2026-01-08T10:16:11.614583Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Relevant tables: bp_log, current_medication, diagnosis, glucose_log, lab_test, lab_test_result, lab_test_result_range, medical_compliance, medication_country_detail, patient...", "module": "sql_service", "function": "_cache_schema", "line": 312}
{"timestamp": "2026-01-08T10:16:11.728739Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "SQL agent initialized successfully with 39 cached tables", "module": "sql_service", "function": "__init__", "line": 273}
{"timestamp": "2026-01-08T10:16:11.733254Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "AgentService initialized successfully", "module": "agent_service", "function": "__init__", "line": 184}
{"timestamp": "2026-01-08T10:16:11.733303Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=867fefe7-296c-4f90-b466-65571e4b1213): 'What is the HTN prevalence rate?...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T10:16:13.373042Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T10:16:13.692818Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Calculate the HTN prevalence rate using the formula: (Elevated BP Referrals / Screened for BP) * 100...'", "module": "sql_service", "function": "query", "line": 455}
{"timestamp": "2026-01-08T10:16:13.693340Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI Template Match: 'htn.*(prevalence|rate)|prevalence.*(htn|hypertension|bp)' -> HTN prevalence rate", "module": "sql_service", "function": "_check_dashboard_kpi", "line": 388}
{"timestamp": "2026-01-08T10:16:13.693402Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 Using pre-defined KPI template for: HTN prevalence rate", "module": "sql_service", "function": "query", "line": 460}
{"timestamp": "2026-01-08T10:16:13.693498Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 471}
{"timestamp": "2026-01-08T10:16:13.693598Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI TEMPLATE EXECUTION (1 API call):", "module": "sql_service", "function": "_execute_kpi_template", "line": 472}
{"timestamp": "2026-01-08T10:16:13.693670Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 473}
{"timestamp": "2026-01-08T10:16:13.693719Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Template: HTN prevalence rate", "module": "sql_service", "function": "_execute_kpi_template", "line": 474}
{"timestamp": "2026-01-08T10:16:13.693767Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL: SELECT \n            ROUND(\n                (COUNT(DISTINCT CASE WHEN is_referred = TRUE \n                    AND referred_reason IN ('Due to Elevated BP', 'Due to Elevated BP & BG') \n                 ...", "module": "sql_service", "function": "_execute_kpi_template", "line": 475}
{"timestamp": "2026-01-08T10:16:13.729529Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query result: [(Decimal('59.49'),)]", "module": "sql_service", "function": "_execute_kpi_template", "line": 479}
{"timestamp": "2026-01-08T10:16:16.262518Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T10:16:16.285715Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 494}
{"timestamp": "2026-01-08T10:16:16.285819Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u2705 KPI template execution completed with 1 API call", "module": "sql_service", "function": "_execute_kpi_template", "line": 495}
{"timestamp": "2026-01-08T10:16:16.285870Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: The HTN prevalence rate, calculated as the percentage of patients referred due to elevated blood pressure out of those screened for blood pressure, is 59.49%. This indicates that within the NCD (Non-Communicable Diseases) program, 59.49% of individuals who were screened for blood pressure were refer...", "module": "sql_service", "function": "_execute_kpi_template", "line": 496}
{"timestamp": "2026-01-08T10:16:16.285911Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 497}
{"timestamp": "2026-01-08T10:16:16.804996Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T10:16:21.128323Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=867fefe7-296c-4f90-b466-65571e4b1213, duration=9.39s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T10:16:35.061260Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=32", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T10:16:35.061384Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=3c9b9a8f-2533-4e9f-8927-dabb2cd02230): 'what is the DBM prevalence rate?...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T10:16:38.309440Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T10:16:38.917233Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Calculate the DBM prevalence rate using the formula: (Elevated BG Referrals / Screened for BG) * 100...'", "module": "sql_service", "function": "query", "line": 455}
{"timestamp": "2026-01-08T10:16:38.917979Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI Template Match: 'dbm.*(prevalence|rate)|prevalence.*(dbm|diabetes|glucose|bg)' -> DBM prevalence rate", "module": "sql_service", "function": "_check_dashboard_kpi", "line": 388}
{"timestamp": "2026-01-08T10:16:38.918046Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 Using pre-defined KPI template for: DBM prevalence rate", "module": "sql_service", "function": "query", "line": 460}
{"timestamp": "2026-01-08T10:16:38.918096Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 471}
{"timestamp": "2026-01-08T10:16:38.918139Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI TEMPLATE EXECUTION (1 API call):", "module": "sql_service", "function": "_execute_kpi_template", "line": 472}
{"timestamp": "2026-01-08T10:16:38.918187Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 473}
{"timestamp": "2026-01-08T10:16:38.918232Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Template: DBM prevalence rate", "module": "sql_service", "function": "_execute_kpi_template", "line": 474}
{"timestamp": "2026-01-08T10:16:38.918272Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL: SELECT \n            ROUND(\n                (COUNT(DISTINCT CASE WHEN is_referred = TRUE \n                    AND referred_reason IN ('Due to Elevated BG', 'Due to Elevated BP & BG') \n                 ...", "module": "sql_service", "function": "_execute_kpi_template", "line": 475}
{"timestamp": "2026-01-08T10:16:38.943723Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query result: [(Decimal('58.92'),)]", "module": "sql_service", "function": "_execute_kpi_template", "line": 479}
{"timestamp": "2026-01-08T10:16:41.175727Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T10:16:41.176564Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 494}
{"timestamp": "2026-01-08T10:16:41.176618Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u2705 KPI template execution completed with 1 API call", "module": "sql_service", "function": "_execute_kpi_template", "line": 495}
{"timestamp": "2026-01-08T10:16:41.176663Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: The DBM prevalence rate, calculated as the percentage of patients referred due to elevated blood glucose (BG) levels out of those screened for BG, is 58.92%. This indicates that within the Non-Communicable Disease (NCD) program, 58.92% of the individuals who were screened for blood glucose levels we...", "module": "sql_service", "function": "_execute_kpi_template", "line": 496}
{"timestamp": "2026-01-08T10:16:41.176700Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 497}
{"timestamp": "2026-01-08T10:16:42.608846Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T10:16:45.274902Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=3c9b9a8f-2533-4e9f-8927-dabb2cd02230, duration=10.21s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T10:16:59.966579Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=28", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T10:16:59.966746Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=a43f9c0c-f003-4994-b36f-c8ef4612d731): 'What is the screening yield?...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T10:17:01.067573Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T10:17:02.078511Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Calculate the screening yield using the formula: (Screening Referrals / Total Screened) * 100 from v...'", "module": "sql_service", "function": "query", "line": 455}
{"timestamp": "2026-01-08T10:17:02.078700Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI Template Match: 'screening.*(yield|rate)' -> screening yield percentage", "module": "sql_service", "function": "_check_dashboard_kpi", "line": 388}
{"timestamp": "2026-01-08T10:17:02.078728Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 Using pre-defined KPI template for: screening yield percentage", "module": "sql_service", "function": "query", "line": 460}
{"timestamp": "2026-01-08T10:17:02.078815Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 471}
{"timestamp": "2026-01-08T10:17:02.078843Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI TEMPLATE EXECUTION (1 API call):", "module": "sql_service", "function": "_execute_kpi_template", "line": 472}
{"timestamp": "2026-01-08T10:17:02.078861Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 473}
{"timestamp": "2026-01-08T10:17:02.078881Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Template: screening yield percentage", "module": "sql_service", "function": "_execute_kpi_template", "line": 474}
{"timestamp": "2026-01-08T10:17:02.078938Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL: SELECT \n            ROUND(\n                (COUNT(DISTINCT CASE WHEN is_referred = TRUE \n                    AND referred_reason IN ('Due to Elevated BP', 'Due to Elevated BG', 'Due to Elevated BP & B...", "module": "sql_service", "function": "_execute_kpi_template", "line": 475}
{"timestamp": "2026-01-08T10:17:02.098768Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query result: [(Decimal('74.36'),)]", "module": "sql_service", "function": "_execute_kpi_template", "line": 479}
{"timestamp": "2026-01-08T10:17:04.932409Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T10:17:04.935003Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 494}
{"timestamp": "2026-01-08T10:17:04.935113Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u2705 KPI template execution completed with 1 API call", "module": "sql_service", "function": "_execute_kpi_template", "line": 495}
{"timestamp": "2026-01-08T10:17:04.935169Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: The screening yield percentage for the NCD program is 74.36%. This figure represents the proportion of individuals who were referred for further evaluation due to elevated blood pressure (BP) and/or blood glucose (BG) levels, out of the total number of individuals who were screened and had a BP read...", "module": "sql_service", "function": "_execute_kpi_template", "line": 496}
{"timestamp": "2026-01-08T10:17:04.935216Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 497}
{"timestamp": "2026-01-08T10:17:05.783445Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T10:17:09.814847Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=a43f9c0c-f003-4994-b36f-c8ef4612d731, duration=9.85s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T11:05:34.594593Z", "level": "INFO", "logger": "app", "message": "Shutting down application", "module": "app", "function": "lifespan", "line": 34}
{"timestamp": "2026-01-08T11:05:38.742715Z", "level": "INFO", "logger": "app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-08T11:05:38.742758Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-08T11:05:38.742780Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-08T11:05:38.742860Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-08T11:05:38.756861Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-08T11:05:38.756901Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-08T11:05:40.812815Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-08T11:05:40.812928Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-08T11:05:40.813003Z", "level": "INFO", "logger": "app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-08T11:05:40.813024Z", "level": "INFO", "logger": "app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-08T11:14:06.454924Z", "level": "INFO", "logger": "app", "message": "Shutting down application", "module": "app", "function": "lifespan", "line": 34}
{"timestamp": "2026-01-08T11:14:10.055032Z", "level": "INFO", "logger": "app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-08T11:14:10.055087Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-08T11:14:10.055114Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-08T11:14:10.055230Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-08T11:14:10.070816Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-08T11:14:10.070861Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-08T11:14:12.176221Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-08T11:14:12.176346Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-08T11:14:12.176457Z", "level": "INFO", "logger": "app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-08T11:14:12.176481Z", "level": "INFO", "logger": "app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-08T11:15:08.964279Z", "level": "INFO", "logger": "app", "message": "Shutting down application", "module": "app", "function": "lifespan", "line": 34}
{"timestamp": "2026-01-08T11:15:11.829502Z", "level": "INFO", "logger": "app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-08T11:15:11.829552Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-08T11:15:11.829580Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-08T11:15:11.829669Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-08T11:15:11.844077Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-08T11:15:11.844122Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-08T11:15:12.927625Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-08T11:15:12.927716Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-08T11:15:12.927772Z", "level": "INFO", "logger": "app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-08T11:15:12.927792Z", "level": "INFO", "logger": "app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-08T11:18:05.930443Z", "level": "INFO", "logger": "app", "message": "Shutting down application", "module": "app", "function": "lifespan", "line": 34}
{"timestamp": "2026-01-08T11:18:08.781649Z", "level": "INFO", "logger": "app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-08T11:18:08.781705Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-08T11:18:08.781735Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-08T11:18:08.781831Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-08T11:18:08.797061Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-08T11:18:08.797099Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-08T11:18:10.085455Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-08T11:18:10.085548Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-08T11:18:10.085606Z", "level": "INFO", "logger": "app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-08T11:18:10.085634Z", "level": "INFO", "logger": "app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-08T11:18:34.347429Z", "level": "INFO", "logger": "app", "message": "Shutting down application", "module": "app", "function": "lifespan", "line": 34}
{"timestamp": "2026-01-08T11:18:37.251023Z", "level": "INFO", "logger": "app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-08T11:18:37.252798Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-08T11:18:37.252827Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-08T11:18:37.252921Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-08T11:18:37.266262Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-08T11:18:37.266303Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-08T11:18:38.579860Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-08T11:18:38.579955Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-08T11:18:38.580009Z", "level": "INFO", "logger": "app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-08T11:18:38.580034Z", "level": "INFO", "logger": "app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-08T11:23:38.178415Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login attempt for user: admin", "module": "auth", "function": "login", "line": 27}
{"timestamp": "2026-01-08T11:23:38.179010Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login successful for user: admin", "module": "auth", "function": "login", "line": 50}
{"timestamp": "2026-01-08T11:23:50.780011Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=31", "module": "chat", "function": "chat", "line": 36, "user_id": "admin"}
{"timestamp": "2026-01-08T11:23:50.780295Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Initializing AgentService", "module": "agent_service", "function": "__init__", "line": 164}
{"timestamp": "2026-01-08T11:23:50.780476Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Connecting to database at postgresql://admin:admin@127.0.0.1:5432/Spice_BD", "module": "sql_service", "function": "__init__", "line": 229}
{"timestamp": "2026-01-08T11:23:51.110724Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Database connection established with view support", "module": "sql_service", "function": "__init__", "line": 246}
{"timestamp": "2026-01-08T11:23:51.335512Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Cached schema for 39 relevant tables out of 114 total", "module": "sql_service", "function": "_cache_schema", "line": 311}
{"timestamp": "2026-01-08T11:23:51.335574Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Relevant tables: bp_log, current_medication, diagnosis, glucose_log, lab_test, lab_test_result, lab_test_result_range, medical_compliance, medication_country_detail, patient...", "module": "sql_service", "function": "_cache_schema", "line": 312}
{"timestamp": "2026-01-08T11:23:51.450562Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "SQL agent initialized successfully with 39 cached tables", "module": "sql_service", "function": "__init__", "line": 273}
{"timestamp": "2026-01-08T11:23:51.454910Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "AgentService initialized successfully", "module": "agent_service", "function": "__init__", "line": 227}
{"timestamp": "2026-01-08T11:23:51.454966Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=c676cc67-073f-4822-b336-f8afc288b395): 'types 2 diabeties patient count...'", "module": "agent_service", "function": "process_query", "line": 266}
{"timestamp": "2026-01-08T11:23:53.013103Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T11:23:53.435986Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Count patients diagnosed with Type 2 Diabetes....'", "module": "sql_service", "function": "query", "line": 455}
{"timestamp": "2026-01-08T11:23:53.437328Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udd0d Analyzing natural language query", "module": "sql_service", "function": "_is_simple_query", "line": 405}
{"timestamp": "2026-01-08T11:23:53.437470Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Query classified as SIMPLE (natural language)", "module": "sql_service", "function": "_is_simple_query", "line": 448}
{"timestamp": "2026-01-08T11:23:53.437510Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Detected simple query - using optimized execution path", "module": "sql_service", "function": "query", "line": 464}
{"timestamp": "2026-01-08T11:23:53.437544Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_optimized", "line": 506}
{"timestamp": "2026-01-08T11:23:53.437572Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 OPTIMIZED SQL EXECUTION:", "module": "sql_service", "function": "_execute_optimized", "line": 507}
{"timestamp": "2026-01-08T11:23:53.437601Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_optimized", "line": 508}
{"timestamp": "2026-01-08T11:23:53.437632Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " API Call 1: Generate SQL query with targeted schema", "module": "sql_service", "function": "_execute_optimized", "line": 520}
{"timestamp": "2026-01-08T11:23:53.437689Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udccb Selected relevant tables for query: patient, patient_diagnosis, glucose_log, patient_tracker", "module": "sql_service", "function": "_get_relevant_schema", "line": 353}
{"timestamp": "2026-01-08T11:23:54.979899Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T11:23:54.990756Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL to execute: SELECT COUNT(DISTINCT pt.patient_id)\nFROM patient_tracker pt\nJOIN patient_diagnosis pd ON pt.id = pd.patient_track_id\nWHERE pd.diabetes_patient_type = 'Type 2 Diabetes';...", "module": "sql_service", "function": "_execute_optimized", "line": 552}
{"timestamp": "2026-01-08T11:23:54.990848Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Executing query against database (no API call)", "module": "sql_service", "function": "_execute_optimized", "line": 558}
{"timestamp": "2026-01-08T11:23:54.996231Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query result: [(0,)]", "module": "sql_service", "function": "_execute_optimized", "line": 560}
{"timestamp": "2026-01-08T11:23:54.996280Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " API Call 2: Format natural language response", "module": "sql_service", "function": "_execute_optimized", "line": 562}
{"timestamp": "2026-01-08T11:23:56.106231Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T11:23:56.109678Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_optimized", "line": 577}
{"timestamp": "2026-01-08T11:23:56.109852Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Optimized execution completed with 2 API call(s) (vs 7 with agent)", "module": "sql_service", "function": "_execute_optimized", "line": 578}
{"timestamp": "2026-01-08T11:23:56.109955Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: There are no patients diagnosed with Type 2 Diabetes....", "module": "sql_service", "function": "_execute_optimized", "line": 579}
{"timestamp": "2026-01-08T11:23:56.110034Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_optimized", "line": 580}
{"timestamp": "2026-01-08T11:23:56.617245Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T11:23:58.885025Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=c676cc67-073f-4822-b336-f8afc288b395, duration=7.43s)", "module": "agent_service", "function": "process_query", "line": 312}
{"timestamp": "2026-01-08T11:24:21.181576Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login attempt for user: admin", "module": "auth", "function": "login", "line": 27}
{"timestamp": "2026-01-08T11:24:21.182586Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login successful for user: admin", "module": "auth", "function": "login", "line": 50}
{"timestamp": "2026-01-08T11:24:28.987955Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=17", "module": "chat", "function": "chat", "line": 36, "user_id": "admin"}
{"timestamp": "2026-01-08T11:24:28.989101Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=e0969deb-eceb-4298-ab0c-9d4a49d8244c): 'types of patients...'", "module": "agent_service", "function": "process_query", "line": 266}
{"timestamp": "2026-01-08T11:24:31.228600Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T11:24:38.724877Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=e0969deb-eceb-4298-ab0c-9d4a49d8244c, duration=9.74s)", "module": "agent_service", "function": "process_query", "line": 312}
{"timestamp": "2026-01-08T11:25:15.954391Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login attempt for user: admin", "module": "auth", "function": "login", "line": 27}
{"timestamp": "2026-01-08T11:25:15.955449Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login successful for user: admin", "module": "auth", "function": "login", "line": 50}
{"timestamp": "2026-01-08T11:29:53.539482Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Streaming chat request from user=admin, query_length=13", "module": "chat", "function": "chat_stream", "line": 93, "user_id": "admin"}
{"timestamp": "2026-01-08T11:29:53.548680Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing streaming query (trace_id=ae0da9d3-2784-4894-90e9-784db1d7a510): 'pateitns w bp...'", "module": "agent_service", "function": "process_query_stream", "line": 338}
{"timestamp": "2026-01-08T11:29:54.712687Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1740}
{"timestamp": "2026-01-08T11:29:55.433165Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "\u2705 Streaming query completed (trace_id=ae0da9d3-2784-4894-90e9-784db1d7a510, duration=1.88s)", "module": "agent_service", "function": "process_query_stream", "line": 474}
{"timestamp": "2026-01-08T11:30:11.987413Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Streaming chat request from user=admin, query_length=65", "module": "chat", "function": "chat_stream", "line": 93, "user_id": "admin"}
{"timestamp": "2026-01-08T11:30:11.989435Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing streaming query (trace_id=adc38f30-3a37-462a-9f44-a563d5e847b4): 'Find records where the doctor advised the patient to quit smoking...'", "module": "agent_service", "function": "process_query_stream", "line": 338}
{"timestamp": "2026-01-08T11:30:13.763279Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1740}
{"timestamp": "2026-01-08T11:30:13.966713Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "\u26a1 Lazy loading vector store on first use...", "module": "agent_service", "function": "vector_store", "line": 233}
{"timestamp": "2026-01-08T11:30:13.967024Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Initializing vector store service", "module": "vector_store", "function": "__init__", "line": 30}
{"timestamp": "2026-01-08T11:30:13.967755Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Looking for RAG config at: /Users/adityanbhatt/fhir_rag/backend/config/embedding_config.yaml", "module": "vector_store", "function": "__init__", "line": 41}
{"timestamp": "2026-01-08T11:30:13.967889Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Loading RAG config from /Users/adityanbhatt/fhir_rag/backend/config/embedding_config.yaml", "module": "vector_store", "function": "__init__", "line": 46}
{"timestamp": "2026-01-08T11:30:13.977561Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Loaded RAG config successfully", "module": "vector_store", "function": "__init__", "line": 51}
{"timestamp": "2026-01-08T11:30:13.978042Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Resolved chroma_path to: /Users/adityanbhatt/fhir_rag/backend/data/indexes/chroma_db_advanced", "module": "retrieve", "function": "_resolve_config_paths", "line": 155}
{"timestamp": "2026-01-08T11:30:13.978182Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Resolved model_path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "retrieve", "function": "_resolve_config_paths", "line": 162}
{"timestamp": "2026-01-08T11:30:14.059647Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Loading docstore from /Users/adityanbhatt/fhir_rag/backend/data/indexes/chroma_db_advanced/parent_docstore.pkl with module remapping", "module": "retrieve", "function": "_load_docstore", "line": 284}
{"timestamp": "2026-01-08T11:30:14.567456Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Successfully loaded docstore with module remapping", "module": "retrieve", "function": "_load_docstore", "line": 286}
{"timestamp": "2026-01-08T11:30:14.568787Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Loading 154161 parent documents for BM25...", "module": "retrieve", "function": "_setup_retrievers", "line": 175}
{"timestamp": "2026-01-08T11:30:14.591884Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Filtered to 59572 documents from relevant tables for BM25 index.", "module": "retrieve", "function": "_setup_retrievers", "line": 185}
{"timestamp": "2026-01-08T11:30:15.406716Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "BM25Retriever initialized on relevant tables.", "module": "retrieve", "function": "_setup_retrievers", "line": 196}
{"timestamp": "2026-01-08T11:30:15.407750Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Initializing reranker: BAAI/bge-reranker-base", "module": "retrieve", "function": "__init__", "line": 137}
{"timestamp": "2026-01-08T11:30:17.568014Z", "level": "INFO", "logger": "sentence_transformers.cross_encoder.CrossEncoder", "message": "Use pytorch device: mps", "module": "CrossEncoder", "function": "__init__", "line": 222}
{"timestamp": "2026-01-08T11:30:18.885671Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Advanced RAG Retriever initialized successfully.", "module": "retrieve", "function": "__init__", "line": 143}
{"timestamp": "2026-01-08T11:30:18.886652Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Vector store initialized successfully", "module": "vector_store", "function": "__init__", "line": 55}
{"timestamp": "2026-01-08T11:30:18.887054Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "\u2705 Vector store loaded", "module": "agent_service", "function": "vector_store", "line": 235}
{"timestamp": "2026-01-08T11:30:18.887498Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Searching vector store for query: 'doctor advised to quit smoking...' (top_k=5)", "module": "vector_store", "function": "search", "line": 69}
{"timestamp": "2026-01-08T11:30:18.888719Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Executing query: doctor advised to quit smoking", "module": "retrieve", "function": "_get_relevant_documents", "line": 223}
{"timestamp": "2026-01-08T11:30:21.900677Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Reranking 100 documents for query: 'doctor advised to quit smoking'", "module": "retrieve", "function": "_get_relevant_documents", "line": 257}
{"timestamp": "2026-01-08T11:30:23.749609Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Returning 10 reranked documents.", "module": "retrieve", "function": "_get_relevant_documents", "line": 267}
{"timestamp": "2026-01-08T11:30:23.749810Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Retrieved 10 documents from vector store", "module": "vector_store", "function": "search", "line": 84}
{"timestamp": "2026-01-08T11:30:24.410975Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1740}
{"timestamp": "2026-01-08T11:30:27.503791Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "\u2705 Streaming query completed (trace_id=adc38f30-3a37-462a-9f44-a563d5e847b4, duration=15.51s)", "module": "agent_service", "function": "process_query_stream", "line": 474}
{"timestamp": "2026-01-08T11:30:39.679836Z", "level": "INFO", "logger": "app", "message": "Shutting down application", "module": "app", "function": "lifespan", "line": 34}
{"timestamp": "2026-01-08T11:30:44.776563Z", "level": "INFO", "logger": "app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-08T11:30:44.776610Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-08T11:30:44.776634Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-08T11:30:44.776721Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-08T11:30:44.793607Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-08T11:30:44.793651Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-08T11:30:46.423692Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-08T11:30:46.423790Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-08T11:30:46.423834Z", "level": "INFO", "logger": "app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-08T11:30:46.423855Z", "level": "INFO", "logger": "app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-08T11:30:49.561743Z", "level": "INFO", "logger": "app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-08T11:30:49.561780Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-08T11:30:49.561806Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-08T11:30:49.561901Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-08T11:30:49.576879Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-08T11:30:49.576921Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-08T11:30:50.865384Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-08T11:30:50.865441Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-08T11:30:50.865469Z", "level": "INFO", "logger": "app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-08T11:30:50.865490Z", "level": "INFO", "logger": "app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
