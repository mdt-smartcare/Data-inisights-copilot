{"timestamp": "2026-01-08T09:01:14.324402Z", "level": "INFO", "logger": "app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-08T09:01:14.324452Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-08T09:01:14.324475Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-08T09:01:14.324554Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-08T09:01:14.339087Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-08T09:01:14.339130Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-08T09:01:15.888142Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-08T09:01:15.888192Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-08T09:01:15.888216Z", "level": "INFO", "logger": "app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-08T09:01:15.888234Z", "level": "INFO", "logger": "app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-08T09:01:51.041116Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login attempt for user: admin", "module": "auth", "function": "login", "line": 27}
{"timestamp": "2026-01-08T09:01:51.041522Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login successful for user: admin", "module": "auth", "function": "login", "line": 50}
{"timestamp": "2026-01-08T09:02:09.249641Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=36", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:02:09.249756Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Initializing AgentService", "module": "agent_service", "function": "__init__", "line": 121}
{"timestamp": "2026-01-08T09:02:09.249848Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Connecting to database at postgresql://admin:admin@127.0.0.1:5432/Spice_BD", "module": "sql_service", "function": "__init__", "line": 26}
{"timestamp": "2026-01-08T09:02:09.432908Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Database connection established", "module": "sql_service", "function": "__init__", "line": 31}
{"timestamp": "2026-01-08T09:02:09.494203Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Cached schema for 37 relevant tables out of 112 total", "module": "sql_service", "function": "_cache_schema", "line": 215}
{"timestamp": "2026-01-08T09:02:09.494251Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Relevant tables: bp_log, current_medication, diagnosis, glucose_log, lab_test, lab_test_result, lab_test_result_range, medical_compliance, medication_country_detail, patient...", "module": "sql_service", "function": "_cache_schema", "line": 216}
{"timestamp": "2026-01-08T09:02:09.607646Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "SQL agent initialized successfully with 37 cached tables", "module": "sql_service", "function": "__init__", "line": 63}
{"timestamp": "2026-01-08T09:02:09.612307Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "AgentService initialized successfully", "module": "agent_service", "function": "__init__", "line": 184}
{"timestamp": "2026-01-08T09:02:09.612357Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=ab45416a-33b4-4e49-b687-b7cf503ea22e): 'count of patients with hypertension....'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:02:10.978209Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:02:11.530241Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Count of patients with hypertension (systolic >= 140 OR diastolic >= 90)...'", "module": "sql_service", "function": "query", "line": 381}
{"timestamp": "2026-01-08T09:02:11.530357Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udd0d Analyzing natural language query", "module": "sql_service", "function": "_is_simple_query", "line": 323}
{"timestamp": "2026-01-08T09:02:11.530619Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query classified as COMPLEX (pattern=True, complexity=True, multi_table=False)", "module": "sql_service", "function": "_is_simple_query", "line": 366}
{"timestamp": "2026-01-08T09:02:11.530669Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Complex query detected - using full agent", "module": "sql_service", "function": "query", "line": 388}
{"timestamp": "2026-01-08T09:02:11.530713Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 524}
{"timestamp": "2026-01-08T09:02:11.530752Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL AGENT EXECUTION TRACE:", "module": "sql_service", "function": "_execute_with_agent", "line": 525}
{"timestamp": "2026-01-08T09:02:11.530791Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 526}
{"timestamp": "2026-01-08T09:02:12.881951Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:02:14.007490Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:02:15.134272Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:02:16.666406Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:02:19.332969Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:02:21.582785Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:02:24.140307Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 552}
{"timestamp": "2026-01-08T09:02:24.140410Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL query completed. Result length: 152 chars", "module": "sql_service", "function": "_execute_with_agent", "line": 553}
{"timestamp": "2026-01-08T09:02:24.140460Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: There are 6,298 patients with hypertension, defined as having a systolic blood pressure of 140 or higher, or a diastolic blood pressure of 90 or higher....", "module": "sql_service", "function": "_execute_with_agent", "line": 555}
{"timestamp": "2026-01-08T09:02:24.140498Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 556}
{"timestamp": "2026-01-08T09:02:24.759612Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:02:28.338002Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=ab45416a-33b4-4e49-b687-b7cf503ea22e, duration=18.73s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:03:27.684431Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Initializing vector store service", "module": "vector_store", "function": "__init__", "line": 30}
{"timestamp": "2026-01-08T09:03:27.685478Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Looking for RAG config at: /Users/adityanbhatt/fhir_rag/backend/config/embedding_config.yaml", "module": "vector_store", "function": "__init__", "line": 41}
{"timestamp": "2026-01-08T09:03:27.685513Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Loading RAG config from /Users/adityanbhatt/fhir_rag/backend/config/embedding_config.yaml", "module": "vector_store", "function": "__init__", "line": 46}
{"timestamp": "2026-01-08T09:03:27.688271Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Loaded RAG config successfully", "module": "vector_store", "function": "__init__", "line": 51}
{"timestamp": "2026-01-08T09:03:27.688425Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Resolved chroma_path to: /Users/adityanbhatt/fhir_rag/backend/data/indexes/chroma_db_advanced", "module": "retrieve", "function": "_resolve_config_paths", "line": 155}
{"timestamp": "2026-01-08T09:03:27.688493Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Resolved model_path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "retrieve", "function": "_resolve_config_paths", "line": 162}
{"timestamp": "2026-01-08T09:03:27.752263Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Loading docstore from /Users/adityanbhatt/fhir_rag/backend/data/indexes/chroma_db_advanced/parent_docstore.pkl with module remapping", "module": "retrieve", "function": "_load_docstore", "line": 284}
{"timestamp": "2026-01-08T09:03:28.222730Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Successfully loaded docstore with module remapping", "module": "retrieve", "function": "_load_docstore", "line": 286}
{"timestamp": "2026-01-08T09:03:28.224067Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Loading 154161 parent documents for BM25...", "module": "retrieve", "function": "_setup_retrievers", "line": 175}
{"timestamp": "2026-01-08T09:03:28.246694Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Filtered to 59572 documents from relevant tables for BM25 index.", "module": "retrieve", "function": "_setup_retrievers", "line": 185}
{"timestamp": "2026-01-08T09:03:29.296786Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "BM25Retriever initialized on relevant tables.", "module": "retrieve", "function": "_setup_retrievers", "line": 196}
{"timestamp": "2026-01-08T09:03:29.297745Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Initializing reranker: BAAI/bge-reranker-base", "module": "retrieve", "function": "__init__", "line": 137}
{"timestamp": "2026-01-08T09:03:31.167095Z", "level": "INFO", "logger": "sentence_transformers.cross_encoder.CrossEncoder", "message": "Use pytorch device: mps", "module": "CrossEncoder", "function": "__init__", "line": 222}
{"timestamp": "2026-01-08T09:03:32.146072Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Advanced RAG Retriever initialized successfully.", "module": "retrieve", "function": "__init__", "line": 143}
{"timestamp": "2026-01-08T09:03:32.146346Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Vector store initialized successfully", "module": "vector_store", "function": "__init__", "line": 55}
{"timestamp": "2026-01-08T09:03:32.146512Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Searching vector store for query: 'test health check...' (top_k=1)", "module": "vector_store", "function": "search", "line": 69}
{"timestamp": "2026-01-08T09:03:32.147363Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Executing query: test health check", "module": "retrieve", "function": "_get_relevant_documents", "line": 223}
{"timestamp": "2026-01-08T09:03:35.238428Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Reranking 82 documents for query: 'test health check'", "module": "retrieve", "function": "_get_relevant_documents", "line": 257}
{"timestamp": "2026-01-08T09:03:36.788992Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Returning 10 reranked documents.", "module": "retrieve", "function": "_get_relevant_documents", "line": 267}
{"timestamp": "2026-01-08T09:03:36.789232Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Retrieved 10 documents from vector store", "module": "vector_store", "function": "search", "line": 84}
{"timestamp": "2026-01-08T09:03:46.022954Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=42", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:03:46.023612Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=e9019fec-a240-4c14-a27e-a17ff0c95115): 'total count of patients with hypertension....'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:03:46.956154Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:03:47.261599Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Count the total number of patients with hypertension....'", "module": "sql_service", "function": "query", "line": 381}
{"timestamp": "2026-01-08T09:03:47.261806Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udd0d Analyzing natural language query", "module": "sql_service", "function": "_is_simple_query", "line": 323}
{"timestamp": "2026-01-08T09:03:47.261944Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query classified as COMPLEX (pattern=True, complexity=True, multi_table=False)", "module": "sql_service", "function": "_is_simple_query", "line": 366}
{"timestamp": "2026-01-08T09:03:47.262019Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Complex query detected - using full agent", "module": "sql_service", "function": "query", "line": 388}
{"timestamp": "2026-01-08T09:03:47.262117Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 524}
{"timestamp": "2026-01-08T09:03:47.262160Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL AGENT EXECUTION TRACE:", "module": "sql_service", "function": "_execute_with_agent", "line": 525}
{"timestamp": "2026-01-08T09:03:47.262192Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 526}
{"timestamp": "2026-01-08T09:03:47.926636Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:03:48.592705Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:03:49.691387Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:03:51.443344Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:03:52.175452Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:03:53.286932Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:03:53.564297Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 552}
{"timestamp": "2026-01-08T09:03:53.564515Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL query completed. Result length: 56 chars", "module": "sql_service", "function": "_execute_with_agent", "line": 553}
{"timestamp": "2026-01-08T09:03:53.564569Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: The total number of patients with hypertension is 1,130....", "module": "sql_service", "function": "_execute_with_agent", "line": 555}
{"timestamp": "2026-01-08T09:03:53.564611Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 556}
{"timestamp": "2026-01-08T09:03:54.091835Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:03:57.323582Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=e9019fec-a240-4c14-a27e-a17ff0c95115, duration=11.30s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:04:09.337443Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=36", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:04:09.337862Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=a7fa526e-a91d-42f2-8dae-3177f1a86c42): 'count of patients with hypertension....'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:04:10.134095Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:04:10.659973Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Count of patients with hypertension....'", "module": "sql_service", "function": "query", "line": 381}
{"timestamp": "2026-01-08T09:04:10.660060Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udd0d Analyzing natural language query", "module": "sql_service", "function": "_is_simple_query", "line": 323}
{"timestamp": "2026-01-08T09:04:10.660131Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query classified as COMPLEX (pattern=True, complexity=True, multi_table=False)", "module": "sql_service", "function": "_is_simple_query", "line": 366}
{"timestamp": "2026-01-08T09:04:10.660170Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Complex query detected - using full agent", "module": "sql_service", "function": "query", "line": 388}
{"timestamp": "2026-01-08T09:04:10.660205Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 524}
{"timestamp": "2026-01-08T09:04:10.660239Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL AGENT EXECUTION TRACE:", "module": "sql_service", "function": "_execute_with_agent", "line": 525}
{"timestamp": "2026-01-08T09:04:10.660271Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 526}
{"timestamp": "2026-01-08T09:04:11.570976Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:04:12.283157Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:04:13.307392Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:04:14.844059Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:04:16.077799Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:04:17.303489Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:04:17.444756Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 552}
{"timestamp": "2026-01-08T09:04:17.444847Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL query completed. Result length: 53 chars", "module": "sql_service", "function": "_execute_with_agent", "line": 553}
{"timestamp": "2026-01-08T09:04:17.444886Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: There are 1,130 patients diagnosed with hypertension....", "module": "sql_service", "function": "_execute_with_agent", "line": 555}
{"timestamp": "2026-01-08T09:04:17.444923Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 556}
{"timestamp": "2026-01-08T09:04:18.020662Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:04:22.654470Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=a7fa526e-a91d-42f2-8dae-3177f1a86c42, duration=13.32s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:04:22.656859Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login attempt for user: admin", "module": "auth", "function": "login", "line": 27}
{"timestamp": "2026-01-08T09:04:22.657147Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login successful for user: admin", "module": "auth", "function": "login", "line": 50}
{"timestamp": "2026-01-08T09:04:22.877124Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=51", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:04:22.877198Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=bc4c6849-d1e7-4c8e-ade7-028f82647103): 'How many patients were screened for blood pressure?...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:04:23.555041Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:04:24.502471Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Count the number of patients who were screened for blood pressure using v_analytics_screening where ...'", "module": "sql_service", "function": "query", "line": 381}
{"timestamp": "2026-01-08T09:04:24.502605Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udd0d Analyzing natural language query", "module": "sql_service", "function": "_is_simple_query", "line": 323}
{"timestamp": "2026-01-08T09:04:24.502731Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query classified as SIMPLE (natural language)", "module": "sql_service", "function": "_is_simple_query", "line": 364}
{"timestamp": "2026-01-08T09:04:24.502794Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Detected simple query - using optimized execution path", "module": "sql_service", "function": "query", "line": 385}
{"timestamp": "2026-01-08T09:04:24.502855Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_optimized", "line": 397}
{"timestamp": "2026-01-08T09:04:24.502903Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 OPTIMIZED SQL EXECUTION:", "module": "sql_service", "function": "_execute_optimized", "line": 398}
{"timestamp": "2026-01-08T09:04:24.502941Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_optimized", "line": 399}
{"timestamp": "2026-01-08T09:04:24.502992Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " API Call 1: Generate SQL query with targeted schema", "module": "sql_service", "function": "_execute_optimized", "line": 414}
{"timestamp": "2026-01-08T09:04:24.503076Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udccb Selected relevant tables for query: patient, bp_log, patient_tracker", "module": "sql_service", "function": "_get_relevant_schema", "line": 266}
{"timestamp": "2026-01-08T09:04:26.025403Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:04:26.028835Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL to execute: SELECT COUNT(DISTINCT patient_id) \nFROM v_analytics_screening \nWHERE workflow_status = 'NCD' \nAND has_bp_reading = TRUE;...", "module": "sql_service", "function": "_execute_optimized", "line": 448}
{"timestamp": "2026-01-08T09:04:26.029025Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Executing query against database (no API call)", "module": "sql_service", "function": "_execute_optimized", "line": 456}
{"timestamp": "2026-01-08T09:04:26.038988Z", "level": "WARNING", "logger": "backend.services.sql_service", "message": "  Optimized execution failed: (psycopg2.errors.UndefinedColumn) column \"patient_id\" does not exist\nLINE 1: SELECT COUNT(DISTINCT patient_id) \n                              ^\n\n[SQL: SELECT COUNT(DISTINCT patient_id) \nFROM v_analytics_screening \nWHERE workflow_status = 'NCD' \nAND has_bp_reading = TRUE;]\n(Background on this error at: https://sqlalche.me/e/20/f405). Falling back to full agent.", "module": "sql_service", "function": "_execute_optimized", "line": 484}
{"timestamp": "2026-01-08T09:04:26.045800Z", "level": "ERROR", "logger": "backend.services.sql_service", "message": "Error details: (psycopg2.errors.UndefinedColumn) column \"patient_id\" does not exist\nLINE 1: SELECT COUNT(DISTINCT patient_id) \n                              ^\n\n[SQL: SELECT COUNT(DISTINCT patient_id) \nFROM v_analytics_screening \nWHERE workflow_status = 'NCD' \nAND has_bp_reading = TRUE;]\n(Background on this error at: https://sqlalche.me/e/20/f405)", "module": "sql_service", "function": "_execute_optimized", "line": 485, "exception": "Traceback (most recent call last):\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/base.py\", line 1971, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/default.py\", line 919, in do_execute\n    cursor.execute(statement, parameters)\npsycopg2.errors.UndefinedColumn: column \"patient_id\" does not exist\nLINE 1: SELECT COUNT(DISTINCT patient_id) \n                              ^\n\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/Users/adityanbhatt/fhir_rag/backend/services/sql_service.py\", line 457, in _execute_optimized\n    result = self.db.run(sql_query)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_community/utilities/sql_database.py\", line 578, in run\n    result = self._execute(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_community/utilities/sql_database.py\", line 543, in _execute\n    cursor = connection.execute(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/base.py\", line 1422, in execute\n    return meth(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/sql/elements.py\", line 514, in _execute_on_connection\n    return connection._execute_clauseelement(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/base.py\", line 1644, in _execute_clauseelement\n    ret = self._execute_context(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/base.py\", line 1850, in _execute_context\n    return self._exec_single_context(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/base.py\", line 1990, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/base.py\", line 2357, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/base.py\", line 1971, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/default.py\", line 919, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column \"patient_id\" does not exist\nLINE 1: SELECT COUNT(DISTINCT patient_id) \n                              ^\n\n[SQL: SELECT COUNT(DISTINCT patient_id) \nFROM v_analytics_screening \nWHERE workflow_status = 'NCD' \nAND has_bp_reading = TRUE;]\n(Background on this error at: https://sqlalche.me/e/20/f405)"}
{"timestamp": "2026-01-08T09:04:26.046149Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 524}
{"timestamp": "2026-01-08T09:04:26.046198Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL AGENT EXECUTION TRACE:", "module": "sql_service", "function": "_execute_with_agent", "line": 525}
{"timestamp": "2026-01-08T09:04:26.046235Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 526}
{"timestamp": "2026-01-08T09:04:26.871302Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:04:27.645506Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:04:28.507621Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:04:28.807578Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 552}
{"timestamp": "2026-01-08T09:04:28.807615Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL query completed. Result length: 183 chars", "module": "sql_service", "function": "_execute_with_agent", "line": 553}
{"timestamp": "2026-01-08T09:04:28.807637Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: It seems that the table `v_analytics_screening` does not exist in the database. Please check if the table name is correct or if there is another table that contains the relevant data....", "module": "sql_service", "function": "_execute_with_agent", "line": 555}
{"timestamp": "2026-01-08T09:04:28.807654Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 556}
{"timestamp": "2026-01-08T09:04:29.588701Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:04:31.505956Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Count the number of screened patients for blood pressure from v_analytics_screening where workflow_s...'", "module": "sql_service", "function": "query", "line": 381}
{"timestamp": "2026-01-08T09:04:31.506011Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udd0d Analyzing natural language query", "module": "sql_service", "function": "_is_simple_query", "line": 323}
{"timestamp": "2026-01-08T09:04:31.506054Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query classified as SIMPLE (natural language)", "module": "sql_service", "function": "_is_simple_query", "line": 364}
{"timestamp": "2026-01-08T09:04:31.506077Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Detected simple query - using optimized execution path", "module": "sql_service", "function": "query", "line": 385}
{"timestamp": "2026-01-08T09:04:31.506098Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_optimized", "line": 397}
{"timestamp": "2026-01-08T09:04:31.506118Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 OPTIMIZED SQL EXECUTION:", "module": "sql_service", "function": "_execute_optimized", "line": 398}
{"timestamp": "2026-01-08T09:04:31.506136Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_optimized", "line": 399}
{"timestamp": "2026-01-08T09:04:31.506155Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " API Call 1: Generate SQL query with targeted schema", "module": "sql_service", "function": "_execute_optimized", "line": 414}
{"timestamp": "2026-01-08T09:04:31.506185Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udccb Selected relevant tables for query: patient, bp_log, patient_tracker", "module": "sql_service", "function": "_get_relevant_schema", "line": 266}
{"timestamp": "2026-01-08T09:04:32.338720Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:04:32.340917Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL to execute: SELECT COUNT(*) \nFROM v_analytics_screening \nWHERE workflow_status = 'NCD' \nAND has_bp_reading = TRUE;...", "module": "sql_service", "function": "_execute_optimized", "line": 448}
{"timestamp": "2026-01-08T09:04:32.341106Z", "level": "WARNING", "logger": "backend.services.sql_service", "message": "Query doesn't reference any known tables", "module": "sql_service", "function": "_validate_sql_query", "line": 509}
{"timestamp": "2026-01-08T09:04:32.341215Z", "level": "WARNING", "logger": "backend.services.sql_service", "message": "  SQL validation failed, falling back to agent", "module": "sql_service", "function": "_execute_optimized", "line": 452}
{"timestamp": "2026-01-08T09:04:32.341297Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 524}
{"timestamp": "2026-01-08T09:04:32.341514Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL AGENT EXECUTION TRACE:", "module": "sql_service", "function": "_execute_with_agent", "line": 525}
{"timestamp": "2026-01-08T09:04:32.341665Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 526}
{"timestamp": "2026-01-08T09:04:33.016074Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:04:33.740320Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:04:34.606406Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:04:35.290892Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 552}
{"timestamp": "2026-01-08T09:04:35.292146Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL query completed. Result length: 143 chars", "module": "sql_service", "function": "_execute_with_agent", "line": 553}
{"timestamp": "2026-01-08T09:04:35.292254Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: It seems that the table `v_analytics_screening` does not exist in the database. Could you please verify the table name or provide more details?...", "module": "sql_service", "function": "_execute_with_agent", "line": 555}
{"timestamp": "2026-01-08T09:04:35.292396Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 556}
{"timestamp": "2026-01-08T09:04:35.629859Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 429 Too Many Requests\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:04:35.630600Z", "level": "INFO", "logger": "openai._base_client", "message": "Retrying request to /chat/completions in 1.508000 seconds", "module": "_base_client", "function": "_sleep_for_retry", "line": 1071}
{"timestamp": "2026-01-08T09:04:37.784604Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:04:42.859289Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=bc4c6849-d1e7-4c8e-ade7-028f82647103, duration=19.98s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:04:42.861797Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login attempt for user: admin", "module": "auth", "function": "login", "line": 27}
{"timestamp": "2026-01-08T09:04:42.862341Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login successful for user: admin", "module": "auth", "function": "login", "line": 50}
{"timestamp": "2026-01-08T09:05:46.323376Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=36", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:05:46.323957Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=9fa4ce49-d4da-4e2f-8b76-e16ad0bbfa9f): 'count of patients with hypertension....'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:05:47.294196Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:05:47.719721Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Count of patients with hypertension (systolic >= 140 OR diastolic >= 90)...'", "module": "sql_service", "function": "query", "line": 381}
{"timestamp": "2026-01-08T09:05:47.719947Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udd0d Analyzing natural language query", "module": "sql_service", "function": "_is_simple_query", "line": 323}
{"timestamp": "2026-01-08T09:05:47.720181Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query classified as COMPLEX (pattern=True, complexity=True, multi_table=False)", "module": "sql_service", "function": "_is_simple_query", "line": 366}
{"timestamp": "2026-01-08T09:05:47.720271Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Complex query detected - using full agent", "module": "sql_service", "function": "query", "line": 388}
{"timestamp": "2026-01-08T09:05:47.720349Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 524}
{"timestamp": "2026-01-08T09:05:47.720412Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL AGENT EXECUTION TRACE:", "module": "sql_service", "function": "_execute_with_agent", "line": 525}
{"timestamp": "2026-01-08T09:05:47.720465Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 526}
{"timestamp": "2026-01-08T09:05:48.785843Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:05:49.569755Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:05:50.491718Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:05:51.827391Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:05:52.693415Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:05:53.665931Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:05:53.993843Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 552}
{"timestamp": "2026-01-08T09:05:53.994067Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL query completed. Result length: 152 chars", "module": "sql_service", "function": "_execute_with_agent", "line": 553}
{"timestamp": "2026-01-08T09:05:53.994177Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: There are 6,298 patients with hypertension, defined as having a systolic blood pressure of 140 or higher, or a diastolic blood pressure of 90 or higher....", "module": "sql_service", "function": "_execute_with_agent", "line": 555}
{"timestamp": "2026-01-08T09:05:53.994305Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 556}
{"timestamp": "2026-01-08T09:05:54.599280Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:05:57.640922Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=9fa4ce49-d4da-4e2f-8b76-e16ad0bbfa9f, duration=11.32s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:06:24.454443Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=36", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:06:24.454796Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=937626bd-d9b6-43a7-9ed9-4ac180ab55d0): 'count of patients with hypertension....'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:06:25.153892Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:06:25.435894Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Count of patients with hypertension....'", "module": "sql_service", "function": "query", "line": 381}
{"timestamp": "2026-01-08T09:06:25.435961Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udd0d Analyzing natural language query", "module": "sql_service", "function": "_is_simple_query", "line": 323}
{"timestamp": "2026-01-08T09:06:25.436017Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query classified as COMPLEX (pattern=True, complexity=True, multi_table=False)", "module": "sql_service", "function": "_is_simple_query", "line": 366}
{"timestamp": "2026-01-08T09:06:25.436049Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Complex query detected - using full agent", "module": "sql_service", "function": "query", "line": 388}
{"timestamp": "2026-01-08T09:06:25.436074Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 524}
{"timestamp": "2026-01-08T09:06:25.436100Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL AGENT EXECUTION TRACE:", "module": "sql_service", "function": "_execute_with_agent", "line": 525}
{"timestamp": "2026-01-08T09:06:25.436122Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 526}
{"timestamp": "2026-01-08T09:06:26.058328Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:06:26.716471Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:06:27.675987Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:06:28.732993Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:06:29.392067Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:06:31.244565Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:06:31.740142Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 552}
{"timestamp": "2026-01-08T09:06:31.740374Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL query completed. Result length: 53 chars", "module": "sql_service", "function": "_execute_with_agent", "line": 553}
{"timestamp": "2026-01-08T09:06:31.740526Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: There are 1,130 patients diagnosed with hypertension....", "module": "sql_service", "function": "_execute_with_agent", "line": 555}
{"timestamp": "2026-01-08T09:06:31.740605Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 556}
{"timestamp": "2026-01-08T09:06:32.780636Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:06:37.634143Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=937626bd-d9b6-43a7-9ed9-4ac180ab55d0, duration=13.18s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:06:48.809491Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=56", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:06:48.809666Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=ab2e87e6-a13e-431a-bda3-c3958e3e8d9e): 'What is the average blood pressure among these patients?...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:06:49.597202Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:06:50.176416Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Calculate the average systolic and diastolic blood pressure for patients in the database....'", "module": "sql_service", "function": "query", "line": 381}
{"timestamp": "2026-01-08T09:06:50.176635Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udd0d Analyzing natural language query", "module": "sql_service", "function": "_is_simple_query", "line": 323}
{"timestamp": "2026-01-08T09:06:50.177902Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query classified as SIMPLE (natural language)", "module": "sql_service", "function": "_is_simple_query", "line": 364}
{"timestamp": "2026-01-08T09:06:50.178063Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Detected simple query - using optimized execution path", "module": "sql_service", "function": "query", "line": 385}
{"timestamp": "2026-01-08T09:06:50.178153Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_optimized", "line": 397}
{"timestamp": "2026-01-08T09:06:50.178217Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 OPTIMIZED SQL EXECUTION:", "module": "sql_service", "function": "_execute_optimized", "line": 398}
{"timestamp": "2026-01-08T09:06:50.178259Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_optimized", "line": 399}
{"timestamp": "2026-01-08T09:06:50.178329Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " API Call 1: Generate SQL query with targeted schema", "module": "sql_service", "function": "_execute_optimized", "line": 414}
{"timestamp": "2026-01-08T09:06:50.178450Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udccb Selected relevant tables for query: patient, bp_log, patient_tracker", "module": "sql_service", "function": "_get_relevant_schema", "line": 266}
{"timestamp": "2026-01-08T09:06:50.975099Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:06:50.980466Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL to execute: SELECT AVG(avg_systolic) AS avg_systolic, AVG(avg_diastolic) AS avg_diastolic FROM bp_log;...", "module": "sql_service", "function": "_execute_optimized", "line": 448}
{"timestamp": "2026-01-08T09:06:50.980640Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Executing query against database (no API call)", "module": "sql_service", "function": "_execute_optimized", "line": 456}
{"timestamp": "2026-01-08T09:06:50.993030Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query result: [(Decimal('137.2907228678353358'), Decimal('90.9827654126452630'))]", "module": "sql_service", "function": "_execute_optimized", "line": 458}
{"timestamp": "2026-01-08T09:06:50.993127Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " API Call 2: Format natural language response", "module": "sql_service", "function": "_execute_optimized", "line": 461}
{"timestamp": "2026-01-08T09:06:51.887524Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:06:51.892537Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_optimized", "line": 476}
{"timestamp": "2026-01-08T09:06:51.892631Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Optimized execution completed with 2 API call(s) (vs 7 with agent)", "module": "sql_service", "function": "_execute_optimized", "line": 477}
{"timestamp": "2026-01-08T09:06:51.892685Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: The average systolic blood pressure for patients in the database is approximately 137.29 mmHg, and the average diastolic blood pressure is approximately 90.98 mmHg....", "module": "sql_service", "function": "_execute_optimized", "line": 478}
{"timestamp": "2026-01-08T09:06:51.892729Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_optimized", "line": 479}
{"timestamp": "2026-01-08T09:06:52.392643Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:06:55.262933Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=ab2e87e6-a13e-431a-bda3-c3958e3e8d9e, duration=6.45s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:07:13.576877Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=154", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:07:13.577045Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=82403202-ccc6-490d-93ce-747a1040e251): 'The count of patients with hypertension, defined as having a systolic blood pressure of 140 or highe...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:07:14.516016Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:07:14.900009Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Count patients with systolic BP >= 140 or diastolic BP >= 90...'", "module": "sql_service", "function": "query", "line": 381}
{"timestamp": "2026-01-08T09:07:14.900086Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udd0d Analyzing natural language query", "module": "sql_service", "function": "_is_simple_query", "line": 323}
{"timestamp": "2026-01-08T09:07:14.900152Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query classified as SIMPLE (natural language)", "module": "sql_service", "function": "_is_simple_query", "line": 364}
{"timestamp": "2026-01-08T09:07:14.900183Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Detected simple query - using optimized execution path", "module": "sql_service", "function": "query", "line": 385}
{"timestamp": "2026-01-08T09:07:14.900213Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_optimized", "line": 397}
{"timestamp": "2026-01-08T09:07:14.900248Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 OPTIMIZED SQL EXECUTION:", "module": "sql_service", "function": "_execute_optimized", "line": 398}
{"timestamp": "2026-01-08T09:07:14.900269Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_optimized", "line": 399}
{"timestamp": "2026-01-08T09:07:14.900295Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " API Call 1: Generate SQL query with targeted schema", "module": "sql_service", "function": "_execute_optimized", "line": 414}
{"timestamp": "2026-01-08T09:07:14.900345Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udccb Selected relevant tables for query: patient, bp_log, patient_tracker", "module": "sql_service", "function": "_get_relevant_schema", "line": 266}
{"timestamp": "2026-01-08T09:07:16.434008Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:07:16.439587Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL to execute: SELECT COUNT(DISTINCT pt.patient_id)\nFROM bp_log bp\nJOIN patient_tracker pt ON bp.patient_track_id = pt.id\nWHERE bp.avg_systolic >= 140 OR bp.avg_diastolic >= 90;...", "module": "sql_service", "function": "_execute_optimized", "line": 448}
{"timestamp": "2026-01-08T09:07:16.439683Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Executing query against database (no API call)", "module": "sql_service", "function": "_execute_optimized", "line": 456}
{"timestamp": "2026-01-08T09:07:16.457610Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query result: [(1263,)]", "module": "sql_service", "function": "_execute_optimized", "line": 458}
{"timestamp": "2026-01-08T09:07:16.457669Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " API Call 2: Format natural language response", "module": "sql_service", "function": "_execute_optimized", "line": 461}
{"timestamp": "2026-01-08T09:07:17.839749Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:07:17.840371Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_optimized", "line": 476}
{"timestamp": "2026-01-08T09:07:17.840442Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Optimized execution completed with 2 API call(s) (vs 7 with agent)", "module": "sql_service", "function": "_execute_optimized", "line": 477}
{"timestamp": "2026-01-08T09:07:17.840475Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: There are 1,263 distinct patients with either an average systolic blood pressure of 140 or higher, or an average diastolic blood pressure of 90 or higher....", "module": "sql_service", "function": "_execute_optimized", "line": 478}
{"timestamp": "2026-01-08T09:07:17.840497Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_optimized", "line": 479}
{"timestamp": "2026-01-08T09:07:18.380681Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:07:22.010438Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=82403202-ccc6-490d-93ce-747a1040e251, duration=8.43s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:09:25.486486Z", "level": "INFO", "logger": "app", "message": "Shutting down application", "module": "app", "function": "lifespan", "line": 34}
{"timestamp": "2026-01-08T09:09:30.038305Z", "level": "INFO", "logger": "app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-08T09:09:30.038348Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-08T09:09:30.038370Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-08T09:09:30.038445Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-08T09:09:30.052242Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-08T09:09:30.052287Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-08T09:09:31.578804Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-08T09:09:31.578867Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-08T09:09:31.578915Z", "level": "INFO", "logger": "app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-08T09:09:31.578937Z", "level": "INFO", "logger": "app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-08T09:10:25.189093Z", "level": "INFO", "logger": "app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-08T09:10:25.189143Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-08T09:10:25.189170Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-08T09:10:25.189246Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-08T09:10:25.202508Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-08T09:10:25.202546Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-08T09:10:25.932949Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-08T09:10:25.933009Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-08T09:10:25.933035Z", "level": "INFO", "logger": "app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-08T09:10:25.933056Z", "level": "INFO", "logger": "app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-08T09:11:00.820181Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login attempt for user: admin", "module": "auth", "function": "login", "line": 27}
{"timestamp": "2026-01-08T09:11:00.821269Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login successful for user: admin", "module": "auth", "function": "login", "line": 50}
{"timestamp": "2026-01-08T09:11:00.822820Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=51", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:11:00.822861Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Initializing AgentService", "module": "agent_service", "function": "__init__", "line": 121}
{"timestamp": "2026-01-08T09:11:00.822911Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Connecting to database at postgresql://admin:admin@127.0.0.1:5432/Spice_BD", "module": "sql_service", "function": "__init__", "line": 26}
{"timestamp": "2026-01-08T09:11:01.179682Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Database connection established with view support", "module": "sql_service", "function": "__init__", "line": 46}
{"timestamp": "2026-01-08T09:11:01.387085Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Cached schema for 39 relevant tables out of 114 total", "module": "sql_service", "function": "_cache_schema", "line": 230}
{"timestamp": "2026-01-08T09:11:01.387151Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Relevant tables: bp_log, current_medication, diagnosis, glucose_log, lab_test, lab_test_result, lab_test_result_range, medical_compliance, medication_country_detail, patient...", "module": "sql_service", "function": "_cache_schema", "line": 231}
{"timestamp": "2026-01-08T09:11:01.489596Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "SQL agent initialized successfully with 39 cached tables", "module": "sql_service", "function": "__init__", "line": 78}
{"timestamp": "2026-01-08T09:11:01.494267Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "AgentService initialized successfully", "module": "agent_service", "function": "__init__", "line": 184}
{"timestamp": "2026-01-08T09:11:01.494322Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=73e939f3-085f-45cb-b2ae-8c9c0aa90b5e): 'How many patients were screened for blood pressure?...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:11:02.503373Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:11:03.589938Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Count the number of patients who were screened for blood pressure using v_analytics_screening where ...'", "module": "sql_service", "function": "query", "line": 396}
{"timestamp": "2026-01-08T09:11:03.590109Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udd0d Analyzing natural language query", "module": "sql_service", "function": "_is_simple_query", "line": 338}
{"timestamp": "2026-01-08T09:11:03.590447Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query classified as COMPLEX (pattern=True, complexity=False, multi_table=True)", "module": "sql_service", "function": "_is_simple_query", "line": 381}
{"timestamp": "2026-01-08T09:11:03.590506Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Complex query detected - using full agent", "module": "sql_service", "function": "query", "line": 403}
{"timestamp": "2026-01-08T09:11:03.590561Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 539}
{"timestamp": "2026-01-08T09:11:03.590604Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL AGENT EXECUTION TRACE:", "module": "sql_service", "function": "_execute_with_agent", "line": 540}
{"timestamp": "2026-01-08T09:11:03.590646Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 541}
{"timestamp": "2026-01-08T09:11:04.333939Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:11:05.712208Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:11:07.321850Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:11:08.660386Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:11:09.269719Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:11:10.225106Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:11:11.056427Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 567}
{"timestamp": "2026-01-08T09:11:11.056638Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL query completed. Result length: 135 chars", "module": "sql_service", "function": "_execute_with_agent", "line": 568}
{"timestamp": "2026-01-08T09:11:11.056764Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: The number of patients who were screened for blood pressure with a workflow status of 'NCD' and have a blood pressure reading is 5,332....", "module": "sql_service", "function": "_execute_with_agent", "line": 570}
{"timestamp": "2026-01-08T09:11:11.056976Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 571}
{"timestamp": "2026-01-08T09:11:11.535103Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:11:14.770329Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=73e939f3-085f-45cb-b2ae-8c9c0aa90b5e, duration=13.28s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:11:56.024643Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login attempt for user: admin", "module": "auth", "function": "login", "line": 27}
{"timestamp": "2026-01-08T09:11:56.024825Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login successful for user: admin", "module": "auth", "function": "login", "line": 50}
{"timestamp": "2026-01-08T09:11:56.025916Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=36", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:11:56.025968Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=143e6919-d3f9-4fb5-8c18-d94ed59ed997): 'How many crisis referrals are there?...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:11:56.699257Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:11:57.612599Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Count the number of crisis referrals from v_analytics_screening where crisis_referral_status = 'Cris...'", "module": "sql_service", "function": "query", "line": 396}
{"timestamp": "2026-01-08T09:11:57.612726Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udd0d Analyzing natural language query", "module": "sql_service", "function": "_is_simple_query", "line": 338}
{"timestamp": "2026-01-08T09:11:57.613736Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query classified as COMPLEX (pattern=False, complexity=False, multi_table=False)", "module": "sql_service", "function": "_is_simple_query", "line": 381}
{"timestamp": "2026-01-08T09:11:57.613784Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Complex query detected - using full agent", "module": "sql_service", "function": "query", "line": 403}
{"timestamp": "2026-01-08T09:11:57.613826Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 539}
{"timestamp": "2026-01-08T09:11:57.613862Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL AGENT EXECUTION TRACE:", "module": "sql_service", "function": "_execute_with_agent", "line": 540}
{"timestamp": "2026-01-08T09:11:57.613896Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 541}
{"timestamp": "2026-01-08T09:11:58.291921Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:11:59.034592Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:12:00.162908Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:12:01.388984Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:12:02.712071Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:12:03.666731Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:12:03.989799Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 567}
{"timestamp": "2026-01-08T09:12:03.990034Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL query completed. Result length: 126 chars", "module": "sql_service", "function": "_execute_with_agent", "line": 568}
{"timestamp": "2026-01-08T09:12:03.990129Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: There are 1,219 crisis referrals in the `v_analytics_screening` table where the `crisis_referral_status` is 'Crisis Referral'....", "module": "sql_service", "function": "_execute_with_agent", "line": 570}
{"timestamp": "2026-01-08T09:12:03.990197Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 571}
{"timestamp": "2026-01-08T09:12:04.528593Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:12:08.673280Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=143e6919-d3f9-4fb5-8c18-d94ed59ed997, duration=12.65s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:12:08.680159Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=46", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:12:08.680313Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=a243e345-2a21-4b3c-b344-758a64b534ce): 'What is the total number of enrolled patients?...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:12:09.296769Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:12:09.643132Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Total number of enrolled patients from v_analytics_enrollment...'", "module": "sql_service", "function": "query", "line": 396}
{"timestamp": "2026-01-08T09:12:09.643315Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udd0d Analyzing natural language query", "module": "sql_service", "function": "_is_simple_query", "line": 338}
{"timestamp": "2026-01-08T09:12:09.643550Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query classified as COMPLEX (pattern=True, complexity=False, multi_table=True)", "module": "sql_service", "function": "_is_simple_query", "line": 381}
{"timestamp": "2026-01-08T09:12:09.643680Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Complex query detected - using full agent", "module": "sql_service", "function": "query", "line": 403}
{"timestamp": "2026-01-08T09:12:09.643761Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 539}
{"timestamp": "2026-01-08T09:12:09.643824Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL AGENT EXECUTION TRACE:", "module": "sql_service", "function": "_execute_with_agent", "line": 540}
{"timestamp": "2026-01-08T09:12:09.643881Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 541}
{"timestamp": "2026-01-08T09:12:10.852169Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:12:11.837194Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:12:14.928830Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:12:16.313919Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:12:16.943734Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 567}
{"timestamp": "2026-01-08T09:12:16.944065Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL query completed. Result length: 47 chars", "module": "sql_service", "function": "_execute_with_agent", "line": 568}
{"timestamp": "2026-01-08T09:12:16.944222Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: The total number of enrolled patients is 2,566....", "module": "sql_service", "function": "_execute_with_agent", "line": 570}
{"timestamp": "2026-01-08T09:12:16.944376Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 571}
{"timestamp": "2026-01-08T09:12:17.672563Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:12:18.815793Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=a243e345-2a21-4b3c-b344-758a64b534ce, duration=10.14s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:12:18.821310Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=45", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:12:18.821441Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=9068a705-edd9-4ac1-99ff-bf1b02640a12): 'How many patients are enrolled with diabetes?...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:12:19.519033Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:12:19.835610Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Count the number of patients enrolled with diabetes from v_analytics_enrollment....'", "module": "sql_service", "function": "query", "line": 396}
{"timestamp": "2026-01-08T09:12:19.835724Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udd0d Analyzing natural language query", "module": "sql_service", "function": "_is_simple_query", "line": 338}
{"timestamp": "2026-01-08T09:12:19.835854Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query classified as COMPLEX (pattern=True, complexity=False, multi_table=True)", "module": "sql_service", "function": "_is_simple_query", "line": 381}
{"timestamp": "2026-01-08T09:12:19.835900Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Complex query detected - using full agent", "module": "sql_service", "function": "query", "line": 403}
{"timestamp": "2026-01-08T09:12:19.835940Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 539}
{"timestamp": "2026-01-08T09:12:19.835979Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL AGENT EXECUTION TRACE:", "module": "sql_service", "function": "_execute_with_agent", "line": 540}
{"timestamp": "2026-01-08T09:12:19.836016Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 541}
{"timestamp": "2026-01-08T09:12:20.498097Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:12:22.075143Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:12:22.996404Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:12:25.146135Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:12:26.173341Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:12:26.992006Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:12:27.122472Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 567}
{"timestamp": "2026-01-08T09:12:27.122537Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL query completed. Result length: 64 chars", "module": "sql_service", "function": "_execute_with_agent", "line": 568}
{"timestamp": "2026-01-08T09:12:27.122612Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: There are 2,733 patients enrolled with diabetes in the database....", "module": "sql_service", "function": "_execute_with_agent", "line": 570}
{"timestamp": "2026-01-08T09:12:27.122638Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 571}
{"timestamp": "2026-01-08T09:12:28.117184Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:12:32.517338Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=9068a705-edd9-4ac1-99ff-bf1b02640a12, duration=13.70s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:13:52.535416Z", "level": "INFO", "logger": "app", "message": "Shutting down application", "module": "app", "function": "lifespan", "line": 34}
{"timestamp": "2026-01-08T09:13:56.363089Z", "level": "INFO", "logger": "app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-08T09:13:56.363126Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-08T09:13:56.363146Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-08T09:13:56.363223Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-08T09:13:56.379190Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-08T09:13:56.379226Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-08T09:13:57.621974Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-08T09:13:57.622080Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-08T09:13:57.622162Z", "level": "INFO", "logger": "app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-08T09:13:57.622185Z", "level": "INFO", "logger": "app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-08T09:18:19.568887Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=53", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:18:19.569228Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Initializing AgentService", "module": "agent_service", "function": "__init__", "line": 121}
{"timestamp": "2026-01-08T09:18:19.569369Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Connecting to database at postgresql://admin:admin@127.0.0.1:5432/Spice_BD", "module": "sql_service", "function": "__init__", "line": 26}
{"timestamp": "2026-01-08T09:18:19.857207Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Database connection established with view support", "module": "sql_service", "function": "__init__", "line": 46}
{"timestamp": "2026-01-08T09:18:20.051893Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Cached schema for 39 relevant tables out of 114 total", "module": "sql_service", "function": "_cache_schema", "line": 230}
{"timestamp": "2026-01-08T09:18:20.051945Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Relevant tables: bp_log, current_medication, diagnosis, glucose_log, lab_test, lab_test_result, lab_test_result_range, medical_compliance, medication_country_detail, patient...", "module": "sql_service", "function": "_cache_schema", "line": 231}
{"timestamp": "2026-01-08T09:18:20.163266Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "SQL agent initialized successfully with 39 cached tables", "module": "sql_service", "function": "__init__", "line": 78}
{"timestamp": "2026-01-08T09:18:20.167674Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "AgentService initialized successfully", "module": "agent_service", "function": "__init__", "line": 184}
{"timestamp": "2026-01-08T09:18:20.167732Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=d7e7076c-0a55-488f-aed3-b8c7acf9ef7d): '\"How many patients were screened for blood pressure?\"...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:18:21.618064Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:18:22.493995Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Count the number of patients who were screened for blood pressure using the v_analytics_screening ta...'", "module": "sql_service", "function": "query", "line": 396}
{"timestamp": "2026-01-08T09:18:22.494087Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udd0d Analyzing natural language query", "module": "sql_service", "function": "_is_simple_query", "line": 338}
{"timestamp": "2026-01-08T09:18:22.494458Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query classified as COMPLEX (pattern=True, complexity=False, multi_table=True)", "module": "sql_service", "function": "_is_simple_query", "line": 381}
{"timestamp": "2026-01-08T09:18:22.494538Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Complex query detected - using full agent", "module": "sql_service", "function": "query", "line": 403}
{"timestamp": "2026-01-08T09:18:22.494592Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 539}
{"timestamp": "2026-01-08T09:18:22.494684Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL AGENT EXECUTION TRACE:", "module": "sql_service", "function": "_execute_with_agent", "line": 540}
{"timestamp": "2026-01-08T09:18:22.494758Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 541}
{"timestamp": "2026-01-08T09:18:23.561452Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:18:24.374950Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:18:26.088299Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:18:27.246073Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:18:28.063658Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:18:28.985587Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:18:29.364533Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 567}
{"timestamp": "2026-01-08T09:18:29.364670Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL query completed. Result length: 135 chars", "module": "sql_service", "function": "_execute_with_agent", "line": 568}
{"timestamp": "2026-01-08T09:18:29.364728Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: The number of patients who were screened for blood pressure with a workflow status of 'NCD' and have a blood pressure reading is 5,332....", "module": "sql_service", "function": "_execute_with_agent", "line": 570}
{"timestamp": "2026-01-08T09:18:29.364775Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 571}
{"timestamp": "2026-01-08T09:18:30.135145Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:18:33.165961Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=d7e7076c-0a55-488f-aed3-b8c7acf9ef7d, duration=13.00s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:19:01.678699Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=53", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:19:01.679739Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=1cd08133-d805-4a68-9fa3-10940ccf5a73): '\"What percentage of screened patients were referred?\"...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:19:02.453792Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:19:03.010255Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Calculate the percentage of screened patients who were referred using the v_analytics_screening tabl...'", "module": "sql_service", "function": "query", "line": 396}
{"timestamp": "2026-01-08T09:19:03.010311Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udd0d Analyzing natural language query", "module": "sql_service", "function": "_is_simple_query", "line": 338}
{"timestamp": "2026-01-08T09:19:03.010858Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query classified as COMPLEX (pattern=False, complexity=True, multi_table=True)", "module": "sql_service", "function": "_is_simple_query", "line": 381}
{"timestamp": "2026-01-08T09:19:03.010890Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Complex query detected - using full agent", "module": "sql_service", "function": "query", "line": 403}
{"timestamp": "2026-01-08T09:19:03.010915Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 539}
{"timestamp": "2026-01-08T09:19:03.010940Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL AGENT EXECUTION TRACE:", "module": "sql_service", "function": "_execute_with_agent", "line": 540}
{"timestamp": "2026-01-08T09:19:03.010963Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 541}
{"timestamp": "2026-01-08T09:19:04.108975Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:19:04.933825Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:19:05.851650Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:19:07.489799Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:19:08.721127Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:19:09.640947Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:19:09.896321Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 567}
{"timestamp": "2026-01-08T09:19:09.896615Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL query completed. Result length: 115 chars", "module": "sql_service", "function": "_execute_with_agent", "line": 568}
{"timestamp": "2026-01-08T09:19:09.896758Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: Approximately 66.58% of screened patients were referred according to the data in the `v_analytics_screening` table....", "module": "sql_service", "function": "_execute_with_agent", "line": 570}
{"timestamp": "2026-01-08T09:19:09.896851Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 571}
{"timestamp": "2026-01-08T09:19:10.679703Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:19:14.378297Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=1cd08133-d805-4a68-9fa3-10940ccf5a73, duration=12.70s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:19:18.348697Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=34", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:19:18.348887Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=4dd5ac61-1cba-4b75-bbb6-1dae308ae147): '\"What is the DBM prevalence rate?\"...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:19:19.369343Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:19:20.279403Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Calculate the DBM prevalence rate using the formula: (Elevated BG Referrals / Screened for BG) * 100...'", "module": "sql_service", "function": "query", "line": 396}
{"timestamp": "2026-01-08T09:19:20.279491Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udd0d Analyzing natural language query", "module": "sql_service", "function": "_is_simple_query", "line": 338}
{"timestamp": "2026-01-08T09:19:20.279590Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query classified as COMPLEX (pattern=False, complexity=False, multi_table=False)", "module": "sql_service", "function": "_is_simple_query", "line": 381}
{"timestamp": "2026-01-08T09:19:20.279638Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Complex query detected - using full agent", "module": "sql_service", "function": "query", "line": 403}
{"timestamp": "2026-01-08T09:19:20.279670Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 539}
{"timestamp": "2026-01-08T09:19:20.279704Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL AGENT EXECUTION TRACE:", "module": "sql_service", "function": "_execute_with_agent", "line": 540}
{"timestamp": "2026-01-08T09:19:20.279735Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 541}
{"timestamp": "2026-01-08T09:19:21.113215Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:19:21.827237Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:19:22.851211Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:19:28.643044Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:19:29.405524Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:19:30.883421Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:19:32.805930Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 567}
{"timestamp": "2026-01-08T09:19:32.806011Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL query completed. Result length: 305 chars", "module": "sql_service", "function": "_execute_with_agent", "line": 568}
{"timestamp": "2026-01-08T09:19:32.806053Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: The DBM prevalence rate, calculated as the percentage of elevated blood glucose referrals out of those screened for blood glucose, is approximately 213.10%. This value suggests that there might be multiple referrals per individual or data inconsistencies, as prevalence rates typically do not exceed ...", "module": "sql_service", "function": "_execute_with_agent", "line": 570}
{"timestamp": "2026-01-08T09:19:32.806087Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 571}
{"timestamp": "2026-01-08T09:19:33.603477Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:19:35.494486Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=4dd5ac61-1cba-4b75-bbb6-1dae308ae147, duration=17.15s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:19:58.338413Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=45", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:19:58.339402Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=cf338cab-906c-4ef0-9b24-8215b162a091): '\"What symptoms indicate hypertensive crisis?\"...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:19:59.105581Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:20:07.123450Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=cf338cab-906c-4ef0-9b24-8215b162a091, duration=8.78s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:20:28.149161Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=52", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:20:28.149244Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=0b1c3e74-4261-40bc-8359-ce9bbbcaec78): '\"Find patients with poor medication adherence notes\"...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:20:28.902640Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:20:29.077302Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "\u26a1 Lazy loading vector store on first use...", "module": "agent_service", "function": "vector_store", "line": 190}
{"timestamp": "2026-01-08T09:20:29.077630Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Initializing vector store service", "module": "vector_store", "function": "__init__", "line": 30}
{"timestamp": "2026-01-08T09:20:29.078122Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Looking for RAG config at: /Users/adityanbhatt/fhir_rag/backend/config/embedding_config.yaml", "module": "vector_store", "function": "__init__", "line": 41}
{"timestamp": "2026-01-08T09:20:29.078274Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Loading RAG config from /Users/adityanbhatt/fhir_rag/backend/config/embedding_config.yaml", "module": "vector_store", "function": "__init__", "line": 46}
{"timestamp": "2026-01-08T09:20:29.086147Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Loaded RAG config successfully", "module": "vector_store", "function": "__init__", "line": 51}
{"timestamp": "2026-01-08T09:20:29.086509Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Resolved chroma_path to: /Users/adityanbhatt/fhir_rag/backend/data/indexes/chroma_db_advanced", "module": "retrieve", "function": "_resolve_config_paths", "line": 155}
{"timestamp": "2026-01-08T09:20:29.086612Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Resolved model_path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "retrieve", "function": "_resolve_config_paths", "line": 162}
{"timestamp": "2026-01-08T09:20:29.170600Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Loading docstore from /Users/adityanbhatt/fhir_rag/backend/data/indexes/chroma_db_advanced/parent_docstore.pkl with module remapping", "module": "retrieve", "function": "_load_docstore", "line": 284}
{"timestamp": "2026-01-08T09:20:29.692246Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Successfully loaded docstore with module remapping", "module": "retrieve", "function": "_load_docstore", "line": 286}
{"timestamp": "2026-01-08T09:20:29.694583Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Loading 154161 parent documents for BM25...", "module": "retrieve", "function": "_setup_retrievers", "line": 175}
{"timestamp": "2026-01-08T09:20:29.718120Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Filtered to 59572 documents from relevant tables for BM25 index.", "module": "retrieve", "function": "_setup_retrievers", "line": 185}
{"timestamp": "2026-01-08T09:20:30.549977Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "BM25Retriever initialized on relevant tables.", "module": "retrieve", "function": "_setup_retrievers", "line": 196}
{"timestamp": "2026-01-08T09:20:30.550990Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Initializing reranker: BAAI/bge-reranker-base", "module": "retrieve", "function": "__init__", "line": 137}
{"timestamp": "2026-01-08T09:20:32.807375Z", "level": "INFO", "logger": "sentence_transformers.cross_encoder.CrossEncoder", "message": "Use pytorch device: mps", "module": "CrossEncoder", "function": "__init__", "line": 222}
{"timestamp": "2026-01-08T09:20:34.035326Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Advanced RAG Retriever initialized successfully.", "module": "retrieve", "function": "__init__", "line": 143}
{"timestamp": "2026-01-08T09:20:34.035463Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Vector store initialized successfully", "module": "vector_store", "function": "__init__", "line": 55}
{"timestamp": "2026-01-08T09:20:34.035533Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "\u2705 Vector store loaded", "module": "agent_service", "function": "vector_store", "line": 192}
{"timestamp": "2026-01-08T09:20:34.035583Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Searching vector store for query: 'Find patients with poor medication adherence notes...' (top_k=5)", "module": "vector_store", "function": "search", "line": 69}
{"timestamp": "2026-01-08T09:20:34.035927Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Executing query: Find patients with poor medication adherence notes", "module": "retrieve", "function": "_get_relevant_documents", "line": 223}
{"timestamp": "2026-01-08T09:20:37.053073Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Reranking 79 documents for query: 'Find patients with poor medication adherence notes'", "module": "retrieve", "function": "_get_relevant_documents", "line": 257}
{"timestamp": "2026-01-08T09:20:38.525308Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Returning 10 reranked documents.", "module": "retrieve", "function": "_get_relevant_documents", "line": 267}
{"timestamp": "2026-01-08T09:20:38.525638Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Retrieved 10 documents from vector store", "module": "vector_store", "function": "search", "line": 84}
{"timestamp": "2026-01-08T09:20:39.069374Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:20:46.255045Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=0b1c3e74-4261-40bc-8359-ce9bbbcaec78, duration=18.11s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:21:05.724212Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=54", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:21:05.724600Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=460ab2e4-639a-42db-a6d7-30942418bfd9): '\"Find patients who were referred but not yet enrolled\"...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:21:06.786307Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:21:06.963639Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Find patients who were referred but not yet enrolled...'", "module": "sql_service", "function": "query", "line": 396}
{"timestamp": "2026-01-08T09:21:06.963869Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udd0d Analyzing natural language query", "module": "sql_service", "function": "_is_simple_query", "line": 338}
{"timestamp": "2026-01-08T09:21:06.964187Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query classified as COMPLEX (pattern=False, complexity=False, multi_table=False)", "module": "sql_service", "function": "_is_simple_query", "line": 381}
{"timestamp": "2026-01-08T09:21:06.964278Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Complex query detected - using full agent", "module": "sql_service", "function": "query", "line": 403}
{"timestamp": "2026-01-08T09:21:06.964352Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 539}
{"timestamp": "2026-01-08T09:21:06.964414Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL AGENT EXECUTION TRACE:", "module": "sql_service", "function": "_execute_with_agent", "line": 540}
{"timestamp": "2026-01-08T09:21:06.964469Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 541}
{"timestamp": "2026-01-08T09:21:07.608578Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:21:08.324654Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:21:09.246037Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:21:12.421271Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:21:14.876580Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:21:20.524904Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:21:25.861410Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 567}
{"timestamp": "2026-01-08T09:21:25.861592Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL query completed. Result length: 338 chars", "module": "sql_service", "function": "_execute_with_agent", "line": 568}
{"timestamp": "2026-01-08T09:21:25.861688Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: Here are some patients who were referred but not yet enrolled:\n\n1. **Patient ID:** 4342, **Name:** HANK G, **Source Refer:** Y\n2. **Patient ID:** 4348, **Name:** KUBY H, **Source Refer:** Y\n3. **Patient ID:** 4351, **Name:** TOM J, **Source Refer:** Y\n\nThese patients have a source of referral but do...", "module": "sql_service", "function": "_execute_with_agent", "line": 570}
{"timestamp": "2026-01-08T09:21:25.861743Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 571}
{"timestamp": "2026-01-08T09:21:26.447814Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:21:29.101796Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=460ab2e4-639a-42db-a6d7-30942418bfd9, duration=23.38s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:22:11.646296Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=68", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:22:11.647338Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=437b1e9b-2f45-4dab-a828-ef21f1e04874): '\"Find cases where treatment plans were modified due to side effects\"...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:22:12.331492Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:22:12.571943Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Searching vector store for query: 'treatment plans modified due to side effects...' (top_k=5)", "module": "vector_store", "function": "search", "line": 69}
{"timestamp": "2026-01-08T09:22:12.572303Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Executing query: treatment plans modified due to side effects", "module": "retrieve", "function": "_get_relevant_documents", "line": 223}
{"timestamp": "2026-01-08T09:22:13.148572Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Reranking 53 documents for query: 'treatment plans modified due to side effects'", "module": "retrieve", "function": "_get_relevant_documents", "line": 257}
{"timestamp": "2026-01-08T09:22:13.939280Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Returning 10 reranked documents.", "module": "retrieve", "function": "_get_relevant_documents", "line": 267}
{"timestamp": "2026-01-08T09:22:13.939423Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Retrieved 10 documents from vector store", "module": "vector_store", "function": "search", "line": 84}
{"timestamp": "2026-01-08T09:22:14.901682Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:22:19.816619Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=437b1e9b-2f45-4dab-a828-ef21f1e04874, duration=8.17s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:22:30.368350Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=64", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:22:30.368575Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=306fb1c5-01f9-4991-95d2-063faf850acd): '\"How many smokers have uncontrolled hypertension (BP > 140/90)?\"...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:22:32.136721Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:22:32.341075Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Count patients with systolic BP > 140 or diastolic BP > 90....'", "module": "sql_service", "function": "query", "line": 396}
{"timestamp": "2026-01-08T09:22:32.341266Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udd0d Analyzing natural language query", "module": "sql_service", "function": "_is_simple_query", "line": 338}
{"timestamp": "2026-01-08T09:22:32.341414Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query classified as SIMPLE (natural language)", "module": "sql_service", "function": "_is_simple_query", "line": 379}
{"timestamp": "2026-01-08T09:22:32.341490Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Detected simple query - using optimized execution path", "module": "sql_service", "function": "query", "line": 400}
{"timestamp": "2026-01-08T09:22:32.341558Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_optimized", "line": 412}
{"timestamp": "2026-01-08T09:22:32.341616Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 OPTIMIZED SQL EXECUTION:", "module": "sql_service", "function": "_execute_optimized", "line": 413}
{"timestamp": "2026-01-08T09:22:32.341666Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_optimized", "line": 414}
{"timestamp": "2026-01-08T09:22:32.341720Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " API Call 1: Generate SQL query with targeted schema", "module": "sql_service", "function": "_execute_optimized", "line": 429}
{"timestamp": "2026-01-08T09:22:32.341845Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udccb Selected relevant tables for query: patient, bp_log, patient_tracker", "module": "sql_service", "function": "_get_relevant_schema", "line": 281}
{"timestamp": "2026-01-08T09:22:34.034166Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:22:34.037025Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL to execute: SELECT COUNT(DISTINCT pt.patient_id)\nFROM bp_log bp\nJOIN patient_tracker pt ON bp.patient_track_id = pt.id\nWHERE bp.avg_systolic > 140 OR bp.avg_diastolic > 90;...", "module": "sql_service", "function": "_execute_optimized", "line": 463}
{"timestamp": "2026-01-08T09:22:34.037191Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Executing query against database (no API call)", "module": "sql_service", "function": "_execute_optimized", "line": 471}
{"timestamp": "2026-01-08T09:22:34.059770Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query result: [(1115,)]", "module": "sql_service", "function": "_execute_optimized", "line": 473}
{"timestamp": "2026-01-08T09:22:34.059884Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " API Call 2: Format natural language response", "module": "sql_service", "function": "_execute_optimized", "line": 476}
{"timestamp": "2026-01-08T09:22:34.798469Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:22:34.813412Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_optimized", "line": 491}
{"timestamp": "2026-01-08T09:22:34.813698Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Optimized execution completed with 2 API call(s) (vs 7 with agent)", "module": "sql_service", "function": "_execute_optimized", "line": 492}
{"timestamp": "2026-01-08T09:22:34.815153Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: There are 1,115 patients with either an average systolic blood pressure greater than 140 or an average diastolic blood pressure greater than 90....", "module": "sql_service", "function": "_execute_optimized", "line": 493}
{"timestamp": "2026-01-08T09:22:34.815258Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_optimized", "line": 494}
{"timestamp": "2026-01-08T09:22:34.816066Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Searching vector store for query: 'Find patients who are smokers....' (top_k=5)", "module": "vector_store", "function": "search", "line": 69}
{"timestamp": "2026-01-08T09:22:34.816250Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Executing query: Find patients who are smokers.", "module": "retrieve", "function": "_get_relevant_documents", "line": 223}
{"timestamp": "2026-01-08T09:22:35.003637Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Reranking 76 documents for query: 'Find patients who are smokers.'", "module": "retrieve", "function": "_get_relevant_documents", "line": 257}
{"timestamp": "2026-01-08T09:22:36.060750Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Returning 10 reranked documents.", "module": "retrieve", "function": "_get_relevant_documents", "line": 267}
{"timestamp": "2026-01-08T09:22:36.060853Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Retrieved 10 documents from vector store", "module": "vector_store", "function": "search", "line": 84}
{"timestamp": "2026-01-08T09:22:36.680078Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:22:43.047825Z", "level": "WARNING", "logger": "backend.services.agent_service", "message": "Failed to parse agent JSON output: Expecting ',' delimiter: line 7 column 34 (char 216)", "module": "agent_service", "function": "_parse_agent_output", "line": 310}
{"timestamp": "2026-01-08T09:22:43.048188Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=306fb1c5-01f9-4991-95d2-063faf850acd, duration=12.68s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:23:05.081394Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=83", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:23:05.082351Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=1edbb359-4027-463b-8255-d83d88cc5f49): '\"Which sites have both high screening volumes and high patient satisfaction notes?\"...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:23:06.599722Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:23:06.715613Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'List sites with the highest screening volumes from v_analytics_screening....'", "module": "sql_service", "function": "query", "line": 396}
{"timestamp": "2026-01-08T09:23:06.715694Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udd0d Analyzing natural language query", "module": "sql_service", "function": "_is_simple_query", "line": 338}
{"timestamp": "2026-01-08T09:23:06.715834Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query classified as COMPLEX (pattern=False, complexity=False, multi_table=False)", "module": "sql_service", "function": "_is_simple_query", "line": 381}
{"timestamp": "2026-01-08T09:23:06.715877Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Complex query detected - using full agent", "module": "sql_service", "function": "query", "line": 403}
{"timestamp": "2026-01-08T09:23:06.715916Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 539}
{"timestamp": "2026-01-08T09:23:06.715953Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL AGENT EXECUTION TRACE:", "module": "sql_service", "function": "_execute_with_agent", "line": 540}
{"timestamp": "2026-01-08T09:23:06.715985Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 541}
{"timestamp": "2026-01-08T09:23:07.698549Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:23:08.375225Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:23:09.408072Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:23:12.296299Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:23:13.257752Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:23:14.790163Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:23:15.956994Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 567}
{"timestamp": "2026-01-08T09:23:15.957177Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL query completed. Result length: 452 chars", "module": "sql_service", "function": "_execute_with_agent", "line": 568}
{"timestamp": "2026-01-08T09:23:15.957292Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: Here are the sites with the highest screening volumes:\n\n1. AutoSiteBangladesh5One - 1,274 screenings\n2. Nilphamari Sadar Upazila Health Complex - 425 screenings\n3. AutoSitescreeningbangladesh9One - 412 screenings\n4. Patgram UHC - 259 screenings\n5. Hatibandha UHC - 223 screenings\n6. Debiganj UHC - 21...", "module": "sql_service", "function": "_execute_with_agent", "line": 570}
{"timestamp": "2026-01-08T09:23:15.957369Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 571}
{"timestamp": "2026-01-08T09:23:15.958231Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Searching vector store for query: 'Find sites with high patient satisfaction notes....' (top_k=5)", "module": "vector_store", "function": "search", "line": 69}
{"timestamp": "2026-01-08T09:23:15.958735Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Executing query: Find sites with high patient satisfaction notes.", "module": "retrieve", "function": "_get_relevant_documents", "line": 223}
{"timestamp": "2026-01-08T09:23:16.316552Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Reranking 75 documents for query: 'Find sites with high patient satisfaction notes.'", "module": "retrieve", "function": "_get_relevant_documents", "line": 257}
{"timestamp": "2026-01-08T09:23:17.253241Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Returning 10 reranked documents.", "module": "retrieve", "function": "_get_relevant_documents", "line": 267}
{"timestamp": "2026-01-08T09:23:17.253414Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Retrieved 10 documents from vector store", "module": "vector_store", "function": "search", "line": 84}
{"timestamp": "2026-01-08T09:23:17.826213Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:23:24.965602Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=1edbb359-4027-463b-8255-d83d88cc5f49, duration=19.88s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:24:12.662065Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=79", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:24:12.662834Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=b6b5b50a-f724-4c91-b5b5-840117f8f73a): 'What are the doctor's observations for patients with uncontrolled hypertension?...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:24:13.660602Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:24:13.898601Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Searching vector store for query: 'doctor's observations for patients with uncontrolled hypertension...' (top_k=5)", "module": "vector_store", "function": "search", "line": 69}
{"timestamp": "2026-01-08T09:24:13.899113Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Executing query: doctor's observations for patients with uncontrolled hypertension", "module": "retrieve", "function": "_get_relevant_documents", "line": 223}
{"timestamp": "2026-01-08T09:24:14.501661Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Reranking 76 documents for query: 'doctor's observations for patients with uncontrolled hypertension'", "module": "retrieve", "function": "_get_relevant_documents", "line": 257}
{"timestamp": "2026-01-08T09:24:15.795913Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Returning 10 reranked documents.", "module": "retrieve", "function": "_get_relevant_documents", "line": 267}
{"timestamp": "2026-01-08T09:24:15.796043Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Retrieved 10 documents from vector store", "module": "vector_store", "function": "search", "line": 84}
{"timestamp": "2026-01-08T09:24:16.331921Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:24:22.878250Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=b6b5b50a-f724-4c91-b5b5-840117f8f73a, duration=10.22s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:24:34.449831Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=69", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:24:34.450107Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=13e9c8d4-3925-4eca-a2a3-027cc81db75e): 'List the latest BP readings for patients who have 'refused medication...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:24:35.784008Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:24:36.113711Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Searching vector store for query: 'Find patients who have 'refused medication' in their clinical notes....' (top_k=5)", "module": "vector_store", "function": "search", "line": 69}
{"timestamp": "2026-01-08T09:24:36.114216Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Executing query: Find patients who have 'refused medication' in their clinical notes.", "module": "retrieve", "function": "_get_relevant_documents", "line": 223}
{"timestamp": "2026-01-08T09:24:36.316311Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Reranking 75 documents for query: 'Find patients who have 'refused medication' in their clinical notes.'", "module": "retrieve", "function": "_get_relevant_documents", "line": 257}
{"timestamp": "2026-01-08T09:24:37.077577Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Returning 10 reranked documents.", "module": "retrieve", "function": "_get_relevant_documents", "line": 267}
{"timestamp": "2026-01-08T09:24:37.077689Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Retrieved 10 documents from vector store", "module": "vector_store", "function": "search", "line": 84}
{"timestamp": "2026-01-08T09:24:37.078015Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'List the latest BP readings for patients....'", "module": "sql_service", "function": "query", "line": 396}
{"timestamp": "2026-01-08T09:24:37.078056Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udd0d Analyzing natural language query", "module": "sql_service", "function": "_is_simple_query", "line": 338}
{"timestamp": "2026-01-08T09:24:37.078145Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query classified as COMPLEX (pattern=False, complexity=False, multi_table=False)", "module": "sql_service", "function": "_is_simple_query", "line": 381}
{"timestamp": "2026-01-08T09:24:37.078165Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Complex query detected - using full agent", "module": "sql_service", "function": "query", "line": 403}
{"timestamp": "2026-01-08T09:24:37.078186Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 539}
{"timestamp": "2026-01-08T09:24:37.078204Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL AGENT EXECUTION TRACE:", "module": "sql_service", "function": "_execute_with_agent", "line": 540}
{"timestamp": "2026-01-08T09:24:37.078222Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 541}
{"timestamp": "2026-01-08T09:24:37.838888Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:24:38.966102Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:24:39.747072Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:24:41.228469Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:24:41.932573Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:24:42.960458Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:24:45.076394Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 567}
{"timestamp": "2026-01-08T09:24:45.076682Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL query completed. Result length: 703 chars", "module": "sql_service", "function": "_execute_with_agent", "line": 568}
{"timestamp": "2026-01-08T09:24:45.076821Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: Here are the latest blood pressure readings for patients:\n\n1. Systolic: 143, Diastolic: 115, Date: 2025-10-24 09:31:38\n2. Systolic: 218, Diastolic: 167, Date: 2025-10-24 09:28:54\n3. Systolic: 193, Diastolic: 145, Date: 2025-10-24 08:09:10\n4. Systolic: 140, Diastolic: 90, Date: 2025-10-13 07:16:34\n5....", "module": "sql_service", "function": "_execute_with_agent", "line": 570}
{"timestamp": "2026-01-08T09:24:45.076964Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 571}
{"timestamp": "2026-01-08T09:24:45.727572Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:24:50.835630Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=13e9c8d4-3925-4eca-a2a3-027cc81db75e, duration=16.39s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:29:00.125373Z", "level": "INFO", "logger": "app", "message": "Shutting down application", "module": "app", "function": "lifespan", "line": 34}
{"timestamp": "2026-01-08T09:29:04.786240Z", "level": "INFO", "logger": "app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-08T09:29:04.786282Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-08T09:29:04.786304Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-08T09:29:04.786372Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-08T09:29:04.801495Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-08T09:29:04.801538Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-08T09:29:06.294904Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-08T09:29:06.294956Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-08T09:29:06.294981Z", "level": "INFO", "logger": "app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-08T09:29:06.294999Z", "level": "INFO", "logger": "app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-08T09:29:35.568099Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login attempt for user: admin", "module": "auth", "function": "login", "line": 27}
{"timestamp": "2026-01-08T09:29:35.569101Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login successful for user: admin", "module": "auth", "function": "login", "line": 50}
{"timestamp": "2026-01-08T09:29:35.570327Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=51", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:29:35.570359Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Initializing AgentService", "module": "agent_service", "function": "__init__", "line": 121}
{"timestamp": "2026-01-08T09:29:35.570384Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Connecting to database at postgresql://admin:admin@127.0.0.1:5432/Spice_BD", "module": "sql_service", "function": "__init__", "line": 26}
{"timestamp": "2026-01-08T09:29:35.914116Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Database connection established with view support", "module": "sql_service", "function": "__init__", "line": 46}
{"timestamp": "2026-01-08T09:29:36.115066Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Cached schema for 39 relevant tables out of 114 total", "module": "sql_service", "function": "_cache_schema", "line": 230}
{"timestamp": "2026-01-08T09:29:36.115123Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Relevant tables: bp_log, current_medication, diagnosis, glucose_log, lab_test, lab_test_result, lab_test_result_range, medical_compliance, medication_country_detail, patient...", "module": "sql_service", "function": "_cache_schema", "line": 231}
{"timestamp": "2026-01-08T09:29:36.229645Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "SQL agent initialized successfully with 39 cached tables", "module": "sql_service", "function": "__init__", "line": 78}
{"timestamp": "2026-01-08T09:29:36.234102Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "AgentService initialized successfully", "module": "agent_service", "function": "__init__", "line": 184}
{"timestamp": "2026-01-08T09:29:36.234163Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=b364d952-3b78-47a2-886f-d9c271a9e546): 'How many patients were screened for blood pressure?...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:29:37.044640Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:29:38.363893Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Count the number of patients who were screened for blood pressure using the v_analytics_screening ta...'", "module": "sql_service", "function": "query", "line": 396}
{"timestamp": "2026-01-08T09:29:38.363963Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udd0d Analyzing natural language query", "module": "sql_service", "function": "_is_simple_query", "line": 338}
{"timestamp": "2026-01-08T09:29:38.364153Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query classified as COMPLEX (pattern=True, complexity=False, multi_table=True)", "module": "sql_service", "function": "_is_simple_query", "line": 381}
{"timestamp": "2026-01-08T09:29:38.364362Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Complex query detected - using full agent", "module": "sql_service", "function": "query", "line": 403}
{"timestamp": "2026-01-08T09:29:38.364430Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 539}
{"timestamp": "2026-01-08T09:29:38.364460Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL AGENT EXECUTION TRACE:", "module": "sql_service", "function": "_execute_with_agent", "line": 540}
{"timestamp": "2026-01-08T09:29:38.364484Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 541}
{"timestamp": "2026-01-08T09:29:39.129386Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:29:39.761134Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:29:40.565141Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:29:41.625562Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:29:43.111419Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:29:44.041750Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:29:44.632733Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 567}
{"timestamp": "2026-01-08T09:29:44.632819Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL query completed. Result length: 135 chars", "module": "sql_service", "function": "_execute_with_agent", "line": 568}
{"timestamp": "2026-01-08T09:29:44.632868Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: The number of patients who were screened for blood pressure with a workflow status of 'NCD' and have a blood pressure reading is 5,332....", "module": "sql_service", "function": "_execute_with_agent", "line": 570}
{"timestamp": "2026-01-08T09:29:44.632906Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 571}
{"timestamp": "2026-01-08T09:29:45.113403Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:29:47.583540Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=b364d952-3b78-47a2-886f-d9c271a9e546, duration=11.35s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:29:47.590303Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=45", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:29:47.590476Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=52289a5e-8d6d-45f9-a438-80b92438bf93): 'What is the total number of crisis referrals?...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:29:48.221626Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:29:48.534310Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Count the total number of crisis referrals from v_analytics_screening where crisis_referral_status =...'", "module": "sql_service", "function": "query", "line": 396}
{"timestamp": "2026-01-08T09:29:48.534505Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udd0d Analyzing natural language query", "module": "sql_service", "function": "_is_simple_query", "line": 338}
{"timestamp": "2026-01-08T09:29:48.535065Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query classified as SIMPLE (natural language)", "module": "sql_service", "function": "_is_simple_query", "line": 379}
{"timestamp": "2026-01-08T09:29:48.535213Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Detected simple query - using optimized execution path", "module": "sql_service", "function": "query", "line": 400}
{"timestamp": "2026-01-08T09:29:48.535294Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_optimized", "line": 412}
{"timestamp": "2026-01-08T09:29:48.535356Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 OPTIMIZED SQL EXECUTION:", "module": "sql_service", "function": "_execute_optimized", "line": 413}
{"timestamp": "2026-01-08T09:29:48.535454Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_optimized", "line": 414}
{"timestamp": "2026-01-08T09:29:48.535589Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " API Call 1: Generate SQL query with targeted schema", "module": "sql_service", "function": "_execute_optimized", "line": 429}
{"timestamp": "2026-01-08T09:29:48.535725Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udccb Selected relevant tables for query: v_analytics_screening", "module": "sql_service", "function": "_get_relevant_schema", "line": 281}
{"timestamp": "2026-01-08T09:29:49.345439Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:29:49.348418Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL to execute: SELECT COUNT(*) \nFROM v_analytics_screening \nWHERE crisis_referral_status = 'Crisis Referral';...", "module": "sql_service", "function": "_execute_optimized", "line": 463}
{"timestamp": "2026-01-08T09:29:49.348618Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Executing query against database (no API call)", "module": "sql_service", "function": "_execute_optimized", "line": 471}
{"timestamp": "2026-01-08T09:29:49.367710Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query result: [(1219,)]", "module": "sql_service", "function": "_execute_optimized", "line": 473}
{"timestamp": "2026-01-08T09:29:49.367877Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " API Call 2: Format natural language response", "module": "sql_service", "function": "_execute_optimized", "line": 476}
{"timestamp": "2026-01-08T09:29:50.371446Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:29:50.374484Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_optimized", "line": 491}
{"timestamp": "2026-01-08T09:29:50.374644Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Optimized execution completed with 2 API call(s) (vs 7 with agent)", "module": "sql_service", "function": "_execute_optimized", "line": 492}
{"timestamp": "2026-01-08T09:29:50.374745Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: There are a total of 1,219 crisis referrals recorded in the v_analytics_screening database....", "module": "sql_service", "function": "_execute_optimized", "line": 493}
{"timestamp": "2026-01-08T09:29:50.374822Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_optimized", "line": 494}
{"timestamp": "2026-01-08T09:29:50.987094Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:29:52.726540Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=52289a5e-8d6d-45f9-a438-80b92438bf93, duration=5.14s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:29:52.731936Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=63", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:29:52.732084Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=b7a6ba5f-d664-42d7-860b-aac88542b432): 'How many patients were referred due to elevated blood pressure?...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:29:53.301595Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:29:53.656290Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Count the number of patients referred due to elevated blood pressure from v_analytics_screening wher...'", "module": "sql_service", "function": "query", "line": 396}
{"timestamp": "2026-01-08T09:29:53.656439Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udd0d Analyzing natural language query", "module": "sql_service", "function": "_is_simple_query", "line": 338}
{"timestamp": "2026-01-08T09:29:53.656545Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query classified as COMPLEX (pattern=True, complexity=False, multi_table=True)", "module": "sql_service", "function": "_is_simple_query", "line": 381}
{"timestamp": "2026-01-08T09:29:53.656588Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Complex query detected - using full agent", "module": "sql_service", "function": "query", "line": 403}
{"timestamp": "2026-01-08T09:29:53.656630Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 539}
{"timestamp": "2026-01-08T09:29:53.656669Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL AGENT EXECUTION TRACE:", "module": "sql_service", "function": "_execute_with_agent", "line": 540}
{"timestamp": "2026-01-08T09:29:53.656711Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 541}
{"timestamp": "2026-01-08T09:29:54.291819Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:29:55.081356Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:29:56.514523Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:29:57.436234Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:29:58.154387Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:29:58.974942Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:29:59.104003Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 567}
{"timestamp": "2026-01-08T09:29:59.104119Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL query completed. Result length: 102 chars", "module": "sql_service", "function": "_execute_with_agent", "line": 568}
{"timestamp": "2026-01-08T09:29:59.104169Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: There are 2,139 patients referred due to elevated blood pressure in the `v_analytics_screening` table....", "module": "sql_service", "function": "_execute_with_agent", "line": 570}
{"timestamp": "2026-01-08T09:29:59.104217Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 571}
{"timestamp": "2026-01-08T09:29:59.580478Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:30:01.544078Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=b7a6ba5f-d664-42d7-860b-aac88542b432, duration=8.81s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:30:01.545610Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=55", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:30:01.545661Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=2f923627-3f83-4f11-8fda-61dc452a4982): 'Show me the breakdown of enrolled patients by condition...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:30:02.352560Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:30:02.559206Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Show the breakdown of enrolled patients by condition using the v_analytics_enrollment table....'", "module": "sql_service", "function": "query", "line": 396}
{"timestamp": "2026-01-08T09:30:02.559303Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udd0d Analyzing natural language query", "module": "sql_service", "function": "_is_simple_query", "line": 338}
{"timestamp": "2026-01-08T09:30:02.560110Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query classified as COMPLEX (pattern=False, complexity=False, multi_table=True)", "module": "sql_service", "function": "_is_simple_query", "line": 381}
{"timestamp": "2026-01-08T09:30:02.560154Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Complex query detected - using full agent", "module": "sql_service", "function": "query", "line": 403}
{"timestamp": "2026-01-08T09:30:02.560191Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 539}
{"timestamp": "2026-01-08T09:30:02.560226Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL AGENT EXECUTION TRACE:", "module": "sql_service", "function": "_execute_with_agent", "line": 540}
{"timestamp": "2026-01-08T09:30:02.560257Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 541}
{"timestamp": "2026-01-08T09:30:03.482172Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:30:04.651536Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:30:06.447567Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:30:07.680790Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:30:08.600303Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:30:09.518979Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:30:09.860151Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 567}
{"timestamp": "2026-01-08T09:30:09.860230Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL query completed. Result length: 193 chars", "module": "sql_service", "function": "_execute_with_agent", "line": 568}
{"timestamp": "2026-01-08T09:30:09.860274Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: Here is the breakdown of enrolled patients by condition:\n\n1. Provisional Diagnosis: 6,666 patients\n2. Co-morbid (DBM + HTN): 734 patients\n3. Hypertension: 368 patients\n4. Diabetes: 138 patients...", "module": "sql_service", "function": "_execute_with_agent", "line": 570}
{"timestamp": "2026-01-08T09:30:09.860317Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 571}
{"timestamp": "2026-01-08T09:30:10.416961Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:30:15.186037Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=2f923627-3f83-4f11-8fda-61dc452a4982, duration=13.64s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:30:15.191486Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=32", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:30:15.191636Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=341e3c29-69e9-426c-b797-ded854e4c247): 'What is the HTN prevalence rate?...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:30:16.072546Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:30:16.842512Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Calculate the HTN prevalence rate using the formula: (Elevated BP Referrals / Screened for BP) * 100...'", "module": "sql_service", "function": "query", "line": 396}
{"timestamp": "2026-01-08T09:30:16.842734Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udd0d Analyzing natural language query", "module": "sql_service", "function": "_is_simple_query", "line": 338}
{"timestamp": "2026-01-08T09:30:16.842884Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query classified as COMPLEX (pattern=False, complexity=False, multi_table=False)", "module": "sql_service", "function": "_is_simple_query", "line": 381}
{"timestamp": "2026-01-08T09:30:16.842950Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Complex query detected - using full agent", "module": "sql_service", "function": "query", "line": 403}
{"timestamp": "2026-01-08T09:30:16.843003Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 539}
{"timestamp": "2026-01-08T09:30:16.843049Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL AGENT EXECUTION TRACE:", "module": "sql_service", "function": "_execute_with_agent", "line": 540}
{"timestamp": "2026-01-08T09:30:16.843093Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 541}
{"timestamp": "2026-01-08T09:30:20.477843Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:30:24.986942Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:30:26.214016Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:30:32.253566Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:30:33.277740Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:30:34.628807Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:30:34.910181Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 567}
{"timestamp": "2026-01-08T09:30:34.910367Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL query completed. Result length: 114 chars", "module": "sql_service", "function": "_execute_with_agent", "line": 568}
{"timestamp": "2026-01-08T09:30:34.910493Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: The HTN prevalence rate, calculated as the percentage of elevated BP referrals among those screened for BP, is 0%....", "module": "sql_service", "function": "_execute_with_agent", "line": 570}
{"timestamp": "2026-01-08T09:30:34.910595Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 571}
{"timestamp": "2026-01-08T09:30:35.428655Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:30:38.025607Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=341e3c29-69e9-426c-b797-ded854e4c247, duration=22.83s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:30:38.030814Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=32", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:30:38.030943Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=a7bba373-0eaf-4f2e-a053-88c0ec635001): 'What is the DBM prevalence rate?...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:30:38.667344Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:30:39.219767Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Calculate the DBM prevalence rate using the formula: (Elevated BG Referrals / Screened for BG) * 100...'", "module": "sql_service", "function": "query", "line": 396}
{"timestamp": "2026-01-08T09:30:39.219936Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udd0d Analyzing natural language query", "module": "sql_service", "function": "_is_simple_query", "line": 338}
{"timestamp": "2026-01-08T09:30:39.220117Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query classified as COMPLEX (pattern=False, complexity=False, multi_table=False)", "module": "sql_service", "function": "_is_simple_query", "line": 381}
{"timestamp": "2026-01-08T09:30:39.220247Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Complex query detected - using full agent", "module": "sql_service", "function": "query", "line": 403}
{"timestamp": "2026-01-08T09:30:39.220338Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 539}
{"timestamp": "2026-01-08T09:30:39.220400Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL AGENT EXECUTION TRACE:", "module": "sql_service", "function": "_execute_with_agent", "line": 540}
{"timestamp": "2026-01-08T09:30:39.220454Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 541}
{"timestamp": "2026-01-08T09:30:39.894275Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:30:40.653839Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:30:41.572932Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:30:43.723569Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:30:44.545197Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:30:45.976078Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:30:46.072484Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 567}
{"timestamp": "2026-01-08T09:30:46.072557Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL query completed. Result length: 48 chars", "module": "sql_service", "function": "_execute_with_agent", "line": 568}
{"timestamp": "2026-01-08T09:30:46.072599Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: The DBM prevalence rate is approximately 89.97%....", "module": "sql_service", "function": "_execute_with_agent", "line": 570}
{"timestamp": "2026-01-08T09:30:46.072632Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 571}
{"timestamp": "2026-01-08T09:30:46.553955Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:30:49.385733Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=a7bba373-0eaf-4f2e-a053-88c0ec635001, duration=11.35s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:30:49.391246Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=43", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:30:49.391392Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=6ea62b80-34e6-438c-a501-8d662b098d59): 'What symptoms indicate hypertensive crisis?...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:30:49.870145Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:30:52.913015Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=6ea62b80-34e6-438c-a501-8d662b098d59, duration=3.52s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:30:52.917301Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=34", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:30:52.917421Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=401706b9-6183-4cfd-9acc-f31b8073e0f8): 'What does PHQ-9 screening measure?...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:30:53.437270Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:30:55.512260Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=401706b9-6183-4cfd-9acc-f31b8073e0f8, duration=2.59s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:30:55.514589Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=50", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:30:55.514673Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=349b14e4-4051-4403-aa42-910fe9251f3a): 'Find patients with poor medication adherence notes...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:30:57.139539Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:30:57.596383Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "\u26a1 Lazy loading vector store on first use...", "module": "agent_service", "function": "vector_store", "line": 190}
{"timestamp": "2026-01-08T09:30:57.596624Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Initializing vector store service", "module": "vector_store", "function": "__init__", "line": 30}
{"timestamp": "2026-01-08T09:30:57.597210Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Looking for RAG config at: /Users/adityanbhatt/fhir_rag/backend/config/embedding_config.yaml", "module": "vector_store", "function": "__init__", "line": 41}
{"timestamp": "2026-01-08T09:30:57.597364Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Loading RAG config from /Users/adityanbhatt/fhir_rag/backend/config/embedding_config.yaml", "module": "vector_store", "function": "__init__", "line": 46}
{"timestamp": "2026-01-08T09:30:57.604974Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Loaded RAG config successfully", "module": "vector_store", "function": "__init__", "line": 51}
{"timestamp": "2026-01-08T09:30:57.605423Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Resolved chroma_path to: /Users/adityanbhatt/fhir_rag/backend/data/indexes/chroma_db_advanced", "module": "retrieve", "function": "_resolve_config_paths", "line": 155}
{"timestamp": "2026-01-08T09:30:57.605566Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Resolved model_path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "retrieve", "function": "_resolve_config_paths", "line": 162}
{"timestamp": "2026-01-08T09:30:57.673804Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Loading docstore from /Users/adityanbhatt/fhir_rag/backend/data/indexes/chroma_db_advanced/parent_docstore.pkl with module remapping", "module": "retrieve", "function": "_load_docstore", "line": 284}
{"timestamp": "2026-01-08T09:30:58.167072Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Successfully loaded docstore with module remapping", "module": "retrieve", "function": "_load_docstore", "line": 286}
{"timestamp": "2026-01-08T09:30:58.168405Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Loading 154161 parent documents for BM25...", "module": "retrieve", "function": "_setup_retrievers", "line": 175}
{"timestamp": "2026-01-08T09:30:58.191091Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Filtered to 59572 documents from relevant tables for BM25 index.", "module": "retrieve", "function": "_setup_retrievers", "line": 185}
{"timestamp": "2026-01-08T09:30:59.019256Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "BM25Retriever initialized on relevant tables.", "module": "retrieve", "function": "_setup_retrievers", "line": 196}
{"timestamp": "2026-01-08T09:30:59.020639Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Initializing reranker: BAAI/bge-reranker-base", "module": "retrieve", "function": "__init__", "line": 137}
{"timestamp": "2026-01-08T09:31:01.149223Z", "level": "INFO", "logger": "sentence_transformers.cross_encoder.CrossEncoder", "message": "Use pytorch device: mps", "module": "CrossEncoder", "function": "__init__", "line": 222}
{"timestamp": "2026-01-08T09:31:02.265634Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Advanced RAG Retriever initialized successfully.", "module": "retrieve", "function": "__init__", "line": 143}
{"timestamp": "2026-01-08T09:31:02.265857Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Vector store initialized successfully", "module": "vector_store", "function": "__init__", "line": 55}
{"timestamp": "2026-01-08T09:31:02.266033Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "\u2705 Vector store loaded", "module": "agent_service", "function": "vector_store", "line": 192}
{"timestamp": "2026-01-08T09:31:02.266141Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Searching vector store for query: 'Find patients with poor medication adherence notes...' (top_k=5)", "module": "vector_store", "function": "search", "line": 69}
{"timestamp": "2026-01-08T09:31:02.266618Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Executing query: Find patients with poor medication adherence notes", "module": "retrieve", "function": "_get_relevant_documents", "line": 223}
{"timestamp": "2026-01-08T09:31:04.812722Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Reranking 79 documents for query: 'Find patients with poor medication adherence notes'", "module": "retrieve", "function": "_get_relevant_documents", "line": 257}
{"timestamp": "2026-01-08T09:31:05.969634Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Returning 10 reranked documents.", "module": "retrieve", "function": "_get_relevant_documents", "line": 267}
{"timestamp": "2026-01-08T09:31:05.969795Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Retrieved 10 documents from vector store", "module": "vector_store", "function": "search", "line": 84}
{"timestamp": "2026-01-08T09:31:06.663461Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:31:12.522406Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=349b14e4-4051-4403-aa42-910fe9251f3a, duration=17.01s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:31:12.525974Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=59", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:31:12.526040Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=29713d69-e07d-42ab-bd5c-bfb91206ba3b): 'Which patients have documented dizziness or blurred vision?...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:31:13.256509Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:31:13.808708Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Searching vector store for query: 'Find patients with documented dizziness or blurred vision in their clinical notes....' (top_k=5)", "module": "vector_store", "function": "search", "line": 69}
{"timestamp": "2026-01-08T09:31:13.809135Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Executing query: Find patients with documented dizziness or blurred vision in their clinical notes.", "module": "retrieve", "function": "_get_relevant_documents", "line": 223}
{"timestamp": "2026-01-08T09:31:14.007648Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Reranking 75 documents for query: 'Find patients with documented dizziness or blurred vision in their clinical notes.'", "module": "retrieve", "function": "_get_relevant_documents", "line": 257}
{"timestamp": "2026-01-08T09:31:14.869518Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Returning 10 reranked documents.", "module": "retrieve", "function": "_get_relevant_documents", "line": 267}
{"timestamp": "2026-01-08T09:31:14.869640Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Retrieved 10 documents from vector store", "module": "vector_store", "function": "search", "line": 84}
{"timestamp": "2026-01-08T09:31:15.397794Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:31:21.484846Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=29713d69-e07d-42ab-bd5c-bfb91206ba3b, duration=8.96s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:31:21.486627Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=78", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:31:21.486687Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=4939115b-04d6-43b0-a821-a961cb30e753): 'Find high-risk patients with multiple comorbidities and poor lifestyle factors...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:31:23.869932Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:31:23.895393Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Find patients with comorbid conditions of both Hypertension and Diabetes....'", "module": "sql_service", "function": "query", "line": 396}
{"timestamp": "2026-01-08T09:31:23.895463Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udd0d Analyzing natural language query", "module": "sql_service", "function": "_is_simple_query", "line": 338}
{"timestamp": "2026-01-08T09:31:23.895568Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query classified as COMPLEX (pattern=False, complexity=True, multi_table=False)", "module": "sql_service", "function": "_is_simple_query", "line": 381}
{"timestamp": "2026-01-08T09:31:23.895594Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Complex query detected - using full agent", "module": "sql_service", "function": "query", "line": 403}
{"timestamp": "2026-01-08T09:31:23.895618Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 539}
{"timestamp": "2026-01-08T09:31:23.895639Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL AGENT EXECUTION TRACE:", "module": "sql_service", "function": "_execute_with_agent", "line": 540}
{"timestamp": "2026-01-08T09:31:23.895660Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 541}
{"timestamp": "2026-01-08T09:31:25.199403Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:31:26.019209Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:31:27.145923Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:31:29.951807Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:31:33.596649Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:31:37.080299Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:31:37.404228Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 567}
{"timestamp": "2026-01-08T09:31:37.404436Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL query completed. Result length: 97 chars", "module": "sql_service", "function": "_execute_with_agent", "line": 568}
{"timestamp": "2026-01-08T09:31:37.404566Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: There are no patients in the database with comorbid conditions of both Hypertension and Diabetes....", "module": "sql_service", "function": "_execute_with_agent", "line": 570}
{"timestamp": "2026-01-08T09:31:37.404655Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 571}
{"timestamp": "2026-01-08T09:31:37.405436Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Searching vector store for query: 'Find patients with poor lifestyle factors such as smoking, poor diet, or lack of exercise....' (top_k=5)", "module": "vector_store", "function": "search", "line": 69}
{"timestamp": "2026-01-08T09:31:37.405718Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Executing query: Find patients with poor lifestyle factors such as smoking, poor diet, or lack of exercise.", "module": "retrieve", "function": "_get_relevant_documents", "line": 223}
{"timestamp": "2026-01-08T09:31:37.648581Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Reranking 87 documents for query: 'Find patients with poor lifestyle factors such as smoking, poor diet, or lack of exercise.'", "module": "retrieve", "function": "_get_relevant_documents", "line": 257}
{"timestamp": "2026-01-08T09:31:38.834693Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Returning 10 reranked documents.", "module": "retrieve", "function": "_get_relevant_documents", "line": 267}
{"timestamp": "2026-01-08T09:31:38.835090Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Retrieved 10 documents from vector store", "module": "vector_store", "function": "search", "line": 84}
{"timestamp": "2026-01-08T09:31:41.686756Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:31:45.212792Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=4939115b-04d6-43b0-a821-a961cb30e753, duration=23.73s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:31:45.214741Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=72", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:31:45.214800Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=fe778e2d-6506-41ca-af38-b204be4e67ba): 'Identify patients who may need intensive counseling based on their notes...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:31:45.990152Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:31:47.016691Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Searching vector store for query: 'Find patients with notes indicating need for intensive counseling, such as mentions of 'non-complian...' (top_k=5)", "module": "vector_store", "function": "search", "line": 69}
{"timestamp": "2026-01-08T09:31:47.017725Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Executing query: Find patients with notes indicating need for intensive counseling, such as mentions of 'non-compliance', 'refused medication', 'poor adherence', or 'lifestyle issues'.", "module": "retrieve", "function": "_get_relevant_documents", "line": 223}
{"timestamp": "2026-01-08T09:31:47.719822Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Reranking 93 documents for query: 'Find patients with notes indicating need for intensive counseling, such as mentions of 'non-compliance', 'refused medication', 'poor adherence', or 'lifestyle issues'.'", "module": "retrieve", "function": "_get_relevant_documents", "line": 257}
{"timestamp": "2026-01-08T09:31:49.061431Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Returning 10 reranked documents.", "module": "retrieve", "function": "_get_relevant_documents", "line": 267}
{"timestamp": "2026-01-08T09:31:49.061528Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Retrieved 10 documents from vector store", "module": "vector_store", "function": "search", "line": 84}
{"timestamp": "2026-01-08T09:31:49.588885Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:31:55.728501Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=fe778e2d-6506-41ca-af38-b204be4e67ba, duration=10.51s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:31:55.730365Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=48", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:31:55.730425Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=8dfaa475-efde-4c3c-8ef9-902db69e0893): 'How many smokers have uncontrolled hypertension?...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:31:56.946214Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:31:56.958542Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Count patients with uncontrolled hypertension....'", "module": "sql_service", "function": "query", "line": 396}
{"timestamp": "2026-01-08T09:31:56.958637Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udd0d Analyzing natural language query", "module": "sql_service", "function": "_is_simple_query", "line": 338}
{"timestamp": "2026-01-08T09:31:56.958722Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query classified as COMPLEX (pattern=True, complexity=True, multi_table=False)", "module": "sql_service", "function": "_is_simple_query", "line": 381}
{"timestamp": "2026-01-08T09:31:56.958762Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Complex query detected - using full agent", "module": "sql_service", "function": "query", "line": 403}
{"timestamp": "2026-01-08T09:31:56.958820Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 539}
{"timestamp": "2026-01-08T09:31:56.958856Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL AGENT EXECUTION TRACE:", "module": "sql_service", "function": "_execute_with_agent", "line": 540}
{"timestamp": "2026-01-08T09:31:56.958888Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 541}
{"timestamp": "2026-01-08T09:31:57.765442Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:31:58.685867Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:32:00.221291Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:32:02.374895Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:32:02.782249Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 429 Too Many Requests\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:32:02.783824Z", "level": "INFO", "logger": "openai._base_client", "message": "Retrying request to /chat/completions in 1.752000 seconds", "module": "_base_client", "function": "_sleep_for_retry", "line": 1071}
{"timestamp": "2026-01-08T09:32:05.618186Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:32:06.877583Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 429 Too Many Requests\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:32:06.878635Z", "level": "INFO", "logger": "openai._base_client", "message": "Retrying request to /chat/completions in 4.616000 seconds", "module": "_base_client", "function": "_sleep_for_retry", "line": 1071}
{"timestamp": "2026-01-08T09:32:11.895191Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 429 Too Many Requests\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:32:11.896225Z", "level": "INFO", "logger": "openai._base_client", "message": "Retrying request to /chat/completions in 1.602000 seconds", "module": "_base_client", "function": "_sleep_for_retry", "line": 1071}
{"timestamp": "2026-01-08T09:32:14.254665Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:32:14.291916Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 567}
{"timestamp": "2026-01-08T09:32:14.292083Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL query completed. Result length: 54 chars", "module": "sql_service", "function": "_execute_with_agent", "line": 568}
{"timestamp": "2026-01-08T09:32:14.292186Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: There are 879 patients with uncontrolled hypertension....", "module": "sql_service", "function": "_execute_with_agent", "line": 570}
{"timestamp": "2026-01-08T09:32:14.292264Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 571}
{"timestamp": "2026-01-08T09:32:14.293023Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Searching vector store for query: 'Find patients who are smokers....' (top_k=5)", "module": "vector_store", "function": "search", "line": 69}
{"timestamp": "2026-01-08T09:32:14.293291Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Executing query: Find patients who are smokers.", "module": "retrieve", "function": "_get_relevant_documents", "line": 223}
{"timestamp": "2026-01-08T09:32:14.630786Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Reranking 76 documents for query: 'Find patients who are smokers.'", "module": "retrieve", "function": "_get_relevant_documents", "line": 257}
{"timestamp": "2026-01-08T09:32:15.660839Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Returning 10 reranked documents.", "module": "retrieve", "function": "_get_relevant_documents", "line": 267}
{"timestamp": "2026-01-08T09:32:15.661253Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Retrieved 10 documents from vector store", "module": "vector_store", "function": "search", "line": 84}
{"timestamp": "2026-01-08T09:32:16.299979Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 429 Too Many Requests\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:32:16.301027Z", "level": "INFO", "logger": "openai._base_client", "message": "Retrying request to /chat/completions in 2.322000 seconds", "module": "_base_client", "function": "_sleep_for_retry", "line": 1071}
{"timestamp": "2026-01-08T09:32:19.676028Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:32:25.652219Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=8dfaa475-efde-4c3c-8ef9-902db69e0893, duration=29.92s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:32:25.656257Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=67", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:32:25.656323Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=966dfc84-ad0e-414d-bd2b-2cc724dd407b): 'Count crisis referrals and describe the typical symptoms documented...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:32:27.053042Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:32:27.068879Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Count the number of crisis referrals from v_analytics_screening....'", "module": "sql_service", "function": "query", "line": 396}
{"timestamp": "2026-01-08T09:32:27.068976Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udd0d Analyzing natural language query", "module": "sql_service", "function": "_is_simple_query", "line": 338}
{"timestamp": "2026-01-08T09:32:27.069077Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query classified as COMPLEX (pattern=False, complexity=False, multi_table=False)", "module": "sql_service", "function": "_is_simple_query", "line": 381}
{"timestamp": "2026-01-08T09:32:27.069121Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Complex query detected - using full agent", "module": "sql_service", "function": "query", "line": 403}
{"timestamp": "2026-01-08T09:32:27.069158Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 539}
{"timestamp": "2026-01-08T09:32:27.069194Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL AGENT EXECUTION TRACE:", "module": "sql_service", "function": "_execute_with_agent", "line": 540}
{"timestamp": "2026-01-08T09:32:27.069227Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 541}
{"timestamp": "2026-01-08T09:32:27.768527Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:32:28.385844Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:32:28.894264Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 429 Too Many Requests\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:32:28.895350Z", "level": "INFO", "logger": "openai._base_client", "message": "Retrying request to /chat/completions in 0.600000 seconds", "module": "_base_client", "function": "_sleep_for_retry", "line": 1071}
{"timestamp": "2026-01-08T09:32:29.897120Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 429 Too Many Requests\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:32:29.897397Z", "level": "INFO", "logger": "openai._base_client", "message": "Retrying request to /chat/completions in 0.487000 seconds", "module": "_base_client", "function": "_sleep_for_retry", "line": 1071}
{"timestamp": "2026-01-08T09:32:31.352118Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:32:32.474202Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:32:32.785710Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 429 Too Many Requests\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:32:32.786845Z", "level": "INFO", "logger": "openai._base_client", "message": "Retrying request to /chat/completions in 0.414000 seconds", "module": "_base_client", "function": "_sleep_for_retry", "line": 1071}
{"timestamp": "2026-01-08T09:32:34.099889Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:32:35.243619Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:32:35.368430Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 567}
{"timestamp": "2026-01-08T09:32:35.368613Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL query completed. Result length: 70 chars", "module": "sql_service", "function": "_execute_with_agent", "line": 568}
{"timestamp": "2026-01-08T09:32:35.368725Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: There are 7,906 crisis referrals in the `v_analytics_screening` table....", "module": "sql_service", "function": "_execute_with_agent", "line": 570}
{"timestamp": "2026-01-08T09:32:35.368810Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 571}
{"timestamp": "2026-01-08T09:32:35.369635Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Searching vector store for query: 'Find typical symptoms documented in crisis referrals....' (top_k=5)", "module": "vector_store", "function": "search", "line": 69}
{"timestamp": "2026-01-08T09:32:35.369938Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Executing query: Find typical symptoms documented in crisis referrals.", "module": "retrieve", "function": "_get_relevant_documents", "line": 223}
{"timestamp": "2026-01-08T09:32:35.550584Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Reranking 75 documents for query: 'Find typical symptoms documented in crisis referrals.'", "module": "retrieve", "function": "_get_relevant_documents", "line": 257}
{"timestamp": "2026-01-08T09:32:36.642474Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Returning 10 reranked documents.", "module": "retrieve", "function": "_get_relevant_documents", "line": 267}
{"timestamp": "2026-01-08T09:32:36.642899Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Retrieved 10 documents from vector store", "module": "vector_store", "function": "search", "line": 84}
{"timestamp": "2026-01-08T09:32:36.983646Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 429 Too Many Requests\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:32:36.984600Z", "level": "INFO", "logger": "openai._base_client", "message": "Retrying request to /chat/completions in 3.142000 seconds", "module": "_base_client", "function": "_sleep_for_retry", "line": 1071}
{"timestamp": "2026-01-08T09:32:40.466051Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 429 Too Many Requests\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:32:40.467063Z", "level": "INFO", "logger": "openai._base_client", "message": "Retrying request to /chat/completions in 1.660000 seconds", "module": "_base_client", "function": "_sleep_for_retry", "line": 1071}
{"timestamp": "2026-01-08T09:32:42.721881Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:32:46.765951Z", "level": "WARNING", "logger": "backend.services.agent_service", "message": "Failed to parse agent JSON output: Expecting ',' delimiter: line 7 column 34 (char 218)", "module": "agent_service", "function": "_parse_agent_output", "line": 310}
{"timestamp": "2026-01-08T09:32:46.766056Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=966dfc84-ad0e-414d-bd2b-2cc724dd407b, duration=21.11s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:32:46.767840Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=66", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:32:46.767898Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=ef226ad3-ca89-4a5d-b3e9-0223a5a51b06): 'Identify high-risk patients and summarize their clinical histories...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:32:47.326052Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:32:49.987354Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Identify patients with comorbid hypertension and diabetes....'", "module": "sql_service", "function": "query", "line": 396}
{"timestamp": "2026-01-08T09:32:49.987499Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udd0d Analyzing natural language query", "module": "sql_service", "function": "_is_simple_query", "line": 338}
{"timestamp": "2026-01-08T09:32:49.987640Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query classified as COMPLEX (pattern=False, complexity=True, multi_table=False)", "module": "sql_service", "function": "_is_simple_query", "line": 381}
{"timestamp": "2026-01-08T09:32:49.987690Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Complex query detected - using full agent", "module": "sql_service", "function": "query", "line": 403}
{"timestamp": "2026-01-08T09:32:49.987734Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 539}
{"timestamp": "2026-01-08T09:32:49.987775Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL AGENT EXECUTION TRACE:", "module": "sql_service", "function": "_execute_with_agent", "line": 540}
{"timestamp": "2026-01-08T09:32:49.987816Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 541}
{"timestamp": "2026-01-08T09:32:50.807390Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:32:51.794611Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:32:52.356796Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 429 Too Many Requests\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:32:52.357029Z", "level": "INFO", "logger": "openai._base_client", "message": "Retrying request to /chat/completions in 4.288000 seconds", "module": "_base_client", "function": "_sleep_for_retry", "line": 1071}
{"timestamp": "2026-01-08T09:32:57.772195Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:33:02.969259Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:33:03.506681Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 429 Too Many Requests\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:33:03.507784Z", "level": "INFO", "logger": "openai._base_client", "message": "Retrying request to /chat/completions in 0.112000 seconds", "module": "_base_client", "function": "_sleep_for_retry", "line": 1071}
{"timestamp": "2026-01-08T09:33:04.306232Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:33:05.348262Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 429 Too Many Requests\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:33:05.348655Z", "level": "INFO", "logger": "openai._base_client", "message": "Retrying request to /chat/completions in 5.326000 seconds", "module": "_base_client", "function": "_sleep_for_retry", "line": 1071}
{"timestamp": "2026-01-08T09:33:10.956389Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 429 Too Many Requests\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:33:10.956692Z", "level": "INFO", "logger": "openai._base_client", "message": "Retrying request to /chat/completions in 0.002000 seconds", "module": "_base_client", "function": "_sleep_for_retry", "line": 1071}
{"timestamp": "2026-01-08T09:33:11.262946Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 429 Too Many Requests\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:33:11.272227Z", "level": "ERROR", "logger": "backend.services.sql_service", "message": " SQL query failed: Error code: 429 - {'error': {'message': 'Rate limit reached for gpt-4o in organization org-lIshM8Wztmovd0NtwBOdGn9Y on tokens per min (TPM): Limit 30000, Used 27394, Requested 2663. Please try again in 114ms. Visit https://platform.openai.com/account/rate-limits to learn more.', 'type': 'tokens', 'param': None, 'code': 'rate_limit_exceeded'}}", "module": "sql_service", "function": "_execute_with_agent", "line": 576, "exception": "Traceback (most recent call last):\n  File \"/Users/adityanbhatt/fhir_rag/backend/services/sql_service.py\", line 545, in _execute_with_agent\n    result = self.sql_agent.invoke({\"input\": question})\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain/chains/base.py\", line 165, in invoke\n    self._call(inputs, run_manager=run_manager)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain/agents/agent.py\", line 1625, in _call\n    next_step_output = self._take_next_step(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain/agents/agent.py\", line 1325, in _take_next_step\n    list(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain/agents/agent.py\", line 1352, in _iter_next_step\n    output = self._action_agent.plan(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain/agents/agent.py\", line 573, in plan\n    for chunk in self.runnable.stream(inputs, config={\"callbacks\": callbacks}):\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_core/runnables/base.py\", line 3650, in stream\n    yield from self.transform(iter([input]), config, **kwargs)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_core/runnables/base.py\", line 3636, in transform\n    yield from self._transform_stream_with_config(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_core/runnables/base.py\", line 2372, in _transform_stream_with_config\n    chunk: Output = context.run(next, iterator)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_core/runnables/base.py\", line 3595, in _transform\n    yield from final_pipeline\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_core/runnables/base.py\", line 1571, in transform\n    for ichunk in input:\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_core/runnables/base.py\", line 5927, in transform\n    yield from self.bound.transform(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_core/runnables/base.py\", line 1589, in transform\n    yield from self.stream(final, config, **kwargs)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_core/language_models/chat_models.py\", line 522, in stream\n    for chunk in self._stream(input_messages, stop=stop, **kwargs):\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_openai/chat_models/base.py\", line 1123, in _stream\n    response = self.client.create(**payload)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/openai/_utils/_utils.py\", line 286, in wrapper\n    return func(*args, **kwargs)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/openai/resources/chat/completions/completions.py\", line 1156, in create\n    return self._post(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/openai/_base_client.py\", line 1259, in post\n    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/openai/_base_client.py\", line 1047, in request\n    raise self._make_status_error_from_response(err.response) from None\nopenai.RateLimitError: Error code: 429 - {'error': {'message': 'Rate limit reached for gpt-4o in organization org-lIshM8Wztmovd0NtwBOdGn9Y on tokens per min (TPM): Limit 30000, Used 27394, Requested 2663. Please try again in 114ms. Visit https://platform.openai.com/account/rate-limits to learn more.', 'type': 'tokens', 'param': None, 'code': 'rate_limit_exceeded'}}"}
{"timestamp": "2026-01-08T09:33:11.273508Z", "level": "ERROR", "logger": "backend.services.agent_service", "message": "Query processing failed (trace_id=ef226ad3-ca89-4a5d-b3e9-0223a5a51b06): Error code: 429 - {'error': {'message': 'Rate limit reached for gpt-4o in organization org-lIshM8Wztmovd0NtwBOdGn9Y on tokens per min (TPM): Limit 30000, Used 27394, Requested 2663. Please try again in 114ms. Visit https://platform.openai.com/account/rate-limits to learn more.', 'type': 'tokens', 'param': None, 'code': 'rate_limit_exceeded'}}", "module": "agent_service", "function": "process_query", "line": 274, "exception": "Traceback (most recent call last):\n  File \"/Users/adityanbhatt/fhir_rag/backend/services/agent_service.py\", line 227, in process_query\n    result = self.agent_executor.invoke({\"input\": query})\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain/chains/base.py\", line 165, in invoke\n    self._call(inputs, run_manager=run_manager)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain/agents/agent.py\", line 1625, in _call\n    next_step_output = self._take_next_step(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain/agents/agent.py\", line 1325, in _take_next_step\n    list(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain/agents/agent.py\", line 1408, in _iter_next_step\n    yield self._perform_agent_action(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain/agents/agent.py\", line 1433, in _perform_agent_action\n    observation = tool.run(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_core/tools/base.py\", line 895, in run\n    raise error_to_raise\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_core/tools/base.py\", line 864, in run\n    response = context.run(self._run, *tool_args, **tool_kwargs)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_core/tools/simple.py\", line 123, in _run\n    return self.func(*args, **kwargs)\n  File \"/Users/adityanbhatt/fhir_rag/backend/services/sql_service.py\", line 404, in query\n    return self._execute_with_agent(question)\n  File \"/Users/adityanbhatt/fhir_rag/backend/services/sql_service.py\", line 545, in _execute_with_agent\n    result = self.sql_agent.invoke({\"input\": question})\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain/chains/base.py\", line 165, in invoke\n    self._call(inputs, run_manager=run_manager)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain/agents/agent.py\", line 1625, in _call\n    next_step_output = self._take_next_step(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain/agents/agent.py\", line 1325, in _take_next_step\n    list(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain/agents/agent.py\", line 1352, in _iter_next_step\n    output = self._action_agent.plan(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain/agents/agent.py\", line 573, in plan\n    for chunk in self.runnable.stream(inputs, config={\"callbacks\": callbacks}):\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_core/runnables/base.py\", line 3650, in stream\n    yield from self.transform(iter([input]), config, **kwargs)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_core/runnables/base.py\", line 3636, in transform\n    yield from self._transform_stream_with_config(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_core/runnables/base.py\", line 2372, in _transform_stream_with_config\n    chunk: Output = context.run(next, iterator)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_core/runnables/base.py\", line 3595, in _transform\n    yield from final_pipeline\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_core/runnables/base.py\", line 1571, in transform\n    for ichunk in input:\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_core/runnables/base.py\", line 5927, in transform\n    yield from self.bound.transform(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_core/runnables/base.py\", line 1589, in transform\n    yield from self.stream(final, config, **kwargs)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_core/language_models/chat_models.py\", line 522, in stream\n    for chunk in self._stream(input_messages, stop=stop, **kwargs):\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_openai/chat_models/base.py\", line 1123, in _stream\n    response = self.client.create(**payload)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/openai/_utils/_utils.py\", line 286, in wrapper\n    return func(*args, **kwargs)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/openai/resources/chat/completions/completions.py\", line 1156, in create\n    return self._post(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/openai/_base_client.py\", line 1259, in post\n    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/openai/_base_client.py\", line 1047, in request\n    raise self._make_status_error_from_response(err.response) from None\nopenai.RateLimitError: Error code: 429 - {'error': {'message': 'Rate limit reached for gpt-4o in organization org-lIshM8Wztmovd0NtwBOdGn9Y on tokens per min (TPM): Limit 30000, Used 27394, Requested 2663. Please try again in 114ms. Visit https://platform.openai.com/account/rate-limits to learn more.', 'type': 'tokens', 'param': None, 'code': 'rate_limit_exceeded'}}"}
{"timestamp": "2026-01-08T09:33:11.273994Z", "level": "ERROR", "logger": "backend.api.routes.chat", "message": "Chat request failed for user=admin: Error code: 429 - {'error': {'message': 'Rate limit reached for gpt-4o in organization org-lIshM8Wztmovd0NtwBOdGn9Y on tokens per min (TPM): Limit 30000, Used 27394, Requested 2663. Please try again in 114ms. Visit https://platform.openai.com/account/rate-limits to learn more.', 'type': 'tokens', 'param': None, 'code': 'rate_limit_exceeded'}}", "module": "chat", "function": "chat", "line": 51, "exception": "Traceback (most recent call last):\n  File \"/Users/adityanbhatt/fhir_rag/backend/api/routes/chat.py\", line 43, in chat\n    result = await agent_service.process_query(\n  File \"/Users/adityanbhatt/fhir_rag/backend/services/agent_service.py\", line 227, in process_query\n    result = self.agent_executor.invoke({\"input\": query})\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain/chains/base.py\", line 165, in invoke\n    self._call(inputs, run_manager=run_manager)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain/agents/agent.py\", line 1625, in _call\n    next_step_output = self._take_next_step(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain/agents/agent.py\", line 1325, in _take_next_step\n    list(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain/agents/agent.py\", line 1408, in _iter_next_step\n    yield self._perform_agent_action(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain/agents/agent.py\", line 1433, in _perform_agent_action\n    observation = tool.run(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_core/tools/base.py\", line 895, in run\n    raise error_to_raise\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_core/tools/base.py\", line 864, in run\n    response = context.run(self._run, *tool_args, **tool_kwargs)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_core/tools/simple.py\", line 123, in _run\n    return self.func(*args, **kwargs)\n  File \"/Users/adityanbhatt/fhir_rag/backend/services/sql_service.py\", line 404, in query\n    return self._execute_with_agent(question)\n  File \"/Users/adityanbhatt/fhir_rag/backend/services/sql_service.py\", line 545, in _execute_with_agent\n    result = self.sql_agent.invoke({\"input\": question})\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain/chains/base.py\", line 165, in invoke\n    self._call(inputs, run_manager=run_manager)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain/agents/agent.py\", line 1625, in _call\n    next_step_output = self._take_next_step(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain/agents/agent.py\", line 1325, in _take_next_step\n    list(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain/agents/agent.py\", line 1352, in _iter_next_step\n    output = self._action_agent.plan(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain/agents/agent.py\", line 573, in plan\n    for chunk in self.runnable.stream(inputs, config={\"callbacks\": callbacks}):\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_core/runnables/base.py\", line 3650, in stream\n    yield from self.transform(iter([input]), config, **kwargs)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_core/runnables/base.py\", line 3636, in transform\n    yield from self._transform_stream_with_config(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_core/runnables/base.py\", line 2372, in _transform_stream_with_config\n    chunk: Output = context.run(next, iterator)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_core/runnables/base.py\", line 3595, in _transform\n    yield from final_pipeline\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_core/runnables/base.py\", line 1571, in transform\n    for ichunk in input:\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_core/runnables/base.py\", line 5927, in transform\n    yield from self.bound.transform(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_core/runnables/base.py\", line 1589, in transform\n    yield from self.stream(final, config, **kwargs)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_core/language_models/chat_models.py\", line 522, in stream\n    for chunk in self._stream(input_messages, stop=stop, **kwargs):\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_openai/chat_models/base.py\", line 1123, in _stream\n    response = self.client.create(**payload)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/openai/_utils/_utils.py\", line 286, in wrapper\n    return func(*args, **kwargs)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/openai/resources/chat/completions/completions.py\", line 1156, in create\n    return self._post(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/openai/_base_client.py\", line 1259, in post\n    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/openai/_base_client.py\", line 1047, in request\n    raise self._make_status_error_from_response(err.response) from None\nopenai.RateLimitError: Error code: 429 - {'error': {'message': 'Rate limit reached for gpt-4o in organization org-lIshM8Wztmovd0NtwBOdGn9Y on tokens per min (TPM): Limit 30000, Used 27394, Requested 2663. Please try again in 114ms. Visit https://platform.openai.com/account/rate-limits to learn more.', 'type': 'tokens', 'param': None, 'code': 'rate_limit_exceeded'}}", "user_id": "admin"}
{"timestamp": "2026-01-08T09:33:11.276014Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=85", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:33:11.276080Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=65e70e1b-4736-4161-9396-d6678243c73d): 'Analyze patients who were crisis referrals and describe their follow-up care patterns...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:33:12.111702Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:33:12.293000Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Searching vector store for query: 'Crisis referrals follow-up care patterns...' (top_k=5)", "module": "vector_store", "function": "search", "line": 69}
{"timestamp": "2026-01-08T09:33:12.293239Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Executing query: Crisis referrals follow-up care patterns", "module": "retrieve", "function": "_get_relevant_documents", "line": 223}
{"timestamp": "2026-01-08T09:33:12.781162Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Reranking 77 documents for query: 'Crisis referrals follow-up care patterns'", "module": "retrieve", "function": "_get_relevant_documents", "line": 257}
{"timestamp": "2026-01-08T09:33:13.829550Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Returning 10 reranked documents.", "module": "retrieve", "function": "_get_relevant_documents", "line": 267}
{"timestamp": "2026-01-08T09:33:13.829673Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Retrieved 10 documents from vector store", "module": "vector_store", "function": "search", "line": 84}
{"timestamp": "2026-01-08T09:33:14.360886Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:33:20.723060Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=65e70e1b-4736-4161-9396-d6678243c73d, duration=9.45s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:33:26.043549Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login attempt for user: admin", "module": "auth", "function": "login", "line": 27}
{"timestamp": "2026-01-08T09:33:26.043699Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login successful for user: admin", "module": "auth", "function": "login", "line": 50}
{"timestamp": "2026-01-08T09:33:26.045463Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=51", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:33:26.045523Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=ea379dc5-6ffc-4ac5-93bf-d112d53e20fb): 'How many patients were screened for blood pressure?...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:33:28.434808Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:33:29.000953Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Count the number of patients who were screened for blood pressure using the v_analytics_screening ta...'", "module": "sql_service", "function": "query", "line": 396}
{"timestamp": "2026-01-08T09:33:29.001239Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udd0d Analyzing natural language query", "module": "sql_service", "function": "_is_simple_query", "line": 338}
{"timestamp": "2026-01-08T09:33:29.001420Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query classified as COMPLEX (pattern=True, complexity=False, multi_table=True)", "module": "sql_service", "function": "_is_simple_query", "line": 381}
{"timestamp": "2026-01-08T09:33:29.001509Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Complex query detected - using full agent", "module": "sql_service", "function": "query", "line": 403}
{"timestamp": "2026-01-08T09:33:29.001629Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 539}
{"timestamp": "2026-01-08T09:33:29.001703Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL AGENT EXECUTION TRACE:", "module": "sql_service", "function": "_execute_with_agent", "line": 540}
{"timestamp": "2026-01-08T09:33:29.001765Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 541}
{"timestamp": "2026-01-08T09:33:30.336021Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:33:31.157262Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:33:31.952005Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:33:33.203882Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:33:34.819364Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:33:36.171956Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:33:36.417726Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 567}
{"timestamp": "2026-01-08T09:33:36.417921Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL query completed. Result length: 135 chars", "module": "sql_service", "function": "_execute_with_agent", "line": 568}
{"timestamp": "2026-01-08T09:33:36.418036Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: The number of patients who were screened for blood pressure with a workflow status of 'NCD' and have a blood pressure reading is 5,332....", "module": "sql_service", "function": "_execute_with_agent", "line": 570}
{"timestamp": "2026-01-08T09:33:36.418383Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 571}
{"timestamp": "2026-01-08T09:33:37.096565Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:33:39.442870Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=ea379dc5-6ffc-4ac5-93bf-d112d53e20fb, duration=13.40s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:33:39.448727Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=45", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:33:39.448865Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=a45a1c34-cf91-4c27-bbe2-c08da393b2fa): 'What is the total number of crisis referrals?...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:33:40.064007Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:33:40.406928Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Count the total number of crisis referrals from v_analytics_screening where crisis_referral_status =...'", "module": "sql_service", "function": "query", "line": 396}
{"timestamp": "2026-01-08T09:33:40.407182Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udd0d Analyzing natural language query", "module": "sql_service", "function": "_is_simple_query", "line": 338}
{"timestamp": "2026-01-08T09:33:40.407395Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query classified as SIMPLE (natural language)", "module": "sql_service", "function": "_is_simple_query", "line": 379}
{"timestamp": "2026-01-08T09:33:40.407517Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Detected simple query - using optimized execution path", "module": "sql_service", "function": "query", "line": 400}
{"timestamp": "2026-01-08T09:33:40.407622Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_optimized", "line": 412}
{"timestamp": "2026-01-08T09:33:40.407686Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 OPTIMIZED SQL EXECUTION:", "module": "sql_service", "function": "_execute_optimized", "line": 413}
{"timestamp": "2026-01-08T09:33:40.407739Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_optimized", "line": 414}
{"timestamp": "2026-01-08T09:33:40.408021Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " API Call 1: Generate SQL query with targeted schema", "module": "sql_service", "function": "_execute_optimized", "line": 429}
{"timestamp": "2026-01-08T09:33:40.408233Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udccb Selected relevant tables for query: v_analytics_screening", "module": "sql_service", "function": "_get_relevant_schema", "line": 281}
{"timestamp": "2026-01-08T09:33:41.396499Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:33:41.399743Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL to execute: SELECT COUNT(*) \nFROM v_analytics_screening \nWHERE crisis_referral_status = 'Crisis Referral';...", "module": "sql_service", "function": "_execute_optimized", "line": 463}
{"timestamp": "2026-01-08T09:33:41.399983Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Executing query against database (no API call)", "module": "sql_service", "function": "_execute_optimized", "line": 471}
{"timestamp": "2026-01-08T09:33:41.419559Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query result: [(1219,)]", "module": "sql_service", "function": "_execute_optimized", "line": 473}
{"timestamp": "2026-01-08T09:33:41.419739Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " API Call 2: Format natural language response", "module": "sql_service", "function": "_execute_optimized", "line": 476}
{"timestamp": "2026-01-08T09:33:42.429871Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:33:42.435521Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_optimized", "line": 491}
{"timestamp": "2026-01-08T09:33:42.435677Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Optimized execution completed with 2 API call(s) (vs 7 with agent)", "module": "sql_service", "function": "_execute_optimized", "line": 492}
{"timestamp": "2026-01-08T09:33:42.435786Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: There are a total of 1,219 crisis referrals recorded in the v_analytics_screening database....", "module": "sql_service", "function": "_execute_optimized", "line": 493}
{"timestamp": "2026-01-08T09:33:42.436103Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_optimized", "line": 494}
{"timestamp": "2026-01-08T09:33:43.049364Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:33:45.067093Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=a45a1c34-cf91-4c27-bbe2-c08da393b2fa, duration=5.62s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:33:45.072373Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=63", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:33:45.072496Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=68aea736-c2a0-4e5e-b8d1-d618535b7571): 'How many patients were referred due to elevated blood pressure?...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:33:45.908883Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:33:46.278040Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Count the number of patients referred due to elevated blood pressure from v_analytics_screening wher...'", "module": "sql_service", "function": "query", "line": 396}
{"timestamp": "2026-01-08T09:33:46.278098Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udd0d Analyzing natural language query", "module": "sql_service", "function": "_is_simple_query", "line": 338}
{"timestamp": "2026-01-08T09:33:46.278158Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query classified as COMPLEX (pattern=True, complexity=False, multi_table=True)", "module": "sql_service", "function": "_is_simple_query", "line": 381}
{"timestamp": "2026-01-08T09:33:46.278184Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Complex query detected - using full agent", "module": "sql_service", "function": "query", "line": 403}
{"timestamp": "2026-01-08T09:33:46.278209Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 539}
{"timestamp": "2026-01-08T09:33:46.278235Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL AGENT EXECUTION TRACE:", "module": "sql_service", "function": "_execute_with_agent", "line": 540}
{"timestamp": "2026-01-08T09:33:46.278258Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 541}
{"timestamp": "2026-01-08T09:33:46.617668Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 429 Too Many Requests\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:33:46.618846Z", "level": "INFO", "logger": "openai._base_client", "message": "Retrying request to /chat/completions in 0.192000 seconds", "module": "_base_client", "function": "_sleep_for_retry", "line": 1071}
{"timestamp": "2026-01-08T09:33:47.538897Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:33:47.847557Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 429 Too Many Requests\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:33:47.848442Z", "level": "INFO", "logger": "openai._base_client", "message": "Retrying request to /chat/completions in 0.928000 seconds", "module": "_base_client", "function": "_sleep_for_retry", "line": 1071}
{"timestamp": "2026-01-08T09:33:49.178346Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 429 Too Many Requests\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:33:49.178648Z", "level": "INFO", "logger": "openai._base_client", "message": "Retrying request to /chat/completions in 0.852000 seconds", "module": "_base_client", "function": "_sleep_for_retry", "line": 1071}
{"timestamp": "2026-01-08T09:33:50.817926Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:33:51.629167Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:33:52.710434Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:33:53.069731Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 429 Too Many Requests\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:33:53.070646Z", "level": "INFO", "logger": "openai._base_client", "message": "Retrying request to /chat/completions in 2.878000 seconds", "module": "_base_client", "function": "_sleep_for_retry", "line": 1071}
{"timestamp": "2026-01-08T09:33:56.254744Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 429 Too Many Requests\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:33:56.256080Z", "level": "INFO", "logger": "openai._base_client", "message": "Retrying request to /chat/completions in 0.958000 seconds", "module": "_base_client", "function": "_sleep_for_retry", "line": 1071}
{"timestamp": "2026-01-08T09:33:57.986580Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:33:59.120077Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:33:59.295702Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 567}
{"timestamp": "2026-01-08T09:33:59.295833Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL query completed. Result length: 72 chars", "module": "sql_service", "function": "_execute_with_agent", "line": 568}
{"timestamp": "2026-01-08T09:33:59.295886Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: The number of patients referred due to elevated blood pressure is 2,139....", "module": "sql_service", "function": "_execute_with_agent", "line": 570}
{"timestamp": "2026-01-08T09:33:59.295931Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 571}
{"timestamp": "2026-01-08T09:33:59.623439Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 429 Too Many Requests\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:33:59.624300Z", "level": "INFO", "logger": "openai._base_client", "message": "Retrying request to /chat/completions in 2.486000 seconds", "module": "_base_client", "function": "_sleep_for_retry", "line": 1071}
{"timestamp": "2026-01-08T09:34:02.490356Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 429 Too Many Requests\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:34:02.495343Z", "level": "INFO", "logger": "openai._base_client", "message": "Retrying request to /chat/completions in 2.342000 seconds", "module": "_base_client", "function": "_sleep_for_retry", "line": 1071}
{"timestamp": "2026-01-08T09:34:05.666013Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:34:08.305723Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=68aea736-c2a0-4e5e-b8d1-d618535b7571, duration=23.23s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:34:08.310091Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=32", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:34:08.310211Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=37661349-d18c-4466-bb63-c67d94b20598): 'What is the HTN prevalence rate?...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:34:09.139583Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:34:09.820950Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Calculate the HTN prevalence rate using the formula: (Elevated BP Referrals / Screened for BP) * 100...'", "module": "sql_service", "function": "query", "line": 396}
{"timestamp": "2026-01-08T09:34:09.821070Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udd0d Analyzing natural language query", "module": "sql_service", "function": "_is_simple_query", "line": 338}
{"timestamp": "2026-01-08T09:34:09.821176Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query classified as COMPLEX (pattern=False, complexity=False, multi_table=False)", "module": "sql_service", "function": "_is_simple_query", "line": 381}
{"timestamp": "2026-01-08T09:34:09.821220Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Complex query detected - using full agent", "module": "sql_service", "function": "query", "line": 403}
{"timestamp": "2026-01-08T09:34:09.821258Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 539}
{"timestamp": "2026-01-08T09:34:09.821292Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL AGENT EXECUTION TRACE:", "module": "sql_service", "function": "_execute_with_agent", "line": 540}
{"timestamp": "2026-01-08T09:34:09.821326Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 541}
{"timestamp": "2026-01-08T09:34:10.589719Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:34:11.300842Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:34:12.038430Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 429 Too Many Requests\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:34:12.039520Z", "level": "INFO", "logger": "openai._base_client", "message": "Retrying request to /chat/completions in 4.126000 seconds", "module": "_base_client", "function": "_sleep_for_retry", "line": 1071}
{"timestamp": "2026-01-08T09:34:16.447445Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 429 Too Many Requests\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:34:16.448382Z", "level": "INFO", "logger": "openai._base_client", "message": "Retrying request to /chat/completions in 0.124000 seconds", "module": "_base_client", "function": "_sleep_for_retry", "line": 1071}
{"timestamp": "2026-01-08T09:34:17.339353Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:34:19.694607Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:34:20.001294Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 429 Too Many Requests\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:34:20.002720Z", "level": "INFO", "logger": "openai._base_client", "message": "Retrying request to /chat/completions in 2.496000 seconds", "module": "_base_client", "function": "_sleep_for_retry", "line": 1071}
{"timestamp": "2026-01-08T09:34:23.308902Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:34:24.096740Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 429 Too Many Requests\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:34:24.097725Z", "level": "INFO", "logger": "openai._base_client", "message": "Retrying request to /chat/completions in 4.120000 seconds", "module": "_base_client", "function": "_sleep_for_retry", "line": 1071}
{"timestamp": "2026-01-08T09:34:29.016151Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:34:29.024703Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 567}
{"timestamp": "2026-01-08T09:34:29.024817Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL query completed. Result length: 48 chars", "module": "sql_service", "function": "_execute_with_agent", "line": 568}
{"timestamp": "2026-01-08T09:34:29.024875Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: The HTN prevalence rate is approximately 90.87%....", "module": "sql_service", "function": "_execute_with_agent", "line": 570}
{"timestamp": "2026-01-08T09:34:29.024922Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 571}
{"timestamp": "2026-01-08T09:34:29.628299Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:34:32.078253Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=37661349-d18c-4466-bb63-c67d94b20598, duration=23.77s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:34:32.085940Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=43", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:34:32.086087Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=c68656ba-28e6-458d-b741-c101b6aaa943): 'What symptoms indicate hypertensive crisis?...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:34:32.373251Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 429 Too Many Requests\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:34:32.374281Z", "level": "INFO", "logger": "openai._base_client", "message": "Retrying request to /chat/completions in 2.210000 seconds", "module": "_base_client", "function": "_sleep_for_retry", "line": 1071}
{"timestamp": "2026-01-08T09:34:34.962781Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 429 Too Many Requests\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:34:34.963711Z", "level": "INFO", "logger": "openai._base_client", "message": "Retrying request to /chat/completions in 1.038000 seconds", "module": "_base_client", "function": "_sleep_for_retry", "line": 1071}
{"timestamp": "2026-01-08T09:34:36.511538Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:34:39.665445Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=c68656ba-28e6-458d-b741-c101b6aaa943, duration=7.58s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:34:39.669110Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=54", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:34:39.669220Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=cceb15f7-559e-4ba6-ab26-147ec0f53128): 'Find patients who are smokers with high blood pressure...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:34:41.098543Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:34:41.261194Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Searching vector store for query: 'Find patients who are smokers...' (top_k=5)", "module": "vector_store", "function": "search", "line": 69}
{"timestamp": "2026-01-08T09:34:41.261372Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Executing query: Find patients who are smokers", "module": "retrieve", "function": "_get_relevant_documents", "line": 223}
{"timestamp": "2026-01-08T09:34:41.760667Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Reranking 61 documents for query: 'Find patients who are smokers'", "module": "retrieve", "function": "_get_relevant_documents", "line": 257}
{"timestamp": "2026-01-08T09:34:42.947836Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Returning 10 reranked documents.", "module": "retrieve", "function": "_get_relevant_documents", "line": 267}
{"timestamp": "2026-01-08T09:34:42.948030Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Retrieved 10 documents from vector store", "module": "vector_store", "function": "search", "line": 84}
{"timestamp": "2026-01-08T09:34:42.948366Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Count patients with systolic BP >= 140 or diastolic BP >= 90...'", "module": "sql_service", "function": "query", "line": 396}
{"timestamp": "2026-01-08T09:34:42.948394Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udd0d Analyzing natural language query", "module": "sql_service", "function": "_is_simple_query", "line": 338}
{"timestamp": "2026-01-08T09:34:42.948478Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query classified as SIMPLE (natural language)", "module": "sql_service", "function": "_is_simple_query", "line": 379}
{"timestamp": "2026-01-08T09:34:42.948500Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Detected simple query - using optimized execution path", "module": "sql_service", "function": "query", "line": 400}
{"timestamp": "2026-01-08T09:34:42.948519Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_optimized", "line": 412}
{"timestamp": "2026-01-08T09:34:42.948538Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 OPTIMIZED SQL EXECUTION:", "module": "sql_service", "function": "_execute_optimized", "line": 413}
{"timestamp": "2026-01-08T09:34:42.948556Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_optimized", "line": 414}
{"timestamp": "2026-01-08T09:34:42.948575Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " API Call 1: Generate SQL query with targeted schema", "module": "sql_service", "function": "_execute_optimized", "line": 429}
{"timestamp": "2026-01-08T09:34:42.948616Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udccb Selected relevant tables for query: patient, bp_log, patient_tracker", "module": "sql_service", "function": "_get_relevant_schema", "line": 281}
{"timestamp": "2026-01-08T09:34:43.950077Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:34:43.953329Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL to execute: SELECT COUNT(DISTINCT pt.patient_id)\nFROM bp_log bp\nJOIN patient_tracker pt ON bp.patient_track_id = pt.id\nWHERE bp.avg_systolic >= 140 OR bp.avg_diastolic >= 90;...", "module": "sql_service", "function": "_execute_optimized", "line": 463}
{"timestamp": "2026-01-08T09:34:43.953396Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Executing query against database (no API call)", "module": "sql_service", "function": "_execute_optimized", "line": 471}
{"timestamp": "2026-01-08T09:34:43.974285Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query result: [(1263,)]", "module": "sql_service", "function": "_execute_optimized", "line": 473}
{"timestamp": "2026-01-08T09:34:43.974361Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " API Call 2: Format natural language response", "module": "sql_service", "function": "_execute_optimized", "line": 476}
{"timestamp": "2026-01-08T09:34:44.884129Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:34:44.885034Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_optimized", "line": 491}
{"timestamp": "2026-01-08T09:34:44.885094Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Optimized execution completed with 2 API call(s) (vs 7 with agent)", "module": "sql_service", "function": "_execute_optimized", "line": 492}
{"timestamp": "2026-01-08T09:34:44.885135Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: There are 1,263 distinct patients with either an average systolic blood pressure of 140 or higher, or an average diastolic blood pressure of 90 or higher....", "module": "sql_service", "function": "_execute_optimized", "line": 493}
{"timestamp": "2026-01-08T09:34:44.885166Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_optimized", "line": 494}
{"timestamp": "2026-01-08T09:34:45.401725Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:34:49.726101Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=cceb15f7-559e-4ba6-ab26-147ec0f53128, duration=10.06s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:34:49.730050Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=50", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:34:49.730103Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=c2c461b5-b606-4a78-ae38-321d4c17ebaf): 'Is a blood pressure of 145/92 considered elevated?...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:34:50.287084Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:34:51.149764Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=c2c461b5-b606-4a78-ae38-321d4c17ebaf, duration=1.42s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:34:51.156023Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=74", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:34:51.156179Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=a9e140b9-103b-44df-a72a-ad2a64ac5a43): 'A patient has BP 150/95 and glucose 12 mmol/L RBS. What referral category?...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:34:51.635753Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:34:55.163713Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=a9e140b9-103b-44df-a72a-ad2a64ac5a43, duration=4.01s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:35:42.427711Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login attempt for user: admin", "module": "auth", "function": "login", "line": 27}
{"timestamp": "2026-01-08T09:35:42.427956Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login successful for user: admin", "module": "auth", "function": "login", "line": 50}
{"timestamp": "2026-01-08T09:35:42.429242Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=51", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T09:35:42.429304Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=1b424212-d9f0-442e-902a-b43e381b1fc3): 'How many patients were screened for blood pressure?...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T09:35:43.394578Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:35:44.003070Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Count the number of patients who were screened for blood pressure using v_analytics_screening where ...'", "module": "sql_service", "function": "query", "line": 396}
{"timestamp": "2026-01-08T09:35:44.003430Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udd0d Analyzing natural language query", "module": "sql_service", "function": "_is_simple_query", "line": 338}
{"timestamp": "2026-01-08T09:35:44.003722Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query classified as COMPLEX (pattern=True, complexity=False, multi_table=True)", "module": "sql_service", "function": "_is_simple_query", "line": 381}
{"timestamp": "2026-01-08T09:35:44.003788Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Complex query detected - using full agent", "module": "sql_service", "function": "query", "line": 403}
{"timestamp": "2026-01-08T09:35:44.003853Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 539}
{"timestamp": "2026-01-08T09:35:44.003898Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL AGENT EXECUTION TRACE:", "module": "sql_service", "function": "_execute_with_agent", "line": 540}
{"timestamp": "2026-01-08T09:35:44.003958Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 541}
{"timestamp": "2026-01-08T09:35:45.030444Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:35:45.816845Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:35:47.864898Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:35:49.090959Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:35:49.912896Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:35:50.832001Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:35:51.347197Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 567}
{"timestamp": "2026-01-08T09:35:51.347280Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL query completed. Result length: 135 chars", "module": "sql_service", "function": "_execute_with_agent", "line": 568}
{"timestamp": "2026-01-08T09:35:51.347325Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: The number of patients who were screened for blood pressure with a workflow status of 'NCD' and have a blood pressure reading is 5,332....", "module": "sql_service", "function": "_execute_with_agent", "line": 570}
{"timestamp": "2026-01-08T09:35:51.347362Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 571}
{"timestamp": "2026-01-08T09:35:52.106935Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T09:35:54.662016Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=1b424212-d9f0-442e-902a-b43e381b1fc3, duration=12.23s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T09:45:19.981493Z", "level": "INFO", "logger": "app", "message": "Shutting down application", "module": "app", "function": "lifespan", "line": 34}
{"timestamp": "2026-01-08T09:45:24.885856Z", "level": "INFO", "logger": "app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-08T09:45:24.885899Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-08T09:45:24.885921Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-08T09:45:24.886001Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-08T09:45:24.902906Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-08T09:45:24.902948Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-08T09:45:26.537344Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-08T09:45:26.537397Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-08T09:45:26.537423Z", "level": "INFO", "logger": "app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-08T09:45:26.537442Z", "level": "INFO", "logger": "app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-08T09:46:49.113453Z", "level": "INFO", "logger": "app", "message": "Shutting down application", "module": "app", "function": "lifespan", "line": 34}
{"timestamp": "2026-01-08T09:46:52.634457Z", "level": "INFO", "logger": "app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-08T09:46:52.634496Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-08T09:46:52.634518Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-08T09:46:52.634585Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-08T09:46:52.648195Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-08T09:46:52.648241Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-08T09:46:53.782557Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-08T09:46:53.782671Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-08T09:46:53.782745Z", "level": "INFO", "logger": "app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-08T09:46:53.782768Z", "level": "INFO", "logger": "app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-08T09:48:19.573506Z", "level": "INFO", "logger": "app", "message": "Shutting down application", "module": "app", "function": "lifespan", "line": 34}
{"timestamp": "2026-01-08T09:48:22.355320Z", "level": "INFO", "logger": "app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-08T09:48:22.355368Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-08T09:48:22.355396Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-08T09:48:22.355488Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-08T09:48:22.369023Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-08T09:48:22.369069Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-08T09:48:23.339969Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-08T09:48:23.340041Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-08T09:48:23.340084Z", "level": "INFO", "logger": "app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-08T09:48:23.340102Z", "level": "INFO", "logger": "app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-08T09:53:36.302109Z", "level": "INFO", "logger": "app", "message": "Shutting down application", "module": "app", "function": "lifespan", "line": 34}
{"timestamp": "2026-01-08T09:53:39.105999Z", "level": "INFO", "logger": "app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-08T09:53:39.106050Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-08T09:53:39.106077Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-08T09:53:39.106164Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-08T09:53:39.120574Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-08T09:53:39.120618Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-08T09:53:40.275581Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-08T09:53:40.275660Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-08T09:53:40.275706Z", "level": "INFO", "logger": "app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-08T09:53:40.275726Z", "level": "INFO", "logger": "app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-08T09:55:29.713556Z", "level": "INFO", "logger": "app", "message": "Shutting down application", "module": "app", "function": "lifespan", "line": 34}
{"timestamp": "2026-01-08T09:55:32.551343Z", "level": "INFO", "logger": "app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-08T09:55:32.551396Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-08T09:55:32.551420Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-08T09:55:32.551498Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-08T09:55:32.564509Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-08T09:55:32.564558Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-08T09:55:33.760981Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-08T09:55:33.761210Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-08T09:55:33.761418Z", "level": "INFO", "logger": "app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-08T09:55:33.761476Z", "level": "INFO", "logger": "app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-08T10:04:20.100959Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login attempt for user: admin", "module": "auth", "function": "login", "line": 27}
{"timestamp": "2026-01-08T10:04:20.101581Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login successful for user: admin", "module": "auth", "function": "login", "line": 50}
{"timestamp": "2026-01-08T10:04:29.344323Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=32", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T10:04:29.344529Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Initializing AgentService", "module": "agent_service", "function": "__init__", "line": 121}
{"timestamp": "2026-01-08T10:04:29.344653Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Connecting to database at postgresql://admin:admin@127.0.0.1:5432/Spice_BD", "module": "sql_service", "function": "__init__", "line": 258}
{"timestamp": "2026-01-08T10:04:29.725258Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Database connection established with view support", "module": "sql_service", "function": "__init__", "line": 275}
{"timestamp": "2026-01-08T10:04:29.946618Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Cached schema for 39 relevant tables out of 114 total", "module": "sql_service", "function": "_cache_schema", "line": 340}
{"timestamp": "2026-01-08T10:04:29.946670Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Relevant tables: bp_log, current_medication, diagnosis, glucose_log, lab_test, lab_test_result, lab_test_result_range, medical_compliance, medication_country_detail, patient...", "module": "sql_service", "function": "_cache_schema", "line": 341}
{"timestamp": "2026-01-08T10:04:30.060881Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "SQL agent initialized successfully with 39 cached tables", "module": "sql_service", "function": "__init__", "line": 302}
{"timestamp": "2026-01-08T10:04:30.065173Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "AgentService initialized successfully", "module": "agent_service", "function": "__init__", "line": 184}
{"timestamp": "2026-01-08T10:04:30.065228Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=7a5168dd-8ef2-4523-9110-6e38e4a161aa): 'What is the HTN prevalence rate?...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T10:04:31.356652Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T10:04:32.028804Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Calculate the HTN prevalence rate using the formula: (Elevated BP Referrals / Screened for BP) * 100...'", "module": "sql_service", "function": "query", "line": 482}
{"timestamp": "2026-01-08T10:04:32.029136Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI Template Match: 'screened for bp' -> patients screened for blood pressure", "module": "sql_service", "function": "_check_dashboard_kpi", "line": 415}
{"timestamp": "2026-01-08T10:04:32.029378Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 Using pre-defined KPI template for: patients screened for blood pressure", "module": "sql_service", "function": "query", "line": 487}
{"timestamp": "2026-01-08T10:04:32.029687Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 498}
{"timestamp": "2026-01-08T10:04:32.029775Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI TEMPLATE EXECUTION (1 API call):", "module": "sql_service", "function": "_execute_kpi_template", "line": 499}
{"timestamp": "2026-01-08T10:04:32.029826Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 500}
{"timestamp": "2026-01-08T10:04:32.029873Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Template: patients screened for blood pressure", "module": "sql_service", "function": "_execute_kpi_template", "line": 501}
{"timestamp": "2026-01-08T10:04:32.029926Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL: SELECT COUNT(DISTINCT patient_track_id) as count\n        FROM v_analytics_screening \n        WHERE workflow_status = 'NCD' \n        AND has_bp_reading = TRUE...", "module": "sql_service", "function": "_execute_kpi_template", "line": 502}
{"timestamp": "2026-01-08T10:04:32.057431Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query result: [(5332,)]", "module": "sql_service", "function": "_execute_kpi_template", "line": 506}
{"timestamp": "2026-01-08T10:04:40.082444Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T10:04:40.091771Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 521}
{"timestamp": "2026-01-08T10:04:40.091881Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u2705 KPI template execution completed with 1 API call", "module": "sql_service", "function": "_execute_kpi_template", "line": 522}
{"timestamp": "2026-01-08T10:04:40.091938Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: The total number of patients screened for blood pressure in the NCD program is 5,332. This figure represents the distinct count of individuals who have undergone blood pressure screening and have a recorded blood pressure reading. To calculate the hypertension (HTN) prevalence rate, you would need t...", "module": "sql_service", "function": "_execute_kpi_template", "line": 523}
{"timestamp": "2026-01-08T10:04:40.091979Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 524}
{"timestamp": "2026-01-08T10:04:40.841858Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T10:04:44.578974Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=7a5168dd-8ef2-4523-9110-6e38e4a161aa, duration=14.51s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T10:04:59.276525Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=45", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T10:04:59.276652Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=5dc6fc0e-9501-4816-9c06-4c537c18ab7c): 'What is the total number of crisis referrals?...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T10:05:00.336216Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T10:05:00.922147Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Count the total number of crisis referrals from v_analytics_screening where crisis_referral_status =...'", "module": "sql_service", "function": "query", "line": 482}
{"timestamp": "2026-01-08T10:05:00.922464Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI Template Match: 'crisis referral' -> crisis referrals", "module": "sql_service", "function": "_check_dashboard_kpi", "line": 415}
{"timestamp": "2026-01-08T10:05:00.922528Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 Using pre-defined KPI template for: crisis referrals", "module": "sql_service", "function": "query", "line": 487}
{"timestamp": "2026-01-08T10:05:00.922603Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 498}
{"timestamp": "2026-01-08T10:05:00.922650Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI TEMPLATE EXECUTION (1 API call):", "module": "sql_service", "function": "_execute_kpi_template", "line": 499}
{"timestamp": "2026-01-08T10:05:00.922690Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 500}
{"timestamp": "2026-01-08T10:05:00.922729Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Template: crisis referrals", "module": "sql_service", "function": "_execute_kpi_template", "line": 501}
{"timestamp": "2026-01-08T10:05:00.922770Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL: SELECT COUNT(DISTINCT patient_track_id) as count\n        FROM v_analytics_screening \n        WHERE crisis_referral_status = 'Crisis Referral'...", "module": "sql_service", "function": "_execute_kpi_template", "line": 502}
{"timestamp": "2026-01-08T10:05:00.942438Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query result: [(1219,)]", "module": "sql_service", "function": "_execute_kpi_template", "line": 506}
{"timestamp": "2026-01-08T10:05:03.307794Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T10:05:03.318096Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 521}
{"timestamp": "2026-01-08T10:05:03.318218Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u2705 KPI template execution completed with 1 API call", "module": "sql_service", "function": "_execute_kpi_template", "line": 522}
{"timestamp": "2026-01-08T10:05:03.318338Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: The total number of crisis referrals recorded in the v_analytics_screening database, where the crisis_referral_status is 'Crisis Referral', is 1,219. This figure represents the distinct instances where patients were identified and referred for crisis intervention, highlighting the volume of urgent c...", "module": "sql_service", "function": "_execute_kpi_template", "line": 523}
{"timestamp": "2026-01-08T10:05:03.318415Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 524}
{"timestamp": "2026-01-08T10:05:04.065644Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T10:05:07.772791Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=5dc6fc0e-9501-4816-9c06-4c537c18ab7c, duration=8.50s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T10:06:46.600797Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=49", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T10:06:46.601089Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=814c48e6-fe10-46ea-a8d7-ccef78561312): 'What are the common reasons for crisis referrals?...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T10:06:47.448773Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T10:06:47.960717Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'What are the common reasons for crisis referrals in v_analytics_screening?...'", "module": "sql_service", "function": "query", "line": 482}
{"timestamp": "2026-01-08T10:06:47.960883Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI Template Match: 'crisis referral' -> crisis referrals", "module": "sql_service", "function": "_check_dashboard_kpi", "line": 415}
{"timestamp": "2026-01-08T10:06:47.960930Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 Using pre-defined KPI template for: crisis referrals", "module": "sql_service", "function": "query", "line": 487}
{"timestamp": "2026-01-08T10:06:47.960974Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 498}
{"timestamp": "2026-01-08T10:06:47.961013Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI TEMPLATE EXECUTION (1 API call):", "module": "sql_service", "function": "_execute_kpi_template", "line": 499}
{"timestamp": "2026-01-08T10:06:47.961051Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 500}
{"timestamp": "2026-01-08T10:06:47.961089Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Template: crisis referrals", "module": "sql_service", "function": "_execute_kpi_template", "line": 501}
{"timestamp": "2026-01-08T10:06:47.961129Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL: SELECT COUNT(DISTINCT patient_track_id) as count\n        FROM v_analytics_screening \n        WHERE crisis_referral_status = 'Crisis Referral'...", "module": "sql_service", "function": "_execute_kpi_template", "line": 502}
{"timestamp": "2026-01-08T10:06:47.981313Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query result: [(1219,)]", "module": "sql_service", "function": "_execute_kpi_template", "line": 506}
{"timestamp": "2026-01-08T10:06:51.443684Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T10:06:51.446564Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 521}
{"timestamp": "2026-01-08T10:06:51.446714Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u2705 KPI template execution completed with 1 API call", "module": "sql_service", "function": "_execute_kpi_template", "line": 522}
{"timestamp": "2026-01-08T10:06:51.446816Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: In the context of the NCD (Non-Communicable Diseases) program, the database query indicates that there have been 1,219 distinct crisis referrals recorded. This number represents the total count of unique patient cases that have been identified as requiring immediate attention due to a crisis situati...", "module": "sql_service", "function": "_execute_kpi_template", "line": 523}
{"timestamp": "2026-01-08T10:06:51.446891Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 524}
{"timestamp": "2026-01-08T10:06:52.057302Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T10:06:53.973432Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=814c48e6-fe10-46ea-a8d7-ccef78561312, duration=7.37s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T10:07:11.694434Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=26", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T10:07:11.694671Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=7949870a-198f-46b4-97a8-d254cf1327ca): 'explore the clinical notes...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T10:07:12.741897Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T10:07:14.346911Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=7949870a-198f-46b4-97a8-d254cf1327ca, duration=2.65s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T10:11:04.485140Z", "level": "INFO", "logger": "app", "message": "Shutting down application", "module": "app", "function": "lifespan", "line": 34}
{"timestamp": "2026-01-08T10:11:08.266984Z", "level": "INFO", "logger": "app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-08T10:11:08.267027Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-08T10:11:08.267049Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-08T10:11:08.267125Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-08T10:11:08.281610Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-08T10:11:08.281653Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-08T10:11:09.874091Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-08T10:11:09.874187Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-08T10:11:09.874226Z", "level": "INFO", "logger": "app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-08T10:11:09.874249Z", "level": "INFO", "logger": "app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-08T10:11:12.680076Z", "level": "INFO", "logger": "app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-08T10:11:12.680126Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-08T10:11:12.680152Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-08T10:11:12.680234Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-08T10:11:12.694077Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-08T10:11:12.694123Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-08T10:11:13.465980Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-08T10:11:13.466040Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-08T10:11:13.466064Z", "level": "INFO", "logger": "app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-08T10:11:13.466086Z", "level": "INFO", "logger": "app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-08T10:15:23.548694Z", "level": "INFO", "logger": "app", "message": "Shutting down application", "module": "app", "function": "lifespan", "line": 34}
{"timestamp": "2026-01-08T10:15:27.069151Z", "level": "INFO", "logger": "app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-08T10:15:27.069190Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-08T10:15:27.069211Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-08T10:15:27.069283Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-08T10:15:27.083439Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-08T10:15:27.083479Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-08T10:15:28.467075Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-08T10:15:28.467152Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-08T10:15:28.467199Z", "level": "INFO", "logger": "app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-08T10:15:28.467218Z", "level": "INFO", "logger": "app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-08T10:15:58.780301Z", "level": "INFO", "logger": "app", "message": "Shutting down application", "module": "app", "function": "lifespan", "line": 34}
{"timestamp": "2026-01-08T10:16:01.531614Z", "level": "INFO", "logger": "app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-08T10:16:01.531666Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-08T10:16:01.531692Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-08T10:16:01.531769Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-08T10:16:01.545333Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-08T10:16:01.545375Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-08T10:16:02.594877Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-08T10:16:02.594966Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-08T10:16:02.595014Z", "level": "INFO", "logger": "app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-08T10:16:02.595034Z", "level": "INFO", "logger": "app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-08T10:16:11.094456Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=32", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T10:16:11.094604Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Initializing AgentService", "module": "agent_service", "function": "__init__", "line": 121}
{"timestamp": "2026-01-08T10:16:11.094699Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Connecting to database at postgresql://admin:admin@127.0.0.1:5432/Spice_BD", "module": "sql_service", "function": "__init__", "line": 229}
{"timestamp": "2026-01-08T10:16:11.398268Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Database connection established with view support", "module": "sql_service", "function": "__init__", "line": 246}
{"timestamp": "2026-01-08T10:16:11.614531Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Cached schema for 39 relevant tables out of 114 total", "module": "sql_service", "function": "_cache_schema", "line": 311}
{"timestamp": "2026-01-08T10:16:11.614583Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Relevant tables: bp_log, current_medication, diagnosis, glucose_log, lab_test, lab_test_result, lab_test_result_range, medical_compliance, medication_country_detail, patient...", "module": "sql_service", "function": "_cache_schema", "line": 312}
{"timestamp": "2026-01-08T10:16:11.728739Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "SQL agent initialized successfully with 39 cached tables", "module": "sql_service", "function": "__init__", "line": 273}
{"timestamp": "2026-01-08T10:16:11.733254Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "AgentService initialized successfully", "module": "agent_service", "function": "__init__", "line": 184}
{"timestamp": "2026-01-08T10:16:11.733303Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=867fefe7-296c-4f90-b466-65571e4b1213): 'What is the HTN prevalence rate?...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T10:16:13.373042Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T10:16:13.692818Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Calculate the HTN prevalence rate using the formula: (Elevated BP Referrals / Screened for BP) * 100...'", "module": "sql_service", "function": "query", "line": 455}
{"timestamp": "2026-01-08T10:16:13.693340Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI Template Match: 'htn.*(prevalence|rate)|prevalence.*(htn|hypertension|bp)' -> HTN prevalence rate", "module": "sql_service", "function": "_check_dashboard_kpi", "line": 388}
{"timestamp": "2026-01-08T10:16:13.693402Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 Using pre-defined KPI template for: HTN prevalence rate", "module": "sql_service", "function": "query", "line": 460}
{"timestamp": "2026-01-08T10:16:13.693498Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 471}
{"timestamp": "2026-01-08T10:16:13.693598Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI TEMPLATE EXECUTION (1 API call):", "module": "sql_service", "function": "_execute_kpi_template", "line": 472}
{"timestamp": "2026-01-08T10:16:13.693670Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 473}
{"timestamp": "2026-01-08T10:16:13.693719Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Template: HTN prevalence rate", "module": "sql_service", "function": "_execute_kpi_template", "line": 474}
{"timestamp": "2026-01-08T10:16:13.693767Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL: SELECT \n            ROUND(\n                (COUNT(DISTINCT CASE WHEN is_referred = TRUE \n                    AND referred_reason IN ('Due to Elevated BP', 'Due to Elevated BP & BG') \n                 ...", "module": "sql_service", "function": "_execute_kpi_template", "line": 475}
{"timestamp": "2026-01-08T10:16:13.729529Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query result: [(Decimal('59.49'),)]", "module": "sql_service", "function": "_execute_kpi_template", "line": 479}
{"timestamp": "2026-01-08T10:16:16.262518Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T10:16:16.285715Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 494}
{"timestamp": "2026-01-08T10:16:16.285819Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u2705 KPI template execution completed with 1 API call", "module": "sql_service", "function": "_execute_kpi_template", "line": 495}
{"timestamp": "2026-01-08T10:16:16.285870Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: The HTN prevalence rate, calculated as the percentage of patients referred due to elevated blood pressure out of those screened for blood pressure, is 59.49%. This indicates that within the NCD (Non-Communicable Diseases) program, 59.49% of individuals who were screened for blood pressure were refer...", "module": "sql_service", "function": "_execute_kpi_template", "line": 496}
{"timestamp": "2026-01-08T10:16:16.285911Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 497}
{"timestamp": "2026-01-08T10:16:16.804996Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T10:16:21.128323Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=867fefe7-296c-4f90-b466-65571e4b1213, duration=9.39s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T10:16:35.061260Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=32", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T10:16:35.061384Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=3c9b9a8f-2533-4e9f-8927-dabb2cd02230): 'what is the DBM prevalence rate?...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T10:16:38.309440Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T10:16:38.917233Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Calculate the DBM prevalence rate using the formula: (Elevated BG Referrals / Screened for BG) * 100...'", "module": "sql_service", "function": "query", "line": 455}
{"timestamp": "2026-01-08T10:16:38.917979Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI Template Match: 'dbm.*(prevalence|rate)|prevalence.*(dbm|diabetes|glucose|bg)' -> DBM prevalence rate", "module": "sql_service", "function": "_check_dashboard_kpi", "line": 388}
{"timestamp": "2026-01-08T10:16:38.918046Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 Using pre-defined KPI template for: DBM prevalence rate", "module": "sql_service", "function": "query", "line": 460}
{"timestamp": "2026-01-08T10:16:38.918096Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 471}
{"timestamp": "2026-01-08T10:16:38.918139Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI TEMPLATE EXECUTION (1 API call):", "module": "sql_service", "function": "_execute_kpi_template", "line": 472}
{"timestamp": "2026-01-08T10:16:38.918187Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 473}
{"timestamp": "2026-01-08T10:16:38.918232Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Template: DBM prevalence rate", "module": "sql_service", "function": "_execute_kpi_template", "line": 474}
{"timestamp": "2026-01-08T10:16:38.918272Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL: SELECT \n            ROUND(\n                (COUNT(DISTINCT CASE WHEN is_referred = TRUE \n                    AND referred_reason IN ('Due to Elevated BG', 'Due to Elevated BP & BG') \n                 ...", "module": "sql_service", "function": "_execute_kpi_template", "line": 475}
{"timestamp": "2026-01-08T10:16:38.943723Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query result: [(Decimal('58.92'),)]", "module": "sql_service", "function": "_execute_kpi_template", "line": 479}
{"timestamp": "2026-01-08T10:16:41.175727Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T10:16:41.176564Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 494}
{"timestamp": "2026-01-08T10:16:41.176618Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u2705 KPI template execution completed with 1 API call", "module": "sql_service", "function": "_execute_kpi_template", "line": 495}
{"timestamp": "2026-01-08T10:16:41.176663Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: The DBM prevalence rate, calculated as the percentage of patients referred due to elevated blood glucose (BG) levels out of those screened for BG, is 58.92%. This indicates that within the Non-Communicable Disease (NCD) program, 58.92% of the individuals who were screened for blood glucose levels we...", "module": "sql_service", "function": "_execute_kpi_template", "line": 496}
{"timestamp": "2026-01-08T10:16:41.176700Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 497}
{"timestamp": "2026-01-08T10:16:42.608846Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T10:16:45.274902Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=3c9b9a8f-2533-4e9f-8927-dabb2cd02230, duration=10.21s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T10:16:59.966579Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=28", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-08T10:16:59.966746Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=a43f9c0c-f003-4994-b36f-c8ef4612d731): 'What is the screening yield?...'", "module": "agent_service", "function": "process_query", "line": 223}
{"timestamp": "2026-01-08T10:17:01.067573Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T10:17:02.078511Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Calculate the screening yield using the formula: (Screening Referrals / Total Screened) * 100 from v...'", "module": "sql_service", "function": "query", "line": 455}
{"timestamp": "2026-01-08T10:17:02.078700Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI Template Match: 'screening.*(yield|rate)' -> screening yield percentage", "module": "sql_service", "function": "_check_dashboard_kpi", "line": 388}
{"timestamp": "2026-01-08T10:17:02.078728Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 Using pre-defined KPI template for: screening yield percentage", "module": "sql_service", "function": "query", "line": 460}
{"timestamp": "2026-01-08T10:17:02.078815Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 471}
{"timestamp": "2026-01-08T10:17:02.078843Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI TEMPLATE EXECUTION (1 API call):", "module": "sql_service", "function": "_execute_kpi_template", "line": 472}
{"timestamp": "2026-01-08T10:17:02.078861Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 473}
{"timestamp": "2026-01-08T10:17:02.078881Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Template: screening yield percentage", "module": "sql_service", "function": "_execute_kpi_template", "line": 474}
{"timestamp": "2026-01-08T10:17:02.078938Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL: SELECT \n            ROUND(\n                (COUNT(DISTINCT CASE WHEN is_referred = TRUE \n                    AND referred_reason IN ('Due to Elevated BP', 'Due to Elevated BG', 'Due to Elevated BP & B...", "module": "sql_service", "function": "_execute_kpi_template", "line": 475}
{"timestamp": "2026-01-08T10:17:02.098768Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query result: [(Decimal('74.36'),)]", "module": "sql_service", "function": "_execute_kpi_template", "line": 479}
{"timestamp": "2026-01-08T10:17:04.932409Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T10:17:04.935003Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 494}
{"timestamp": "2026-01-08T10:17:04.935113Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u2705 KPI template execution completed with 1 API call", "module": "sql_service", "function": "_execute_kpi_template", "line": 495}
{"timestamp": "2026-01-08T10:17:04.935169Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: The screening yield percentage for the NCD program is 74.36%. This figure represents the proportion of individuals who were referred for further evaluation due to elevated blood pressure (BP) and/or blood glucose (BG) levels, out of the total number of individuals who were screened and had a BP read...", "module": "sql_service", "function": "_execute_kpi_template", "line": 496}
{"timestamp": "2026-01-08T10:17:04.935216Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 497}
{"timestamp": "2026-01-08T10:17:05.783445Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T10:17:09.814847Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=a43f9c0c-f003-4994-b36f-c8ef4612d731, duration=9.85s)", "module": "agent_service", "function": "process_query", "line": 269}
{"timestamp": "2026-01-08T11:05:34.594593Z", "level": "INFO", "logger": "app", "message": "Shutting down application", "module": "app", "function": "lifespan", "line": 34}
{"timestamp": "2026-01-08T11:05:38.742715Z", "level": "INFO", "logger": "app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-08T11:05:38.742758Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-08T11:05:38.742780Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-08T11:05:38.742860Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-08T11:05:38.756861Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-08T11:05:38.756901Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-08T11:05:40.812815Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-08T11:05:40.812928Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-08T11:05:40.813003Z", "level": "INFO", "logger": "app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-08T11:05:40.813024Z", "level": "INFO", "logger": "app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-08T11:14:06.454924Z", "level": "INFO", "logger": "app", "message": "Shutting down application", "module": "app", "function": "lifespan", "line": 34}
{"timestamp": "2026-01-08T11:14:10.055032Z", "level": "INFO", "logger": "app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-08T11:14:10.055087Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-08T11:14:10.055114Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-08T11:14:10.055230Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-08T11:14:10.070816Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-08T11:14:10.070861Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-08T11:14:12.176221Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-08T11:14:12.176346Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-08T11:14:12.176457Z", "level": "INFO", "logger": "app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-08T11:14:12.176481Z", "level": "INFO", "logger": "app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-08T11:15:08.964279Z", "level": "INFO", "logger": "app", "message": "Shutting down application", "module": "app", "function": "lifespan", "line": 34}
{"timestamp": "2026-01-08T11:15:11.829502Z", "level": "INFO", "logger": "app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-08T11:15:11.829552Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-08T11:15:11.829580Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-08T11:15:11.829669Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-08T11:15:11.844077Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-08T11:15:11.844122Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-08T11:15:12.927625Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-08T11:15:12.927716Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-08T11:15:12.927772Z", "level": "INFO", "logger": "app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-08T11:15:12.927792Z", "level": "INFO", "logger": "app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-08T11:18:05.930443Z", "level": "INFO", "logger": "app", "message": "Shutting down application", "module": "app", "function": "lifespan", "line": 34}
{"timestamp": "2026-01-08T11:18:08.781649Z", "level": "INFO", "logger": "app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-08T11:18:08.781705Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-08T11:18:08.781735Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-08T11:18:08.781831Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-08T11:18:08.797061Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-08T11:18:08.797099Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-08T11:18:10.085455Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-08T11:18:10.085548Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-08T11:18:10.085606Z", "level": "INFO", "logger": "app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-08T11:18:10.085634Z", "level": "INFO", "logger": "app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-08T11:18:34.347429Z", "level": "INFO", "logger": "app", "message": "Shutting down application", "module": "app", "function": "lifespan", "line": 34}
{"timestamp": "2026-01-08T11:18:37.251023Z", "level": "INFO", "logger": "app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-08T11:18:37.252798Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-08T11:18:37.252827Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-08T11:18:37.252921Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-08T11:18:37.266262Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-08T11:18:37.266303Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-08T11:18:38.579860Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-08T11:18:38.579955Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-08T11:18:38.580009Z", "level": "INFO", "logger": "app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-08T11:18:38.580034Z", "level": "INFO", "logger": "app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-08T11:23:38.178415Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login attempt for user: admin", "module": "auth", "function": "login", "line": 27}
{"timestamp": "2026-01-08T11:23:38.179010Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login successful for user: admin", "module": "auth", "function": "login", "line": 50}
{"timestamp": "2026-01-08T11:23:50.780011Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=31", "module": "chat", "function": "chat", "line": 36, "user_id": "admin"}
{"timestamp": "2026-01-08T11:23:50.780295Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Initializing AgentService", "module": "agent_service", "function": "__init__", "line": 164}
{"timestamp": "2026-01-08T11:23:50.780476Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Connecting to database at postgresql://admin:admin@127.0.0.1:5432/Spice_BD", "module": "sql_service", "function": "__init__", "line": 229}
{"timestamp": "2026-01-08T11:23:51.110724Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Database connection established with view support", "module": "sql_service", "function": "__init__", "line": 246}
{"timestamp": "2026-01-08T11:23:51.335512Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Cached schema for 39 relevant tables out of 114 total", "module": "sql_service", "function": "_cache_schema", "line": 311}
{"timestamp": "2026-01-08T11:23:51.335574Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Relevant tables: bp_log, current_medication, diagnosis, glucose_log, lab_test, lab_test_result, lab_test_result_range, medical_compliance, medication_country_detail, patient...", "module": "sql_service", "function": "_cache_schema", "line": 312}
{"timestamp": "2026-01-08T11:23:51.450562Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "SQL agent initialized successfully with 39 cached tables", "module": "sql_service", "function": "__init__", "line": 273}
{"timestamp": "2026-01-08T11:23:51.454910Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "AgentService initialized successfully", "module": "agent_service", "function": "__init__", "line": 227}
{"timestamp": "2026-01-08T11:23:51.454966Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=c676cc67-073f-4822-b336-f8afc288b395): 'types 2 diabeties patient count...'", "module": "agent_service", "function": "process_query", "line": 266}
{"timestamp": "2026-01-08T11:23:53.013103Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T11:23:53.435986Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Count patients diagnosed with Type 2 Diabetes....'", "module": "sql_service", "function": "query", "line": 455}
{"timestamp": "2026-01-08T11:23:53.437328Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udd0d Analyzing natural language query", "module": "sql_service", "function": "_is_simple_query", "line": 405}
{"timestamp": "2026-01-08T11:23:53.437470Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Query classified as SIMPLE (natural language)", "module": "sql_service", "function": "_is_simple_query", "line": 448}
{"timestamp": "2026-01-08T11:23:53.437510Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Detected simple query - using optimized execution path", "module": "sql_service", "function": "query", "line": 464}
{"timestamp": "2026-01-08T11:23:53.437544Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_optimized", "line": 506}
{"timestamp": "2026-01-08T11:23:53.437572Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 OPTIMIZED SQL EXECUTION:", "module": "sql_service", "function": "_execute_optimized", "line": 507}
{"timestamp": "2026-01-08T11:23:53.437601Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_optimized", "line": 508}
{"timestamp": "2026-01-08T11:23:53.437632Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " API Call 1: Generate SQL query with targeted schema", "module": "sql_service", "function": "_execute_optimized", "line": 520}
{"timestamp": "2026-01-08T11:23:53.437689Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udccb Selected relevant tables for query: patient, patient_diagnosis, glucose_log, patient_tracker", "module": "sql_service", "function": "_get_relevant_schema", "line": 353}
{"timestamp": "2026-01-08T11:23:54.979899Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T11:23:54.990756Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL to execute: SELECT COUNT(DISTINCT pt.patient_id)\nFROM patient_tracker pt\nJOIN patient_diagnosis pd ON pt.id = pd.patient_track_id\nWHERE pd.diabetes_patient_type = 'Type 2 Diabetes';...", "module": "sql_service", "function": "_execute_optimized", "line": 552}
{"timestamp": "2026-01-08T11:23:54.990848Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Executing query against database (no API call)", "module": "sql_service", "function": "_execute_optimized", "line": 558}
{"timestamp": "2026-01-08T11:23:54.996231Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query result: [(0,)]", "module": "sql_service", "function": "_execute_optimized", "line": 560}
{"timestamp": "2026-01-08T11:23:54.996280Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " API Call 2: Format natural language response", "module": "sql_service", "function": "_execute_optimized", "line": 562}
{"timestamp": "2026-01-08T11:23:56.106231Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T11:23:56.109678Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_optimized", "line": 577}
{"timestamp": "2026-01-08T11:23:56.109852Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Optimized execution completed with 2 API call(s) (vs 7 with agent)", "module": "sql_service", "function": "_execute_optimized", "line": 578}
{"timestamp": "2026-01-08T11:23:56.109955Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: There are no patients diagnosed with Type 2 Diabetes....", "module": "sql_service", "function": "_execute_optimized", "line": 579}
{"timestamp": "2026-01-08T11:23:56.110034Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_optimized", "line": 580}
{"timestamp": "2026-01-08T11:23:56.617245Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T11:23:58.885025Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=c676cc67-073f-4822-b336-f8afc288b395, duration=7.43s)", "module": "agent_service", "function": "process_query", "line": 312}
{"timestamp": "2026-01-08T11:24:21.181576Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login attempt for user: admin", "module": "auth", "function": "login", "line": 27}
{"timestamp": "2026-01-08T11:24:21.182586Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login successful for user: admin", "module": "auth", "function": "login", "line": 50}
{"timestamp": "2026-01-08T11:24:28.987955Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=17", "module": "chat", "function": "chat", "line": 36, "user_id": "admin"}
{"timestamp": "2026-01-08T11:24:28.989101Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=e0969deb-eceb-4298-ab0c-9d4a49d8244c): 'types of patients...'", "module": "agent_service", "function": "process_query", "line": 266}
{"timestamp": "2026-01-08T11:24:31.228600Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-08T11:24:38.724877Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=e0969deb-eceb-4298-ab0c-9d4a49d8244c, duration=9.74s)", "module": "agent_service", "function": "process_query", "line": 312}
{"timestamp": "2026-01-08T11:25:15.954391Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login attempt for user: admin", "module": "auth", "function": "login", "line": 27}
{"timestamp": "2026-01-08T11:25:15.955449Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login successful for user: admin", "module": "auth", "function": "login", "line": 50}
{"timestamp": "2026-01-08T11:29:53.539482Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Streaming chat request from user=admin, query_length=13", "module": "chat", "function": "chat_stream", "line": 93, "user_id": "admin"}
{"timestamp": "2026-01-08T11:29:53.548680Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing streaming query (trace_id=ae0da9d3-2784-4894-90e9-784db1d7a510): 'pateitns w bp...'", "module": "agent_service", "function": "process_query_stream", "line": 338}
{"timestamp": "2026-01-08T11:29:54.712687Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1740}
{"timestamp": "2026-01-08T11:29:55.433165Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "\u2705 Streaming query completed (trace_id=ae0da9d3-2784-4894-90e9-784db1d7a510, duration=1.88s)", "module": "agent_service", "function": "process_query_stream", "line": 474}
{"timestamp": "2026-01-08T11:30:11.987413Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Streaming chat request from user=admin, query_length=65", "module": "chat", "function": "chat_stream", "line": 93, "user_id": "admin"}
{"timestamp": "2026-01-08T11:30:11.989435Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing streaming query (trace_id=adc38f30-3a37-462a-9f44-a563d5e847b4): 'Find records where the doctor advised the patient to quit smoking...'", "module": "agent_service", "function": "process_query_stream", "line": 338}
{"timestamp": "2026-01-08T11:30:13.763279Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1740}
{"timestamp": "2026-01-08T11:30:13.966713Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "\u26a1 Lazy loading vector store on first use...", "module": "agent_service", "function": "vector_store", "line": 233}
{"timestamp": "2026-01-08T11:30:13.967024Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Initializing vector store service", "module": "vector_store", "function": "__init__", "line": 30}
{"timestamp": "2026-01-08T11:30:13.967755Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Looking for RAG config at: /Users/adityanbhatt/fhir_rag/backend/config/embedding_config.yaml", "module": "vector_store", "function": "__init__", "line": 41}
{"timestamp": "2026-01-08T11:30:13.967889Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Loading RAG config from /Users/adityanbhatt/fhir_rag/backend/config/embedding_config.yaml", "module": "vector_store", "function": "__init__", "line": 46}
{"timestamp": "2026-01-08T11:30:13.977561Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Loaded RAG config successfully", "module": "vector_store", "function": "__init__", "line": 51}
{"timestamp": "2026-01-08T11:30:13.978042Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Resolved chroma_path to: /Users/adityanbhatt/fhir_rag/backend/data/indexes/chroma_db_advanced", "module": "retrieve", "function": "_resolve_config_paths", "line": 155}
{"timestamp": "2026-01-08T11:30:13.978182Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Resolved model_path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "retrieve", "function": "_resolve_config_paths", "line": 162}
{"timestamp": "2026-01-08T11:30:14.059647Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Loading docstore from /Users/adityanbhatt/fhir_rag/backend/data/indexes/chroma_db_advanced/parent_docstore.pkl with module remapping", "module": "retrieve", "function": "_load_docstore", "line": 284}
{"timestamp": "2026-01-08T11:30:14.567456Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Successfully loaded docstore with module remapping", "module": "retrieve", "function": "_load_docstore", "line": 286}
{"timestamp": "2026-01-08T11:30:14.568787Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Loading 154161 parent documents for BM25...", "module": "retrieve", "function": "_setup_retrievers", "line": 175}
{"timestamp": "2026-01-08T11:30:14.591884Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Filtered to 59572 documents from relevant tables for BM25 index.", "module": "retrieve", "function": "_setup_retrievers", "line": 185}
{"timestamp": "2026-01-08T11:30:15.406716Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "BM25Retriever initialized on relevant tables.", "module": "retrieve", "function": "_setup_retrievers", "line": 196}
{"timestamp": "2026-01-08T11:30:15.407750Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Initializing reranker: BAAI/bge-reranker-base", "module": "retrieve", "function": "__init__", "line": 137}
{"timestamp": "2026-01-08T11:30:17.568014Z", "level": "INFO", "logger": "sentence_transformers.cross_encoder.CrossEncoder", "message": "Use pytorch device: mps", "module": "CrossEncoder", "function": "__init__", "line": 222}
{"timestamp": "2026-01-08T11:30:18.885671Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Advanced RAG Retriever initialized successfully.", "module": "retrieve", "function": "__init__", "line": 143}
{"timestamp": "2026-01-08T11:30:18.886652Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Vector store initialized successfully", "module": "vector_store", "function": "__init__", "line": 55}
{"timestamp": "2026-01-08T11:30:18.887054Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "\u2705 Vector store loaded", "module": "agent_service", "function": "vector_store", "line": 235}
{"timestamp": "2026-01-08T11:30:18.887498Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Searching vector store for query: 'doctor advised to quit smoking...' (top_k=5)", "module": "vector_store", "function": "search", "line": 69}
{"timestamp": "2026-01-08T11:30:18.888719Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Executing query: doctor advised to quit smoking", "module": "retrieve", "function": "_get_relevant_documents", "line": 223}
{"timestamp": "2026-01-08T11:30:21.900677Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Reranking 100 documents for query: 'doctor advised to quit smoking'", "module": "retrieve", "function": "_get_relevant_documents", "line": 257}
{"timestamp": "2026-01-08T11:30:23.749609Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Returning 10 reranked documents.", "module": "retrieve", "function": "_get_relevant_documents", "line": 267}
{"timestamp": "2026-01-08T11:30:23.749810Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Retrieved 10 documents from vector store", "module": "vector_store", "function": "search", "line": 84}
{"timestamp": "2026-01-08T11:30:24.410975Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1740}
{"timestamp": "2026-01-08T11:30:27.503791Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "\u2705 Streaming query completed (trace_id=adc38f30-3a37-462a-9f44-a563d5e847b4, duration=15.51s)", "module": "agent_service", "function": "process_query_stream", "line": 474}
{"timestamp": "2026-01-08T11:30:39.679836Z", "level": "INFO", "logger": "app", "message": "Shutting down application", "module": "app", "function": "lifespan", "line": 34}
{"timestamp": "2026-01-08T11:30:44.776563Z", "level": "INFO", "logger": "app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-08T11:30:44.776610Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-08T11:30:44.776634Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-08T11:30:44.776721Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-08T11:30:44.793607Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-08T11:30:44.793651Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-08T11:30:46.423692Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-08T11:30:46.423790Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-08T11:30:46.423834Z", "level": "INFO", "logger": "app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-08T11:30:46.423855Z", "level": "INFO", "logger": "app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-08T11:30:49.561743Z", "level": "INFO", "logger": "app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-08T11:30:49.561780Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-08T11:30:49.561806Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-08T11:30:49.561901Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-08T11:30:49.576879Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-08T11:30:49.576921Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-08T11:30:50.865384Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-08T11:30:50.865441Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-08T11:30:50.865469Z", "level": "INFO", "logger": "app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-08T11:30:50.865490Z", "level": "INFO", "logger": "app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-09T05:09:05.803936Z", "level": "INFO", "logger": "app", "message": "Shutting down application", "module": "app", "function": "lifespan", "line": 34}
{"timestamp": "2026-01-09T05:09:10.312147Z", "level": "INFO", "logger": "app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-09T05:09:10.312191Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-09T05:09:10.312214Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-09T05:09:10.312292Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-09T05:09:10.328390Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-09T05:09:10.328432Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-09T05:09:12.316784Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-09T05:09:12.317014Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-09T05:09:12.317153Z", "level": "INFO", "logger": "app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-09T05:09:12.317175Z", "level": "INFO", "logger": "app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-09T05:11:05.387689Z", "level": "INFO", "logger": "app", "message": "Shutting down application", "module": "app", "function": "lifespan", "line": 34}
{"timestamp": "2026-01-09T05:11:08.515834Z", "level": "INFO", "logger": "app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-09T05:11:08.515888Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-09T05:11:08.515912Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-09T05:11:08.516003Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-09T05:11:08.529835Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-09T05:11:08.529876Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-09T05:11:09.634271Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-09T05:11:09.634358Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-09T05:11:09.634402Z", "level": "INFO", "logger": "app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-09T05:11:09.634424Z", "level": "INFO", "logger": "app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-09T05:12:10.158382Z", "level": "INFO", "logger": "app", "message": "Shutting down application", "module": "app", "function": "lifespan", "line": 34}
{"timestamp": "2026-01-09T05:12:12.817065Z", "level": "INFO", "logger": "app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-09T05:12:12.817129Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-09T05:12:12.817155Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-09T05:12:12.817237Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-09T05:12:12.831227Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-09T05:12:12.831267Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-09T05:12:13.889102Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-09T05:12:13.889184Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-09T05:12:13.889237Z", "level": "INFO", "logger": "app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-09T05:12:13.889258Z", "level": "INFO", "logger": "app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-09T05:13:22.302648Z", "level": "INFO", "logger": "app", "message": "Shutting down application", "module": "app", "function": "lifespan", "line": 34}
{"timestamp": "2026-01-09T05:13:24.930899Z", "level": "INFO", "logger": "app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-09T05:13:24.930951Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-09T05:13:24.930981Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-09T05:13:24.931073Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-09T05:13:24.944720Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-09T05:13:24.944766Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-09T05:13:25.906607Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-09T05:13:25.906715Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-09T05:13:25.906776Z", "level": "INFO", "logger": "app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-09T05:13:25.906805Z", "level": "INFO", "logger": "app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-09T05:15:05.534701Z", "level": "INFO", "logger": "app", "message": "Shutting down application", "module": "app", "function": "lifespan", "line": 34}
{"timestamp": "2026-01-09T05:15:08.207738Z", "level": "INFO", "logger": "app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-09T05:15:08.207791Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-09T05:15:08.207817Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-09T05:15:08.207897Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-09T05:15:08.222592Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-09T05:15:08.222630Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-09T05:15:09.237128Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-09T05:15:09.237227Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-09T05:15:09.237287Z", "level": "INFO", "logger": "app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-09T05:15:09.237312Z", "level": "INFO", "logger": "app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-09T05:41:28.437593Z", "level": "INFO", "logger": "app", "message": "Shutting down application", "module": "app", "function": "lifespan", "line": 34}
{"timestamp": "2026-01-09T05:41:31.943352Z", "level": "INFO", "logger": "app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-09T05:41:31.943395Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-09T05:41:31.943418Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-09T05:41:31.943495Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-09T05:41:31.957226Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-09T05:41:31.957270Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-09T05:41:34.003540Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-09T05:41:34.003760Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-09T05:41:34.003953Z", "level": "INFO", "logger": "app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-09T05:41:34.003983Z", "level": "INFO", "logger": "app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-09T05:56:23.060587Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login attempt for user: admin", "module": "auth", "function": "login", "line": 27}
{"timestamp": "2026-01-09T05:56:23.068928Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login successful for user: admin", "module": "auth", "function": "login", "line": 50}
{"timestamp": "2026-01-09T05:56:42.509320Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=59", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-09T05:56:42.509617Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Initializing AgentService", "module": "agent_service", "function": "__init__", "line": 149}
{"timestamp": "2026-01-09T05:56:42.510346Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Connecting to database at postgresql://admin:admin@127.0.0.1:5432/Spice_BD", "module": "sql_service", "function": "__init__", "line": 336}
{"timestamp": "2026-01-09T05:56:42.745480Z", "level": "ERROR", "logger": "backend.services.sql_service", "message": "Failed to initialize SQL service: (psycopg2.OperationalError) connection to server at \"127.0.0.1\", port 5432 failed: FATAL:  role \"admin\" does not exist\n\n(Background on this error at: https://sqlalche.me/e/20/e3q8)", "module": "sql_service", "function": "__init__", "line": 394, "exception": "Traceback (most recent call last):\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/base.py\", line 146, in __init__\n    self._dbapi_connection = engine.raw_connection()\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/base.py\", line 3304, in raw_connection\n    return self.pool.connect()\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 449, in connect\n    return _ConnectionFairy._checkout(self)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 1263, in _checkout\n    fairy = _ConnectionRecord.checkout(pool)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 712, in checkout\n    rec = pool._do_get()\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/impl.py\", line 179, in _do_get\n    with util.safe_reraise():\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/impl.py\", line 177, in _do_get\n    return self._create_connection()\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 390, in _create_connection\n    return _ConnectionRecord(self)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 674, in __init__\n    self.__connect()\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 900, in __connect\n    with util.safe_reraise():\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 896, in __connect\n    self.dbapi_connection = connection = pool._invoke_creator(self)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/create.py\", line 643, in connect\n    return dialect.connect(*cargs, **cparams)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/default.py\", line 617, in connect\n    return self.loaded_dbapi.connect(*cargs, **cparams)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/psycopg2/__init__.py\", line 122, in connect\n    conn = _connect(dsn, connection_factory=connection_factory, **kwasync)\npsycopg2.OperationalError: connection to server at \"127.0.0.1\", port 5432 failed: FATAL:  role \"admin\" does not exist\n\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/Users/adityanbhatt/fhir_rag/backend/services/sql_service.py\", line 340, in __init__\n    temp_db = SQLDatabase.from_uri(settings.database_url)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_community/utilities/sql_database.py\", line 175, in from_uri\n    return cls(create_engine(database_uri, **_engine_args), **kwargs)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_community/utilities/sql_database.py\", line 106, in __init__\n    self._inspector = inspect(self._engine)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/inspection.py\", line 140, in inspect\n    ret = reg(subject)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/reflection.py\", line 303, in _engine_insp\n    return Inspector._construct(Inspector._init_engine, bind)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/reflection.py\", line 236, in _construct\n    init(self, bind)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/reflection.py\", line 247, in _init_engine\n    engine.connect().close()\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/base.py\", line 3280, in connect\n    return self._connection_cls(self)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/base.py\", line 148, in __init__\n    Connection._handle_dbapi_exception_noconnection(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/base.py\", line 2444, in _handle_dbapi_exception_noconnection\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/base.py\", line 146, in __init__\n    self._dbapi_connection = engine.raw_connection()\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/base.py\", line 3304, in raw_connection\n    return self.pool.connect()\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 449, in connect\n    return _ConnectionFairy._checkout(self)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 1263, in _checkout\n    fairy = _ConnectionRecord.checkout(pool)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 712, in checkout\n    rec = pool._do_get()\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/impl.py\", line 179, in _do_get\n    with util.safe_reraise():\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/impl.py\", line 177, in _do_get\n    return self._create_connection()\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 390, in _create_connection\n    return _ConnectionRecord(self)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 674, in __init__\n    self.__connect()\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 900, in __connect\n    with util.safe_reraise():\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 896, in __connect\n    self.dbapi_connection = connection = pool._invoke_creator(self)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/create.py\", line 643, in connect\n    return dialect.connect(*cargs, **cparams)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/default.py\", line 617, in connect\n    return self.loaded_dbapi.connect(*cargs, **cparams)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/psycopg2/__init__.py\", line 122, in connect\n    conn = _connect(dsn, connection_factory=connection_factory, **kwasync)\nsqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at \"127.0.0.1\", port 5432 failed: FATAL:  role \"admin\" does not exist\n\n(Background on this error at: https://sqlalche.me/e/20/e3q8)"}
{"timestamp": "2026-01-09T05:56:42.746125Z", "level": "ERROR", "logger": "backend.api.routes.chat", "message": "Chat request failed for user=admin: (psycopg2.OperationalError) connection to server at \"127.0.0.1\", port 5432 failed: FATAL:  role \"admin\" does not exist\n\n(Background on this error at: https://sqlalche.me/e/20/e3q8)", "module": "chat", "function": "chat", "line": 51, "exception": "Traceback (most recent call last):\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/base.py\", line 146, in __init__\n    self._dbapi_connection = engine.raw_connection()\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/base.py\", line 3304, in raw_connection\n    return self.pool.connect()\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 449, in connect\n    return _ConnectionFairy._checkout(self)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 1263, in _checkout\n    fairy = _ConnectionRecord.checkout(pool)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 712, in checkout\n    rec = pool._do_get()\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/impl.py\", line 179, in _do_get\n    with util.safe_reraise():\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/impl.py\", line 177, in _do_get\n    return self._create_connection()\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 390, in _create_connection\n    return _ConnectionRecord(self)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 674, in __init__\n    self.__connect()\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 900, in __connect\n    with util.safe_reraise():\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 896, in __connect\n    self.dbapi_connection = connection = pool._invoke_creator(self)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/create.py\", line 643, in connect\n    return dialect.connect(*cargs, **cparams)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/default.py\", line 617, in connect\n    return self.loaded_dbapi.connect(*cargs, **cparams)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/psycopg2/__init__.py\", line 122, in connect\n    conn = _connect(dsn, connection_factory=connection_factory, **kwasync)\npsycopg2.OperationalError: connection to server at \"127.0.0.1\", port 5432 failed: FATAL:  role \"admin\" does not exist\n\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/Users/adityanbhatt/fhir_rag/backend/api/routes/chat.py\", line 42, in chat\n    agent_service = get_agent_service()\n  File \"/Users/adityanbhatt/fhir_rag/backend/services/agent_service.py\", line 376, in get_agent_service\n    _agent_service = AgentService()\n  File \"/Users/adityanbhatt/fhir_rag/backend/services/agent_service.py\", line 152, in __init__\n    self.sql_service = get_sql_service()\n  File \"/Users/adityanbhatt/fhir_rag/backend/services/sql_service.py\", line 787, in get_sql_service\n    return SQLService()\n  File \"/Users/adityanbhatt/fhir_rag/backend/services/sql_service.py\", line 340, in __init__\n    temp_db = SQLDatabase.from_uri(settings.database_url)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_community/utilities/sql_database.py\", line 175, in from_uri\n    return cls(create_engine(database_uri, **_engine_args), **kwargs)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_community/utilities/sql_database.py\", line 106, in __init__\n    self._inspector = inspect(self._engine)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/inspection.py\", line 140, in inspect\n    ret = reg(subject)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/reflection.py\", line 303, in _engine_insp\n    return Inspector._construct(Inspector._init_engine, bind)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/reflection.py\", line 236, in _construct\n    init(self, bind)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/reflection.py\", line 247, in _init_engine\n    engine.connect().close()\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/base.py\", line 3280, in connect\n    return self._connection_cls(self)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/base.py\", line 148, in __init__\n    Connection._handle_dbapi_exception_noconnection(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/base.py\", line 2444, in _handle_dbapi_exception_noconnection\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/base.py\", line 146, in __init__\n    self._dbapi_connection = engine.raw_connection()\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/base.py\", line 3304, in raw_connection\n    return self.pool.connect()\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 449, in connect\n    return _ConnectionFairy._checkout(self)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 1263, in _checkout\n    fairy = _ConnectionRecord.checkout(pool)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 712, in checkout\n    rec = pool._do_get()\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/impl.py\", line 179, in _do_get\n    with util.safe_reraise():\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/impl.py\", line 177, in _do_get\n    return self._create_connection()\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 390, in _create_connection\n    return _ConnectionRecord(self)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 674, in __init__\n    self.__connect()\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 900, in __connect\n    with util.safe_reraise():\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 896, in __connect\n    self.dbapi_connection = connection = pool._invoke_creator(self)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/create.py\", line 643, in connect\n    return dialect.connect(*cargs, **cparams)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/default.py\", line 617, in connect\n    return self.loaded_dbapi.connect(*cargs, **cparams)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/psycopg2/__init__.py\", line 122, in connect\n    conn = _connect(dsn, connection_factory=connection_factory, **kwasync)\nsqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at \"127.0.0.1\", port 5432 failed: FATAL:  role \"admin\" does not exist\n\n(Background on this error at: https://sqlalche.me/e/20/e3q8)", "user_id": "admin"}
{"timestamp": "2026-01-09T05:56:55.548814Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=59", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-09T05:56:55.548967Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Initializing AgentService", "module": "agent_service", "function": "__init__", "line": 149}
{"timestamp": "2026-01-09T05:56:55.549104Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Connecting to database at postgresql://admin:admin@127.0.0.1:5432/Spice_BD", "module": "sql_service", "function": "__init__", "line": 336}
{"timestamp": "2026-01-09T05:56:55.554958Z", "level": "ERROR", "logger": "backend.services.sql_service", "message": "Failed to initialize SQL service: (psycopg2.OperationalError) connection to server at \"127.0.0.1\", port 5432 failed: FATAL:  role \"admin\" does not exist\n\n(Background on this error at: https://sqlalche.me/e/20/e3q8)", "module": "sql_service", "function": "__init__", "line": 394, "exception": "Traceback (most recent call last):\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/base.py\", line 146, in __init__\n    self._dbapi_connection = engine.raw_connection()\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/base.py\", line 3304, in raw_connection\n    return self.pool.connect()\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 449, in connect\n    return _ConnectionFairy._checkout(self)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 1263, in _checkout\n    fairy = _ConnectionRecord.checkout(pool)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 712, in checkout\n    rec = pool._do_get()\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/impl.py\", line 179, in _do_get\n    with util.safe_reraise():\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/impl.py\", line 177, in _do_get\n    return self._create_connection()\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 390, in _create_connection\n    return _ConnectionRecord(self)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 674, in __init__\n    self.__connect()\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 900, in __connect\n    with util.safe_reraise():\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 896, in __connect\n    self.dbapi_connection = connection = pool._invoke_creator(self)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/create.py\", line 643, in connect\n    return dialect.connect(*cargs, **cparams)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/default.py\", line 617, in connect\n    return self.loaded_dbapi.connect(*cargs, **cparams)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/psycopg2/__init__.py\", line 122, in connect\n    conn = _connect(dsn, connection_factory=connection_factory, **kwasync)\npsycopg2.OperationalError: connection to server at \"127.0.0.1\", port 5432 failed: FATAL:  role \"admin\" does not exist\n\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/Users/adityanbhatt/fhir_rag/backend/services/sql_service.py\", line 340, in __init__\n    temp_db = SQLDatabase.from_uri(settings.database_url)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_community/utilities/sql_database.py\", line 175, in from_uri\n    return cls(create_engine(database_uri, **_engine_args), **kwargs)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_community/utilities/sql_database.py\", line 106, in __init__\n    self._inspector = inspect(self._engine)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/inspection.py\", line 140, in inspect\n    ret = reg(subject)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/reflection.py\", line 303, in _engine_insp\n    return Inspector._construct(Inspector._init_engine, bind)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/reflection.py\", line 236, in _construct\n    init(self, bind)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/reflection.py\", line 247, in _init_engine\n    engine.connect().close()\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/base.py\", line 3280, in connect\n    return self._connection_cls(self)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/base.py\", line 148, in __init__\n    Connection._handle_dbapi_exception_noconnection(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/base.py\", line 2444, in _handle_dbapi_exception_noconnection\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/base.py\", line 146, in __init__\n    self._dbapi_connection = engine.raw_connection()\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/base.py\", line 3304, in raw_connection\n    return self.pool.connect()\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 449, in connect\n    return _ConnectionFairy._checkout(self)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 1263, in _checkout\n    fairy = _ConnectionRecord.checkout(pool)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 712, in checkout\n    rec = pool._do_get()\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/impl.py\", line 179, in _do_get\n    with util.safe_reraise():\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/impl.py\", line 177, in _do_get\n    return self._create_connection()\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 390, in _create_connection\n    return _ConnectionRecord(self)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 674, in __init__\n    self.__connect()\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 900, in __connect\n    with util.safe_reraise():\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 896, in __connect\n    self.dbapi_connection = connection = pool._invoke_creator(self)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/create.py\", line 643, in connect\n    return dialect.connect(*cargs, **cparams)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/default.py\", line 617, in connect\n    return self.loaded_dbapi.connect(*cargs, **cparams)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/psycopg2/__init__.py\", line 122, in connect\n    conn = _connect(dsn, connection_factory=connection_factory, **kwasync)\nsqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at \"127.0.0.1\", port 5432 failed: FATAL:  role \"admin\" does not exist\n\n(Background on this error at: https://sqlalche.me/e/20/e3q8)"}
{"timestamp": "2026-01-09T05:56:55.557256Z", "level": "ERROR", "logger": "backend.api.routes.chat", "message": "Chat request failed for user=admin: (psycopg2.OperationalError) connection to server at \"127.0.0.1\", port 5432 failed: FATAL:  role \"admin\" does not exist\n\n(Background on this error at: https://sqlalche.me/e/20/e3q8)", "module": "chat", "function": "chat", "line": 51, "exception": "Traceback (most recent call last):\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/base.py\", line 146, in __init__\n    self._dbapi_connection = engine.raw_connection()\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/base.py\", line 3304, in raw_connection\n    return self.pool.connect()\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 449, in connect\n    return _ConnectionFairy._checkout(self)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 1263, in _checkout\n    fairy = _ConnectionRecord.checkout(pool)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 712, in checkout\n    rec = pool._do_get()\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/impl.py\", line 179, in _do_get\n    with util.safe_reraise():\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/impl.py\", line 177, in _do_get\n    return self._create_connection()\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 390, in _create_connection\n    return _ConnectionRecord(self)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 674, in __init__\n    self.__connect()\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 900, in __connect\n    with util.safe_reraise():\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 896, in __connect\n    self.dbapi_connection = connection = pool._invoke_creator(self)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/create.py\", line 643, in connect\n    return dialect.connect(*cargs, **cparams)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/default.py\", line 617, in connect\n    return self.loaded_dbapi.connect(*cargs, **cparams)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/psycopg2/__init__.py\", line 122, in connect\n    conn = _connect(dsn, connection_factory=connection_factory, **kwasync)\npsycopg2.OperationalError: connection to server at \"127.0.0.1\", port 5432 failed: FATAL:  role \"admin\" does not exist\n\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/Users/adityanbhatt/fhir_rag/backend/api/routes/chat.py\", line 42, in chat\n    agent_service = get_agent_service()\n  File \"/Users/adityanbhatt/fhir_rag/backend/services/agent_service.py\", line 376, in get_agent_service\n    _agent_service = AgentService()\n  File \"/Users/adityanbhatt/fhir_rag/backend/services/agent_service.py\", line 152, in __init__\n    self.sql_service = get_sql_service()\n  File \"/Users/adityanbhatt/fhir_rag/backend/services/sql_service.py\", line 787, in get_sql_service\n    return SQLService()\n  File \"/Users/adityanbhatt/fhir_rag/backend/services/sql_service.py\", line 340, in __init__\n    temp_db = SQLDatabase.from_uri(settings.database_url)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_community/utilities/sql_database.py\", line 175, in from_uri\n    return cls(create_engine(database_uri, **_engine_args), **kwargs)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_community/utilities/sql_database.py\", line 106, in __init__\n    self._inspector = inspect(self._engine)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/inspection.py\", line 140, in inspect\n    ret = reg(subject)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/reflection.py\", line 303, in _engine_insp\n    return Inspector._construct(Inspector._init_engine, bind)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/reflection.py\", line 236, in _construct\n    init(self, bind)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/reflection.py\", line 247, in _init_engine\n    engine.connect().close()\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/base.py\", line 3280, in connect\n    return self._connection_cls(self)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/base.py\", line 148, in __init__\n    Connection._handle_dbapi_exception_noconnection(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/base.py\", line 2444, in _handle_dbapi_exception_noconnection\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/base.py\", line 146, in __init__\n    self._dbapi_connection = engine.raw_connection()\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/base.py\", line 3304, in raw_connection\n    return self.pool.connect()\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 449, in connect\n    return _ConnectionFairy._checkout(self)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 1263, in _checkout\n    fairy = _ConnectionRecord.checkout(pool)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 712, in checkout\n    rec = pool._do_get()\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/impl.py\", line 179, in _do_get\n    with util.safe_reraise():\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/impl.py\", line 177, in _do_get\n    return self._create_connection()\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 390, in _create_connection\n    return _ConnectionRecord(self)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 674, in __init__\n    self.__connect()\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 900, in __connect\n    with util.safe_reraise():\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 896, in __connect\n    self.dbapi_connection = connection = pool._invoke_creator(self)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/create.py\", line 643, in connect\n    return dialect.connect(*cargs, **cparams)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/default.py\", line 617, in connect\n    return self.loaded_dbapi.connect(*cargs, **cparams)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/psycopg2/__init__.py\", line 122, in connect\n    conn = _connect(dsn, connection_factory=connection_factory, **kwasync)\nsqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at \"127.0.0.1\", port 5432 failed: FATAL:  role \"admin\" does not exist\n\n(Background on this error at: https://sqlalche.me/e/20/e3q8)", "user_id": "admin"}
{"timestamp": "2026-01-09T05:57:12.255161Z", "level": "INFO", "logger": "app", "message": "Shutting down application", "module": "app", "function": "lifespan", "line": 34}
{"timestamp": "2026-01-09T05:57:19.847074Z", "level": "INFO", "logger": "app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-09T05:57:19.847117Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-09T05:57:19.847140Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-09T05:57:19.847204Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-09T05:57:19.862342Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-09T05:57:19.862389Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-09T05:57:21.619482Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-09T05:57:21.619573Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-09T05:57:21.619631Z", "level": "INFO", "logger": "app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-09T05:57:21.619653Z", "level": "INFO", "logger": "app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-09T05:57:25.152661Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=59", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-09T05:57:25.152793Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Initializing AgentService", "module": "agent_service", "function": "__init__", "line": 149}
{"timestamp": "2026-01-09T05:57:25.152912Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Connecting to database at postgresql://admin:admin@127.0.0.1:5432/Spice_BD", "module": "sql_service", "function": "__init__", "line": 336}
{"timestamp": "2026-01-09T05:57:25.240479Z", "level": "ERROR", "logger": "backend.services.sql_service", "message": "Failed to initialize SQL service: (psycopg2.OperationalError) connection to server at \"127.0.0.1\", port 5432 failed: FATAL:  role \"admin\" does not exist\n\n(Background on this error at: https://sqlalche.me/e/20/e3q8)", "module": "sql_service", "function": "__init__", "line": 394, "exception": "Traceback (most recent call last):\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/base.py\", line 146, in __init__\n    self._dbapi_connection = engine.raw_connection()\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/base.py\", line 3304, in raw_connection\n    return self.pool.connect()\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 449, in connect\n    return _ConnectionFairy._checkout(self)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 1263, in _checkout\n    fairy = _ConnectionRecord.checkout(pool)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 712, in checkout\n    rec = pool._do_get()\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/impl.py\", line 179, in _do_get\n    with util.safe_reraise():\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/impl.py\", line 177, in _do_get\n    return self._create_connection()\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 390, in _create_connection\n    return _ConnectionRecord(self)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 674, in __init__\n    self.__connect()\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 900, in __connect\n    with util.safe_reraise():\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 896, in __connect\n    self.dbapi_connection = connection = pool._invoke_creator(self)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/create.py\", line 643, in connect\n    return dialect.connect(*cargs, **cparams)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/default.py\", line 617, in connect\n    return self.loaded_dbapi.connect(*cargs, **cparams)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/psycopg2/__init__.py\", line 122, in connect\n    conn = _connect(dsn, connection_factory=connection_factory, **kwasync)\npsycopg2.OperationalError: connection to server at \"127.0.0.1\", port 5432 failed: FATAL:  role \"admin\" does not exist\n\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/Users/adityanbhatt/fhir_rag/backend/services/sql_service.py\", line 340, in __init__\n    temp_db = SQLDatabase.from_uri(settings.database_url)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_community/utilities/sql_database.py\", line 175, in from_uri\n    return cls(create_engine(database_uri, **_engine_args), **kwargs)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_community/utilities/sql_database.py\", line 106, in __init__\n    self._inspector = inspect(self._engine)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/inspection.py\", line 140, in inspect\n    ret = reg(subject)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/reflection.py\", line 303, in _engine_insp\n    return Inspector._construct(Inspector._init_engine, bind)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/reflection.py\", line 236, in _construct\n    init(self, bind)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/reflection.py\", line 247, in _init_engine\n    engine.connect().close()\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/base.py\", line 3280, in connect\n    return self._connection_cls(self)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/base.py\", line 148, in __init__\n    Connection._handle_dbapi_exception_noconnection(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/base.py\", line 2444, in _handle_dbapi_exception_noconnection\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/base.py\", line 146, in __init__\n    self._dbapi_connection = engine.raw_connection()\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/base.py\", line 3304, in raw_connection\n    return self.pool.connect()\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 449, in connect\n    return _ConnectionFairy._checkout(self)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 1263, in _checkout\n    fairy = _ConnectionRecord.checkout(pool)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 712, in checkout\n    rec = pool._do_get()\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/impl.py\", line 179, in _do_get\n    with util.safe_reraise():\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/impl.py\", line 177, in _do_get\n    return self._create_connection()\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 390, in _create_connection\n    return _ConnectionRecord(self)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 674, in __init__\n    self.__connect()\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 900, in __connect\n    with util.safe_reraise():\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 896, in __connect\n    self.dbapi_connection = connection = pool._invoke_creator(self)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/create.py\", line 643, in connect\n    return dialect.connect(*cargs, **cparams)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/default.py\", line 617, in connect\n    return self.loaded_dbapi.connect(*cargs, **cparams)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/psycopg2/__init__.py\", line 122, in connect\n    conn = _connect(dsn, connection_factory=connection_factory, **kwasync)\nsqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at \"127.0.0.1\", port 5432 failed: FATAL:  role \"admin\" does not exist\n\n(Background on this error at: https://sqlalche.me/e/20/e3q8)"}
{"timestamp": "2026-01-09T05:57:25.241099Z", "level": "ERROR", "logger": "backend.api.routes.chat", "message": "Chat request failed for user=admin: (psycopg2.OperationalError) connection to server at \"127.0.0.1\", port 5432 failed: FATAL:  role \"admin\" does not exist\n\n(Background on this error at: https://sqlalche.me/e/20/e3q8)", "module": "chat", "function": "chat", "line": 51, "exception": "Traceback (most recent call last):\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/base.py\", line 146, in __init__\n    self._dbapi_connection = engine.raw_connection()\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/base.py\", line 3304, in raw_connection\n    return self.pool.connect()\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 449, in connect\n    return _ConnectionFairy._checkout(self)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 1263, in _checkout\n    fairy = _ConnectionRecord.checkout(pool)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 712, in checkout\n    rec = pool._do_get()\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/impl.py\", line 179, in _do_get\n    with util.safe_reraise():\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/impl.py\", line 177, in _do_get\n    return self._create_connection()\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 390, in _create_connection\n    return _ConnectionRecord(self)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 674, in __init__\n    self.__connect()\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 900, in __connect\n    with util.safe_reraise():\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 896, in __connect\n    self.dbapi_connection = connection = pool._invoke_creator(self)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/create.py\", line 643, in connect\n    return dialect.connect(*cargs, **cparams)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/default.py\", line 617, in connect\n    return self.loaded_dbapi.connect(*cargs, **cparams)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/psycopg2/__init__.py\", line 122, in connect\n    conn = _connect(dsn, connection_factory=connection_factory, **kwasync)\npsycopg2.OperationalError: connection to server at \"127.0.0.1\", port 5432 failed: FATAL:  role \"admin\" does not exist\n\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/Users/adityanbhatt/fhir_rag/backend/api/routes/chat.py\", line 42, in chat\n    agent_service = get_agent_service()\n  File \"/Users/adityanbhatt/fhir_rag/backend/services/agent_service.py\", line 376, in get_agent_service\n    _agent_service = AgentService()\n  File \"/Users/adityanbhatt/fhir_rag/backend/services/agent_service.py\", line 152, in __init__\n    self.sql_service = get_sql_service()\n  File \"/Users/adityanbhatt/fhir_rag/backend/services/sql_service.py\", line 787, in get_sql_service\n    return SQLService()\n  File \"/Users/adityanbhatt/fhir_rag/backend/services/sql_service.py\", line 340, in __init__\n    temp_db = SQLDatabase.from_uri(settings.database_url)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_community/utilities/sql_database.py\", line 175, in from_uri\n    return cls(create_engine(database_uri, **_engine_args), **kwargs)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_community/utilities/sql_database.py\", line 106, in __init__\n    self._inspector = inspect(self._engine)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/inspection.py\", line 140, in inspect\n    ret = reg(subject)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/reflection.py\", line 303, in _engine_insp\n    return Inspector._construct(Inspector._init_engine, bind)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/reflection.py\", line 236, in _construct\n    init(self, bind)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/reflection.py\", line 247, in _init_engine\n    engine.connect().close()\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/base.py\", line 3280, in connect\n    return self._connection_cls(self)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/base.py\", line 148, in __init__\n    Connection._handle_dbapi_exception_noconnection(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/base.py\", line 2444, in _handle_dbapi_exception_noconnection\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/base.py\", line 146, in __init__\n    self._dbapi_connection = engine.raw_connection()\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/base.py\", line 3304, in raw_connection\n    return self.pool.connect()\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 449, in connect\n    return _ConnectionFairy._checkout(self)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 1263, in _checkout\n    fairy = _ConnectionRecord.checkout(pool)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 712, in checkout\n    rec = pool._do_get()\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/impl.py\", line 179, in _do_get\n    with util.safe_reraise():\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/impl.py\", line 177, in _do_get\n    return self._create_connection()\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 390, in _create_connection\n    return _ConnectionRecord(self)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 674, in __init__\n    self.__connect()\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 900, in __connect\n    with util.safe_reraise():\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 896, in __connect\n    self.dbapi_connection = connection = pool._invoke_creator(self)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/create.py\", line 643, in connect\n    return dialect.connect(*cargs, **cparams)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/default.py\", line 617, in connect\n    return self.loaded_dbapi.connect(*cargs, **cparams)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/psycopg2/__init__.py\", line 122, in connect\n    conn = _connect(dsn, connection_factory=connection_factory, **kwasync)\nsqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at \"127.0.0.1\", port 5432 failed: FATAL:  role \"admin\" does not exist\n\n(Background on this error at: https://sqlalche.me/e/20/e3q8)", "user_id": "admin"}
{"timestamp": "2026-01-09T05:59:21.045418Z", "level": "INFO", "logger": "app", "message": "Shutting down application", "module": "app", "function": "lifespan", "line": 34}
{"timestamp": "2026-01-09T05:59:26.829218Z", "level": "INFO", "logger": "app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-09T05:59:26.829262Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-09T05:59:26.829282Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-09T05:59:26.829353Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-09T05:59:26.843491Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-09T05:59:26.843536Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-09T05:59:27.899114Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-09T05:59:27.899191Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-09T05:59:27.899233Z", "level": "INFO", "logger": "app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-09T05:59:27.899251Z", "level": "INFO", "logger": "app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-09T05:59:33.392227Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=59", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-09T05:59:33.392345Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Initializing AgentService", "module": "agent_service", "function": "__init__", "line": 149}
{"timestamp": "2026-01-09T05:59:33.392498Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Connecting to database at postgresql://admin:admin@127.0.0.1:5432/Spice_BD", "module": "sql_service", "function": "__init__", "line": 336}
{"timestamp": "2026-01-09T05:59:33.801010Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Database connection established with view support", "module": "sql_service", "function": "__init__", "line": 364}
{"timestamp": "2026-01-09T05:59:33.965690Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Cached schema for 48 relevant tables out of 125 total", "module": "sql_service", "function": "_cache_schema", "line": 429}
{"timestamp": "2026-01-09T05:59:33.965752Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Relevant tables: bp_log, current_medication, diagnosis, glucose_log, lab_test, lab_test_result, lab_test_result_range, medical_compliance, medication_country_detail, patient...", "module": "sql_service", "function": "_cache_schema", "line": 430}
{"timestamp": "2026-01-09T05:59:34.084413Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "SQL agent initialized successfully with 48 cached tables", "module": "sql_service", "function": "__init__", "line": 391}
{"timestamp": "2026-01-09T05:59:34.088709Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "AgentService initialized successfully", "module": "agent_service", "function": "__init__", "line": 212}
{"timestamp": "2026-01-09T05:59:34.088764Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=815d071e-b5da-43aa-8927-bcf2273cbf94): 'How many patients were screened by each health worker role?...'", "module": "agent_service", "function": "process_query", "line": 251}
{"timestamp": "2026-01-09T05:59:35.734276Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T05:59:36.466528Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Count the number of screened patients by each health worker role using the screener_role_name from v...'", "module": "sql_service", "function": "query", "line": 573}
{"timestamp": "2026-01-09T05:59:36.467958Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI Template Match: 'screener.*role|role.*screener|who.*screen' -> screening counts by screener role", "module": "sql_service", "function": "_check_dashboard_kpi", "line": 506}
{"timestamp": "2026-01-09T05:59:36.468151Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 Using pre-defined KPI template for: screening counts by screener role", "module": "sql_service", "function": "query", "line": 578}
{"timestamp": "2026-01-09T05:59:36.468296Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 589}
{"timestamp": "2026-01-09T05:59:36.468396Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI TEMPLATE EXECUTION (1 API call):", "module": "sql_service", "function": "_execute_kpi_template", "line": 590}
{"timestamp": "2026-01-09T05:59:36.468463Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 591}
{"timestamp": "2026-01-09T05:59:36.468559Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Template: screening counts by screener role", "module": "sql_service", "function": "_execute_kpi_template", "line": 592}
{"timestamp": "2026-01-09T05:59:36.468682Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL: SELECT \n            screener_role_name,\n            COUNT(DISTINCT patient_track_id) as patients_screened\n        FROM v_analytics_screening_enhanced \n        WHERE workflow_status = 'NCD' AND screene...", "module": "sql_service", "function": "_execute_kpi_template", "line": 593}
{"timestamp": "2026-01-09T05:59:36.504892Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query result: [('SHASTHYA KORMI', 2002), ('MEDICAL OFFICER', 1439), ('CHCP', 984), ('NURSE', 853), ('Unknown', 781), ('PROGRAM ORGANIZER', 448), ('PARA_COUNSELLOR', 128), ('FIELD ORGANIZER', 117), ('EMR_SPICE_QUICKSIGHT_ADMIN', 58), ('HRIO', 13), ('HEALTH_COACH', 10), ('LAB_TECHNICIAN', 7), ('NUTRITIONIST', 3), ('PHARMACIST', 1)]", "module": "sql_service", "function": "_execute_kpi_template", "line": 597}
{"timestamp": "2026-01-09T05:59:43.813832Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T05:59:43.825635Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 612}
{"timestamp": "2026-01-09T05:59:43.825739Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u2705 KPI template execution completed with 1 API call", "module": "sql_service", "function": "_execute_kpi_template", "line": 613}
{"timestamp": "2026-01-09T05:59:43.825797Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: In the context of the NCD (Non-Communicable Diseases) program, the screening counts by health worker role are as follows:\n\n- Shasthya Kormi screened 2,002 patients, indicating their significant involvement in the screening process.\n- Medical Officers screened 1,439 patients, highlighting their criti...", "module": "sql_service", "function": "_execute_kpi_template", "line": 614}
{"timestamp": "2026-01-09T05:59:43.825845Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 615}
{"timestamp": "2026-01-09T05:59:47.601384Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:00:13.114739Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=815d071e-b5da-43aa-8927-bcf2273cbf94, duration=39.03s)", "module": "agent_service", "function": "process_query", "line": 297}
{"timestamp": "2026-01-09T06:00:13.121361Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=59", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-09T06:00:13.121681Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=fb3098c7-de6b-491c-b3ac-c7646d3cd317): 'How many patients were screened by each health worker role?...'", "module": "agent_service", "function": "process_query", "line": 251}
{"timestamp": "2026-01-09T06:00:16.481110Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:00:17.768814Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Count the number of screened patients by each health worker role using the screener_role_name from v...'", "module": "sql_service", "function": "query", "line": 573}
{"timestamp": "2026-01-09T06:00:17.768902Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI Template Match: 'screener.*role|role.*screener|who.*screen' -> screening counts by screener role", "module": "sql_service", "function": "_check_dashboard_kpi", "line": 506}
{"timestamp": "2026-01-09T06:00:17.768939Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 Using pre-defined KPI template for: screening counts by screener role", "module": "sql_service", "function": "query", "line": 578}
{"timestamp": "2026-01-09T06:00:17.768974Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 589}
{"timestamp": "2026-01-09T06:00:17.769005Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI TEMPLATE EXECUTION (1 API call):", "module": "sql_service", "function": "_execute_kpi_template", "line": 590}
{"timestamp": "2026-01-09T06:00:17.769030Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 591}
{"timestamp": "2026-01-09T06:00:17.769056Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Template: screening counts by screener role", "module": "sql_service", "function": "_execute_kpi_template", "line": 592}
{"timestamp": "2026-01-09T06:00:17.769086Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL: SELECT \n            screener_role_name,\n            COUNT(DISTINCT patient_track_id) as patients_screened\n        FROM v_analytics_screening_enhanced \n        WHERE workflow_status = 'NCD' AND screene...", "module": "sql_service", "function": "_execute_kpi_template", "line": 593}
{"timestamp": "2026-01-09T06:00:17.793755Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query result: [('SHASTHYA KORMI', 2002), ('MEDICAL OFFICER', 1439), ('CHCP', 984), ('NURSE', 853), ('Unknown', 781), ('PROGRAM ORGANIZER', 448), ('PARA_COUNSELLOR', 128), ('FIELD ORGANIZER', 117), ('EMR_SPICE_QUICKSIGHT_ADMIN', 58), ('HRIO', 13), ('HEALTH_COACH', 10), ('LAB_TECHNICIAN', 7), ('NUTRITIONIST', 3), ('PHARMACIST', 1)]", "module": "sql_service", "function": "_execute_kpi_template", "line": 597}
{"timestamp": "2026-01-09T06:00:24.874307Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:00:24.875546Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 612}
{"timestamp": "2026-01-09T06:00:24.875608Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u2705 KPI template execution completed with 1 API call", "module": "sql_service", "function": "_execute_kpi_template", "line": 613}
{"timestamp": "2026-01-09T06:00:24.875657Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: In the context of the NCD (Non-Communicable Diseases) program, the screening counts by health worker role are as follows:\n\n- Shasthya Kormi screened 2,002 patients, indicating their significant involvement in the screening process.\n- Medical Officers screened 1,439 patients, highlighting their criti...", "module": "sql_service", "function": "_execute_kpi_template", "line": 614}
{"timestamp": "2026-01-09T06:00:24.875697Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 615}
{"timestamp": "2026-01-09T06:00:26.822909Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:00:35.906390Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=fb3098c7-de6b-491c-b3ac-c7646d3cd317, duration=22.78s)", "module": "agent_service", "function": "process_query", "line": 297}
{"timestamp": "2026-01-09T06:00:49.102841Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=34", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-09T06:00:49.102995Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=9318e670-655b-4f4e-8542-8f74dc778203): 'How many NCD patients are smokers?...'", "module": "agent_service", "function": "process_query", "line": 251}
{"timestamp": "2026-01-09T06:00:49.887104Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:00:50.846569Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Count the number of NCD patients who are smokers....'", "module": "sql_service", "function": "query", "line": 573}
{"timestamp": "2026-01-09T06:00:50.846675Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI Template Match: 'smoker|smoking.*patient' -> smoking status among NCD patients", "module": "sql_service", "function": "_check_dashboard_kpi", "line": 506}
{"timestamp": "2026-01-09T06:00:50.846725Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 Using pre-defined KPI template for: smoking status among NCD patients", "module": "sql_service", "function": "query", "line": 578}
{"timestamp": "2026-01-09T06:00:50.846767Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 589}
{"timestamp": "2026-01-09T06:00:50.846805Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI TEMPLATE EXECUTION (1 API call):", "module": "sql_service", "function": "_execute_kpi_template", "line": 590}
{"timestamp": "2026-01-09T06:00:50.846839Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 591}
{"timestamp": "2026-01-09T06:00:50.850919Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Template: smoking status among NCD patients", "module": "sql_service", "function": "_execute_kpi_template", "line": 592}
{"timestamp": "2026-01-09T06:00:50.850995Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL: SELECT \n            COUNT(DISTINCT CASE WHEN is_smoker = TRUE THEN patient_track_id END) as smokers,\n            COUNT(DISTINCT CASE WHEN is_smoker = FALSE OR is_smoker IS NULL THEN patient_track_id E...", "module": "sql_service", "function": "_execute_kpi_template", "line": 593}
{"timestamp": "2026-01-09T06:00:50.880926Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query result: [(0, 6786, Decimal('0.00'))]", "module": "sql_service", "function": "_execute_kpi_template", "line": 597}
{"timestamp": "2026-01-09T06:00:52.520507Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:00:52.562138Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 612}
{"timestamp": "2026-01-09T06:00:52.562261Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u2705 KPI template execution completed with 1 API call", "module": "sql_service", "function": "_execute_kpi_template", "line": 613}
{"timestamp": "2026-01-09T06:00:52.562313Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: In the NCD program, there are 0 patients identified as smokers out of a total of 6,786 patients. This results in a smoking rate of 0.00%. This indicates that none of the patients currently tracked in the program have been recorded as smokers, which could reflect effective smoking cessation efforts o...", "module": "sql_service", "function": "_execute_kpi_template", "line": 614}
{"timestamp": "2026-01-09T06:00:52.562362Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 615}
{"timestamp": "2026-01-09T06:00:53.106189Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:00:56.733648Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=9318e670-655b-4f4e-8542-8f74dc778203, duration=7.63s)", "module": "agent_service", "function": "process_query", "line": 297}
{"timestamp": "2026-01-09T06:01:24.264202Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=41", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-09T06:01:24.264332Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=257d1105-9573-4326-9ea1-156edb69be9b): 'Show glycemic control status distribution...'", "module": "agent_service", "function": "process_query", "line": 251}
{"timestamp": "2026-01-09T06:01:25.669855Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:01:26.352606Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Show the distribution of glycemic control status using the categories: 'Normal', 'Pre-Diabetic', 'Co...'", "module": "sql_service", "function": "query", "line": 573}
{"timestamp": "2026-01-09T06:01:26.352740Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI Template Match: 'glycemic.*control|hba1c.*control' -> glycemic control status distribution", "module": "sql_service", "function": "_check_dashboard_kpi", "line": 506}
{"timestamp": "2026-01-09T06:01:26.352788Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 Using pre-defined KPI template for: glycemic control status distribution", "module": "sql_service", "function": "query", "line": 578}
{"timestamp": "2026-01-09T06:01:26.352828Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 589}
{"timestamp": "2026-01-09T06:01:26.352865Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI TEMPLATE EXECUTION (1 API call):", "module": "sql_service", "function": "_execute_kpi_template", "line": 590}
{"timestamp": "2026-01-09T06:01:26.352899Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 591}
{"timestamp": "2026-01-09T06:01:26.352943Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Template: glycemic control status distribution", "module": "sql_service", "function": "_execute_kpi_template", "line": 592}
{"timestamp": "2026-01-09T06:01:26.352981Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL: SELECT \n            glycemic_control_status,\n            COUNT(DISTINCT patient_track_id) as patient_count\n        FROM v_analytics_enrollment_enhanced \n        WHERE patient_status = 'ENROLLED' AND w...", "module": "sql_service", "function": "_execute_kpi_template", "line": 593}
{"timestamp": "2026-01-09T06:01:26.373007Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query result: [('Very Poorly Controlled', 3), ('Controlled Diabetic', 2), ('Pre-Diabetic', 1), ('Normal', 2), ('Invalid Data', 8), ('No HbA1c Data', 1855)]", "module": "sql_service", "function": "_execute_kpi_template", "line": 597}
{"timestamp": "2026-01-09T06:01:30.660464Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:01:30.661695Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 612}
{"timestamp": "2026-01-09T06:01:30.661756Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u2705 KPI template execution completed with 1 API call", "module": "sql_service", "function": "_execute_kpi_template", "line": 613}
{"timestamp": "2026-01-09T06:01:30.661891Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: In the NCD program, the distribution of glycemic control status among enrolled patients is as follows: \n\n- 3 patients are classified as 'Very Poorly Controlled'.\n- 2 patients are 'Controlled Diabetic'.\n- 1 patient is 'Pre-Diabetic'.\n- 2 patients have a 'Normal' glycemic status.\n\nAdditionally, there ...", "module": "sql_service", "function": "_execute_kpi_template", "line": 614}
{"timestamp": "2026-01-09T06:01:30.661958Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 615}
{"timestamp": "2026-01-09T06:01:31.229900Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:01:35.716509Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=257d1105-9573-4326-9ea1-156edb69be9b, duration=11.45s)", "module": "agent_service", "function": "process_query", "line": 297}
{"timestamp": "2026-01-09T06:01:51.369583Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=43", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-09T06:01:51.369707Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=3a5b6238-826e-485c-8da4-1d2ddfd2e4e7): 'find critical risk patients who are smokers...'", "module": "agent_service", "function": "process_query", "line": 251}
{"timestamp": "2026-01-09T06:01:53.039914Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:01:53.357626Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Find patients with a critical risk category from v_high_risk_patients....'", "module": "sql_service", "function": "query", "line": 573}
{"timestamp": "2026-01-09T06:01:53.357882Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI Template Match: 'high.?risk.*patient|critical.*patient|risk.*(category|stratification)' -> high-risk patient distribution by category", "module": "sql_service", "function": "_check_dashboard_kpi", "line": 506}
{"timestamp": "2026-01-09T06:01:53.358005Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 Using pre-defined KPI template for: high-risk patient distribution by category", "module": "sql_service", "function": "query", "line": 578}
{"timestamp": "2026-01-09T06:01:53.358098Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 589}
{"timestamp": "2026-01-09T06:01:53.358172Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI TEMPLATE EXECUTION (1 API call):", "module": "sql_service", "function": "_execute_kpi_template", "line": 590}
{"timestamp": "2026-01-09T06:01:53.358239Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 591}
{"timestamp": "2026-01-09T06:01:53.358308Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Template: high-risk patient distribution by category", "module": "sql_service", "function": "_execute_kpi_template", "line": 592}
{"timestamp": "2026-01-09T06:01:53.358374Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL: SELECT risk_category, COUNT(DISTINCT patient_track_id) as count\n        FROM v_high_risk_patients \n        WHERE workflow_status = 'NCD'\n        GROUP BY risk_category\n        ORDER BY CASE risk_categ...", "module": "sql_service", "function": "_execute_kpi_template", "line": 593}
{"timestamp": "2026-01-09T06:01:53.398446Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query result: [('Critical', 166), ('High', 1279), ('Moderate', 1334), ('Low', 4007)]", "module": "sql_service", "function": "_execute_kpi_template", "line": 597}
{"timestamp": "2026-01-09T06:01:54.585958Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:01:54.588573Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 612}
{"timestamp": "2026-01-09T06:01:54.588723Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u2705 KPI template execution completed with 1 API call", "module": "sql_service", "function": "_execute_kpi_template", "line": 613}
{"timestamp": "2026-01-09T06:01:54.588827Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: In the context of the NCD (Non-Communicable Diseases) program, there are 166 patients identified as having a critical risk category. This indicates that these patients require immediate and intensive management due to their high likelihood of adverse health outcomes. The categorization helps priorit...", "module": "sql_service", "function": "_execute_kpi_template", "line": 614}
{"timestamp": "2026-01-09T06:01:54.588915Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 615}
{"timestamp": "2026-01-09T06:01:54.590074Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "\u26a1 Lazy loading vector store on first use...", "module": "agent_service", "function": "vector_store", "line": 218}
{"timestamp": "2026-01-09T06:01:54.590286Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Initializing vector store service", "module": "vector_store", "function": "__init__", "line": 30}
{"timestamp": "2026-01-09T06:01:54.591177Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Looking for RAG config at: /Users/adityanbhatt/fhir_rag/backend/config/embedding_config.yaml", "module": "vector_store", "function": "__init__", "line": 41}
{"timestamp": "2026-01-09T06:01:54.591535Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Loading RAG config from /Users/adityanbhatt/fhir_rag/backend/config/embedding_config.yaml", "module": "vector_store", "function": "__init__", "line": 46}
{"timestamp": "2026-01-09T06:01:54.598623Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Loaded RAG config successfully", "module": "vector_store", "function": "__init__", "line": 51}
{"timestamp": "2026-01-09T06:01:54.599094Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Resolved chroma_path to: /Users/adityanbhatt/fhir_rag/backend/data/indexes/chroma_db_advanced", "module": "retrieve", "function": "_resolve_config_paths", "line": 155}
{"timestamp": "2026-01-09T06:01:54.599236Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Resolved model_path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "retrieve", "function": "_resolve_config_paths", "line": 162}
{"timestamp": "2026-01-09T06:01:54.691902Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Loading docstore from /Users/adityanbhatt/fhir_rag/backend/data/indexes/chroma_db_advanced/parent_docstore.pkl with module remapping", "module": "retrieve", "function": "_load_docstore", "line": 284}
{"timestamp": "2026-01-09T06:01:55.201134Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Successfully loaded docstore with module remapping", "module": "retrieve", "function": "_load_docstore", "line": 286}
{"timestamp": "2026-01-09T06:01:55.202780Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Loading 154161 parent documents for BM25...", "module": "retrieve", "function": "_setup_retrievers", "line": 175}
{"timestamp": "2026-01-09T06:01:55.226120Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Filtered to 59572 documents from relevant tables for BM25 index.", "module": "retrieve", "function": "_setup_retrievers", "line": 185}
{"timestamp": "2026-01-09T06:01:56.034129Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "BM25Retriever initialized on relevant tables.", "module": "retrieve", "function": "_setup_retrievers", "line": 196}
{"timestamp": "2026-01-09T06:01:56.035169Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Initializing reranker: BAAI/bge-reranker-base", "module": "retrieve", "function": "__init__", "line": 137}
{"timestamp": "2026-01-09T06:01:58.592013Z", "level": "INFO", "logger": "sentence_transformers.cross_encoder.CrossEncoder", "message": "Use pytorch device: mps", "module": "CrossEncoder", "function": "__init__", "line": 222}
{"timestamp": "2026-01-09T06:01:59.497431Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Advanced RAG Retriever initialized successfully.", "module": "retrieve", "function": "__init__", "line": 143}
{"timestamp": "2026-01-09T06:01:59.498328Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Vector store initialized successfully", "module": "vector_store", "function": "__init__", "line": 55}
{"timestamp": "2026-01-09T06:01:59.498589Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "\u2705 Vector store loaded", "module": "agent_service", "function": "vector_store", "line": 220}
{"timestamp": "2026-01-09T06:01:59.498759Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Searching vector store for query: 'Find patients who are smokers....' (top_k=5)", "module": "vector_store", "function": "search", "line": 69}
{"timestamp": "2026-01-09T06:01:59.499384Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Executing query: Find patients who are smokers.", "module": "retrieve", "function": "_get_relevant_documents", "line": 223}
{"timestamp": "2026-01-09T06:02:02.335223Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Reranking 76 documents for query: 'Find patients who are smokers.'", "module": "retrieve", "function": "_get_relevant_documents", "line": 257}
{"timestamp": "2026-01-09T06:02:03.791681Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Returning 10 reranked documents.", "module": "retrieve", "function": "_get_relevant_documents", "line": 267}
{"timestamp": "2026-01-09T06:02:03.791871Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Retrieved 10 documents from vector store", "module": "vector_store", "function": "search", "line": 84}
{"timestamp": "2026-01-09T06:02:07.478852Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:02:18.689999Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=3a5b6238-826e-485c-8da4-1d2ddfd2e4e7, duration=27.32s)", "module": "agent_service", "function": "process_query", "line": 297}
{"timestamp": "2026-01-09T06:05:15.493259Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=69", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-09T06:05:15.493601Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=ea5afb74-1e89-48bf-85bd-df5d15576141): 'How does smoking prevalence compare across different risk categories?...'", "module": "agent_service", "function": "process_query", "line": 251}
{"timestamp": "2026-01-09T06:05:17.735889Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:05:19.216717Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Compare smoking prevalence across different risk categories using v_high_risk_patients and v_patient...'", "module": "sql_service", "function": "query", "line": 573}
{"timestamp": "2026-01-09T06:05:19.216985Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI Template Match: 'high.?risk.*patient|critical.*patient|risk.*(category|stratification)' -> high-risk patient distribution by category", "module": "sql_service", "function": "_check_dashboard_kpi", "line": 506}
{"timestamp": "2026-01-09T06:05:19.217099Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 Using pre-defined KPI template for: high-risk patient distribution by category", "module": "sql_service", "function": "query", "line": 578}
{"timestamp": "2026-01-09T06:05:19.217213Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 589}
{"timestamp": "2026-01-09T06:05:19.217284Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI TEMPLATE EXECUTION (1 API call):", "module": "sql_service", "function": "_execute_kpi_template", "line": 590}
{"timestamp": "2026-01-09T06:05:19.217356Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 591}
{"timestamp": "2026-01-09T06:05:19.217412Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Template: high-risk patient distribution by category", "module": "sql_service", "function": "_execute_kpi_template", "line": 592}
{"timestamp": "2026-01-09T06:05:19.217484Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL: SELECT risk_category, COUNT(DISTINCT patient_track_id) as count\n        FROM v_high_risk_patients \n        WHERE workflow_status = 'NCD'\n        GROUP BY risk_category\n        ORDER BY CASE risk_categ...", "module": "sql_service", "function": "_execute_kpi_template", "line": 593}
{"timestamp": "2026-01-09T06:05:19.266276Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query result: [('Critical', 166), ('High', 1279), ('Moderate', 1334), ('Low', 4007)]", "module": "sql_service", "function": "_execute_kpi_template", "line": 597}
{"timestamp": "2026-01-09T06:05:22.039777Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:05:22.044445Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 612}
{"timestamp": "2026-01-09T06:05:22.044753Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u2705 KPI template execution completed with 1 API call", "module": "sql_service", "function": "_execute_kpi_template", "line": 613}
{"timestamp": "2026-01-09T06:05:22.044873Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: In the NCD program context, the distribution of high-risk patients by risk category is as follows: there are 166 patients classified as 'Critical', 1,279 as 'High', 1,334 as 'Moderate', and 4,007 as 'Low'. This categorization helps prioritize patient management and resource allocation based on the s...", "module": "sql_service", "function": "_execute_kpi_template", "line": 614}
{"timestamp": "2026-01-09T06:05:22.045450Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 615}
{"timestamp": "2026-01-09T06:05:23.423072Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:05:28.207557Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Calculate smoking prevalence within each risk category using v_high_risk_patients and v_patient_life...'", "module": "sql_service", "function": "query", "line": 573}
{"timestamp": "2026-01-09T06:05:28.207709Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI Template Match: 'high.?risk.*patient|critical.*patient|risk.*(category|stratification)' -> high-risk patient distribution by category", "module": "sql_service", "function": "_check_dashboard_kpi", "line": 506}
{"timestamp": "2026-01-09T06:05:28.207766Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 Using pre-defined KPI template for: high-risk patient distribution by category", "module": "sql_service", "function": "query", "line": 578}
{"timestamp": "2026-01-09T06:05:28.207814Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 589}
{"timestamp": "2026-01-09T06:05:28.207856Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI TEMPLATE EXECUTION (1 API call):", "module": "sql_service", "function": "_execute_kpi_template", "line": 590}
{"timestamp": "2026-01-09T06:05:28.207897Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 591}
{"timestamp": "2026-01-09T06:05:28.207937Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Template: high-risk patient distribution by category", "module": "sql_service", "function": "_execute_kpi_template", "line": 592}
{"timestamp": "2026-01-09T06:05:28.207978Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL: SELECT risk_category, COUNT(DISTINCT patient_track_id) as count\n        FROM v_high_risk_patients \n        WHERE workflow_status = 'NCD'\n        GROUP BY risk_category\n        ORDER BY CASE risk_categ...", "module": "sql_service", "function": "_execute_kpi_template", "line": 593}
{"timestamp": "2026-01-09T06:05:28.247993Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query result: [('Critical', 166), ('High', 1279), ('Moderate', 1334), ('Low', 4007)]", "module": "sql_service", "function": "_execute_kpi_template", "line": 597}
{"timestamp": "2026-01-09T06:05:33.254266Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:05:33.259411Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 612}
{"timestamp": "2026-01-09T06:05:33.259455Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u2705 KPI template execution completed with 1 API call", "module": "sql_service", "function": "_execute_kpi_template", "line": 613}
{"timestamp": "2026-01-09T06:05:33.259569Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: The distribution of high-risk patients within the NCD (Non-Communicable Diseases) program is categorized as follows: 166 patients are classified as 'Critical', 1,279 as 'High', 1,334 as 'Moderate', and 4,007 as 'Low'. These numbers represent the count of distinct patients in each risk category based...", "module": "sql_service", "function": "_execute_kpi_template", "line": 614}
{"timestamp": "2026-01-09T06:05:33.259647Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 615}
{"timestamp": "2026-01-09T06:05:33.894717Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:05:37.474536Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Calculate the number and percentage of smokers in each risk category using v_high_risk_patients and ...'", "module": "sql_service", "function": "query", "line": 573}
{"timestamp": "2026-01-09T06:05:37.474621Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI Template Match: 'high.?risk.*patient|critical.*patient|risk.*(category|stratification)' -> high-risk patient distribution by category", "module": "sql_service", "function": "_check_dashboard_kpi", "line": 506}
{"timestamp": "2026-01-09T06:05:37.474663Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 Using pre-defined KPI template for: high-risk patient distribution by category", "module": "sql_service", "function": "query", "line": 578}
{"timestamp": "2026-01-09T06:05:37.474698Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 589}
{"timestamp": "2026-01-09T06:05:37.474733Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI TEMPLATE EXECUTION (1 API call):", "module": "sql_service", "function": "_execute_kpi_template", "line": 590}
{"timestamp": "2026-01-09T06:05:37.474765Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 591}
{"timestamp": "2026-01-09T06:05:37.474790Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Template: high-risk patient distribution by category", "module": "sql_service", "function": "_execute_kpi_template", "line": 592}
{"timestamp": "2026-01-09T06:05:37.474820Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL: SELECT risk_category, COUNT(DISTINCT patient_track_id) as count\n        FROM v_high_risk_patients \n        WHERE workflow_status = 'NCD'\n        GROUP BY risk_category\n        ORDER BY CASE risk_categ...", "module": "sql_service", "function": "_execute_kpi_template", "line": 593}
{"timestamp": "2026-01-09T06:05:37.513413Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query result: [('Critical', 166), ('High', 1279), ('Moderate', 1334), ('Low', 4007)]", "module": "sql_service", "function": "_execute_kpi_template", "line": 597}
{"timestamp": "2026-01-09T06:05:43.338155Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:05:43.340993Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 612}
{"timestamp": "2026-01-09T06:05:43.341160Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u2705 KPI template execution completed with 1 API call", "module": "sql_service", "function": "_execute_kpi_template", "line": 613}
{"timestamp": "2026-01-09T06:05:43.341334Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: In the context of the NCD (Non-Communicable Diseases) program, the distribution of high-risk patients by risk category is as follows:\n\n- **Critical Risk**: 166 patients\n- **High Risk**: 1,279 patients\n- **Moderate Risk**: 1,334 patients\n- **Low Risk**: 4,007 patients\n\nThese numbers represent the cou...", "module": "sql_service", "function": "_execute_kpi_template", "line": 614}
{"timestamp": "2026-01-09T06:05:43.341442Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 615}
{"timestamp": "2026-01-09T06:05:45.488161Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:05:49.755613Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Determine the number and percentage of smokers in each risk category by joining v_high_risk_patients...'", "module": "sql_service", "function": "query", "line": 573}
{"timestamp": "2026-01-09T06:05:49.756906Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI Template Match: 'high.?risk.*patient|critical.*patient|risk.*(category|stratification)' -> high-risk patient distribution by category", "module": "sql_service", "function": "_check_dashboard_kpi", "line": 506}
{"timestamp": "2026-01-09T06:05:49.757022Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 Using pre-defined KPI template for: high-risk patient distribution by category", "module": "sql_service", "function": "query", "line": 578}
{"timestamp": "2026-01-09T06:05:49.757108Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 589}
{"timestamp": "2026-01-09T06:05:49.757190Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI TEMPLATE EXECUTION (1 API call):", "module": "sql_service", "function": "_execute_kpi_template", "line": 590}
{"timestamp": "2026-01-09T06:05:49.757266Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 591}
{"timestamp": "2026-01-09T06:05:49.757332Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Template: high-risk patient distribution by category", "module": "sql_service", "function": "_execute_kpi_template", "line": 592}
{"timestamp": "2026-01-09T06:05:49.757401Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL: SELECT risk_category, COUNT(DISTINCT patient_track_id) as count\n        FROM v_high_risk_patients \n        WHERE workflow_status = 'NCD'\n        GROUP BY risk_category\n        ORDER BY CASE risk_categ...", "module": "sql_service", "function": "_execute_kpi_template", "line": 593}
{"timestamp": "2026-01-09T06:05:49.795133Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query result: [('Critical', 166), ('High', 1279), ('Moderate', 1334), ('Low', 4007)]", "module": "sql_service", "function": "_execute_kpi_template", "line": 597}
{"timestamp": "2026-01-09T06:05:54.704191Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:05:54.705300Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 612}
{"timestamp": "2026-01-09T06:05:54.705365Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u2705 KPI template execution completed with 1 API call", "module": "sql_service", "function": "_execute_kpi_template", "line": 613}
{"timestamp": "2026-01-09T06:05:54.705415Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: In the context of the NCD (Non-Communicable Diseases) program, the distribution of high-risk patients by category is as follows:\n\n- **Critical Risk**: 166 patients\n- **High Risk**: 1,279 patients\n- **Moderate Risk**: 1,334 patients\n- **Low Risk**: 4,007 patients\n\nTo determine the number and percenta...", "module": "sql_service", "function": "_execute_kpi_template", "line": 614}
{"timestamp": "2026-01-09T06:05:54.705455Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 615}
{"timestamp": "2026-01-09T06:05:55.278704Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:05:57.323182Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Calculate the number and percentage of smokers in each risk category using v_high_risk_patients and ...'", "module": "sql_service", "function": "query", "line": 573}
{"timestamp": "2026-01-09T06:05:57.323361Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI Template Match: 'high.?risk.*patient|critical.*patient|risk.*(category|stratification)' -> high-risk patient distribution by category", "module": "sql_service", "function": "_check_dashboard_kpi", "line": 506}
{"timestamp": "2026-01-09T06:05:57.323436Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 Using pre-defined KPI template for: high-risk patient distribution by category", "module": "sql_service", "function": "query", "line": 578}
{"timestamp": "2026-01-09T06:05:57.323521Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 589}
{"timestamp": "2026-01-09T06:05:57.323615Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI TEMPLATE EXECUTION (1 API call):", "module": "sql_service", "function": "_execute_kpi_template", "line": 590}
{"timestamp": "2026-01-09T06:05:57.323664Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 591}
{"timestamp": "2026-01-09T06:05:57.323706Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Template: high-risk patient distribution by category", "module": "sql_service", "function": "_execute_kpi_template", "line": 592}
{"timestamp": "2026-01-09T06:05:57.323753Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL: SELECT risk_category, COUNT(DISTINCT patient_track_id) as count\n        FROM v_high_risk_patients \n        WHERE workflow_status = 'NCD'\n        GROUP BY risk_category\n        ORDER BY CASE risk_categ...", "module": "sql_service", "function": "_execute_kpi_template", "line": 593}
{"timestamp": "2026-01-09T06:05:57.363053Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query result: [('Critical', 166), ('High', 1279), ('Moderate', 1334), ('Low', 4007)]", "module": "sql_service", "function": "_execute_kpi_template", "line": 597}
{"timestamp": "2026-01-09T06:06:43.993814Z", "level": "INFO", "logger": "app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-09T06:06:43.993856Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-09T06:06:43.993879Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-09T06:06:43.993949Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-09T06:06:44.009597Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-09T06:06:44.009644Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-09T06:06:45.491755Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-09T06:06:45.491805Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-09T06:06:45.491831Z", "level": "INFO", "logger": "app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-09T06:06:45.491850Z", "level": "INFO", "logger": "app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-09T06:06:46.764911Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=34", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-09T06:06:46.765113Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Initializing AgentService", "module": "agent_service", "function": "__init__", "line": 149}
{"timestamp": "2026-01-09T06:06:46.765185Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Connecting to database at postgresql://admin:admin@127.0.0.1:5432/Spice_BD", "module": "sql_service", "function": "__init__", "line": 336}
{"timestamp": "2026-01-09T06:06:47.148231Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Database connection established with view support", "module": "sql_service", "function": "__init__", "line": 364}
{"timestamp": "2026-01-09T06:06:47.306650Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Cached schema for 48 relevant tables out of 125 total", "module": "sql_service", "function": "_cache_schema", "line": 429}
{"timestamp": "2026-01-09T06:06:47.306711Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Relevant tables: bp_log, current_medication, diagnosis, glucose_log, lab_test, lab_test_result, lab_test_result_range, medical_compliance, medication_country_detail, patient...", "module": "sql_service", "function": "_cache_schema", "line": 430}
{"timestamp": "2026-01-09T06:06:47.417108Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "SQL agent initialized successfully with 48 cached tables", "module": "sql_service", "function": "__init__", "line": 391}
{"timestamp": "2026-01-09T06:06:47.421621Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "AgentService initialized successfully", "module": "agent_service", "function": "__init__", "line": 212}
{"timestamp": "2026-01-09T06:06:47.421672Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=231ca34b-0152-419c-9cf7-f1f9b38e26c7): 'How many NCD patients are smokers?...'", "module": "agent_service", "function": "process_query", "line": 251}
{"timestamp": "2026-01-09T06:06:48.264816Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:06:48.615553Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Count the number of NCD patients who are smokers....'", "module": "sql_service", "function": "query", "line": 573}
{"timestamp": "2026-01-09T06:06:48.615947Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI Template Match: 'smoker|smoking.*patient' -> smoking status among NCD patients", "module": "sql_service", "function": "_check_dashboard_kpi", "line": 506}
{"timestamp": "2026-01-09T06:06:48.616006Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 Using pre-defined KPI template for: smoking status among NCD patients", "module": "sql_service", "function": "query", "line": 578}
{"timestamp": "2026-01-09T06:06:48.616052Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 589}
{"timestamp": "2026-01-09T06:06:48.616089Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI TEMPLATE EXECUTION (1 API call):", "module": "sql_service", "function": "_execute_kpi_template", "line": 590}
{"timestamp": "2026-01-09T06:06:48.616145Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 591}
{"timestamp": "2026-01-09T06:06:48.616180Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Template: smoking status among NCD patients", "module": "sql_service", "function": "_execute_kpi_template", "line": 592}
{"timestamp": "2026-01-09T06:06:48.616215Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL: SELECT \n            COUNT(DISTINCT CASE WHEN is_smoker = TRUE THEN patient_track_id END) as smokers,\n            COUNT(DISTINCT CASE WHEN is_smoker = FALSE OR is_smoker IS NULL THEN patient_track_id E...", "module": "sql_service", "function": "_execute_kpi_template", "line": 593}
{"timestamp": "2026-01-09T06:06:48.645439Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query result: [(0, 6786, Decimal('0.00'))]", "module": "sql_service", "function": "_execute_kpi_template", "line": 597}
{"timestamp": "2026-01-09T06:06:51.336358Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:06:51.347211Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 612}
{"timestamp": "2026-01-09T06:06:51.347327Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u2705 KPI template execution completed with 1 API call", "module": "sql_service", "function": "_execute_kpi_template", "line": 613}
{"timestamp": "2026-01-09T06:06:51.347379Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: In the NCD program, there are currently 0 patients identified as smokers. Out of the total number of patients, 6,786 are either non-smokers or their smoking status is unknown. Consequently, the smoking rate among NCD patients is 0.00%. This indicates that none of the patients tracked in this dataset...", "module": "sql_service", "function": "_execute_kpi_template", "line": 614}
{"timestamp": "2026-01-09T06:06:51.347421Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 615}
{"timestamp": "2026-01-09T06:06:52.049424Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:06:53.725322Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=231ca34b-0152-419c-9cf7-f1f9b38e26c7, duration=6.30s)", "module": "agent_service", "function": "process_query", "line": 297}
{"timestamp": "2026-01-09T06:07:11.517603Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=44", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-09T06:07:11.517732Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=a3588412-f873-47f2-8b8a-145e54f9b6e1): 'How many patients are in each risk category?...'", "module": "agent_service", "function": "process_query", "line": 251}
{"timestamp": "2026-01-09T06:07:12.831945Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:07:13.374850Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Count the number of patients in each risk category from v_high_risk_patients....'", "module": "sql_service", "function": "query", "line": 573}
{"timestamp": "2026-01-09T06:07:13.374985Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI Template Match: 'high.?risk.*patient|critical.*patient|risk.*(category|stratification)' -> high-risk patient distribution by category", "module": "sql_service", "function": "_check_dashboard_kpi", "line": 506}
{"timestamp": "2026-01-09T06:07:13.375051Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 Using pre-defined KPI template for: high-risk patient distribution by category", "module": "sql_service", "function": "query", "line": 578}
{"timestamp": "2026-01-09T06:07:13.375099Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 589}
{"timestamp": "2026-01-09T06:07:13.375143Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI TEMPLATE EXECUTION (1 API call):", "module": "sql_service", "function": "_execute_kpi_template", "line": 590}
{"timestamp": "2026-01-09T06:07:13.375184Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 591}
{"timestamp": "2026-01-09T06:07:13.375225Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Template: high-risk patient distribution by category", "module": "sql_service", "function": "_execute_kpi_template", "line": 592}
{"timestamp": "2026-01-09T06:07:13.375267Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL: SELECT risk_category, COUNT(DISTINCT patient_track_id) as count\n        FROM v_high_risk_patients \n        WHERE workflow_status = 'NCD'\n        GROUP BY risk_category\n        ORDER BY CASE risk_categ...", "module": "sql_service", "function": "_execute_kpi_template", "line": 593}
{"timestamp": "2026-01-09T06:07:13.415748Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query result: [('Critical', 166), ('High', 1279), ('Moderate', 1334), ('Low', 4007)]", "module": "sql_service", "function": "_execute_kpi_template", "line": 597}
{"timestamp": "2026-01-09T06:07:15.337783Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:07:15.339000Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 612}
{"timestamp": "2026-01-09T06:07:15.339067Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u2705 KPI template execution completed with 1 API call", "module": "sql_service", "function": "_execute_kpi_template", "line": 613}
{"timestamp": "2026-01-09T06:07:15.339116Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: In the NCD program, the distribution of high-risk patients by category is as follows: there are 166 patients classified as 'Critical', 1,279 as 'High', 1,334 as 'Moderate', and 4,007 as 'Low'. These numbers represent the count of distinct patients in each risk category, indicating the level of atten...", "module": "sql_service", "function": "_execute_kpi_template", "line": 614}
{"timestamp": "2026-01-09T06:07:15.339158Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 615}
{"timestamp": "2026-01-09T06:07:15.879561Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:07:20.690429Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=a3588412-f873-47f2-8b8a-145e54f9b6e1, duration=9.17s)", "module": "agent_service", "function": "process_query", "line": 297}
{"timestamp": "2026-01-09T06:09:24.224560Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=58", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-09T06:09:24.224678Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=63471fa8-5556-476f-b6c3-e4fb8c58f090): 'What is the trend in risk category distribution over time?...'", "module": "agent_service", "function": "process_query", "line": 251}
{"timestamp": "2026-01-09T06:09:25.131645Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:09:25.763706Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Show the trend in risk category distribution over time using the v_high_risk_patients view....'", "module": "sql_service", "function": "query", "line": 573}
{"timestamp": "2026-01-09T06:09:25.763917Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI Template Match: 'high.?risk.*patient|critical.*patient|risk.*(category|stratification)' -> high-risk patient distribution by category", "module": "sql_service", "function": "_check_dashboard_kpi", "line": 506}
{"timestamp": "2026-01-09T06:09:25.763998Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 Using pre-defined KPI template for: high-risk patient distribution by category", "module": "sql_service", "function": "query", "line": 578}
{"timestamp": "2026-01-09T06:09:25.764066Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 589}
{"timestamp": "2026-01-09T06:09:25.764161Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI TEMPLATE EXECUTION (1 API call):", "module": "sql_service", "function": "_execute_kpi_template", "line": 590}
{"timestamp": "2026-01-09T06:09:25.764230Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 591}
{"timestamp": "2026-01-09T06:09:25.764280Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Template: high-risk patient distribution by category", "module": "sql_service", "function": "_execute_kpi_template", "line": 592}
{"timestamp": "2026-01-09T06:09:25.764325Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL: SELECT risk_category, COUNT(DISTINCT patient_track_id) as count\n        FROM v_high_risk_patients \n        WHERE workflow_status = 'NCD'\n        GROUP BY risk_category\n        ORDER BY CASE risk_categ...", "module": "sql_service", "function": "_execute_kpi_template", "line": 593}
{"timestamp": "2026-01-09T06:09:25.800640Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query result: [('Critical', 166), ('High', 1279), ('Moderate', 1334), ('Low', 4007)]", "module": "sql_service", "function": "_execute_kpi_template", "line": 597}
{"timestamp": "2026-01-09T06:09:31.178225Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:09:31.180709Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 612}
{"timestamp": "2026-01-09T06:09:31.180826Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u2705 KPI template execution completed with 1 API call", "module": "sql_service", "function": "_execute_kpi_template", "line": 613}
{"timestamp": "2026-01-09T06:09:31.180886Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: The current distribution of high-risk patients within the NCD (Non-Communicable Diseases) program is as follows: 166 patients are categorized as 'Critical', 1,279 as 'High', 1,334 as 'Moderate', and 4,007 as 'Low'. This distribution indicates that the majority of patients fall into the 'Low' risk ca...", "module": "sql_service", "function": "_execute_kpi_template", "line": 614}
{"timestamp": "2026-01-09T06:09:31.180933Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 615}
{"timestamp": "2026-01-09T06:09:31.708681Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:09:35.388844Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=63471fa8-5556-476f-b6c3-e4fb8c58f090, duration=11.16s)", "module": "agent_service", "function": "process_query", "line": 297}
{"timestamp": "2026-01-09T06:13:35.737784Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=34", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-09T06:13:35.738013Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=398f300c-7c25-4549-b086-0e616c1e6f4a): 'How many NCD patients are smokers?...'", "module": "agent_service", "function": "process_query", "line": 251}
{"timestamp": "2026-01-09T06:13:37.665475Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:13:38.245783Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Count the number of NCD patients who are smokers....'", "module": "sql_service", "function": "query", "line": 573}
{"timestamp": "2026-01-09T06:13:38.246062Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI Template Match: 'smoker|smoking.*patient' -> smoking status among NCD patients", "module": "sql_service", "function": "_check_dashboard_kpi", "line": 506}
{"timestamp": "2026-01-09T06:13:38.246209Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 Using pre-defined KPI template for: smoking status among NCD patients", "module": "sql_service", "function": "query", "line": 578}
{"timestamp": "2026-01-09T06:13:38.246325Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 589}
{"timestamp": "2026-01-09T06:13:38.246519Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI TEMPLATE EXECUTION (1 API call):", "module": "sql_service", "function": "_execute_kpi_template", "line": 590}
{"timestamp": "2026-01-09T06:13:38.246619Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 591}
{"timestamp": "2026-01-09T06:13:38.246703Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Template: smoking status among NCD patients", "module": "sql_service", "function": "_execute_kpi_template", "line": 592}
{"timestamp": "2026-01-09T06:13:38.246776Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL: SELECT \n            COUNT(DISTINCT CASE WHEN is_smoker = TRUE THEN patient_track_id END) as smokers,\n            COUNT(DISTINCT CASE WHEN is_smoker = FALSE OR is_smoker IS NULL THEN patient_track_id E...", "module": "sql_service", "function": "_execute_kpi_template", "line": 593}
{"timestamp": "2026-01-09T06:13:38.287106Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query result: [(690, 6096, Decimal('10.17'))]", "module": "sql_service", "function": "_execute_kpi_template", "line": 597}
{"timestamp": "2026-01-09T06:13:39.922990Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:13:39.925415Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 612}
{"timestamp": "2026-01-09T06:13:39.925565Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u2705 KPI template execution completed with 1 API call", "module": "sql_service", "function": "_execute_kpi_template", "line": 613}
{"timestamp": "2026-01-09T06:13:39.925665Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: In the context of the NCD (Non-Communicable Diseases) program, there are 690 patients identified as smokers. This represents 10.17% of the total NCD patient population, which includes both smokers and non-smokers. The remaining 6,096 patients are either non-smokers or have an unknown smoking status....", "module": "sql_service", "function": "_execute_kpi_template", "line": 614}
{"timestamp": "2026-01-09T06:13:39.925752Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 615}
{"timestamp": "2026-01-09T06:13:40.533474Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:13:46.049464Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=398f300c-7c25-4549-b086-0e616c1e6f4a, duration=10.31s)", "module": "agent_service", "function": "process_query", "line": 297}
{"timestamp": "2026-01-09T06:14:04.666028Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=52", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-09T06:14:04.666262Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=ef738795-1df0-4787-8a45-e7e0a0e78775): 'Find count of critical risk patients who are smokers...'", "module": "agent_service", "function": "process_query", "line": 251}
{"timestamp": "2026-01-09T06:14:05.416058Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:14:06.013219Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Count critical risk patients who are smokers using v_high_risk_patients and v_patient_lifestyle....'", "module": "sql_service", "function": "query", "line": 573}
{"timestamp": "2026-01-09T06:14:06.013459Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI Template Match: 'high.?risk.*patient|critical.*patient|risk.*(category|stratification)' -> high-risk patient distribution by category", "module": "sql_service", "function": "_check_dashboard_kpi", "line": 506}
{"timestamp": "2026-01-09T06:14:06.013556Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 Using pre-defined KPI template for: high-risk patient distribution by category", "module": "sql_service", "function": "query", "line": 578}
{"timestamp": "2026-01-09T06:14:06.013694Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 589}
{"timestamp": "2026-01-09T06:14:06.013898Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI TEMPLATE EXECUTION (1 API call):", "module": "sql_service", "function": "_execute_kpi_template", "line": 590}
{"timestamp": "2026-01-09T06:14:06.013986Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 591}
{"timestamp": "2026-01-09T06:14:06.014040Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Template: high-risk patient distribution by category", "module": "sql_service", "function": "_execute_kpi_template", "line": 592}
{"timestamp": "2026-01-09T06:14:06.014093Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL: SELECT risk_category, COUNT(DISTINCT patient_track_id) as count\n        FROM v_high_risk_patients \n        WHERE workflow_status = 'NCD'\n        GROUP BY risk_category\n        ORDER BY CASE risk_categ...", "module": "sql_service", "function": "_execute_kpi_template", "line": 593}
{"timestamp": "2026-01-09T06:14:06.062787Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query result: [('Critical', 166), ('High', 1279), ('Moderate', 1334), ('Low', 4007)]", "module": "sql_service", "function": "_execute_kpi_template", "line": 597}
{"timestamp": "2026-01-09T06:14:13.102534Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:14:13.104818Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 612}
{"timestamp": "2026-01-09T06:14:13.104945Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u2705 KPI template execution completed with 1 API call", "module": "sql_service", "function": "_execute_kpi_template", "line": 613}
{"timestamp": "2026-01-09T06:14:13.105037Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: In the context of the Non-Communicable Diseases (NCD) program, the distribution of high-risk patients by category is as follows: there are 166 patients classified as 'Critical', 1,279 as 'High', 1,334 as 'Moderate', and 4,007 as 'Low'. These numbers represent the count of distinct patients in each r...", "module": "sql_service", "function": "_execute_kpi_template", "line": 614}
{"timestamp": "2026-01-09T06:14:13.105106Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 615}
{"timestamp": "2026-01-09T06:14:14.029558Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:14:16.009685Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Count critical risk patients who are smokers using v_high_risk_patients and v_patient_lifestyle....'", "module": "sql_service", "function": "query", "line": 573}
{"timestamp": "2026-01-09T06:14:16.009894Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI Template Match: 'high.?risk.*patient|critical.*patient|risk.*(category|stratification)' -> high-risk patient distribution by category", "module": "sql_service", "function": "_check_dashboard_kpi", "line": 506}
{"timestamp": "2026-01-09T06:14:16.009987Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 Using pre-defined KPI template for: high-risk patient distribution by category", "module": "sql_service", "function": "query", "line": 578}
{"timestamp": "2026-01-09T06:14:16.010064Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 589}
{"timestamp": "2026-01-09T06:14:16.010128Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI TEMPLATE EXECUTION (1 API call):", "module": "sql_service", "function": "_execute_kpi_template", "line": 590}
{"timestamp": "2026-01-09T06:14:16.010186Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 591}
{"timestamp": "2026-01-09T06:14:16.010240Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Template: high-risk patient distribution by category", "module": "sql_service", "function": "_execute_kpi_template", "line": 592}
{"timestamp": "2026-01-09T06:14:16.010295Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL: SELECT risk_category, COUNT(DISTINCT patient_track_id) as count\n        FROM v_high_risk_patients \n        WHERE workflow_status = 'NCD'\n        GROUP BY risk_category\n        ORDER BY CASE risk_categ...", "module": "sql_service", "function": "_execute_kpi_template", "line": 593}
{"timestamp": "2026-01-09T06:14:16.057967Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query result: [('Critical', 166), ('High', 1279), ('Moderate', 1334), ('Low', 4007)]", "module": "sql_service", "function": "_execute_kpi_template", "line": 597}
{"timestamp": "2026-01-09T06:14:27.946218Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:14:27.949151Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 612}
{"timestamp": "2026-01-09T06:14:27.949362Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u2705 KPI template execution completed with 1 API call", "module": "sql_service", "function": "_execute_kpi_template", "line": 613}
{"timestamp": "2026-01-09T06:14:27.949478Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: In the context of the Non-Communicable Diseases (NCD) program, the distribution of high-risk patients by category is as follows: there are 166 patients classified as 'Critical', 1,279 as 'High', 1,334 as 'Moderate', and 4,007 as 'Low'. These numbers represent the count of distinct patients in each r...", "module": "sql_service", "function": "_execute_kpi_template", "line": 614}
{"timestamp": "2026-01-09T06:14:27.950045Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 615}
{"timestamp": "2026-01-09T06:14:28.620823Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:14:30.542124Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Count critical risk patients who are smokers by joining v_high_risk_patients and v_patient_lifestyle...'", "module": "sql_service", "function": "query", "line": 573}
{"timestamp": "2026-01-09T06:14:30.542314Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI Template Match: 'high.?risk.*patient|critical.*patient|risk.*(category|stratification)' -> high-risk patient distribution by category", "module": "sql_service", "function": "_check_dashboard_kpi", "line": 506}
{"timestamp": "2026-01-09T06:14:30.542405Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 Using pre-defined KPI template for: high-risk patient distribution by category", "module": "sql_service", "function": "query", "line": 578}
{"timestamp": "2026-01-09T06:14:30.542483Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 589}
{"timestamp": "2026-01-09T06:14:30.542554Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI TEMPLATE EXECUTION (1 API call):", "module": "sql_service", "function": "_execute_kpi_template", "line": 590}
{"timestamp": "2026-01-09T06:14:30.542621Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 591}
{"timestamp": "2026-01-09T06:14:30.542684Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Template: high-risk patient distribution by category", "module": "sql_service", "function": "_execute_kpi_template", "line": 592}
{"timestamp": "2026-01-09T06:14:30.542750Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL: SELECT risk_category, COUNT(DISTINCT patient_track_id) as count\n        FROM v_high_risk_patients \n        WHERE workflow_status = 'NCD'\n        GROUP BY risk_category\n        ORDER BY CASE risk_categ...", "module": "sql_service", "function": "_execute_kpi_template", "line": 593}
{"timestamp": "2026-01-09T06:14:30.590992Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query result: [('Critical', 166), ('High', 1279), ('Moderate', 1334), ('Low', 4007)]", "module": "sql_service", "function": "_execute_kpi_template", "line": 597}
{"timestamp": "2026-01-09T06:14:44.893332Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:14:44.896216Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 612}
{"timestamp": "2026-01-09T06:14:44.896383Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u2705 KPI template execution completed with 1 API call", "module": "sql_service", "function": "_execute_kpi_template", "line": 613}
{"timestamp": "2026-01-09T06:14:44.896538Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: In the context of the Non-Communicable Diseases (NCD) program, the distribution of high-risk patients by category is as follows: there are 166 patients classified as 'Critical', 1,279 as 'High', 1,334 as 'Moderate', and 4,007 as 'Low' risk. These numbers represent the count of distinct patients in e...", "module": "sql_service", "function": "_execute_kpi_template", "line": 614}
{"timestamp": "2026-01-09T06:14:44.896675Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 615}
{"timestamp": "2026-01-09T06:14:45.659643Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:14:47.288485Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Count critical risk patients who are smokers by joining v_high_risk_patients and v_patient_lifestyle...'", "module": "sql_service", "function": "query", "line": 573}
{"timestamp": "2026-01-09T06:14:47.289001Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI Template Match: 'high.?risk.*patient|critical.*patient|risk.*(category|stratification)' -> high-risk patient distribution by category", "module": "sql_service", "function": "_check_dashboard_kpi", "line": 506}
{"timestamp": "2026-01-09T06:14:47.289168Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 Using pre-defined KPI template for: high-risk patient distribution by category", "module": "sql_service", "function": "query", "line": 578}
{"timestamp": "2026-01-09T06:14:47.289255Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 589}
{"timestamp": "2026-01-09T06:14:47.289333Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI TEMPLATE EXECUTION (1 API call):", "module": "sql_service", "function": "_execute_kpi_template", "line": 590}
{"timestamp": "2026-01-09T06:14:47.289414Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 591}
{"timestamp": "2026-01-09T06:14:47.289479Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Template: high-risk patient distribution by category", "module": "sql_service", "function": "_execute_kpi_template", "line": 592}
{"timestamp": "2026-01-09T06:14:47.289603Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL: SELECT risk_category, COUNT(DISTINCT patient_track_id) as count\n        FROM v_high_risk_patients \n        WHERE workflow_status = 'NCD'\n        GROUP BY risk_category\n        ORDER BY CASE risk_categ...", "module": "sql_service", "function": "_execute_kpi_template", "line": 593}
{"timestamp": "2026-01-09T06:14:47.335625Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query result: [('Critical', 166), ('High', 1279), ('Moderate', 1334), ('Low', 4007)]", "module": "sql_service", "function": "_execute_kpi_template", "line": 597}
{"timestamp": "2026-01-09T06:14:54.262225Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:14:54.265785Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 612}
{"timestamp": "2026-01-09T06:14:54.266013Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u2705 KPI template execution completed with 1 API call", "module": "sql_service", "function": "_execute_kpi_template", "line": 613}
{"timestamp": "2026-01-09T06:14:54.266197Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: In the context of the Non-Communicable Diseases (NCD) program, the distribution of high-risk patients by risk category is as follows: there are 166 patients classified as 'Critical', 1,279 as 'High', 1,334 as 'Moderate', and 4,007 as 'Low'. These numbers represent the count of distinct patients in e...", "module": "sql_service", "function": "_execute_kpi_template", "line": 614}
{"timestamp": "2026-01-09T06:14:54.266325Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 615}
{"timestamp": "2026-01-09T06:14:54.983769Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:14:56.539308Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Count critical risk patients who are smokers by joining v_high_risk_patients and v_patient_lifestyle...'", "module": "sql_service", "function": "query", "line": 573}
{"timestamp": "2026-01-09T06:14:56.539557Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI Template Match: 'high.?risk.*patient|critical.*patient|risk.*(category|stratification)' -> high-risk patient distribution by category", "module": "sql_service", "function": "_check_dashboard_kpi", "line": 506}
{"timestamp": "2026-01-09T06:14:56.539685Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 Using pre-defined KPI template for: high-risk patient distribution by category", "module": "sql_service", "function": "query", "line": 578}
{"timestamp": "2026-01-09T06:14:56.539793Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 589}
{"timestamp": "2026-01-09T06:14:56.539876Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI TEMPLATE EXECUTION (1 API call):", "module": "sql_service", "function": "_execute_kpi_template", "line": 590}
{"timestamp": "2026-01-09T06:14:56.539940Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 591}
{"timestamp": "2026-01-09T06:14:56.539995Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Template: high-risk patient distribution by category", "module": "sql_service", "function": "_execute_kpi_template", "line": 592}
{"timestamp": "2026-01-09T06:14:56.540138Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL: SELECT risk_category, COUNT(DISTINCT patient_track_id) as count\n        FROM v_high_risk_patients \n        WHERE workflow_status = 'NCD'\n        GROUP BY risk_category\n        ORDER BY CASE risk_categ...", "module": "sql_service", "function": "_execute_kpi_template", "line": 593}
{"timestamp": "2026-01-09T06:14:56.586265Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query result: [('Critical', 166), ('High', 1279), ('Moderate', 1334), ('Low', 4007)]", "module": "sql_service", "function": "_execute_kpi_template", "line": 597}
{"timestamp": "2026-01-09T06:14:58.463832Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:14:58.466737Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 612}
{"timestamp": "2026-01-09T06:14:58.466887Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u2705 KPI template execution completed with 1 API call", "module": "sql_service", "function": "_execute_kpi_template", "line": 613}
{"timestamp": "2026-01-09T06:14:58.466980Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: In the context of the Non-Communicable Diseases (NCD) program, the distribution of high-risk patients by category is as follows: there are 166 patients classified as 'Critical', 1,279 as 'High', 1,334 as 'Moderate', and 4,007 as 'Low' risk. These numbers represent the count of distinct patients in e...", "module": "sql_service", "function": "_execute_kpi_template", "line": 614}
{"timestamp": "2026-01-09T06:14:58.467052Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 615}
{"timestamp": "2026-01-09T06:14:59.074593Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:15:00.124247Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Count critical risk patients who are smokers by joining v_high_risk_patients and v_patient_lifestyle...'", "module": "sql_service", "function": "query", "line": 573}
{"timestamp": "2026-01-09T06:15:00.124631Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI Template Match: 'high.?risk.*patient|critical.*patient|risk.*(category|stratification)' -> high-risk patient distribution by category", "module": "sql_service", "function": "_check_dashboard_kpi", "line": 506}
{"timestamp": "2026-01-09T06:15:00.124864Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 Using pre-defined KPI template for: high-risk patient distribution by category", "module": "sql_service", "function": "query", "line": 578}
{"timestamp": "2026-01-09T06:15:00.125087Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 589}
{"timestamp": "2026-01-09T06:15:00.125201Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI TEMPLATE EXECUTION (1 API call):", "module": "sql_service", "function": "_execute_kpi_template", "line": 590}
{"timestamp": "2026-01-09T06:15:00.125270Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 591}
{"timestamp": "2026-01-09T06:15:00.125370Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Template: high-risk patient distribution by category", "module": "sql_service", "function": "_execute_kpi_template", "line": 592}
{"timestamp": "2026-01-09T06:15:00.125476Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL: SELECT risk_category, COUNT(DISTINCT patient_track_id) as count\n        FROM v_high_risk_patients \n        WHERE workflow_status = 'NCD'\n        GROUP BY risk_category\n        ORDER BY CASE risk_categ...", "module": "sql_service", "function": "_execute_kpi_template", "line": 593}
{"timestamp": "2026-01-09T06:15:00.173155Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query result: [('Critical', 166), ('High', 1279), ('Moderate', 1334), ('Low', 4007)]", "module": "sql_service", "function": "_execute_kpi_template", "line": 597}
{"timestamp": "2026-01-09T06:15:05.066138Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:15:05.070671Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 612}
{"timestamp": "2026-01-09T06:15:05.070848Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u2705 KPI template execution completed with 1 API call", "module": "sql_service", "function": "_execute_kpi_template", "line": 613}
{"timestamp": "2026-01-09T06:15:05.071016Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: In the context of the Non-Communicable Diseases (NCD) program, the distribution of high-risk patients by category is as follows: there are 166 patients classified as 'Critical', 1,279 as 'High', 1,334 as 'Moderate', and 4,007 as 'Low' risk. These numbers represent the count of distinct patients in e...", "module": "sql_service", "function": "_execute_kpi_template", "line": 614}
{"timestamp": "2026-01-09T06:15:05.071191Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 615}
{"timestamp": "2026-01-09T06:15:05.669954Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:15:07.707454Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Count critical risk patients who are smokers by joining v_high_risk_patients and v_patient_lifestyle...'", "module": "sql_service", "function": "query", "line": 573}
{"timestamp": "2026-01-09T06:15:07.707593Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI Template Match: 'high.?risk.*patient|critical.*patient|risk.*(category|stratification)' -> high-risk patient distribution by category", "module": "sql_service", "function": "_check_dashboard_kpi", "line": 506}
{"timestamp": "2026-01-09T06:15:07.707650Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 Using pre-defined KPI template for: high-risk patient distribution by category", "module": "sql_service", "function": "query", "line": 578}
{"timestamp": "2026-01-09T06:15:07.707695Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 589}
{"timestamp": "2026-01-09T06:15:07.707737Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI TEMPLATE EXECUTION (1 API call):", "module": "sql_service", "function": "_execute_kpi_template", "line": 590}
{"timestamp": "2026-01-09T06:15:07.707777Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 591}
{"timestamp": "2026-01-09T06:15:07.707815Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Template: high-risk patient distribution by category", "module": "sql_service", "function": "_execute_kpi_template", "line": 592}
{"timestamp": "2026-01-09T06:15:07.707856Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL: SELECT risk_category, COUNT(DISTINCT patient_track_id) as count\n        FROM v_high_risk_patients \n        WHERE workflow_status = 'NCD'\n        GROUP BY risk_category\n        ORDER BY CASE risk_categ...", "module": "sql_service", "function": "_execute_kpi_template", "line": 593}
{"timestamp": "2026-01-09T06:15:07.754330Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query result: [('Critical', 166), ('High', 1279), ('Moderate', 1334), ('Low', 4007)]", "module": "sql_service", "function": "_execute_kpi_template", "line": 597}
{"timestamp": "2026-01-09T06:15:10.339633Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:15:10.342531Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 612}
{"timestamp": "2026-01-09T06:15:10.342685Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u2705 KPI template execution completed with 1 API call", "module": "sql_service", "function": "_execute_kpi_template", "line": 613}
{"timestamp": "2026-01-09T06:15:10.342798Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: In the NCD program, the distribution of high-risk patients by category is as follows: there are 166 patients classified as 'Critical', 1,279 as 'High', 1,334 as 'Moderate', and 4,007 as 'Low' risk. These numbers represent the count of distinct patients in each risk category based on their health ass...", "module": "sql_service", "function": "_execute_kpi_template", "line": 614}
{"timestamp": "2026-01-09T06:15:10.342879Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 615}
{"timestamp": "2026-01-09T06:15:10.951006Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:15:12.343520Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Count critical risk patients who are smokers by joining v_high_risk_patients and v_patient_lifestyle...'", "module": "sql_service", "function": "query", "line": 573}
{"timestamp": "2026-01-09T06:15:12.343781Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI Template Match: 'high.?risk.*patient|critical.*patient|risk.*(category|stratification)' -> high-risk patient distribution by category", "module": "sql_service", "function": "_check_dashboard_kpi", "line": 506}
{"timestamp": "2026-01-09T06:15:12.343948Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 Using pre-defined KPI template for: high-risk patient distribution by category", "module": "sql_service", "function": "query", "line": 578}
{"timestamp": "2026-01-09T06:15:12.344070Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 589}
{"timestamp": "2026-01-09T06:15:12.344147Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI TEMPLATE EXECUTION (1 API call):", "module": "sql_service", "function": "_execute_kpi_template", "line": 590}
{"timestamp": "2026-01-09T06:15:12.344211Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 591}
{"timestamp": "2026-01-09T06:15:12.344392Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Template: high-risk patient distribution by category", "module": "sql_service", "function": "_execute_kpi_template", "line": 592}
{"timestamp": "2026-01-09T06:15:12.344475Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL: SELECT risk_category, COUNT(DISTINCT patient_track_id) as count\n        FROM v_high_risk_patients \n        WHERE workflow_status = 'NCD'\n        GROUP BY risk_category\n        ORDER BY CASE risk_categ...", "module": "sql_service", "function": "_execute_kpi_template", "line": 593}
{"timestamp": "2026-01-09T06:15:12.390733Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query result: [('Critical', 166), ('High', 1279), ('Moderate', 1334), ('Low', 4007)]", "module": "sql_service", "function": "_execute_kpi_template", "line": 597}
{"timestamp": "2026-01-09T06:15:17.710136Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:15:17.711002Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 612}
{"timestamp": "2026-01-09T06:15:17.711059Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u2705 KPI template execution completed with 1 API call", "module": "sql_service", "function": "_execute_kpi_template", "line": 613}
{"timestamp": "2026-01-09T06:15:17.711106Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: In the context of the Non-Communicable Diseases (NCD) program, the distribution of high-risk patients by category is as follows: there are 166 patients classified as 'Critical', 1,279 as 'High', 1,334 as 'Moderate', and 4,007 as 'Low' risk. These numbers represent the count of distinct patients in e...", "module": "sql_service", "function": "_execute_kpi_template", "line": 614}
{"timestamp": "2026-01-09T06:15:17.711145Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 615}
{"timestamp": "2026-01-09T06:15:18.326986Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:15:20.500154Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Count critical risk patients who are smokers by joining v_high_risk_patients and v_patient_lifestyle...'", "module": "sql_service", "function": "query", "line": 573}
{"timestamp": "2026-01-09T06:15:20.500378Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI Template Match: 'high.?risk.*patient|critical.*patient|risk.*(category|stratification)' -> high-risk patient distribution by category", "module": "sql_service", "function": "_check_dashboard_kpi", "line": 506}
{"timestamp": "2026-01-09T06:15:20.500483Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 Using pre-defined KPI template for: high-risk patient distribution by category", "module": "sql_service", "function": "query", "line": 578}
{"timestamp": "2026-01-09T06:15:20.500568Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 589}
{"timestamp": "2026-01-09T06:15:20.500636Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI TEMPLATE EXECUTION (1 API call):", "module": "sql_service", "function": "_execute_kpi_template", "line": 590}
{"timestamp": "2026-01-09T06:15:20.500694Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 591}
{"timestamp": "2026-01-09T06:15:20.500746Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Template: high-risk patient distribution by category", "module": "sql_service", "function": "_execute_kpi_template", "line": 592}
{"timestamp": "2026-01-09T06:15:20.500798Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL: SELECT risk_category, COUNT(DISTINCT patient_track_id) as count\n        FROM v_high_risk_patients \n        WHERE workflow_status = 'NCD'\n        GROUP BY risk_category\n        ORDER BY CASE risk_categ...", "module": "sql_service", "function": "_execute_kpi_template", "line": 593}
{"timestamp": "2026-01-09T06:15:20.546284Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query result: [('Critical', 166), ('High', 1279), ('Moderate', 1334), ('Low', 4007)]", "module": "sql_service", "function": "_execute_kpi_template", "line": 597}
{"timestamp": "2026-01-09T06:15:23.651711Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:15:23.654071Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 612}
{"timestamp": "2026-01-09T06:15:23.654238Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u2705 KPI template execution completed with 1 API call", "module": "sql_service", "function": "_execute_kpi_template", "line": 613}
{"timestamp": "2026-01-09T06:15:23.654358Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: In the NCD program, the distribution of high-risk patients by category is as follows: there are 166 patients classified as 'Critical', 1,279 as 'High', 1,334 as 'Moderate', and 4,007 as 'Low' risk. These numbers represent the count of distinct patients in each risk category based on their health ass...", "module": "sql_service", "function": "_execute_kpi_template", "line": 614}
{"timestamp": "2026-01-09T06:15:23.654448Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 615}
{"timestamp": "2026-01-09T06:15:24.283166Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:15:25.424998Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Count critical risk patients who are smokers by joining v_high_risk_patients and v_patient_lifestyle...'", "module": "sql_service", "function": "query", "line": 573}
{"timestamp": "2026-01-09T06:15:25.425242Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI Template Match: 'high.?risk.*patient|critical.*patient|risk.*(category|stratification)' -> high-risk patient distribution by category", "module": "sql_service", "function": "_check_dashboard_kpi", "line": 506}
{"timestamp": "2026-01-09T06:15:25.425374Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 Using pre-defined KPI template for: high-risk patient distribution by category", "module": "sql_service", "function": "query", "line": 578}
{"timestamp": "2026-01-09T06:15:25.425479Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 589}
{"timestamp": "2026-01-09T06:15:25.425564Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI TEMPLATE EXECUTION (1 API call):", "module": "sql_service", "function": "_execute_kpi_template", "line": 590}
{"timestamp": "2026-01-09T06:15:25.425639Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 591}
{"timestamp": "2026-01-09T06:15:25.425709Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Template: high-risk patient distribution by category", "module": "sql_service", "function": "_execute_kpi_template", "line": 592}
{"timestamp": "2026-01-09T06:15:25.425773Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL: SELECT risk_category, COUNT(DISTINCT patient_track_id) as count\n        FROM v_high_risk_patients \n        WHERE workflow_status = 'NCD'\n        GROUP BY risk_category\n        ORDER BY CASE risk_categ...", "module": "sql_service", "function": "_execute_kpi_template", "line": 593}
{"timestamp": "2026-01-09T06:15:25.473836Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query result: [('Critical', 166), ('High', 1279), ('Moderate', 1334), ('Low', 4007)]", "module": "sql_service", "function": "_execute_kpi_template", "line": 597}
{"timestamp": "2026-01-09T06:15:29.106030Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:15:29.122726Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 612}
{"timestamp": "2026-01-09T06:15:29.122827Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u2705 KPI template execution completed with 1 API call", "module": "sql_service", "function": "_execute_kpi_template", "line": 613}
{"timestamp": "2026-01-09T06:15:29.122988Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: In the context of the NCD (Non-Communicable Diseases) program, the distribution of high-risk patients by category is as follows: there are 166 patients classified as 'Critical', 1,279 as 'High', 1,334 as 'Moderate', and 4,007 as 'Low' risk. These numbers represent the count of distinct patients in e...", "module": "sql_service", "function": "_execute_kpi_template", "line": 614}
{"timestamp": "2026-01-09T06:15:29.123062Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 615}
{"timestamp": "2026-01-09T06:15:29.695542Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:15:30.676767Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Count critical risk patients who are smokers by joining v_high_risk_patients and v_patient_lifestyle...'", "module": "sql_service", "function": "query", "line": 573}
{"timestamp": "2026-01-09T06:15:30.676907Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI Template Match: 'high.?risk.*patient|critical.*patient|risk.*(category|stratification)' -> high-risk patient distribution by category", "module": "sql_service", "function": "_check_dashboard_kpi", "line": 506}
{"timestamp": "2026-01-09T06:15:30.676958Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 Using pre-defined KPI template for: high-risk patient distribution by category", "module": "sql_service", "function": "query", "line": 578}
{"timestamp": "2026-01-09T06:15:30.677005Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 589}
{"timestamp": "2026-01-09T06:15:30.677221Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI TEMPLATE EXECUTION (1 API call):", "module": "sql_service", "function": "_execute_kpi_template", "line": 590}
{"timestamp": "2026-01-09T06:15:30.677287Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 591}
{"timestamp": "2026-01-09T06:15:30.677324Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Template: high-risk patient distribution by category", "module": "sql_service", "function": "_execute_kpi_template", "line": 592}
{"timestamp": "2026-01-09T06:15:30.677356Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL: SELECT risk_category, COUNT(DISTINCT patient_track_id) as count\n        FROM v_high_risk_patients \n        WHERE workflow_status = 'NCD'\n        GROUP BY risk_category\n        ORDER BY CASE risk_categ...", "module": "sql_service", "function": "_execute_kpi_template", "line": 593}
{"timestamp": "2026-01-09T06:15:30.712833Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query result: [('Critical', 166), ('High', 1279), ('Moderate', 1334), ('Low', 4007)]", "module": "sql_service", "function": "_execute_kpi_template", "line": 597}
{"timestamp": "2026-01-09T06:15:33.383421Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:15:33.386302Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 612}
{"timestamp": "2026-01-09T06:15:33.386465Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u2705 KPI template execution completed with 1 API call", "module": "sql_service", "function": "_execute_kpi_template", "line": 613}
{"timestamp": "2026-01-09T06:15:33.386571Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: In the context of the Non-Communicable Diseases (NCD) program, the distribution of high-risk patients by category is as follows: there are 166 patients classified as 'Critical', 1,279 as 'High', 1,334 as 'Moderate', and 4,007 as 'Low' risk. These numbers represent the count of distinct patients in e...", "module": "sql_service", "function": "_execute_kpi_template", "line": 614}
{"timestamp": "2026-01-09T06:15:33.386649Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 615}
{"timestamp": "2026-01-09T06:15:33.991566Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:15:35.039941Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Count critical risk patients who are smokers by joining v_high_risk_patients and v_patient_lifestyle...'", "module": "sql_service", "function": "query", "line": 573}
{"timestamp": "2026-01-09T06:15:35.040052Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI Template Match: 'high.?risk.*patient|critical.*patient|risk.*(category|stratification)' -> high-risk patient distribution by category", "module": "sql_service", "function": "_check_dashboard_kpi", "line": 506}
{"timestamp": "2026-01-09T06:15:35.040106Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 Using pre-defined KPI template for: high-risk patient distribution by category", "module": "sql_service", "function": "query", "line": 578}
{"timestamp": "2026-01-09T06:15:35.040151Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 589}
{"timestamp": "2026-01-09T06:15:35.040195Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI TEMPLATE EXECUTION (1 API call):", "module": "sql_service", "function": "_execute_kpi_template", "line": 590}
{"timestamp": "2026-01-09T06:15:35.040236Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 591}
{"timestamp": "2026-01-09T06:15:35.040276Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Template: high-risk patient distribution by category", "module": "sql_service", "function": "_execute_kpi_template", "line": 592}
{"timestamp": "2026-01-09T06:15:35.040318Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL: SELECT risk_category, COUNT(DISTINCT patient_track_id) as count\n        FROM v_high_risk_patients \n        WHERE workflow_status = 'NCD'\n        GROUP BY risk_category\n        ORDER BY CASE risk_categ...", "module": "sql_service", "function": "_execute_kpi_template", "line": 593}
{"timestamp": "2026-01-09T06:15:35.073049Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query result: [('Critical', 166), ('High', 1279), ('Moderate', 1334), ('Low', 4007)]", "module": "sql_service", "function": "_execute_kpi_template", "line": 597}
{"timestamp": "2026-01-09T06:15:37.577041Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:15:37.579653Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 612}
{"timestamp": "2026-01-09T06:15:37.579803Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u2705 KPI template execution completed with 1 API call", "module": "sql_service", "function": "_execute_kpi_template", "line": 613}
{"timestamp": "2026-01-09T06:15:37.579910Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: In the NCD program, the distribution of high-risk patients by category is as follows: there are 166 patients classified as 'Critical', 1,279 as 'High', 1,334 as 'Moderate', and 4,007 as 'Low' risk. These numbers represent the count of distinct patients in each risk category based on their health ass...", "module": "sql_service", "function": "_execute_kpi_template", "line": 614}
{"timestamp": "2026-01-09T06:15:37.579987Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 615}
{"timestamp": "2026-01-09T06:15:38.272514Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:15:39.129731Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Count critical risk patients who are smokers by joining v_high_risk_patients and v_patient_lifestyle...'", "module": "sql_service", "function": "query", "line": 573}
{"timestamp": "2026-01-09T06:15:39.129905Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI Template Match: 'high.?risk.*patient|critical.*patient|risk.*(category|stratification)' -> high-risk patient distribution by category", "module": "sql_service", "function": "_check_dashboard_kpi", "line": 506}
{"timestamp": "2026-01-09T06:15:39.129966Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 Using pre-defined KPI template for: high-risk patient distribution by category", "module": "sql_service", "function": "query", "line": 578}
{"timestamp": "2026-01-09T06:15:39.130018Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 589}
{"timestamp": "2026-01-09T06:15:39.130066Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI TEMPLATE EXECUTION (1 API call):", "module": "sql_service", "function": "_execute_kpi_template", "line": 590}
{"timestamp": "2026-01-09T06:15:39.130110Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 591}
{"timestamp": "2026-01-09T06:15:39.130155Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Template: high-risk patient distribution by category", "module": "sql_service", "function": "_execute_kpi_template", "line": 592}
{"timestamp": "2026-01-09T06:15:39.130204Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL: SELECT risk_category, COUNT(DISTINCT patient_track_id) as count\n        FROM v_high_risk_patients \n        WHERE workflow_status = 'NCD'\n        GROUP BY risk_category\n        ORDER BY CASE risk_categ...", "module": "sql_service", "function": "_execute_kpi_template", "line": 593}
{"timestamp": "2026-01-09T06:15:39.177113Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query result: [('Critical', 166), ('High', 1279), ('Moderate', 1334), ('Low', 4007)]", "module": "sql_service", "function": "_execute_kpi_template", "line": 597}
{"timestamp": "2026-01-09T06:15:41.161154Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:15:41.163459Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 612}
{"timestamp": "2026-01-09T06:15:41.163563Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u2705 KPI template execution completed with 1 API call", "module": "sql_service", "function": "_execute_kpi_template", "line": 613}
{"timestamp": "2026-01-09T06:15:41.163624Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: In the context of the Non-Communicable Diseases (NCD) program, the distribution of high-risk patients by category is as follows: there are 166 patients classified as 'Critical', 1,279 as 'High', 1,334 as 'Moderate', and 4,007 as 'Low' risk. These numbers represent the count of distinct patients in e...", "module": "sql_service", "function": "_execute_kpi_template", "line": 614}
{"timestamp": "2026-01-09T06:15:41.163685Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 615}
{"timestamp": "2026-01-09T06:15:41.876101Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:15:42.708518Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Count critical risk patients who are smokers by joining v_high_risk_patients and v_patient_lifestyle...'", "module": "sql_service", "function": "query", "line": 573}
{"timestamp": "2026-01-09T06:15:42.708717Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI Template Match: 'high.?risk.*patient|critical.*patient|risk.*(category|stratification)' -> high-risk patient distribution by category", "module": "sql_service", "function": "_check_dashboard_kpi", "line": 506}
{"timestamp": "2026-01-09T06:15:42.708818Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 Using pre-defined KPI template for: high-risk patient distribution by category", "module": "sql_service", "function": "query", "line": 578}
{"timestamp": "2026-01-09T06:15:42.708906Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 589}
{"timestamp": "2026-01-09T06:15:42.708973Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI TEMPLATE EXECUTION (1 API call):", "module": "sql_service", "function": "_execute_kpi_template", "line": 590}
{"timestamp": "2026-01-09T06:15:42.709031Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 591}
{"timestamp": "2026-01-09T06:15:42.709083Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Template: high-risk patient distribution by category", "module": "sql_service", "function": "_execute_kpi_template", "line": 592}
{"timestamp": "2026-01-09T06:15:42.709137Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL: SELECT risk_category, COUNT(DISTINCT patient_track_id) as count\n        FROM v_high_risk_patients \n        WHERE workflow_status = 'NCD'\n        GROUP BY risk_category\n        ORDER BY CASE risk_categ...", "module": "sql_service", "function": "_execute_kpi_template", "line": 593}
{"timestamp": "2026-01-09T06:15:42.757092Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query result: [('Critical', 166), ('High', 1279), ('Moderate', 1334), ('Low', 4007)]", "module": "sql_service", "function": "_execute_kpi_template", "line": 597}
{"timestamp": "2026-01-09T06:15:45.151337Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:15:45.152042Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 612}
{"timestamp": "2026-01-09T06:15:45.152094Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u2705 KPI template execution completed with 1 API call", "module": "sql_service", "function": "_execute_kpi_template", "line": 613}
{"timestamp": "2026-01-09T06:15:45.152131Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: In the context of the Non-Communicable Diseases (NCD) program, the distribution of high-risk patients by risk category is as follows: there are 166 patients classified as 'Critical', 1,279 as 'High', 1,334 as 'Moderate', and 4,007 as 'Low'. These numbers represent the count of distinct patients in e...", "module": "sql_service", "function": "_execute_kpi_template", "line": 614}
{"timestamp": "2026-01-09T06:15:45.152159Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 615}
{"timestamp": "2026-01-09T06:15:46.182664Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:15:46.818582Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Count critical risk patients who are smokers by joining v_high_risk_patients and v_patient_lifestyle...'", "module": "sql_service", "function": "query", "line": 573}
{"timestamp": "2026-01-09T06:15:46.818846Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI Template Match: 'high.?risk.*patient|critical.*patient|risk.*(category|stratification)' -> high-risk patient distribution by category", "module": "sql_service", "function": "_check_dashboard_kpi", "line": 506}
{"timestamp": "2026-01-09T06:15:46.818897Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 Using pre-defined KPI template for: high-risk patient distribution by category", "module": "sql_service", "function": "query", "line": 578}
{"timestamp": "2026-01-09T06:15:46.818939Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 589}
{"timestamp": "2026-01-09T06:15:46.818994Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI TEMPLATE EXECUTION (1 API call):", "module": "sql_service", "function": "_execute_kpi_template", "line": 590}
{"timestamp": "2026-01-09T06:15:46.819030Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 591}
{"timestamp": "2026-01-09T06:15:46.819064Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Template: high-risk patient distribution by category", "module": "sql_service", "function": "_execute_kpi_template", "line": 592}
{"timestamp": "2026-01-09T06:15:46.819100Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL: SELECT risk_category, COUNT(DISTINCT patient_track_id) as count\n        FROM v_high_risk_patients \n        WHERE workflow_status = 'NCD'\n        GROUP BY risk_category\n        ORDER BY CASE risk_categ...", "module": "sql_service", "function": "_execute_kpi_template", "line": 593}
{"timestamp": "2026-01-09T06:15:46.866216Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query result: [('Critical', 166), ('High', 1279), ('Moderate', 1334), ('Low', 4007)]", "module": "sql_service", "function": "_execute_kpi_template", "line": 597}
{"timestamp": "2026-01-09T06:15:48.941383Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:15:48.942356Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 612}
{"timestamp": "2026-01-09T06:15:48.942420Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u2705 KPI template execution completed with 1 API call", "module": "sql_service", "function": "_execute_kpi_template", "line": 613}
{"timestamp": "2026-01-09T06:15:48.942470Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: In the context of the Non-Communicable Diseases (NCD) program, the distribution of high-risk patients by category is as follows: there are 166 patients classified as 'Critical', 1,279 as 'High', 1,334 as 'Moderate', and 4,007 as 'Low' risk. These numbers represent the count of distinct patients in e...", "module": "sql_service", "function": "_execute_kpi_template", "line": 614}
{"timestamp": "2026-01-09T06:15:48.942577Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 615}
{"timestamp": "2026-01-09T06:15:48.942864Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=ef738795-1df0-4787-8a45-e7e0a0e78775, duration=104.28s)", "module": "agent_service", "function": "process_query", "line": 297}
{"timestamp": "2026-01-09T06:18:18.489275Z", "level": "INFO", "logger": "app", "message": "Shutting down application", "module": "app", "function": "lifespan", "line": 34}
{"timestamp": "2026-01-09T06:18:22.318324Z", "level": "INFO", "logger": "app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-09T06:18:22.318366Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-09T06:18:22.318389Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-09T06:18:22.318466Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-09T06:18:22.333004Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-09T06:18:22.333045Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-09T06:18:24.438499Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-09T06:18:24.438568Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-09T06:18:24.438618Z", "level": "INFO", "logger": "app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-09T06:18:24.438636Z", "level": "INFO", "logger": "app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-09T06:19:40.748181Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=34", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-09T06:19:40.748311Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Initializing AgentService", "module": "agent_service", "function": "__init__", "line": 149}
{"timestamp": "2026-01-09T06:19:40.748426Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Connecting to database at postgresql://admin:admin@127.0.0.1:5432/Spice_BD", "module": "sql_service", "function": "__init__", "line": 385}
{"timestamp": "2026-01-09T06:19:41.121211Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Database connection established with view support", "module": "sql_service", "function": "__init__", "line": 413}
{"timestamp": "2026-01-09T06:19:41.283130Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Cached schema for 48 relevant tables out of 125 total", "module": "sql_service", "function": "_cache_schema", "line": 478}
{"timestamp": "2026-01-09T06:19:41.283186Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Relevant tables: bp_log, current_medication, diagnosis, glucose_log, lab_test, lab_test_result, lab_test_result_range, medical_compliance, medication_country_detail, patient...", "module": "sql_service", "function": "_cache_schema", "line": 479}
{"timestamp": "2026-01-09T06:19:41.404550Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "SQL agent initialized successfully with 48 cached tables", "module": "sql_service", "function": "__init__", "line": 440}
{"timestamp": "2026-01-09T06:19:41.408972Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "AgentService initialized successfully", "module": "agent_service", "function": "__init__", "line": 212}
{"timestamp": "2026-01-09T06:19:41.409027Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=d50e62d5-7203-4203-8686-ede7190f18ec): 'Show smoking rate by risk category...'", "module": "agent_service", "function": "process_query", "line": 251}
{"timestamp": "2026-01-09T06:19:42.212316Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:19:42.713698Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Show the smoking rate by risk category using the v_high_risk_patients and v_patient_lifestyle tables...'", "module": "sql_service", "function": "query", "line": 622}
{"timestamp": "2026-01-09T06:19:42.714257Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI Template Match: '(critical|high).?risk.*smok|smok.*(critical|high).?risk' -> high-risk patients by smoking status", "module": "sql_service", "function": "_check_dashboard_kpi", "line": 555}
{"timestamp": "2026-01-09T06:19:42.714365Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 Using pre-defined KPI template for: high-risk patients by smoking status", "module": "sql_service", "function": "query", "line": 627}
{"timestamp": "2026-01-09T06:19:42.714464Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 638}
{"timestamp": "2026-01-09T06:19:42.714540Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI TEMPLATE EXECUTION (1 API call):", "module": "sql_service", "function": "_execute_kpi_template", "line": 639}
{"timestamp": "2026-01-09T06:19:42.714594Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 640}
{"timestamp": "2026-01-09T06:19:42.714645Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Template: high-risk patients by smoking status", "module": "sql_service", "function": "_execute_kpi_template", "line": 641}
{"timestamp": "2026-01-09T06:19:42.714695Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL: SELECT \n            risk_category,\n            COUNT(DISTINCT CASE WHEN is_smoker = TRUE THEN patient_track_id END) as smokers,\n            COUNT(DISTINCT CASE WHEN is_smoker = FALSE OR is_smoker IS N...", "module": "sql_service", "function": "_execute_kpi_template", "line": 642}
{"timestamp": "2026-01-09T06:19:42.763727Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query result: [('Critical', 14, 152, 166), ('High', 53, 1226, 1279), ('Moderate', 164, 1170, 1334), ('Low', 459, 3548, 4007)]", "module": "sql_service", "function": "_execute_kpi_template", "line": 646}
{"timestamp": "2026-01-09T06:19:46.189574Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:19:46.204318Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 661}
{"timestamp": "2026-01-09T06:19:46.204420Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u2705 KPI template execution completed with 1 API call", "module": "sql_service", "function": "_execute_kpi_template", "line": 662}
{"timestamp": "2026-01-09T06:19:46.204482Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: In the NCD program, the distribution of high-risk patients by smoking status is as follows:\n\n- **Critical Risk Category**: Out of 166 patients, 14 are smokers, representing approximately 8.4% of this group.\n- **High Risk Category**: Out of 1,279 patients, 53 are smokers, which is about 4.1%.\n- **Mod...", "module": "sql_service", "function": "_execute_kpi_template", "line": 663}
{"timestamp": "2026-01-09T06:19:46.204533Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 664}
{"timestamp": "2026-01-09T06:19:46.926878Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:19:52.810904Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=d50e62d5-7203-4203-8686-ede7190f18ec, duration=11.40s)", "module": "agent_service", "function": "process_query", "line": 297}
{"timestamp": "2026-01-09T06:20:00.480482Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=43", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-09T06:20:00.480894Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=9cc93bbd-465b-47d9-a703-cf99677c4579): 'Find critical risk patients who are smokers...'", "module": "agent_service", "function": "process_query", "line": 251}
{"timestamp": "2026-01-09T06:20:02.793798Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:20:02.808030Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Find critical risk patients from v_high_risk_patients...'", "module": "sql_service", "function": "query", "line": 622}
{"timestamp": "2026-01-09T06:20:02.808679Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI Template Match: 'high.?risk.*patient|critical.*patient|risk.*(category|stratification)' -> high-risk patient distribution by category", "module": "sql_service", "function": "_check_dashboard_kpi", "line": 555}
{"timestamp": "2026-01-09T06:20:02.808735Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 Using pre-defined KPI template for: high-risk patient distribution by category", "module": "sql_service", "function": "query", "line": 627}
{"timestamp": "2026-01-09T06:20:02.808778Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 638}
{"timestamp": "2026-01-09T06:20:02.808815Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI TEMPLATE EXECUTION (1 API call):", "module": "sql_service", "function": "_execute_kpi_template", "line": 639}
{"timestamp": "2026-01-09T06:20:02.808850Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 640}
{"timestamp": "2026-01-09T06:20:02.808884Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Template: high-risk patient distribution by category", "module": "sql_service", "function": "_execute_kpi_template", "line": 641}
{"timestamp": "2026-01-09T06:20:02.808920Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL: SELECT risk_category, COUNT(DISTINCT patient_track_id) as count\n        FROM v_high_risk_patients \n        WHERE workflow_status = 'NCD'\n        GROUP BY risk_category\n        ORDER BY CASE risk_categ...", "module": "sql_service", "function": "_execute_kpi_template", "line": 642}
{"timestamp": "2026-01-09T06:20:02.856404Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query result: [('Critical', 166), ('High', 1279), ('Moderate', 1334), ('Low', 4007)]", "module": "sql_service", "function": "_execute_kpi_template", "line": 646}
{"timestamp": "2026-01-09T06:20:04.839079Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:20:04.842080Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 661}
{"timestamp": "2026-01-09T06:20:04.842297Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u2705 KPI template execution completed with 1 API call", "module": "sql_service", "function": "_execute_kpi_template", "line": 662}
{"timestamp": "2026-01-09T06:20:04.842484Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: In the context of the NCD (Non-Communicable Diseases) program, there are 166 patients categorized as \"Critical\" risk. This indicates that these patients require the most urgent attention and intervention due to their high-risk status. The distribution of high-risk patients also includes 1,279 in the...", "module": "sql_service", "function": "_execute_kpi_template", "line": 663}
{"timestamp": "2026-01-09T06:20:04.842653Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 664}
{"timestamp": "2026-01-09T06:20:04.843858Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "\u26a1 Lazy loading vector store on first use...", "module": "agent_service", "function": "vector_store", "line": 218}
{"timestamp": "2026-01-09T06:20:04.844012Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Initializing vector store service", "module": "vector_store", "function": "__init__", "line": 30}
{"timestamp": "2026-01-09T06:20:04.844713Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Looking for RAG config at: /Users/adityanbhatt/fhir_rag/backend/config/embedding_config.yaml", "module": "vector_store", "function": "__init__", "line": 41}
{"timestamp": "2026-01-09T06:20:04.844816Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Loading RAG config from /Users/adityanbhatt/fhir_rag/backend/config/embedding_config.yaml", "module": "vector_store", "function": "__init__", "line": 46}
{"timestamp": "2026-01-09T06:20:04.853078Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Loaded RAG config successfully", "module": "vector_store", "function": "__init__", "line": 51}
{"timestamp": "2026-01-09T06:20:04.853633Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Resolved chroma_path to: /Users/adityanbhatt/fhir_rag/backend/data/indexes/chroma_db_advanced", "module": "retrieve", "function": "_resolve_config_paths", "line": 155}
{"timestamp": "2026-01-09T06:20:04.853782Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Resolved model_path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "retrieve", "function": "_resolve_config_paths", "line": 162}
{"timestamp": "2026-01-09T06:20:04.935037Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Loading docstore from /Users/adityanbhatt/fhir_rag/backend/data/indexes/chroma_db_advanced/parent_docstore.pkl with module remapping", "module": "retrieve", "function": "_load_docstore", "line": 284}
{"timestamp": "2026-01-09T06:20:05.431607Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Successfully loaded docstore with module remapping", "module": "retrieve", "function": "_load_docstore", "line": 286}
{"timestamp": "2026-01-09T06:20:05.433084Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Loading 154161 parent documents for BM25...", "module": "retrieve", "function": "_setup_retrievers", "line": 175}
{"timestamp": "2026-01-09T06:20:05.455906Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Filtered to 59572 documents from relevant tables for BM25 index.", "module": "retrieve", "function": "_setup_retrievers", "line": 185}
{"timestamp": "2026-01-09T06:20:06.267243Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "BM25Retriever initialized on relevant tables.", "module": "retrieve", "function": "_setup_retrievers", "line": 196}
{"timestamp": "2026-01-09T06:20:06.268222Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Initializing reranker: BAAI/bge-reranker-base", "module": "retrieve", "function": "__init__", "line": 137}
{"timestamp": "2026-01-09T06:20:08.459363Z", "level": "INFO", "logger": "sentence_transformers.cross_encoder.CrossEncoder", "message": "Use pytorch device: mps", "module": "CrossEncoder", "function": "__init__", "line": 222}
{"timestamp": "2026-01-09T06:20:09.561490Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Advanced RAG Retriever initialized successfully.", "module": "retrieve", "function": "__init__", "line": 143}
{"timestamp": "2026-01-09T06:20:09.561727Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Vector store initialized successfully", "module": "vector_store", "function": "__init__", "line": 55}
{"timestamp": "2026-01-09T06:20:09.561873Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "\u2705 Vector store loaded", "module": "agent_service", "function": "vector_store", "line": 220}
{"timestamp": "2026-01-09T06:20:09.561980Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Searching vector store for query: 'Find patients who are smokers...' (top_k=5)", "module": "vector_store", "function": "search", "line": 69}
{"timestamp": "2026-01-09T06:20:09.562719Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Executing query: Find patients who are smokers", "module": "retrieve", "function": "_get_relevant_documents", "line": 223}
{"timestamp": "2026-01-09T06:20:12.504441Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Reranking 61 documents for query: 'Find patients who are smokers'", "module": "retrieve", "function": "_get_relevant_documents", "line": 257}
{"timestamp": "2026-01-09T06:20:13.777286Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Returning 10 reranked documents.", "module": "retrieve", "function": "_get_relevant_documents", "line": 267}
{"timestamp": "2026-01-09T06:20:13.777510Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Retrieved 10 documents from vector store", "module": "vector_store", "function": "search", "line": 84}
{"timestamp": "2026-01-09T06:20:14.468066Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:20:20.872026Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=9cc93bbd-465b-47d9-a703-cf99677c4579, duration=20.39s)", "module": "agent_service", "function": "process_query", "line": 297}
{"timestamp": "2026-01-09T06:21:38.672669Z", "level": "INFO", "logger": "app", "message": "Shutting down application", "module": "app", "function": "lifespan", "line": 34}
{"timestamp": "2026-01-09T06:21:43.268419Z", "level": "INFO", "logger": "app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-09T06:21:43.268459Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-09T06:21:43.268480Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-09T06:21:43.268555Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-09T06:21:43.284741Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-09T06:21:43.284782Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-09T06:21:44.924643Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-09T06:21:44.924698Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-09T06:21:44.924724Z", "level": "INFO", "logger": "app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-09T06:21:44.924742Z", "level": "INFO", "logger": "app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-09T06:22:21.703846Z", "level": "INFO", "logger": "app", "message": "Shutting down application", "module": "app", "function": "lifespan", "line": 34}
{"timestamp": "2026-01-09T06:22:24.638454Z", "level": "INFO", "logger": "app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-09T06:22:24.638496Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-09T06:22:24.638520Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-09T06:22:24.638604Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-09T06:22:24.652072Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-09T06:22:24.652122Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-09T06:22:25.332275Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-09T06:22:25.332338Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-09T06:22:25.332363Z", "level": "INFO", "logger": "app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-09T06:22:25.332386Z", "level": "INFO", "logger": "app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-09T06:22:26.847158Z", "level": "INFO", "logger": "app", "message": "Shutting down application", "module": "app", "function": "lifespan", "line": 34}
{"timestamp": "2026-01-09T06:22:29.615313Z", "level": "INFO", "logger": "app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-09T06:22:29.615364Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-09T06:22:29.615389Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-09T06:22:29.615479Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-09T06:22:29.631791Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-09T06:22:29.631838Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-09T06:22:30.327998Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-09T06:22:30.328059Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-09T06:22:30.328084Z", "level": "INFO", "logger": "app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-09T06:22:30.328107Z", "level": "INFO", "logger": "app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-09T06:22:32.999339Z", "level": "INFO", "logger": "app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-09T06:22:32.999385Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-09T06:22:32.999412Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-09T06:22:32.999498Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-09T06:22:33.012634Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-09T06:22:33.012680Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-09T06:22:33.670047Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-09T06:22:33.670109Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-09T06:22:33.670135Z", "level": "INFO", "logger": "app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-09T06:22:33.670159Z", "level": "INFO", "logger": "app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-09T06:23:11.637839Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=41", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-09T06:23:11.637976Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Initializing AgentService", "module": "agent_service", "function": "__init__", "line": 149}
{"timestamp": "2026-01-09T06:23:11.638048Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Connecting to database at postgresql://admin:admin@127.0.0.1:5432/Spice_BD", "module": "sql_service", "function": "__init__", "line": 385}
{"timestamp": "2026-01-09T06:23:12.036539Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Database connection established with view support", "module": "sql_service", "function": "__init__", "line": 413}
{"timestamp": "2026-01-09T06:23:12.199057Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Cached schema for 48 relevant tables out of 125 total", "module": "sql_service", "function": "_cache_schema", "line": 478}
{"timestamp": "2026-01-09T06:23:12.199143Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Relevant tables: bp_log, current_medication, diagnosis, glucose_log, lab_test, lab_test_result, lab_test_result_range, medical_compliance, medication_country_detail, patient...", "module": "sql_service", "function": "_cache_schema", "line": 479}
{"timestamp": "2026-01-09T06:23:12.316391Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "SQL agent initialized successfully with 48 cached tables", "module": "sql_service", "function": "__init__", "line": 440}
{"timestamp": "2026-01-09T06:23:12.320822Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "AgentService initialized successfully", "module": "agent_service", "function": "__init__", "line": 212}
{"timestamp": "2026-01-09T06:23:12.320873Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=8dc46467-59ad-443a-ba18-0a0e90a193a8): 'Show high-risk patients by smoking status...'", "module": "agent_service", "function": "process_query", "line": 251}
{"timestamp": "2026-01-09T06:23:12.320977Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI Template Match: '(critical|high).?risk.*smok|smok.*(critical|high).?risk' -> high-risk patients by smoking status", "module": "sql_service", "function": "_check_dashboard_kpi", "line": 555}
{"timestamp": "2026-01-09T06:23:12.320999Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "\u26a1 FAST PATH: KPI template matched on original query: high-risk patients by smoking status", "module": "agent_service", "function": "process_query", "line": 261}
{"timestamp": "2026-01-09T06:23:12.321020Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 638}
{"timestamp": "2026-01-09T06:23:12.321036Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI TEMPLATE EXECUTION (1 API call):", "module": "sql_service", "function": "_execute_kpi_template", "line": 639}
{"timestamp": "2026-01-09T06:23:12.321052Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 640}
{"timestamp": "2026-01-09T06:23:12.321067Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Template: high-risk patients by smoking status", "module": "sql_service", "function": "_execute_kpi_template", "line": 641}
{"timestamp": "2026-01-09T06:23:12.321083Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL: SELECT \n            risk_category,\n            COUNT(DISTINCT CASE WHEN is_smoker = TRUE THEN patient_track_id END) as smokers,\n            COUNT(DISTINCT CASE WHEN is_smoker = FALSE OR is_smoker IS N...", "module": "sql_service", "function": "_execute_kpi_template", "line": 642}
{"timestamp": "2026-01-09T06:23:12.355871Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query result: [('Critical', 14, 152, 166), ('High', 53, 1226, 1279), ('Moderate', 164, 1170, 1334), ('Low', 459, 3548, 4007)]", "module": "sql_service", "function": "_execute_kpi_template", "line": 646}
{"timestamp": "2026-01-09T06:23:15.313882Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:23:15.332299Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 661}
{"timestamp": "2026-01-09T06:23:15.332357Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u2705 KPI template execution completed with 1 API call", "module": "sql_service", "function": "_execute_kpi_template", "line": 662}
{"timestamp": "2026-01-09T06:23:15.332389Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: In the NCD program, high-risk patients are categorized by their risk levels and smoking status. The data shows the following:\n\n- **Critical Risk**: There are 166 patients, with 14 identified as smokers and 152 as non-smokers.\n- **High Risk**: Out of 1,279 patients, 53 are smokers and 1,226 are non-s...", "module": "sql_service", "function": "_execute_kpi_template", "line": 663}
{"timestamp": "2026-01-09T06:23:15.332414Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 664}
{"timestamp": "2026-01-09T06:23:15.332547Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "\u2705 KPI fast-path completed (trace_id=8dc46467-59ad-443a-ba18-0a0e90a193a8, duration=3.01s)", "module": "agent_service", "function": "process_query", "line": 291}
{"timestamp": "2026-01-09T06:25:02.782969Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=87", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-09T06:25:02.783180Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=688b59c6-e5bc-4d2d-b32c-b607daa26233): 'Based on the CVD risk scoring criteria, how many patients fall into each risk category?...'", "module": "agent_service", "function": "process_query", "line": 251}
{"timestamp": "2026-01-09T06:25:02.783814Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI Template Match: 'high.?risk.*patient|critical.*patient|risk.*(category|stratification)' -> high-risk patient distribution by category", "module": "sql_service", "function": "_check_dashboard_kpi", "line": 555}
{"timestamp": "2026-01-09T06:25:02.783868Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "\u26a1 FAST PATH: KPI template matched on original query: high-risk patient distribution by category", "module": "agent_service", "function": "process_query", "line": 261}
{"timestamp": "2026-01-09T06:25:02.783979Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 638}
{"timestamp": "2026-01-09T06:25:02.784060Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI TEMPLATE EXECUTION (1 API call):", "module": "sql_service", "function": "_execute_kpi_template", "line": 639}
{"timestamp": "2026-01-09T06:25:02.784118Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 640}
{"timestamp": "2026-01-09T06:25:02.784171Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Template: high-risk patient distribution by category", "module": "sql_service", "function": "_execute_kpi_template", "line": 641}
{"timestamp": "2026-01-09T06:25:02.784232Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL: SELECT risk_category, COUNT(DISTINCT patient_track_id) as count\n        FROM v_high_risk_patients \n        WHERE workflow_status = 'NCD'\n        GROUP BY risk_category\n        ORDER BY CASE risk_categ...", "module": "sql_service", "function": "_execute_kpi_template", "line": 642}
{"timestamp": "2026-01-09T06:25:02.826061Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query result: [('Critical', 166), ('High', 1279), ('Moderate', 1334), ('Low', 4007)]", "module": "sql_service", "function": "_execute_kpi_template", "line": 646}
{"timestamp": "2026-01-09T06:25:06.514681Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:25:06.518833Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 661}
{"timestamp": "2026-01-09T06:25:06.518983Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u2705 KPI template execution completed with 1 API call", "module": "sql_service", "function": "_execute_kpi_template", "line": 662}
{"timestamp": "2026-01-09T06:25:06.519104Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: Based on the CVD risk scoring criteria within the NCD program, the distribution of high-risk patients is as follows: 166 patients are categorized as 'Critical', 1,279 as 'High', 1,334 as 'Moderate', and 4,007 as 'Low'. These numbers represent the count of distinct patients in each risk category, ind...", "module": "sql_service", "function": "_execute_kpi_template", "line": 663}
{"timestamp": "2026-01-09T06:25:06.519312Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 664}
{"timestamp": "2026-01-09T06:25:06.519625Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "\u2705 KPI fast-path completed (trace_id=688b59c6-e5bc-4d2d-b32c-b607daa26233, duration=3.74s)", "module": "agent_service", "function": "process_query", "line": 291}
{"timestamp": "2026-01-09T06:26:35.048073Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login attempt for user: admin", "module": "auth", "function": "login", "line": 27}
{"timestamp": "2026-01-09T06:26:35.048819Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login successful for user: admin", "module": "auth", "function": "login", "line": 50}
{"timestamp": "2026-01-09T06:26:38.021030Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=61", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-09T06:26:38.021265Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=a2830cab-6175-428a-8df7-0ba5f2a34cfe): 'How is blood pressure recorded in FHIR Observation resources?...'", "module": "agent_service", "function": "process_query", "line": 251}
{"timestamp": "2026-01-09T06:26:38.681040Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:26:47.079081Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=a2830cab-6175-428a-8df7-0ba5f2a34cfe, duration=9.06s)", "module": "agent_service", "function": "process_query", "line": 341}
{"timestamp": "2026-01-09T06:27:08.821134Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=107", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-09T06:27:08.821342Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=eb052a68-68a3-4b17-9a0b-17cb31a599a1): 'According to the NCD guidelines, which patients have uncontrolled diabetes and what are their HbA1c ...'", "module": "agent_service", "function": "process_query", "line": 251}
{"timestamp": "2026-01-09T06:27:10.021412Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:27:10.159185Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'List patients with uncontrolled diabetes and their HbA1c values according to the NCD guidelines....'", "module": "sql_service", "function": "query", "line": 622}
{"timestamp": "2026-01-09T06:27:10.159557Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udd0d Analyzing natural language query", "module": "sql_service", "function": "_is_simple_query", "line": 572}
{"timestamp": "2026-01-09T06:27:10.161342Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query classified as COMPLEX (pattern=False, complexity=False, multi_table=False)", "module": "sql_service", "function": "_is_simple_query", "line": 617}
{"timestamp": "2026-01-09T06:27:10.161466Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Complex query detected - using full agent", "module": "sql_service", "function": "query", "line": 634}
{"timestamp": "2026-01-09T06:27:10.161545Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 781}
{"timestamp": "2026-01-09T06:27:10.161610Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL AGENT EXECUTION TRACE:", "module": "sql_service", "function": "_execute_with_agent", "line": 782}
{"timestamp": "2026-01-09T06:27:10.161664Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 783}
{"timestamp": "2026-01-09T06:27:10.975240Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:27:12.582089Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:27:15.044382Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:27:20.979944Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:27:22.945308Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:27:24.974881Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:27:28.738125Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:27:30.827982Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:27:33.482702Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:27:33.932165Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 806}
{"timestamp": "2026-01-09T06:27:33.932453Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL query completed. Result length: 36 chars", "module": "sql_service", "function": "_execute_with_agent", "line": 807}
{"timestamp": "2026-01-09T06:27:33.932609Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: Agent stopped due to max iterations....", "module": "sql_service", "function": "_execute_with_agent", "line": 809}
{"timestamp": "2026-01-09T06:27:33.932778Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 810}
{"timestamp": "2026-01-09T06:27:34.601775Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:27:35.543852Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'List patients with uncontrolled diabetes and their HbA1c values according to the NCD guidelines....'", "module": "sql_service", "function": "query", "line": 622}
{"timestamp": "2026-01-09T06:27:35.544185Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udd0d Analyzing natural language query", "module": "sql_service", "function": "_is_simple_query", "line": 572}
{"timestamp": "2026-01-09T06:27:35.544385Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query classified as COMPLEX (pattern=False, complexity=False, multi_table=False)", "module": "sql_service", "function": "_is_simple_query", "line": 617}
{"timestamp": "2026-01-09T06:27:35.544476Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Complex query detected - using full agent", "module": "sql_service", "function": "query", "line": 634}
{"timestamp": "2026-01-09T06:27:35.544543Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 781}
{"timestamp": "2026-01-09T06:27:35.544603Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL AGENT EXECUTION TRACE:", "module": "sql_service", "function": "_execute_with_agent", "line": 782}
{"timestamp": "2026-01-09T06:27:35.544659Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 783}
{"timestamp": "2026-01-09T06:27:36.444613Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:27:37.062349Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:27:38.397504Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:27:40.951461Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:27:41.871718Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:27:43.996487Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:27:45.933649Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:27:46.281479Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 429 Too Many Requests\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:27:46.282507Z", "level": "INFO", "logger": "openai._base_client", "message": "Retrying request to /chat/completions in 2.206000 seconds", "module": "_base_client", "function": "_sleep_for_retry", "line": 1071}
{"timestamp": "2026-01-09T06:27:49.245663Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:27:49.652687Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 429 Too Many Requests\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:27:49.653110Z", "level": "INFO", "logger": "openai._base_client", "message": "Retrying request to /chat/completions in 0.192000 seconds", "module": "_base_client", "function": "_sleep_for_retry", "line": 1071}
{"timestamp": "2026-01-09T06:27:50.158712Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 429 Too Many Requests\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:27:50.159609Z", "level": "INFO", "logger": "openai._base_client", "message": "Retrying request to /chat/completions in 6.244000 seconds", "module": "_base_client", "function": "_sleep_for_retry", "line": 1071}
{"timestamp": "2026-01-09T06:27:56.762641Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 429 Too Many Requests\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:27:56.771890Z", "level": "ERROR", "logger": "backend.services.sql_service", "message": " SQL query failed: Error code: 429 - {'error': {'message': 'Rate limit reached for gpt-4o in organization org-lIshM8Wztmovd0NtwBOdGn9Y on tokens per min (TPM): Limit 30000, Used 27088, Requested 3901. Please try again in 1.978s. Visit https://platform.openai.com/account/rate-limits to learn more.', 'type': 'tokens', 'param': None, 'code': 'rate_limit_exceeded'}}", "module": "sql_service", "function": "_execute_with_agent", "line": 815, "exception": "Traceback (most recent call last):\n  File \"/Users/adityanbhatt/fhir_rag/backend/services/sql_service.py\", line 786, in _execute_with_agent\n    result = self.sql_agent.invoke({\"input\": question})\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain/chains/base.py\", line 165, in invoke\n    self._call(inputs, run_manager=run_manager)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain/agents/agent.py\", line 1625, in _call\n    next_step_output = self._take_next_step(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain/agents/agent.py\", line 1325, in _take_next_step\n    list(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain/agents/agent.py\", line 1352, in _iter_next_step\n    output = self._action_agent.plan(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain/agents/agent.py\", line 573, in plan\n    for chunk in self.runnable.stream(inputs, config={\"callbacks\": callbacks}):\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_core/runnables/base.py\", line 3650, in stream\n    yield from self.transform(iter([input]), config, **kwargs)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_core/runnables/base.py\", line 3636, in transform\n    yield from self._transform_stream_with_config(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_core/runnables/base.py\", line 2372, in _transform_stream_with_config\n    chunk: Output = context.run(next, iterator)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_core/runnables/base.py\", line 3595, in _transform\n    yield from final_pipeline\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_core/runnables/base.py\", line 1571, in transform\n    for ichunk in input:\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_core/runnables/base.py\", line 5927, in transform\n    yield from self.bound.transform(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_core/runnables/base.py\", line 1589, in transform\n    yield from self.stream(final, config, **kwargs)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_core/language_models/chat_models.py\", line 522, in stream\n    for chunk in self._stream(input_messages, stop=stop, **kwargs):\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_openai/chat_models/base.py\", line 1123, in _stream\n    response = self.client.create(**payload)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/openai/_utils/_utils.py\", line 286, in wrapper\n    return func(*args, **kwargs)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/openai/resources/chat/completions/completions.py\", line 1156, in create\n    return self._post(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/openai/_base_client.py\", line 1259, in post\n    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/openai/_base_client.py\", line 1047, in request\n    raise self._make_status_error_from_response(err.response) from None\nopenai.RateLimitError: Error code: 429 - {'error': {'message': 'Rate limit reached for gpt-4o in organization org-lIshM8Wztmovd0NtwBOdGn9Y on tokens per min (TPM): Limit 30000, Used 27088, Requested 3901. Please try again in 1.978s. Visit https://platform.openai.com/account/rate-limits to learn more.', 'type': 'tokens', 'param': None, 'code': 'rate_limit_exceeded'}}"}
{"timestamp": "2026-01-09T06:27:56.773482Z", "level": "ERROR", "logger": "backend.services.agent_service", "message": "Query processing failed (trace_id=eb052a68-68a3-4b17-9a0b-17cb31a599a1): Error code: 429 - {'error': {'message': 'Rate limit reached for gpt-4o in organization org-lIshM8Wztmovd0NtwBOdGn9Y on tokens per min (TPM): Limit 30000, Used 27088, Requested 3901. Please try again in 1.978s. Visit https://platform.openai.com/account/rate-limits to learn more.', 'type': 'tokens', 'param': None, 'code': 'rate_limit_exceeded'}}", "module": "agent_service", "function": "process_query", "line": 346, "exception": "Traceback (most recent call last):\n  File \"/Users/adityanbhatt/fhir_rag/backend/services/agent_service.py\", line 299, in process_query\n    result = self.agent_executor.invoke({\"input\": query})\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain/chains/base.py\", line 165, in invoke\n    self._call(inputs, run_manager=run_manager)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain/agents/agent.py\", line 1625, in _call\n    next_step_output = self._take_next_step(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain/agents/agent.py\", line 1325, in _take_next_step\n    list(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain/agents/agent.py\", line 1408, in _iter_next_step\n    yield self._perform_agent_action(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain/agents/agent.py\", line 1433, in _perform_agent_action\n    observation = tool.run(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_core/tools/base.py\", line 895, in run\n    raise error_to_raise\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_core/tools/base.py\", line 864, in run\n    response = context.run(self._run, *tool_args, **tool_kwargs)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_core/tools/simple.py\", line 123, in _run\n    return self.func(*args, **kwargs)\n  File \"/Users/adityanbhatt/fhir_rag/backend/services/sql_service.py\", line 635, in query\n    return self._execute_with_agent(question)\n  File \"/Users/adityanbhatt/fhir_rag/backend/services/sql_service.py\", line 786, in _execute_with_agent\n    result = self.sql_agent.invoke({\"input\": question})\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain/chains/base.py\", line 165, in invoke\n    self._call(inputs, run_manager=run_manager)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain/agents/agent.py\", line 1625, in _call\n    next_step_output = self._take_next_step(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain/agents/agent.py\", line 1325, in _take_next_step\n    list(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain/agents/agent.py\", line 1352, in _iter_next_step\n    output = self._action_agent.plan(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain/agents/agent.py\", line 573, in plan\n    for chunk in self.runnable.stream(inputs, config={\"callbacks\": callbacks}):\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_core/runnables/base.py\", line 3650, in stream\n    yield from self.transform(iter([input]), config, **kwargs)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_core/runnables/base.py\", line 3636, in transform\n    yield from self._transform_stream_with_config(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_core/runnables/base.py\", line 2372, in _transform_stream_with_config\n    chunk: Output = context.run(next, iterator)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_core/runnables/base.py\", line 3595, in _transform\n    yield from final_pipeline\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_core/runnables/base.py\", line 1571, in transform\n    for ichunk in input:\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_core/runnables/base.py\", line 5927, in transform\n    yield from self.bound.transform(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_core/runnables/base.py\", line 1589, in transform\n    yield from self.stream(final, config, **kwargs)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_core/language_models/chat_models.py\", line 522, in stream\n    for chunk in self._stream(input_messages, stop=stop, **kwargs):\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_openai/chat_models/base.py\", line 1123, in _stream\n    response = self.client.create(**payload)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/openai/_utils/_utils.py\", line 286, in wrapper\n    return func(*args, **kwargs)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/openai/resources/chat/completions/completions.py\", line 1156, in create\n    return self._post(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/openai/_base_client.py\", line 1259, in post\n    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/openai/_base_client.py\", line 1047, in request\n    raise self._make_status_error_from_response(err.response) from None\nopenai.RateLimitError: Error code: 429 - {'error': {'message': 'Rate limit reached for gpt-4o in organization org-lIshM8Wztmovd0NtwBOdGn9Y on tokens per min (TPM): Limit 30000, Used 27088, Requested 3901. Please try again in 1.978s. Visit https://platform.openai.com/account/rate-limits to learn more.', 'type': 'tokens', 'param': None, 'code': 'rate_limit_exceeded'}}"}
{"timestamp": "2026-01-09T06:27:56.774130Z", "level": "ERROR", "logger": "backend.api.routes.chat", "message": "Chat request failed for user=admin: Error code: 429 - {'error': {'message': 'Rate limit reached for gpt-4o in organization org-lIshM8Wztmovd0NtwBOdGn9Y on tokens per min (TPM): Limit 30000, Used 27088, Requested 3901. Please try again in 1.978s. Visit https://platform.openai.com/account/rate-limits to learn more.', 'type': 'tokens', 'param': None, 'code': 'rate_limit_exceeded'}}", "module": "chat", "function": "chat", "line": 51, "exception": "Traceback (most recent call last):\n  File \"/Users/adityanbhatt/fhir_rag/backend/api/routes/chat.py\", line 43, in chat\n    result = await agent_service.process_query(\n  File \"/Users/adityanbhatt/fhir_rag/backend/services/agent_service.py\", line 299, in process_query\n    result = self.agent_executor.invoke({\"input\": query})\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain/chains/base.py\", line 165, in invoke\n    self._call(inputs, run_manager=run_manager)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain/agents/agent.py\", line 1625, in _call\n    next_step_output = self._take_next_step(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain/agents/agent.py\", line 1325, in _take_next_step\n    list(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain/agents/agent.py\", line 1408, in _iter_next_step\n    yield self._perform_agent_action(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain/agents/agent.py\", line 1433, in _perform_agent_action\n    observation = tool.run(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_core/tools/base.py\", line 895, in run\n    raise error_to_raise\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_core/tools/base.py\", line 864, in run\n    response = context.run(self._run, *tool_args, **tool_kwargs)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_core/tools/simple.py\", line 123, in _run\n    return self.func(*args, **kwargs)\n  File \"/Users/adityanbhatt/fhir_rag/backend/services/sql_service.py\", line 635, in query\n    return self._execute_with_agent(question)\n  File \"/Users/adityanbhatt/fhir_rag/backend/services/sql_service.py\", line 786, in _execute_with_agent\n    result = self.sql_agent.invoke({\"input\": question})\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain/chains/base.py\", line 165, in invoke\n    self._call(inputs, run_manager=run_manager)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain/agents/agent.py\", line 1625, in _call\n    next_step_output = self._take_next_step(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain/agents/agent.py\", line 1325, in _take_next_step\n    list(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain/agents/agent.py\", line 1352, in _iter_next_step\n    output = self._action_agent.plan(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain/agents/agent.py\", line 573, in plan\n    for chunk in self.runnable.stream(inputs, config={\"callbacks\": callbacks}):\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_core/runnables/base.py\", line 3650, in stream\n    yield from self.transform(iter([input]), config, **kwargs)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_core/runnables/base.py\", line 3636, in transform\n    yield from self._transform_stream_with_config(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_core/runnables/base.py\", line 2372, in _transform_stream_with_config\n    chunk: Output = context.run(next, iterator)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_core/runnables/base.py\", line 3595, in _transform\n    yield from final_pipeline\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_core/runnables/base.py\", line 1571, in transform\n    for ichunk in input:\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_core/runnables/base.py\", line 5927, in transform\n    yield from self.bound.transform(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_core/runnables/base.py\", line 1589, in transform\n    yield from self.stream(final, config, **kwargs)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_core/language_models/chat_models.py\", line 522, in stream\n    for chunk in self._stream(input_messages, stop=stop, **kwargs):\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_openai/chat_models/base.py\", line 1123, in _stream\n    response = self.client.create(**payload)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/openai/_utils/_utils.py\", line 286, in wrapper\n    return func(*args, **kwargs)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/openai/resources/chat/completions/completions.py\", line 1156, in create\n    return self._post(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/openai/_base_client.py\", line 1259, in post\n    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/openai/_base_client.py\", line 1047, in request\n    raise self._make_status_error_from_response(err.response) from None\nopenai.RateLimitError: Error code: 429 - {'error': {'message': 'Rate limit reached for gpt-4o in organization org-lIshM8Wztmovd0NtwBOdGn9Y on tokens per min (TPM): Limit 30000, Used 27088, Requested 3901. Please try again in 1.978s. Visit https://platform.openai.com/account/rate-limits to learn more.', 'type': 'tokens', 'param': None, 'code': 'rate_limit_exceeded'}}", "user_id": "admin"}
{"timestamp": "2026-01-09T06:28:34.886017Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=52", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-09T06:28:34.886181Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=d565cb14-35da-4023-bdcd-f98b8340ecb0): '\"Find patients with poor medication adherence notes\"...'", "module": "agent_service", "function": "process_query", "line": 251}
{"timestamp": "2026-01-09T06:28:35.641318Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:28:35.792737Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "\u26a1 Lazy loading vector store on first use...", "module": "agent_service", "function": "vector_store", "line": 218}
{"timestamp": "2026-01-09T06:28:35.792983Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Initializing vector store service", "module": "vector_store", "function": "__init__", "line": 30}
{"timestamp": "2026-01-09T06:28:35.793525Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Looking for RAG config at: /Users/adityanbhatt/fhir_rag/backend/config/embedding_config.yaml", "module": "vector_store", "function": "__init__", "line": 41}
{"timestamp": "2026-01-09T06:28:35.793607Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Loading RAG config from /Users/adityanbhatt/fhir_rag/backend/config/embedding_config.yaml", "module": "vector_store", "function": "__init__", "line": 46}
{"timestamp": "2026-01-09T06:28:35.800026Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Loaded RAG config successfully", "module": "vector_store", "function": "__init__", "line": 51}
{"timestamp": "2026-01-09T06:28:35.800551Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Resolved chroma_path to: /Users/adityanbhatt/fhir_rag/backend/data/indexes/chroma_db_advanced", "module": "retrieve", "function": "_resolve_config_paths", "line": 155}
{"timestamp": "2026-01-09T06:28:35.800698Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Resolved model_path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "retrieve", "function": "_resolve_config_paths", "line": 162}
{"timestamp": "2026-01-09T06:28:35.887965Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Loading docstore from /Users/adityanbhatt/fhir_rag/backend/data/indexes/chroma_db_advanced/parent_docstore.pkl with module remapping", "module": "retrieve", "function": "_load_docstore", "line": 284}
{"timestamp": "2026-01-09T06:28:36.421055Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Successfully loaded docstore with module remapping", "module": "retrieve", "function": "_load_docstore", "line": 286}
{"timestamp": "2026-01-09T06:28:36.422470Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Loading 154161 parent documents for BM25...", "module": "retrieve", "function": "_setup_retrievers", "line": 175}
{"timestamp": "2026-01-09T06:28:36.445754Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Filtered to 59572 documents from relevant tables for BM25 index.", "module": "retrieve", "function": "_setup_retrievers", "line": 185}
{"timestamp": "2026-01-09T06:28:37.277508Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "BM25Retriever initialized on relevant tables.", "module": "retrieve", "function": "_setup_retrievers", "line": 196}
{"timestamp": "2026-01-09T06:28:37.278541Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Initializing reranker: BAAI/bge-reranker-base", "module": "retrieve", "function": "__init__", "line": 137}
{"timestamp": "2026-01-09T06:28:39.447486Z", "level": "INFO", "logger": "sentence_transformers.cross_encoder.CrossEncoder", "message": "Use pytorch device: mps", "module": "CrossEncoder", "function": "__init__", "line": 222}
{"timestamp": "2026-01-09T06:28:40.449208Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Advanced RAG Retriever initialized successfully.", "module": "retrieve", "function": "__init__", "line": 143}
{"timestamp": "2026-01-09T06:28:40.449410Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Vector store initialized successfully", "module": "vector_store", "function": "__init__", "line": 55}
{"timestamp": "2026-01-09T06:28:40.449525Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "\u2705 Vector store loaded", "module": "agent_service", "function": "vector_store", "line": 220}
{"timestamp": "2026-01-09T06:28:40.449621Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Searching vector store for query: 'Find patients with poor medication adherence notes...' (top_k=5)", "module": "vector_store", "function": "search", "line": 69}
{"timestamp": "2026-01-09T06:28:40.450254Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Executing query: Find patients with poor medication adherence notes", "module": "retrieve", "function": "_get_relevant_documents", "line": 223}
{"timestamp": "2026-01-09T06:28:43.261658Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Reranking 79 documents for query: 'Find patients with poor medication adherence notes'", "module": "retrieve", "function": "_get_relevant_documents", "line": 257}
{"timestamp": "2026-01-09T06:28:44.663248Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Returning 10 reranked documents.", "module": "retrieve", "function": "_get_relevant_documents", "line": 267}
{"timestamp": "2026-01-09T06:28:44.663495Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Retrieved 10 documents from vector store", "module": "vector_store", "function": "search", "line": 84}
{"timestamp": "2026-01-09T06:28:45.260810Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:28:51.580923Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=d565cb14-35da-4023-bdcd-f98b8340ecb0, duration=16.69s)", "module": "agent_service", "function": "process_query", "line": 341}
{"timestamp": "2026-01-09T06:29:08.405545Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=68", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-09T06:29:08.405947Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=327c6386-8376-4b8f-abe5-eccdd3d9b880): '\"Find cases where treatment plans were modified due to side effects\"...'", "module": "agent_service", "function": "process_query", "line": 251}
{"timestamp": "2026-01-09T06:29:09.524978Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:29:09.798426Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Searching vector store for query: 'treatment plans modified due to side effects...' (top_k=5)", "module": "vector_store", "function": "search", "line": 69}
{"timestamp": "2026-01-09T06:29:09.798780Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Executing query: treatment plans modified due to side effects", "module": "retrieve", "function": "_get_relevant_documents", "line": 223}
{"timestamp": "2026-01-09T06:29:10.041765Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Reranking 53 documents for query: 'treatment plans modified due to side effects'", "module": "retrieve", "function": "_get_relevant_documents", "line": 257}
{"timestamp": "2026-01-09T06:29:10.745228Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Returning 10 reranked documents.", "module": "retrieve", "function": "_get_relevant_documents", "line": 267}
{"timestamp": "2026-01-09T06:29:10.745324Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Retrieved 10 documents from vector store", "module": "vector_store", "function": "search", "line": 84}
{"timestamp": "2026-01-09T06:29:11.374556Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:29:17.098201Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=327c6386-8376-4b8f-abe5-eccdd3d9b880, duration=8.69s)", "module": "agent_service", "function": "process_query", "line": 341}
{"timestamp": "2026-01-09T06:29:33.278741Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=62", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-09T06:29:33.279099Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=e321d5fc-b045-4aeb-99e9-bd7ffe096323): 'Are there any common medications linked to these side effects?...'", "module": "agent_service", "function": "process_query", "line": 251}
{"timestamp": "2026-01-09T06:29:34.208842Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:29:35.226100Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=e321d5fc-b045-4aeb-99e9-bd7ffe096323, duration=1.95s)", "module": "agent_service", "function": "process_query", "line": 341}
{"timestamp": "2026-01-09T06:31:26.137347Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=87", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-09T06:31:26.137754Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=663fac40-9901-40c3-bc15-d06f2151a00b): '\"Analyze patients who were crisis referrals and describe their follow-up care patterns\"...'", "module": "agent_service", "function": "process_query", "line": 251}
{"timestamp": "2026-01-09T06:31:26.139793Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI Template Match: 'crisis.*(referral|refer)' -> crisis referrals", "module": "sql_service", "function": "_check_dashboard_kpi", "line": 555}
{"timestamp": "2026-01-09T06:31:26.139861Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "\u26a1 FAST PATH: KPI template matched on original query: crisis referrals", "module": "agent_service", "function": "process_query", "line": 261}
{"timestamp": "2026-01-09T06:31:26.139898Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 638}
{"timestamp": "2026-01-09T06:31:26.139929Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI TEMPLATE EXECUTION (1 API call):", "module": "sql_service", "function": "_execute_kpi_template", "line": 639}
{"timestamp": "2026-01-09T06:31:26.139948Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 640}
{"timestamp": "2026-01-09T06:31:26.139978Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Template: crisis referrals", "module": "sql_service", "function": "_execute_kpi_template", "line": 641}
{"timestamp": "2026-01-09T06:31:26.139998Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL: SELECT COUNT(DISTINCT patient_track_id) as count\n        FROM v_analytics_screening \n        WHERE crisis_referral_status = 'Crisis Referral'...", "module": "sql_service", "function": "_execute_kpi_template", "line": 642}
{"timestamp": "2026-01-09T06:31:26.228056Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query result: [(1219,)]", "module": "sql_service", "function": "_execute_kpi_template", "line": 646}
{"timestamp": "2026-01-09T06:31:28.380546Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:31:28.386103Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 661}
{"timestamp": "2026-01-09T06:31:28.386434Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u2705 KPI template execution completed with 1 API call", "module": "sql_service", "function": "_execute_kpi_template", "line": 662}
{"timestamp": "2026-01-09T06:31:28.386537Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: In the context of the NCD (Non-Communicable Diseases) program, a total of 1,219 unique patients were identified as crisis referrals. This figure represents the number of individuals who were flagged for urgent follow-up care due to critical health concerns. Understanding the follow-up care patterns ...", "module": "sql_service", "function": "_execute_kpi_template", "line": 663}
{"timestamp": "2026-01-09T06:31:28.386585Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 664}
{"timestamp": "2026-01-09T06:31:28.387949Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "\u2705 KPI fast-path completed (trace_id=663fac40-9901-40c3-bc15-d06f2151a00b, duration=2.25s)", "module": "agent_service", "function": "process_query", "line": 291}
{"timestamp": "2026-01-09T06:31:44.372440Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=69", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-09T06:31:44.372834Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=17b9798f-bc6e-4ac1-965a-c6854bb86649): '\"Compare outcomes of patients with good vs poor medication adherence\"...'", "module": "agent_service", "function": "process_query", "line": 251}
{"timestamp": "2026-01-09T06:31:45.179549Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:31:48.623995Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Compare average HbA1c, systolic BP, and glucose levels for patients with good vs poor medication adh...'", "module": "sql_service", "function": "query", "line": 622}
{"timestamp": "2026-01-09T06:31:48.624199Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udd0d Analyzing natural language query", "module": "sql_service", "function": "_is_simple_query", "line": 572}
{"timestamp": "2026-01-09T06:31:48.624379Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query classified as COMPLEX (pattern=True, complexity=True, multi_table=False)", "module": "sql_service", "function": "_is_simple_query", "line": 617}
{"timestamp": "2026-01-09T06:31:48.624425Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Complex query detected - using full agent", "module": "sql_service", "function": "query", "line": 634}
{"timestamp": "2026-01-09T06:31:48.624472Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 781}
{"timestamp": "2026-01-09T06:31:48.624507Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL AGENT EXECUTION TRACE:", "module": "sql_service", "function": "_execute_with_agent", "line": 782}
{"timestamp": "2026-01-09T06:31:48.624540Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 783}
{"timestamp": "2026-01-09T06:31:49.578970Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:31:51.628351Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:31:52.652651Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:31:57.972407Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:31:58.907047Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:32:00.749760Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:32:02.593442Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 806}
{"timestamp": "2026-01-09T06:32:02.593643Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL query completed. Result length: 347 chars", "module": "sql_service", "function": "_execute_with_agent", "line": 807}
{"timestamp": "2026-01-09T06:32:02.593722Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: The query executed successfully, but it returned no results. This could mean that there are no entries in the database where the medication adherence is explicitly labeled as 'Good' or 'Poor'. \n\nIf you have specific labels for good and poor adherence or additional criteria to define them, please let...", "module": "sql_service", "function": "_execute_with_agent", "line": 809}
{"timestamp": "2026-01-09T06:32:02.593775Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 810}
{"timestamp": "2026-01-09T06:32:02.594536Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Searching vector store for query: 'Find clinical notes mentioning 'good adherence' and 'poor adherence' to medications....' (top_k=5)", "module": "vector_store", "function": "search", "line": 69}
{"timestamp": "2026-01-09T06:32:02.594883Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Executing query: Find clinical notes mentioning 'good adherence' and 'poor adherence' to medications.", "module": "retrieve", "function": "_get_relevant_documents", "line": 223}
{"timestamp": "2026-01-09T06:32:03.169130Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Reranking 96 documents for query: 'Find clinical notes mentioning 'good adherence' and 'poor adherence' to medications.'", "module": "retrieve", "function": "_get_relevant_documents", "line": 257}
{"timestamp": "2026-01-09T06:32:04.624285Z", "level": "INFO", "logger": "backend.rag.retrieve", "message": "Returning 10 reranked documents.", "module": "retrieve", "function": "_get_relevant_documents", "line": 267}
{"timestamp": "2026-01-09T06:32:04.624653Z", "level": "INFO", "logger": "backend.services.vector_store", "message": "Retrieved 10 documents from vector store", "module": "vector_store", "function": "search", "line": 84}
{"timestamp": "2026-01-09T06:32:05.244744Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:32:11.474196Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=17b9798f-bc6e-4ac1-965a-c6854bb86649, duration=27.10s)", "module": "agent_service", "function": "process_query", "line": 341}
{"timestamp": "2026-01-09T06:32:38.016704Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=86", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-09T06:32:38.017025Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=e91532dd-2ef0-48b9-a923-55f6ec5b0f86): '\"Identify 3 high-risk patients (red risk flag) and summarize their clinical histories\"...'", "module": "agent_service", "function": "process_query", "line": 251}
{"timestamp": "2026-01-09T06:32:38.017326Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI Template Match: 'high.?risk.*patient|critical.*patient|risk.*(category|stratification)' -> high-risk patient distribution by category", "module": "sql_service", "function": "_check_dashboard_kpi", "line": 555}
{"timestamp": "2026-01-09T06:32:38.017394Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "\u26a1 FAST PATH: KPI template matched on original query: high-risk patient distribution by category", "module": "agent_service", "function": "process_query", "line": 261}
{"timestamp": "2026-01-09T06:32:38.017945Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 638}
{"timestamp": "2026-01-09T06:32:38.018312Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI TEMPLATE EXECUTION (1 API call):", "module": "sql_service", "function": "_execute_kpi_template", "line": 639}
{"timestamp": "2026-01-09T06:32:38.018411Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 640}
{"timestamp": "2026-01-09T06:32:38.018457Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Template: high-risk patient distribution by category", "module": "sql_service", "function": "_execute_kpi_template", "line": 641}
{"timestamp": "2026-01-09T06:32:38.018523Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL: SELECT risk_category, COUNT(DISTINCT patient_track_id) as count\n        FROM v_high_risk_patients \n        WHERE workflow_status = 'NCD'\n        GROUP BY risk_category\n        ORDER BY CASE risk_categ...", "module": "sql_service", "function": "_execute_kpi_template", "line": 642}
{"timestamp": "2026-01-09T06:32:38.069748Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query result: [('Critical', 166), ('High', 1279), ('Moderate', 1334), ('Low', 4007)]", "module": "sql_service", "function": "_execute_kpi_template", "line": 646}
{"timestamp": "2026-01-09T06:32:42.622409Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:32:42.625911Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 661}
{"timestamp": "2026-01-09T06:32:42.626172Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u2705 KPI template execution completed with 1 API call", "module": "sql_service", "function": "_execute_kpi_template", "line": 662}
{"timestamp": "2026-01-09T06:32:42.626296Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: In the context of the Non-Communicable Diseases (NCD) program, the distribution of high-risk patients is categorized as follows: 166 patients are classified as 'Critical', 1,279 as 'High', 1,334 as 'Moderate', and 4,007 as 'Low'. These numbers represent the count of distinct patients within each ris...", "module": "sql_service", "function": "_execute_kpi_template", "line": 663}
{"timestamp": "2026-01-09T06:32:42.626367Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 664}
{"timestamp": "2026-01-09T06:32:42.626659Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "\u2705 KPI fast-path completed (trace_id=e91532dd-2ef0-48b9-a923-55f6ec5b0f86, duration=4.61s)", "module": "agent_service", "function": "process_query", "line": 291}
{"timestamp": "2026-01-09T06:33:33.239528Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=84", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-09T06:33:33.240154Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=b361dafe-7cb6-439c-94cb-1bee40428734): '\"Identify high-risk patients (red risk flag) and summarize their clinical histories\"...'", "module": "agent_service", "function": "process_query", "line": 251}
{"timestamp": "2026-01-09T06:33:33.240480Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI Template Match: 'high.?risk.*patient|critical.*patient|risk.*(category|stratification)' -> high-risk patient distribution by category", "module": "sql_service", "function": "_check_dashboard_kpi", "line": 555}
{"timestamp": "2026-01-09T06:33:33.240535Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "\u26a1 FAST PATH: KPI template matched on original query: high-risk patient distribution by category", "module": "agent_service", "function": "process_query", "line": 261}
{"timestamp": "2026-01-09T06:33:33.240588Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 638}
{"timestamp": "2026-01-09T06:33:33.240631Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI TEMPLATE EXECUTION (1 API call):", "module": "sql_service", "function": "_execute_kpi_template", "line": 639}
{"timestamp": "2026-01-09T06:33:33.240669Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 640}
{"timestamp": "2026-01-09T06:33:33.240708Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Template: high-risk patient distribution by category", "module": "sql_service", "function": "_execute_kpi_template", "line": 641}
{"timestamp": "2026-01-09T06:33:33.240758Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL: SELECT risk_category, COUNT(DISTINCT patient_track_id) as count\n        FROM v_high_risk_patients \n        WHERE workflow_status = 'NCD'\n        GROUP BY risk_category\n        ORDER BY CASE risk_categ...", "module": "sql_service", "function": "_execute_kpi_template", "line": 642}
{"timestamp": "2026-01-09T06:33:33.288726Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query result: [('Critical', 166), ('High', 1279), ('Moderate', 1334), ('Low', 4007)]", "module": "sql_service", "function": "_execute_kpi_template", "line": 646}
{"timestamp": "2026-01-09T06:33:35.813289Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:33:35.816455Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 661}
{"timestamp": "2026-01-09T06:33:35.816566Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u2705 KPI template execution completed with 1 API call", "module": "sql_service", "function": "_execute_kpi_template", "line": 662}
{"timestamp": "2026-01-09T06:33:35.816622Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: In the context of the Non-Communicable Diseases (NCD) program, the distribution of high-risk patients is categorized as follows: \n\n- **Critical Risk**: 166 patients\n- **High Risk**: 1,279 patients\n- **Moderate Risk**: 1,334 patients\n- **Low Risk**: 4,007 patients\n\nThese numbers represent the count o...", "module": "sql_service", "function": "_execute_kpi_template", "line": 663}
{"timestamp": "2026-01-09T06:33:35.816670Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 664}
{"timestamp": "2026-01-09T06:33:35.817093Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "\u2705 KPI fast-path completed (trace_id=b361dafe-7cb6-439c-94cb-1bee40428734, duration=2.58s)", "module": "agent_service", "function": "process_query", "line": 291}
{"timestamp": "2026-01-09T06:33:41.942407Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=39", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-09T06:33:41.942569Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=3e718ee5-3c03-4077-bda0-a693fd61eba9): 'Show patients with abnormal lab results...'", "module": "agent_service", "function": "process_query", "line": 251}
{"timestamp": "2026-01-09T06:33:41.942708Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI Template Match: 'abnormal.*lab|lab.*abnormal' -> patients by abnormal lab result count", "module": "sql_service", "function": "_check_dashboard_kpi", "line": 555}
{"timestamp": "2026-01-09T06:33:41.942778Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "\u26a1 FAST PATH: KPI template matched on original query: patients by abnormal lab result count", "module": "agent_service", "function": "process_query", "line": 261}
{"timestamp": "2026-01-09T06:33:41.942842Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 638}
{"timestamp": "2026-01-09T06:33:41.942905Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI TEMPLATE EXECUTION (1 API call):", "module": "sql_service", "function": "_execute_kpi_template", "line": 639}
{"timestamp": "2026-01-09T06:33:41.942965Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 640}
{"timestamp": "2026-01-09T06:33:41.943023Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Template: patients by abnormal lab result count", "module": "sql_service", "function": "_execute_kpi_template", "line": 641}
{"timestamp": "2026-01-09T06:33:41.943084Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL: SELECT \n            CASE \n                WHEN abnormal_result_count >= 3 THEN '3+ abnormal'\n                WHEN abnormal_result_count = 2 THEN '2 abnormal'\n                WHEN abnormal_result_count...", "module": "sql_service", "function": "_execute_kpi_template", "line": 642}
{"timestamp": "2026-01-09T06:33:41.947387Z", "level": "WARNING", "logger": "backend.services.sql_service", "message": "\u26a0\ufe0f KPI template execution failed: (psycopg2.errors.GroupingError) column \"v_analytics_enrollment_enhanced.abnormal_result_count\" must appear in the GROUP BY clause or be used in an aggregate function\nLINE 12:         ORDER BY abnormal_result_count DESC\n                          ^\n\n[SQL: SELECT \n            CASE \n                WHEN abnormal_result_count >= 3 THEN '3+ abnormal'\n                WHEN abnormal_result_count = 2 THEN '2 abnormal'\n                WHEN abnormal_result_count = 1 THEN '1 abnormal'\n                ELSE 'No abnormal'\n            END as abnormal_category,\n            COUNT(DISTINCT patient_track_id) as patient_count\n        FROM v_analytics_enrollment_enhanced \n        WHERE patient_status = 'ENROLLED' AND workflow_status = 'NCD'\n        GROUP BY abnormal_category\n        ORDER BY abnormal_result_count DESC]\n(Background on this error at: https://sqlalche.me/e/20/f405). Falling back to agent.", "module": "sql_service", "function": "_execute_kpi_template", "line": 669}
{"timestamp": "2026-01-09T06:33:41.947512Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 781}
{"timestamp": "2026-01-09T06:33:41.947572Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL AGENT EXECUTION TRACE:", "module": "sql_service", "function": "_execute_with_agent", "line": 782}
{"timestamp": "2026-01-09T06:33:41.947688Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 783}
{"timestamp": "2026-01-09T06:33:42.777572Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:33:43.776213Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:33:44.984511Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:33:46.937355Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:33:47.951635Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:33:49.469450Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:33:51.334360Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:33:52.133180Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:33:54.000439Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:33:55.842069Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:33:56.973224Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 806}
{"timestamp": "2026-01-09T06:33:56.973531Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL query completed. Result length: 36 chars", "module": "sql_service", "function": "_execute_with_agent", "line": 807}
{"timestamp": "2026-01-09T06:33:56.973608Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: Agent stopped due to max iterations....", "module": "sql_service", "function": "_execute_with_agent", "line": 809}
{"timestamp": "2026-01-09T06:33:56.973664Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 810}
{"timestamp": "2026-01-09T06:33:56.974256Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "\u2705 KPI fast-path completed (trace_id=3e718ee5-3c03-4077-bda0-a693fd61eba9, duration=15.03s)", "module": "agent_service", "function": "process_query", "line": 291}
{"timestamp": "2026-01-09T06:34:09.194734Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=38", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-09T06:34:09.195421Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=31867dd4-1cd7-45c7-a254-ab126d3ab78f): 'Show enrollment breakdown by condition...'", "module": "agent_service", "function": "process_query", "line": 251}
{"timestamp": "2026-01-09T06:34:09.969604Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:34:10.366837Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Show enrollment breakdown by condition using v_analytics_enrollment...'", "module": "sql_service", "function": "query", "line": 622}
{"timestamp": "2026-01-09T06:34:10.366963Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udd0d Analyzing natural language query", "module": "sql_service", "function": "_is_simple_query", "line": 572}
{"timestamp": "2026-01-09T06:34:10.367086Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udcca Query targets analytics view - treating as single source", "module": "sql_service", "function": "_is_simple_query", "line": 607}
{"timestamp": "2026-01-09T06:34:10.367126Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query classified as COMPLEX (pattern=False, complexity=False, multi_table=False)", "module": "sql_service", "function": "_is_simple_query", "line": 617}
{"timestamp": "2026-01-09T06:34:10.367165Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Complex query detected - using full agent", "module": "sql_service", "function": "query", "line": 634}
{"timestamp": "2026-01-09T06:34:10.367193Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 781}
{"timestamp": "2026-01-09T06:34:10.367224Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL AGENT EXECUTION TRACE:", "module": "sql_service", "function": "_execute_with_agent", "line": 782}
{"timestamp": "2026-01-09T06:34:10.367253Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 783}
{"timestamp": "2026-01-09T06:34:11.096163Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:34:11.714717Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:34:12.735580Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:34:14.300841Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:34:15.194440Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:34:15.809536Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:34:16.749851Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 806}
{"timestamp": "2026-01-09T06:34:16.750055Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL query completed. Result length: 301 chars", "module": "sql_service", "function": "_execute_with_agent", "line": 807}
{"timestamp": "2026-01-09T06:34:16.750186Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: Here is the enrollment breakdown by condition from the `v_analytics_enrollment` table:\n\n1. Provisional Diagnosis: 6,666 enrollments\n2. Co-morbid (DBM + HTN): 734 enrollments\n3. Hypertension: 368 enrollments\n4. Diabetes: 138 enrollments\n\nThese are the top conditions based on the number of enrollments...", "module": "sql_service", "function": "_execute_with_agent", "line": 809}
{"timestamp": "2026-01-09T06:34:16.750288Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 810}
{"timestamp": "2026-01-09T06:34:17.341532Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T06:34:21.939925Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=31867dd4-1cd7-45c7-a254-ab126d3ab78f, duration=12.74s)", "module": "agent_service", "function": "process_query", "line": 341}
{"timestamp": "2026-01-09T09:51:23.842786Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login attempt for user: admin", "module": "auth", "function": "login", "line": 27}
{"timestamp": "2026-01-09T09:51:23.844989Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login successful for user: admin", "module": "auth", "function": "login", "line": 50}
{"timestamp": "2026-01-09T09:51:33.581398Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=21", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-09T09:51:33.582100Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=7f439292-5202-4a87-8622-e0a9694ab05c): 'patients with high bp...'", "module": "agent_service", "function": "process_query", "line": 251}
{"timestamp": "2026-01-09T09:51:35.394195Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T09:51:35.791066Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Count patients with elevated BP (systolic >= 140 OR diastolic >= 90) from v_analytics_screening....'", "module": "sql_service", "function": "query", "line": 622}
{"timestamp": "2026-01-09T09:51:35.791323Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udd0d Analyzing natural language query", "module": "sql_service", "function": "_is_simple_query", "line": 572}
{"timestamp": "2026-01-09T09:51:35.791543Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udcca Query targets analytics view - treating as single source", "module": "sql_service", "function": "_is_simple_query", "line": 607}
{"timestamp": "2026-01-09T09:51:35.791595Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Query classified as SIMPLE (natural language)", "module": "sql_service", "function": "_is_simple_query", "line": 615}
{"timestamp": "2026-01-09T09:51:35.791640Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Detected simple query - using optimized execution path", "module": "sql_service", "function": "query", "line": 631}
{"timestamp": "2026-01-09T09:51:35.791707Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_optimized", "line": 673}
{"timestamp": "2026-01-09T09:51:35.791749Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 OPTIMIZED SQL EXECUTION:", "module": "sql_service", "function": "_execute_optimized", "line": 674}
{"timestamp": "2026-01-09T09:51:35.791788Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_optimized", "line": 675}
{"timestamp": "2026-01-09T09:51:35.791829Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " API Call 1: Generate SQL query with targeted schema", "module": "sql_service", "function": "_execute_optimized", "line": 687}
{"timestamp": "2026-01-09T09:51:35.792471Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udccb Selected relevant tables for query: patient, v_analytics_screening, bp_log, patient_tracker", "module": "sql_service", "function": "_get_relevant_schema", "line": 520}
{"timestamp": "2026-01-09T09:51:37.950582Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T09:51:37.960399Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL to execute: SELECT COUNT(DISTINCT patient_track_id) \nFROM v_analytics_screening \nWHERE avg_systolic >= 140 OR avg_diastolic >= 90;...", "module": "sql_service", "function": "_execute_optimized", "line": 719}
{"timestamp": "2026-01-09T09:51:37.960524Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Executing query against database (no API call)", "module": "sql_service", "function": "_execute_optimized", "line": 725}
{"timestamp": "2026-01-09T09:51:37.979740Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query result: [(3495,)]", "module": "sql_service", "function": "_execute_optimized", "line": 727}
{"timestamp": "2026-01-09T09:51:37.979836Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " API Call 2: Format natural language response", "module": "sql_service", "function": "_execute_optimized", "line": 729}
{"timestamp": "2026-01-09T09:51:40.099916Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T09:51:40.102851Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_optimized", "line": 744}
{"timestamp": "2026-01-09T09:51:40.103168Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Optimized execution completed with 2 API call(s) (vs 7 with agent)", "module": "sql_service", "function": "_execute_optimized", "line": 745}
{"timestamp": "2026-01-09T09:51:40.103400Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: There are 3,495 patients with elevated blood pressure, defined as having an average systolic blood pressure of 140 or higher, or an average diastolic blood pressure of 90 or higher, in the v_analytics_screening database....", "module": "sql_service", "function": "_execute_optimized", "line": 746}
{"timestamp": "2026-01-09T09:51:40.103532Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_optimized", "line": 747}
{"timestamp": "2026-01-09T09:51:41.122226Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-09T09:51:46.866158Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=7f439292-5202-4a87-8622-e0a9694ab05c, duration=13.28s)", "module": "agent_service", "function": "process_query", "line": 341}
{"timestamp": "2026-01-12T04:45:34.058121Z", "level": "INFO", "logger": "app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-12T04:45:34.058160Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-12T04:45:34.058182Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-12T04:45:34.058254Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-12T04:45:34.092394Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-12T04:45:34.092440Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-12T04:45:36.058862Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-12T04:45:36.058908Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-12T04:45:36.058938Z", "level": "INFO", "logger": "app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-12T04:45:36.058959Z", "level": "INFO", "logger": "app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-12T04:45:53.466715Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login attempt for user: admin", "module": "auth", "function": "login", "line": 27}
{"timestamp": "2026-01-12T04:45:53.479014Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login successful for user: admin", "module": "auth", "function": "login", "line": 50}
{"timestamp": "2026-01-12T04:46:02.348633Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=87", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-12T04:46:02.348690Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Initializing AgentService", "module": "agent_service", "function": "__init__", "line": 149}
{"timestamp": "2026-01-12T04:46:02.348721Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Connecting to database at postgresql://admin:admin@127.0.0.1:5432/Spice_BD", "module": "sql_service", "function": "__init__", "line": 385}
{"timestamp": "2026-01-12T04:46:02.468664Z", "level": "ERROR", "logger": "backend.services.sql_service", "message": "Failed to initialize SQL service: (psycopg2.OperationalError) connection to server at \"127.0.0.1\", port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\n\n(Background on this error at: https://sqlalche.me/e/20/e3q8)", "module": "sql_service", "function": "__init__", "line": 443, "exception": "Traceback (most recent call last):\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/base.py\", line 146, in __init__\n    self._dbapi_connection = engine.raw_connection()\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/base.py\", line 3304, in raw_connection\n    return self.pool.connect()\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 449, in connect\n    return _ConnectionFairy._checkout(self)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 1263, in _checkout\n    fairy = _ConnectionRecord.checkout(pool)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 712, in checkout\n    rec = pool._do_get()\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/impl.py\", line 179, in _do_get\n    with util.safe_reraise():\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/impl.py\", line 177, in _do_get\n    return self._create_connection()\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 390, in _create_connection\n    return _ConnectionRecord(self)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 674, in __init__\n    self.__connect()\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 900, in __connect\n    with util.safe_reraise():\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 896, in __connect\n    self.dbapi_connection = connection = pool._invoke_creator(self)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/create.py\", line 643, in connect\n    return dialect.connect(*cargs, **cparams)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/default.py\", line 617, in connect\n    return self.loaded_dbapi.connect(*cargs, **cparams)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/psycopg2/__init__.py\", line 122, in connect\n    conn = _connect(dsn, connection_factory=connection_factory, **kwasync)\npsycopg2.OperationalError: connection to server at \"127.0.0.1\", port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\n\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/Users/adityanbhatt/fhir_rag/backend/services/sql_service.py\", line 389, in __init__\n    temp_db = SQLDatabase.from_uri(settings.database_url)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_community/utilities/sql_database.py\", line 175, in from_uri\n    return cls(create_engine(database_uri, **_engine_args), **kwargs)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_community/utilities/sql_database.py\", line 106, in __init__\n    self._inspector = inspect(self._engine)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/inspection.py\", line 140, in inspect\n    ret = reg(subject)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/reflection.py\", line 303, in _engine_insp\n    return Inspector._construct(Inspector._init_engine, bind)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/reflection.py\", line 236, in _construct\n    init(self, bind)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/reflection.py\", line 247, in _init_engine\n    engine.connect().close()\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/base.py\", line 3280, in connect\n    return self._connection_cls(self)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/base.py\", line 148, in __init__\n    Connection._handle_dbapi_exception_noconnection(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/base.py\", line 2444, in _handle_dbapi_exception_noconnection\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/base.py\", line 146, in __init__\n    self._dbapi_connection = engine.raw_connection()\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/base.py\", line 3304, in raw_connection\n    return self.pool.connect()\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 449, in connect\n    return _ConnectionFairy._checkout(self)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 1263, in _checkout\n    fairy = _ConnectionRecord.checkout(pool)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 712, in checkout\n    rec = pool._do_get()\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/impl.py\", line 179, in _do_get\n    with util.safe_reraise():\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/impl.py\", line 177, in _do_get\n    return self._create_connection()\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 390, in _create_connection\n    return _ConnectionRecord(self)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 674, in __init__\n    self.__connect()\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 900, in __connect\n    with util.safe_reraise():\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 896, in __connect\n    self.dbapi_connection = connection = pool._invoke_creator(self)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/create.py\", line 643, in connect\n    return dialect.connect(*cargs, **cparams)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/default.py\", line 617, in connect\n    return self.loaded_dbapi.connect(*cargs, **cparams)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/psycopg2/__init__.py\", line 122, in connect\n    conn = _connect(dsn, connection_factory=connection_factory, **kwasync)\nsqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at \"127.0.0.1\", port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\n\n(Background on this error at: https://sqlalche.me/e/20/e3q8)"}
{"timestamp": "2026-01-12T04:46:02.469326Z", "level": "ERROR", "logger": "backend.api.routes.chat", "message": "Chat request failed for user=admin: (psycopg2.OperationalError) connection to server at \"127.0.0.1\", port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\n\n(Background on this error at: https://sqlalche.me/e/20/e3q8)", "module": "chat", "function": "chat", "line": 51, "exception": "Traceback (most recent call last):\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/base.py\", line 146, in __init__\n    self._dbapi_connection = engine.raw_connection()\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/base.py\", line 3304, in raw_connection\n    return self.pool.connect()\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 449, in connect\n    return _ConnectionFairy._checkout(self)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 1263, in _checkout\n    fairy = _ConnectionRecord.checkout(pool)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 712, in checkout\n    rec = pool._do_get()\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/impl.py\", line 179, in _do_get\n    with util.safe_reraise():\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/impl.py\", line 177, in _do_get\n    return self._create_connection()\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 390, in _create_connection\n    return _ConnectionRecord(self)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 674, in __init__\n    self.__connect()\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 900, in __connect\n    with util.safe_reraise():\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 896, in __connect\n    self.dbapi_connection = connection = pool._invoke_creator(self)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/create.py\", line 643, in connect\n    return dialect.connect(*cargs, **cparams)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/default.py\", line 617, in connect\n    return self.loaded_dbapi.connect(*cargs, **cparams)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/psycopg2/__init__.py\", line 122, in connect\n    conn = _connect(dsn, connection_factory=connection_factory, **kwasync)\npsycopg2.OperationalError: connection to server at \"127.0.0.1\", port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\n\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/Users/adityanbhatt/fhir_rag/backend/api/routes/chat.py\", line 42, in chat\n    agent_service = get_agent_service()\n  File \"/Users/adityanbhatt/fhir_rag/backend/services/agent_service.py\", line 462, in get_agent_service\n    _agent_service = AgentService()\n  File \"/Users/adityanbhatt/fhir_rag/backend/services/agent_service.py\", line 152, in __init__\n    self.sql_service = get_sql_service()\n  File \"/Users/adityanbhatt/fhir_rag/backend/services/sql_service.py\", line 836, in get_sql_service\n    return SQLService()\n  File \"/Users/adityanbhatt/fhir_rag/backend/services/sql_service.py\", line 389, in __init__\n    temp_db = SQLDatabase.from_uri(settings.database_url)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_community/utilities/sql_database.py\", line 175, in from_uri\n    return cls(create_engine(database_uri, **_engine_args), **kwargs)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/langchain_community/utilities/sql_database.py\", line 106, in __init__\n    self._inspector = inspect(self._engine)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/inspection.py\", line 140, in inspect\n    ret = reg(subject)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/reflection.py\", line 303, in _engine_insp\n    return Inspector._construct(Inspector._init_engine, bind)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/reflection.py\", line 236, in _construct\n    init(self, bind)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/reflection.py\", line 247, in _init_engine\n    engine.connect().close()\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/base.py\", line 3280, in connect\n    return self._connection_cls(self)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/base.py\", line 148, in __init__\n    Connection._handle_dbapi_exception_noconnection(\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/base.py\", line 2444, in _handle_dbapi_exception_noconnection\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/base.py\", line 146, in __init__\n    self._dbapi_connection = engine.raw_connection()\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/base.py\", line 3304, in raw_connection\n    return self.pool.connect()\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 449, in connect\n    return _ConnectionFairy._checkout(self)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 1263, in _checkout\n    fairy = _ConnectionRecord.checkout(pool)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 712, in checkout\n    rec = pool._do_get()\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/impl.py\", line 179, in _do_get\n    with util.safe_reraise():\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/impl.py\", line 177, in _do_get\n    return self._create_connection()\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 390, in _create_connection\n    return _ConnectionRecord(self)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 674, in __init__\n    self.__connect()\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 900, in __connect\n    with util.safe_reraise():\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/pool/base.py\", line 896, in __connect\n    self.dbapi_connection = connection = pool._invoke_creator(self)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/create.py\", line 643, in connect\n    return dialect.connect(*cargs, **cparams)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/sqlalchemy/engine/default.py\", line 617, in connect\n    return self.loaded_dbapi.connect(*cargs, **cparams)\n  File \"/opt/anaconda3/envs/fhir_rag_env/lib/python3.10/site-packages/psycopg2/__init__.py\", line 122, in connect\n    conn = _connect(dsn, connection_factory=connection_factory, **kwasync)\nsqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at \"127.0.0.1\", port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\n\n(Background on this error at: https://sqlalche.me/e/20/e3q8)", "user_id": "admin"}
{"timestamp": "2026-01-12T04:46:25.986665Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=87", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-12T04:46:25.986763Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Initializing AgentService", "module": "agent_service", "function": "__init__", "line": 149}
{"timestamp": "2026-01-12T04:46:25.986824Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Connecting to database at postgresql://admin:admin@127.0.0.1:5432/Spice_BD", "module": "sql_service", "function": "__init__", "line": 385}
{"timestamp": "2026-01-12T04:46:26.387481Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Database connection established with view support", "module": "sql_service", "function": "__init__", "line": 413}
{"timestamp": "2026-01-12T04:46:26.565544Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Cached schema for 48 relevant tables out of 125 total", "module": "sql_service", "function": "_cache_schema", "line": 478}
{"timestamp": "2026-01-12T04:46:26.565588Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Relevant tables: bp_log, current_medication, diagnosis, glucose_log, lab_test, lab_test_result, lab_test_result_range, medical_compliance, medication_country_detail, patient...", "module": "sql_service", "function": "_cache_schema", "line": 479}
{"timestamp": "2026-01-12T04:46:26.708163Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "SQL agent initialized successfully with 48 cached tables", "module": "sql_service", "function": "__init__", "line": 440}
{"timestamp": "2026-01-12T04:46:26.713583Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "AgentService initialized successfully", "module": "agent_service", "function": "__init__", "line": 212}
{"timestamp": "2026-01-12T04:46:26.713635Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=c3ea677d-bb7f-44e9-943d-b8af3c8be5d8): 'Based on the CVD risk scoring criteria, how many patients fall into each risk category?...'", "module": "agent_service", "function": "process_query", "line": 251}
{"timestamp": "2026-01-12T04:46:26.713925Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI Template Match: 'high.?risk.*patient|critical.*patient|risk.*(category|stratification)' -> high-risk patient distribution by category", "module": "sql_service", "function": "_check_dashboard_kpi", "line": 555}
{"timestamp": "2026-01-12T04:46:26.713959Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "\u26a1 FAST PATH: KPI template matched on original query: high-risk patient distribution by category", "module": "agent_service", "function": "process_query", "line": 261}
{"timestamp": "2026-01-12T04:46:26.714005Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 638}
{"timestamp": "2026-01-12T04:46:26.714053Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI TEMPLATE EXECUTION (1 API call):", "module": "sql_service", "function": "_execute_kpi_template", "line": 639}
{"timestamp": "2026-01-12T04:46:26.714088Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 640}
{"timestamp": "2026-01-12T04:46:26.714108Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Template: high-risk patient distribution by category", "module": "sql_service", "function": "_execute_kpi_template", "line": 641}
{"timestamp": "2026-01-12T04:46:26.714130Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL: SELECT risk_category, COUNT(DISTINCT patient_track_id) as count\n        FROM v_high_risk_patients \n        WHERE workflow_status = 'NCD'\n        GROUP BY risk_category\n        ORDER BY CASE risk_categ...", "module": "sql_service", "function": "_execute_kpi_template", "line": 642}
{"timestamp": "2026-01-12T04:46:26.746474Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query result: [('Critical', 166), ('High', 1279), ('Moderate', 1334), ('Low', 4007)]", "module": "sql_service", "function": "_execute_kpi_template", "line": 646}
{"timestamp": "2026-01-12T04:46:30.133003Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-12T04:46:30.142643Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 661}
{"timestamp": "2026-01-12T04:46:30.142720Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u2705 KPI template execution completed with 1 API call", "module": "sql_service", "function": "_execute_kpi_template", "line": 662}
{"timestamp": "2026-01-12T04:46:30.142750Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: Based on the CVD risk scoring criteria within the NCD program, the distribution of high-risk patients is as follows: \n\n- **Critical Risk**: 166 patients\n- **High Risk**: 1,279 patients\n- **Moderate Risk**: 1,334 patients\n- **Low Risk**: 4,007 patients\n\nThese numbers represent the count of patients c...", "module": "sql_service", "function": "_execute_kpi_template", "line": 663}
{"timestamp": "2026-01-12T04:46:30.142775Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 664}
{"timestamp": "2026-01-12T04:46:30.142913Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "\u2705 KPI fast-path completed (trace_id=c3ea677d-bb7f-44e9-943d-b8af3c8be5d8, duration=3.43s)", "module": "agent_service", "function": "process_query", "line": 291}
{"timestamp": "2026-01-12T04:46:35.191895Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=39", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-12T04:46:35.192215Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=6684dbb3-111c-4e87-b7dc-2605d425ad3d): 'Show patients with abnormal lab results...'", "module": "agent_service", "function": "process_query", "line": 251}
{"timestamp": "2026-01-12T04:46:35.192972Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI Template Match: 'abnormal.*lab|lab.*abnormal' -> patients by abnormal lab result count", "module": "sql_service", "function": "_check_dashboard_kpi", "line": 555}
{"timestamp": "2026-01-12T04:46:35.193039Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "\u26a1 FAST PATH: KPI template matched on original query: patients by abnormal lab result count", "module": "agent_service", "function": "process_query", "line": 261}
{"timestamp": "2026-01-12T04:46:35.193080Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 638}
{"timestamp": "2026-01-12T04:46:35.193128Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI TEMPLATE EXECUTION (1 API call):", "module": "sql_service", "function": "_execute_kpi_template", "line": 639}
{"timestamp": "2026-01-12T04:46:35.193165Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 640}
{"timestamp": "2026-01-12T04:46:35.193201Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Template: patients by abnormal lab result count", "module": "sql_service", "function": "_execute_kpi_template", "line": 641}
{"timestamp": "2026-01-12T04:46:35.193251Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL: SELECT \n            CASE \n                WHEN abnormal_result_count >= 3 THEN '3+ abnormal'\n                WHEN abnormal_result_count = 2 THEN '2 abnormal'\n                WHEN abnormal_result_count...", "module": "sql_service", "function": "_execute_kpi_template", "line": 642}
{"timestamp": "2026-01-12T04:46:35.199458Z", "level": "WARNING", "logger": "backend.services.sql_service", "message": "\u26a0\ufe0f KPI template execution failed: (psycopg2.errors.GroupingError) column \"v_analytics_enrollment_enhanced.abnormal_result_count\" must appear in the GROUP BY clause or be used in an aggregate function\nLINE 12:         ORDER BY abnormal_result_count DESC\n                          ^\n\n[SQL: SELECT \n            CASE \n                WHEN abnormal_result_count >= 3 THEN '3+ abnormal'\n                WHEN abnormal_result_count = 2 THEN '2 abnormal'\n                WHEN abnormal_result_count = 1 THEN '1 abnormal'\n                ELSE 'No abnormal'\n            END as abnormal_category,\n            COUNT(DISTINCT patient_track_id) as patient_count\n        FROM v_analytics_enrollment_enhanced \n        WHERE patient_status = 'ENROLLED' AND workflow_status = 'NCD'\n        GROUP BY abnormal_category\n        ORDER BY abnormal_result_count DESC]\n(Background on this error at: https://sqlalche.me/e/20/f405). Falling back to agent.", "module": "sql_service", "function": "_execute_kpi_template", "line": 669}
{"timestamp": "2026-01-12T04:46:35.199569Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 781}
{"timestamp": "2026-01-12T04:46:35.199620Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL AGENT EXECUTION TRACE:", "module": "sql_service", "function": "_execute_with_agent", "line": 782}
{"timestamp": "2026-01-12T04:46:35.199660Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 783}
{"timestamp": "2026-01-12T04:46:36.788214Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-12T04:46:38.388819Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-12T04:46:39.530049Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-12T04:46:41.805577Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-12T04:46:44.369068Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-12T04:46:45.694499Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-12T04:46:47.642409Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 806}
{"timestamp": "2026-01-12T04:46:47.642877Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL query completed. Result length: 428 chars", "module": "sql_service", "function": "_execute_with_agent", "line": 807}
{"timestamp": "2026-01-12T04:46:47.643032Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: Here are some patients with abnormal lab results:\n\n1. **Patient ID:** 4342\n   - **Name:** HANK G\n   - **Test Name:** Oral Glucose Tolerance Test\n   - **Result Value:** abc\n   - **Unit:** mmol/L\n\n2. **Patient ID:** 4348\n   - **Name:** KUBY H\n   - **Test Name:** Oral Glucose Tolerance Test\n   - **Resu...", "module": "sql_service", "function": "_execute_with_agent", "line": 809}
{"timestamp": "2026-01-12T04:46:47.643181Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 810}
{"timestamp": "2026-01-12T04:46:47.643431Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "\u2705 KPI fast-path completed (trace_id=6684dbb3-111c-4e87-b7dc-2605d425ad3d, duration=12.45s)", "module": "agent_service", "function": "process_query", "line": 291}
{"timestamp": "2026-01-12T04:46:55.099504Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=admin, query_length=44", "module": "chat", "function": "chat", "line": 35, "user_id": "admin"}
{"timestamp": "2026-01-12T04:46:55.099872Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=4b4dba23-91fc-4b86-bef3-070b4cba4b1f): 'How many patients are in each risk category?...'", "module": "agent_service", "function": "process_query", "line": 251}
{"timestamp": "2026-01-12T04:46:55.099982Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI Template Match: 'high.?risk.*patient|critical.*patient|risk.*(category|stratification)' -> high-risk patient distribution by category", "module": "sql_service", "function": "_check_dashboard_kpi", "line": 555}
{"timestamp": "2026-01-12T04:46:55.100043Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "\u26a1 FAST PATH: KPI template matched on original query: high-risk patient distribution by category", "module": "agent_service", "function": "process_query", "line": 261}
{"timestamp": "2026-01-12T04:46:55.100100Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 638}
{"timestamp": "2026-01-12T04:46:55.100154Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 KPI TEMPLATE EXECUTION (1 API call):", "module": "sql_service", "function": "_execute_kpi_template", "line": 639}
{"timestamp": "2026-01-12T04:46:55.100208Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 640}
{"timestamp": "2026-01-12T04:46:55.100264Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Template: high-risk patient distribution by category", "module": "sql_service", "function": "_execute_kpi_template", "line": 641}
{"timestamp": "2026-01-12T04:46:55.100326Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL: SELECT risk_category, COUNT(DISTINCT patient_track_id) as count\n        FROM v_high_risk_patients \n        WHERE workflow_status = 'NCD'\n        GROUP BY risk_category\n        ORDER BY CASE risk_categ...", "module": "sql_service", "function": "_execute_kpi_template", "line": 642}
{"timestamp": "2026-01-12T04:46:55.136176Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query result: [('Critical', 166), ('High', 1279), ('Moderate', 1334), ('Low', 4007)]", "module": "sql_service", "function": "_execute_kpi_template", "line": 646}
{"timestamp": "2026-01-12T04:46:57.676122Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-12T04:46:57.679077Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 661}
{"timestamp": "2026-01-12T04:46:57.679197Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u2705 KPI template execution completed with 1 API call", "module": "sql_service", "function": "_execute_kpi_template", "line": 662}
{"timestamp": "2026-01-12T04:46:57.679286Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: In the NCD program, the distribution of high-risk patients by category is as follows: there are 166 patients classified as 'Critical', 1,279 as 'High', 1,334 as 'Moderate', and 4,007 as 'Low'. These numbers represent the count of distinct patients in each risk category, indicating the level of atten...", "module": "sql_service", "function": "_execute_kpi_template", "line": 663}
{"timestamp": "2026-01-12T04:46:57.679362Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_kpi_template", "line": 664}
{"timestamp": "2026-01-12T04:46:57.679515Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "\u2705 KPI fast-path completed (trace_id=4b4dba23-91fc-4b86-bef3-070b4cba4b1f, duration=2.58s)", "module": "agent_service", "function": "process_query", "line": 291}
{"timestamp": "2026-01-27T11:14:00.056708Z", "level": "INFO", "logger": "backend.app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-27T11:14:00.056909Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-27T11:14:00.056938Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-27T11:14:00.057018Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-27T11:14:00.074030Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-27T11:14:00.074086Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-27T11:14:02.260561Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-27T11:14:02.260683Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-27T11:14:02.260749Z", "level": "INFO", "logger": "backend.app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-27T11:14:02.260779Z", "level": "INFO", "logger": "backend.app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-27T11:14:07.314594Z", "level": "INFO", "logger": "backend.app", "message": "Shutting down application", "module": "app", "function": "lifespan", "line": 34}
{"timestamp": "2026-01-27T11:14:10.725628Z", "level": "INFO", "logger": "backend.app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-27T11:14:10.725673Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-27T11:14:10.725702Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-27T11:14:10.725783Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-27T11:14:10.740497Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-27T11:14:10.740540Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-27T11:14:11.926807Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-27T11:14:11.926925Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-27T11:14:11.926980Z", "level": "INFO", "logger": "backend.app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-27T11:14:11.927037Z", "level": "INFO", "logger": "backend.app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-27T11:14:14.962427Z", "level": "INFO", "logger": "backend.app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-27T11:14:14.962468Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-27T11:14:14.962493Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-27T11:14:14.962574Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-27T11:14:14.978001Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-27T11:14:14.978038Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-27T11:14:16.249739Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-27T11:14:16.249881Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-27T11:14:16.249945Z", "level": "INFO", "logger": "backend.app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-27T11:14:16.249969Z", "level": "INFO", "logger": "backend.app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-27T11:14:19.260699Z", "level": "INFO", "logger": "backend.app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-27T11:14:19.260751Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-27T11:14:19.260782Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-27T11:14:19.260887Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-27T11:14:19.276190Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-27T11:14:19.276237Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-27T11:14:20.500622Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-27T11:14:20.500685Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-27T11:14:20.500713Z", "level": "INFO", "logger": "backend.app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-27T11:14:20.500732Z", "level": "INFO", "logger": "backend.app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-27T11:16:13.607133Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Connecting to database at postgresql://admin:admin@localhost:5432/Spice_BD", "module": "sql_service", "function": "__init__", "line": 389}
{"timestamp": "2026-01-27T11:16:13.986856Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Database connection established with view support", "module": "sql_service", "function": "__init__", "line": 417}
{"timestamp": "2026-01-27T11:16:14.136368Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Cached schema for 48 relevant tables out of 125 total", "module": "sql_service", "function": "_cache_schema", "line": 482}
{"timestamp": "2026-01-27T11:16:14.136431Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Relevant tables: bp_log, current_medication, diagnosis, glucose_log, lab_test, lab_test_result, lab_test_result_range, medical_compliance, medication_country_detail, patient...", "module": "sql_service", "function": "_cache_schema", "line": 483}
{"timestamp": "2026-01-27T11:16:14.260400Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "SQL agent initialized successfully with 48 cached tables", "module": "sql_service", "function": "__init__", "line": 444}
{"timestamp": "2026-01-27T11:16:14.260465Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Initializing AgentService", "module": "agent_service", "function": "__init__", "line": 151}
{"timestamp": "2026-01-27T11:16:14.265501Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "AgentService initialized successfully", "module": "agent_service", "function": "__init__", "line": 216}
{"timestamp": "2026-01-27T11:16:46.839225Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-27T11:18:45.950076Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-27T12:18:34.530862Z", "level": "INFO", "logger": "backend.app", "message": "Shutting down application", "module": "app", "function": "lifespan", "line": 34}
{"timestamp": "2026-01-27T12:18:38.756419Z", "level": "INFO", "logger": "backend.app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-27T12:18:38.756463Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-27T12:18:38.756486Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-27T12:18:38.756562Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-27T12:18:38.772077Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-27T12:18:38.772115Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-27T12:18:40.597858Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-27T12:18:40.597951Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-27T12:18:40.598022Z", "level": "INFO", "logger": "backend.app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-27T12:18:40.598044Z", "level": "INFO", "logger": "backend.app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-27T12:18:50.295428Z", "level": "INFO", "logger": "backend.app", "message": "Shutting down application", "module": "app", "function": "lifespan", "line": 34}
{"timestamp": "2026-01-27T12:24:02.556529Z", "level": "INFO", "logger": "backend.app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-27T12:24:02.556575Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-27T12:24:02.556600Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-27T12:24:02.556685Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-27T12:24:02.570861Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-27T12:24:02.570913Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-27T12:24:03.680257Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-27T12:24:03.680461Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-27T12:24:03.680636Z", "level": "INFO", "logger": "backend.app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-27T12:24:03.680707Z", "level": "INFO", "logger": "backend.app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-27T12:27:32.435642Z", "level": "INFO", "logger": "backend.app", "message": "Shutting down application", "module": "app", "function": "lifespan", "line": 34}
{"timestamp": "2026-01-27T12:30:12.010887Z", "level": "INFO", "logger": "backend.app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-27T12:30:12.010928Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-27T12:30:12.010955Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-27T12:30:12.011034Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-27T12:30:12.025835Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-27T12:30:12.025882Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-27T12:30:13.157388Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-27T12:30:13.157489Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-27T12:30:13.157570Z", "level": "INFO", "logger": "backend.app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-27T12:30:13.157589Z", "level": "INFO", "logger": "backend.app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-27T12:32:03.097513Z", "level": "INFO", "logger": "backend.app", "message": "Shutting down application", "module": "app", "function": "lifespan", "line": 34}
{"timestamp": "2026-01-27T12:32:06.116287Z", "level": "INFO", "logger": "backend.app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-27T12:32:06.116327Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-27T12:32:06.116351Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-27T12:32:06.116463Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-27T12:32:06.131008Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-27T12:32:06.131061Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-27T12:32:07.124416Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-27T12:32:07.124503Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-27T12:32:07.124562Z", "level": "INFO", "logger": "backend.app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-27T12:32:07.124588Z", "level": "INFO", "logger": "backend.app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-27T12:33:51.290205Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login attempt for user: admin", "module": "auth", "function": "login", "line": 111}
{"timestamp": "2026-01-27T12:33:51.474542Z", "level": "INFO", "logger": "backend.sqliteDb.db", "message": "Authentication successful: admin", "module": "db", "function": "authenticate_user", "line": 297}
{"timestamp": "2026-01-27T12:33:51.477764Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login successful for user: admin", "module": "auth", "function": "login", "line": 132}
{"timestamp": "2026-01-27T12:33:51.984594Z", "level": "INFO", "logger": "backend.app", "message": "Shutting down application", "module": "app", "function": "lifespan", "line": 34}
{"timestamp": "2026-01-27T12:33:54.962388Z", "level": "INFO", "logger": "backend.app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-27T12:33:54.962427Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-27T12:33:54.962450Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-27T12:33:54.962527Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-27T12:33:54.978071Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-27T12:33:54.978116Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-27T12:33:56.077277Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-27T12:33:56.077382Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-27T12:33:56.077423Z", "level": "INFO", "logger": "backend.app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-27T12:33:56.077446Z", "level": "INFO", "logger": "backend.app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-27T12:33:59.066938Z", "level": "INFO", "logger": "backend.app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-27T12:33:59.066991Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-27T12:33:59.067018Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-27T12:33:59.067097Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-27T12:33:59.081894Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-27T12:33:59.081934Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-27T12:34:00.185697Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-27T12:34:00.185781Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-27T12:34:00.185835Z", "level": "INFO", "logger": "backend.app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-27T12:34:00.185857Z", "level": "INFO", "logger": "backend.app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-27T12:34:00.193406Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Connecting to database at postgresql://admin:admin@localhost:5432/Spice_BD", "module": "sql_service", "function": "__init__", "line": 389}
{"timestamp": "2026-01-27T12:34:00.684922Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Database connection established with view support", "module": "sql_service", "function": "__init__", "line": 417}
{"timestamp": "2026-01-27T12:34:00.857638Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Cached schema for 48 relevant tables out of 125 total", "module": "sql_service", "function": "_cache_schema", "line": 482}
{"timestamp": "2026-01-27T12:34:00.857691Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Relevant tables: bp_log, current_medication, diagnosis, glucose_log, lab_test, lab_test_result, lab_test_result_range, medical_compliance, medication_country_detail, patient...", "module": "sql_service", "function": "_cache_schema", "line": 483}
{"timestamp": "2026-01-27T12:34:00.977573Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "SQL agent initialized successfully with 48 cached tables", "module": "sql_service", "function": "__init__", "line": 444}
{"timestamp": "2026-01-27T12:34:00.977638Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Initializing AgentService", "module": "agent_service", "function": "__init__", "line": 151}
{"timestamp": "2026-01-27T12:34:00.982345Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "AgentService initialized successfully", "module": "agent_service", "function": "__init__", "line": 216}
{"timestamp": "2026-01-27T12:39:03.929063Z", "level": "INFO", "logger": "backend.app", "message": "Shutting down application", "module": "app", "function": "lifespan", "line": 34}
{"timestamp": "2026-01-27T12:39:06.880540Z", "level": "INFO", "logger": "backend.app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-27T12:39:06.880581Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-27T12:39:06.880610Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-27T12:39:06.880693Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-27T12:39:06.894470Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-27T12:39:06.894515Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-27T12:39:08.053868Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-27T12:39:08.053990Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-27T12:39:08.054079Z", "level": "INFO", "logger": "backend.app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-27T12:39:08.054106Z", "level": "INFO", "logger": "backend.app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-27T12:42:56.194987Z", "level": "INFO", "logger": "backend.app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-27T12:42:56.195021Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-27T12:42:56.195047Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-27T12:42:56.195123Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-27T12:42:56.209146Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-27T12:42:56.209177Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-27T12:43:05.048788Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-27T12:43:05.048910Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-27T12:43:05.048998Z", "level": "INFO", "logger": "backend.app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-27T12:43:05.049023Z", "level": "INFO", "logger": "backend.app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-27T12:43:08.060116Z", "level": "INFO", "logger": "backend.app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-27T12:43:08.060170Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-27T12:43:08.060199Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-27T12:43:08.060278Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-27T12:43:08.074287Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-27T12:43:08.074328Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-27T12:43:09.101570Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-27T12:43:09.101669Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-27T12:43:09.101742Z", "level": "INFO", "logger": "backend.app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-27T12:43:09.101767Z", "level": "INFO", "logger": "backend.app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-27T12:43:09.107733Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Connecting to database at postgresql://admin:admin@localhost:5432/Spice_BD", "module": "sql_service", "function": "__init__", "line": 389}
{"timestamp": "2026-01-27T12:43:09.110453Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Connecting to database at postgresql://admin:admin@localhost:5432/Spice_BD", "module": "sql_service", "function": "__init__", "line": 389}
{"timestamp": "2026-01-27T12:43:09.906153Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Database connection established with view support", "module": "sql_service", "function": "__init__", "line": 417}
{"timestamp": "2026-01-27T12:43:09.915212Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Database connection established with view support", "module": "sql_service", "function": "__init__", "line": 417}
{"timestamp": "2026-01-27T12:43:10.197042Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Cached schema for 48 relevant tables out of 125 total", "module": "sql_service", "function": "_cache_schema", "line": 482}
{"timestamp": "2026-01-27T12:43:10.197144Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Relevant tables: bp_log, current_medication, diagnosis, glucose_log, lab_test, lab_test_result, lab_test_result_range, medical_compliance, medication_country_detail, patient...", "module": "sql_service", "function": "_cache_schema", "line": 483}
{"timestamp": "2026-01-27T12:43:10.198915Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Cached schema for 48 relevant tables out of 125 total", "module": "sql_service", "function": "_cache_schema", "line": 482}
{"timestamp": "2026-01-27T12:43:10.198985Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Relevant tables: bp_log, current_medication, diagnosis, glucose_log, lab_test, lab_test_result, lab_test_result_range, medical_compliance, medication_country_detail, patient...", "module": "sql_service", "function": "_cache_schema", "line": 483}
{"timestamp": "2026-01-27T12:43:10.435083Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "SQL agent initialized successfully with 48 cached tables", "module": "sql_service", "function": "__init__", "line": 444}
{"timestamp": "2026-01-27T12:43:10.435250Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "SQL agent initialized successfully with 48 cached tables", "module": "sql_service", "function": "__init__", "line": 444}
{"timestamp": "2026-01-27T12:43:10.435347Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Initializing AgentService", "module": "agent_service", "function": "__init__", "line": 151}
{"timestamp": "2026-01-27T12:43:10.442334Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Initializing AgentService", "module": "agent_service", "function": "__init__", "line": 151}
{"timestamp": "2026-01-27T12:43:10.457739Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "AgentService initialized successfully", "module": "agent_service", "function": "__init__", "line": 216}
{"timestamp": "2026-01-27T12:43:10.457908Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "AgentService initialized successfully", "module": "agent_service", "function": "__init__", "line": 216}
{"timestamp": "2026-01-27T15:21:15.666538Z", "level": "INFO", "logger": "backend.app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-27T15:21:15.666717Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-27T15:21:15.666750Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-27T15:21:15.666874Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-27T15:21:15.681781Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-27T15:21:15.681823Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-27T15:21:17.929831Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-27T15:21:17.929935Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-27T15:21:17.929988Z", "level": "INFO", "logger": "backend.app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-27T15:21:17.930010Z", "level": "INFO", "logger": "backend.app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-27T15:23:53.084402Z", "level": "INFO", "logger": "backend.app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-27T15:23:53.084456Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-27T15:23:53.084479Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-27T15:23:53.084570Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-27T15:23:53.099773Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-27T15:23:53.099825Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-27T15:23:55.014983Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-27T15:23:55.015069Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-27T15:23:55.015121Z", "level": "INFO", "logger": "backend.app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-27T15:23:55.015141Z", "level": "INFO", "logger": "backend.app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-27T15:29:07.701853Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Connecting to database at postgresql://admin:admin@localhost:5432/Spice_BD", "module": "sql_service", "function": "__init__", "line": 389}
{"timestamp": "2026-01-27T15:29:08.113235Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Database connection established with view support", "module": "sql_service", "function": "__init__", "line": 417}
{"timestamp": "2026-01-27T15:29:08.262186Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Cached schema for 48 relevant tables out of 125 total", "module": "sql_service", "function": "_cache_schema", "line": 482}
{"timestamp": "2026-01-27T15:29:08.262241Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Relevant tables: bp_log, current_medication, diagnosis, glucose_log, lab_test, lab_test_result, lab_test_result_range, medical_compliance, medication_country_detail, patient...", "module": "sql_service", "function": "_cache_schema", "line": 483}
{"timestamp": "2026-01-27T15:29:08.389111Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "SQL agent initialized successfully with 48 cached tables", "module": "sql_service", "function": "__init__", "line": 444}
{"timestamp": "2026-01-27T15:29:08.389168Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Initializing AgentService", "module": "agent_service", "function": "__init__", "line": 151}
{"timestamp": "2026-01-27T15:29:08.394304Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "AgentService initialized successfully", "module": "agent_service", "function": "__init__", "line": 216}
{"timestamp": "2026-01-27T15:30:03.096384Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login attempt for user: admin", "module": "auth", "function": "login", "line": 111}
{"timestamp": "2026-01-27T15:30:03.289684Z", "level": "INFO", "logger": "backend.sqliteDb.db", "message": "Authentication successful: admin", "module": "db", "function": "authenticate_user", "line": 303}
{"timestamp": "2026-01-27T15:30:03.292468Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login successful for user: admin", "module": "auth", "function": "login", "line": 132}
{"timestamp": "2026-01-27T15:40:04.658745Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login attempt for user: admin", "module": "auth", "function": "login", "line": 111}
{"timestamp": "2026-01-27T15:40:04.849712Z", "level": "INFO", "logger": "backend.sqliteDb.db", "message": "Authentication successful: admin", "module": "db", "function": "authenticate_user", "line": 303}
{"timestamp": "2026-01-27T15:40:04.849882Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login successful for user: admin", "module": "auth", "function": "login", "line": 132}
{"timestamp": "2026-01-27T15:54:32.169012Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login attempt for user: admin", "module": "auth", "function": "login", "line": 111}
{"timestamp": "2026-01-27T15:54:32.368744Z", "level": "INFO", "logger": "backend.sqliteDb.db", "message": "Authentication successful: admin", "module": "db", "function": "authenticate_user", "line": 303}
{"timestamp": "2026-01-27T15:54:32.368932Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login successful for user: admin", "module": "auth", "function": "login", "line": 132}
{"timestamp": "2026-01-27T15:59:14.446440Z", "level": "INFO", "logger": "backend.app", "message": "Shutting down application", "module": "app", "function": "lifespan", "line": 34}
{"timestamp": "2026-01-27T16:07:35.568497Z", "level": "INFO", "logger": "backend.app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-27T16:07:35.568545Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-27T16:07:35.568569Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-27T16:07:35.568639Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-27T16:07:35.585800Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-27T16:07:35.585843Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-27T16:07:37.490877Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-27T16:07:37.490983Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-27T16:07:37.491073Z", "level": "INFO", "logger": "backend.app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-27T16:07:37.491096Z", "level": "INFO", "logger": "backend.app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-27T16:07:37.512790Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login attempt for user: admin", "module": "auth", "function": "login", "line": 112}
{"timestamp": "2026-01-27T16:07:37.702745Z", "level": "INFO", "logger": "backend.sqliteDb.db", "message": "Authentication successful: admin", "module": "db", "function": "authenticate_user", "line": 303}
{"timestamp": "2026-01-27T16:07:37.704684Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login successful for user: admin", "module": "auth", "function": "login", "line": 133}
{"timestamp": "2026-01-27T16:07:37.727008Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Connecting to database at postgresql://admin:admin@localhost:5432/Spice_BD", "module": "sql_service", "function": "__init__", "line": 389}
{"timestamp": "2026-01-27T16:07:38.160463Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Database connection established with view support", "module": "sql_service", "function": "__init__", "line": 417}
{"timestamp": "2026-01-27T16:07:38.308025Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Cached schema for 48 relevant tables out of 125 total", "module": "sql_service", "function": "_cache_schema", "line": 482}
{"timestamp": "2026-01-27T16:07:38.308074Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Relevant tables: bp_log, current_medication, diagnosis, glucose_log, lab_test, lab_test_result, lab_test_result_range, medical_compliance, medication_country_detail, patient...", "module": "sql_service", "function": "_cache_schema", "line": 483}
{"timestamp": "2026-01-27T16:07:38.449592Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "SQL agent initialized successfully with 48 cached tables", "module": "sql_service", "function": "__init__", "line": 444}
{"timestamp": "2026-01-27T16:07:38.449655Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Initializing AgentService", "module": "agent_service", "function": "__init__", "line": 151}
{"timestamp": "2026-01-27T16:07:38.454741Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "AgentService initialized successfully", "module": "agent_service", "function": "__init__", "line": 216}
{"timestamp": "2026-01-27T16:08:39.733302Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login attempt for user: admin", "module": "auth", "function": "login", "line": 112}
{"timestamp": "2026-01-27T16:08:39.924356Z", "level": "INFO", "logger": "backend.sqliteDb.db", "message": "Authentication successful: admin", "module": "db", "function": "authenticate_user", "line": 303}
{"timestamp": "2026-01-27T16:08:39.924499Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login successful for user: admin", "module": "auth", "function": "login", "line": 133}
{"timestamp": "2026-01-27T16:10:34.374476Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login attempt for user: admin", "module": "auth", "function": "login", "line": 112}
{"timestamp": "2026-01-27T16:10:34.564653Z", "level": "INFO", "logger": "backend.sqliteDb.db", "message": "Authentication successful: admin", "module": "db", "function": "authenticate_user", "line": 303}
{"timestamp": "2026-01-27T16:10:34.564797Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login successful for user: admin", "module": "auth", "function": "login", "line": 133}
{"timestamp": "2026-01-27T16:22:25.241959Z", "level": "INFO", "logger": "backend.app", "message": "Shutting down application", "module": "app", "function": "lifespan", "line": 34}
{"timestamp": "2026-01-27T16:22:29.293291Z", "level": "INFO", "logger": "backend.app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-27T16:22:29.293331Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-27T16:22:29.293354Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-27T16:22:29.293430Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-27T16:22:29.309908Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-27T16:22:29.309972Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-27T16:22:31.184253Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-27T16:22:31.184374Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-27T16:22:31.184435Z", "level": "INFO", "logger": "backend.app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-27T16:22:31.184458Z", "level": "INFO", "logger": "backend.app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-27T16:22:34.286537Z", "level": "INFO", "logger": "backend.app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-27T16:22:34.286590Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-27T16:22:34.286617Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-27T16:22:34.286698Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-27T16:22:34.302319Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-27T16:22:34.302372Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-27T16:22:35.267569Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-27T16:22:35.267685Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-27T16:22:35.267745Z", "level": "INFO", "logger": "backend.app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-27T16:22:35.267771Z", "level": "INFO", "logger": "backend.app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-27T16:25:28.724061Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login attempt for user: admin", "module": "auth", "function": "login", "line": 112}
{"timestamp": "2026-01-27T16:25:28.910268Z", "level": "INFO", "logger": "backend.sqliteDb.db", "message": "Authentication successful: admin", "module": "db", "function": "authenticate_user", "line": 303}
{"timestamp": "2026-01-27T16:25:28.912320Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login successful for user: admin", "module": "auth", "function": "login", "line": 133}
{"timestamp": "2026-01-27T16:25:28.931139Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Connecting to database at postgresql://admin:admin@localhost:5432/Spice_BD", "module": "sql_service", "function": "__init__", "line": 389}
{"timestamp": "2026-01-27T16:25:29.284135Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Database connection established with view support", "module": "sql_service", "function": "__init__", "line": 417}
{"timestamp": "2026-01-27T16:25:29.436865Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Cached schema for 48 relevant tables out of 125 total", "module": "sql_service", "function": "_cache_schema", "line": 482}
{"timestamp": "2026-01-27T16:25:29.436918Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Relevant tables: bp_log, current_medication, diagnosis, glucose_log, lab_test, lab_test_result, lab_test_result_range, medical_compliance, medication_country_detail, patient...", "module": "sql_service", "function": "_cache_schema", "line": 483}
{"timestamp": "2026-01-27T16:25:29.558763Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "SQL agent initialized successfully with 48 cached tables", "module": "sql_service", "function": "__init__", "line": 444}
{"timestamp": "2026-01-27T16:25:29.558824Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Initializing AgentService", "module": "agent_service", "function": "__init__", "line": 151}
{"timestamp": "2026-01-27T16:25:29.563663Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "AgentService initialized successfully", "module": "agent_service", "function": "__init__", "line": 216}
{"timestamp": "2026-01-27T16:27:48.425332Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login attempt for user: admin", "module": "auth", "function": "login", "line": 112}
{"timestamp": "2026-01-27T16:27:48.618542Z", "level": "WARNING", "logger": "backend.sqliteDb.db", "message": "Authentication failed: Invalid password - admin", "module": "db", "function": "authenticate_user", "line": 298}
{"timestamp": "2026-01-27T16:27:48.618602Z", "level": "WARNING", "logger": "backend.api.routes.auth", "message": "Login failed for user: admin", "module": "auth", "function": "login", "line": 119}
{"timestamp": "2026-01-27T16:27:50.804863Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login attempt for user: admin", "module": "auth", "function": "login", "line": 112}
{"timestamp": "2026-01-27T16:27:50.994523Z", "level": "INFO", "logger": "backend.sqliteDb.db", "message": "Authentication successful: admin", "module": "db", "function": "authenticate_user", "line": 303}
{"timestamp": "2026-01-27T16:27:50.994677Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login successful for user: admin", "module": "auth", "function": "login", "line": 133}
{"timestamp": "2026-01-27T16:38:30.589931Z", "level": "INFO", "logger": "backend.app", "message": "Shutting down application", "module": "app", "function": "lifespan", "line": 34}
{"timestamp": "2026-01-27T16:38:34.633991Z", "level": "INFO", "logger": "backend.app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-27T16:38:34.634030Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-27T16:38:34.634052Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-27T16:38:34.634131Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-27T16:38:34.653245Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-27T16:38:34.653286Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-27T16:38:36.520344Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-27T16:38:36.520706Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-27T16:38:36.520854Z", "level": "INFO", "logger": "backend.app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-27T16:38:36.520887Z", "level": "INFO", "logger": "backend.app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-27T16:42:37.340899Z", "level": "INFO", "logger": "backend.app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-27T16:42:37.340953Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-27T16:42:37.340980Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-27T16:42:37.341079Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-27T16:42:37.355771Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-27T16:42:37.355821Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-27T16:42:38.537455Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-27T16:42:38.537741Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-27T16:42:38.537820Z", "level": "INFO", "logger": "backend.app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-27T16:42:38.537842Z", "level": "INFO", "logger": "backend.app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-27T16:44:49.616447Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login attempt for user: admin", "module": "auth", "function": "login", "line": 112}
{"timestamp": "2026-01-27T16:44:49.800833Z", "level": "INFO", "logger": "backend.sqliteDb.db", "message": "Authentication successful: admin", "module": "db", "function": "authenticate_user", "line": 303}
{"timestamp": "2026-01-27T16:44:49.802423Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login successful for user: admin", "module": "auth", "function": "login", "line": 133}
{"timestamp": "2026-01-27T16:44:49.820168Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Connecting to database at postgresql://admin:admin@localhost:5432/Spice_BD", "module": "sql_service", "function": "__init__", "line": 389}
{"timestamp": "2026-01-27T16:44:50.203658Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Database connection established with view support", "module": "sql_service", "function": "__init__", "line": 417}
{"timestamp": "2026-01-27T16:44:50.360257Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Cached schema for 48 relevant tables out of 125 total", "module": "sql_service", "function": "_cache_schema", "line": 482}
{"timestamp": "2026-01-27T16:44:50.360310Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Relevant tables: bp_log, current_medication, diagnosis, glucose_log, lab_test, lab_test_result, lab_test_result_range, medical_compliance, medication_country_detail, patient...", "module": "sql_service", "function": "_cache_schema", "line": 483}
{"timestamp": "2026-01-27T16:44:50.488382Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "SQL agent initialized successfully with 48 cached tables", "module": "sql_service", "function": "__init__", "line": 444}
{"timestamp": "2026-01-27T16:44:50.488454Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Initializing AgentService", "module": "agent_service", "function": "__init__", "line": 151}
{"timestamp": "2026-01-27T16:44:50.493560Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "AgentService initialized successfully", "module": "agent_service", "function": "__init__", "line": 216}
{"timestamp": "2026-01-27T16:46:28.894779Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login attempt for user: admin_user", "module": "auth", "function": "login", "line": 112}
{"timestamp": "2026-01-27T16:46:29.088418Z", "level": "INFO", "logger": "backend.sqliteDb.db", "message": "Authentication successful: admin_user", "module": "db", "function": "authenticate_user", "line": 303}
{"timestamp": "2026-01-27T16:46:29.088561Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login successful for user: admin_user", "module": "auth", "function": "login", "line": 133}
{"timestamp": "2026-01-27T16:48:58.742339Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login attempt for user: admin_user", "module": "auth", "function": "login", "line": 112}
{"timestamp": "2026-01-27T16:48:58.933923Z", "level": "WARNING", "logger": "backend.sqliteDb.db", "message": "Authentication failed: Invalid password - admin_user", "module": "db", "function": "authenticate_user", "line": 298}
{"timestamp": "2026-01-27T16:48:58.933983Z", "level": "WARNING", "logger": "backend.api.routes.auth", "message": "Login failed for user: admin_user", "module": "auth", "function": "login", "line": 119}
{"timestamp": "2026-01-27T16:49:04.850556Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login attempt for user: admin_user", "module": "auth", "function": "login", "line": 112}
{"timestamp": "2026-01-27T16:49:05.038594Z", "level": "WARNING", "logger": "backend.sqliteDb.db", "message": "Authentication failed: Invalid password - admin_user", "module": "db", "function": "authenticate_user", "line": 298}
{"timestamp": "2026-01-27T16:49:05.038651Z", "level": "WARNING", "logger": "backend.api.routes.auth", "message": "Login failed for user: admin_user", "module": "auth", "function": "login", "line": 119}
{"timestamp": "2026-01-27T16:49:31.633746Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login attempt for user: admin_user", "module": "auth", "function": "login", "line": 112}
{"timestamp": "2026-01-27T16:49:31.823800Z", "level": "INFO", "logger": "backend.sqliteDb.db", "message": "Authentication successful: admin_user", "module": "db", "function": "authenticate_user", "line": 303}
{"timestamp": "2026-01-27T16:49:31.823958Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login successful for user: admin_user", "module": "auth", "function": "login", "line": 133}
{"timestamp": "2026-01-27T16:50:01.584597Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login attempt for user: admin_user", "module": "auth", "function": "login", "line": 112}
{"timestamp": "2026-01-27T16:50:01.774422Z", "level": "INFO", "logger": "backend.sqliteDb.db", "message": "Authentication successful: admin_user", "module": "db", "function": "authenticate_user", "line": 303}
{"timestamp": "2026-01-27T16:50:01.774570Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login successful for user: admin_user", "module": "auth", "function": "login", "line": 133}
{"timestamp": "2026-01-27T16:51:14.200555Z", "level": "INFO", "logger": "backend.app", "message": "Shutting down application", "module": "app", "function": "lifespan", "line": 34}
{"timestamp": "2026-01-27T16:51:18.423140Z", "level": "INFO", "logger": "backend.app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-27T16:51:18.423191Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-27T16:51:18.423214Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-27T16:51:18.423299Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-27T16:51:18.438376Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-27T16:51:18.438425Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-27T16:51:20.528218Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-27T16:51:20.528667Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-27T16:51:20.528730Z", "level": "INFO", "logger": "backend.app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-27T16:51:20.528770Z", "level": "INFO", "logger": "backend.app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-27T16:51:45.507491Z", "level": "INFO", "logger": "backend.app", "message": "Shutting down application", "module": "app", "function": "lifespan", "line": 34}
{"timestamp": "2026-01-27T16:51:48.991650Z", "level": "INFO", "logger": "backend.app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-27T16:51:48.991704Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-27T16:51:48.991730Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-27T16:51:48.991817Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-27T16:51:49.008753Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-27T16:51:49.008802Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-27T16:51:50.099953Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-27T16:51:50.100339Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-27T16:51:50.100391Z", "level": "INFO", "logger": "backend.app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-27T16:51:50.100416Z", "level": "INFO", "logger": "backend.app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-27T16:52:33.354655Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login attempt for user: admin_user", "module": "auth", "function": "login", "line": 112}
{"timestamp": "2026-01-27T16:52:33.541390Z", "level": "WARNING", "logger": "backend.sqliteDb.db", "message": "Authentication failed: Invalid password - admin_user", "module": "db", "function": "authenticate_user", "line": 298}
{"timestamp": "2026-01-27T16:52:33.541451Z", "level": "WARNING", "logger": "backend.api.routes.auth", "message": "Login failed for user: admin_user", "module": "auth", "function": "login", "line": 119}
{"timestamp": "2026-01-27T16:52:43.251628Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login attempt for user: admin_user", "module": "auth", "function": "login", "line": 112}
{"timestamp": "2026-01-27T16:52:43.445189Z", "level": "INFO", "logger": "backend.sqliteDb.db", "message": "Authentication successful: admin_user", "module": "db", "function": "authenticate_user", "line": 303}
{"timestamp": "2026-01-27T16:52:43.447217Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login successful for user: admin_user", "module": "auth", "function": "login", "line": 133}
{"timestamp": "2026-01-27T16:52:43.462468Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Connecting to database at postgresql://admin:admin@localhost:5432/Spice_BD", "module": "sql_service", "function": "__init__", "line": 389}
{"timestamp": "2026-01-27T16:52:43.877834Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Database connection established with view support", "module": "sql_service", "function": "__init__", "line": 417}
{"timestamp": "2026-01-27T16:52:44.014435Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Cached schema for 48 relevant tables out of 125 total", "module": "sql_service", "function": "_cache_schema", "line": 482}
{"timestamp": "2026-01-27T16:52:44.014491Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Relevant tables: bp_log, current_medication, diagnosis, glucose_log, lab_test, lab_test_result, lab_test_result_range, medical_compliance, medication_country_detail, patient...", "module": "sql_service", "function": "_cache_schema", "line": 483}
{"timestamp": "2026-01-27T16:52:44.134166Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "SQL agent initialized successfully with 48 cached tables", "module": "sql_service", "function": "__init__", "line": 444}
{"timestamp": "2026-01-27T16:52:44.134224Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Initializing AgentService", "module": "agent_service", "function": "__init__", "line": 151}
{"timestamp": "2026-01-27T16:52:44.139035Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "AgentService initialized successfully", "module": "agent_service", "function": "__init__", "line": 216}
{"timestamp": "2026-01-27T16:52:58.484505Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login attempt for user: admin_user", "module": "auth", "function": "login", "line": 112}
{"timestamp": "2026-01-27T16:52:58.673904Z", "level": "INFO", "logger": "backend.sqliteDb.db", "message": "Authentication successful: admin_user", "module": "db", "function": "authenticate_user", "line": 303}
{"timestamp": "2026-01-27T16:52:58.674056Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login successful for user: admin_user", "module": "auth", "function": "login", "line": 133}
{"timestamp": "2026-01-27T16:54:53.977518Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login attempt for user: admin_user", "module": "auth", "function": "login", "line": 112}
{"timestamp": "2026-01-27T16:54:54.170740Z", "level": "INFO", "logger": "backend.sqliteDb.db", "message": "Authentication successful: admin_user", "module": "db", "function": "authenticate_user", "line": 303}
{"timestamp": "2026-01-27T16:54:54.170888Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login successful for user: admin_user", "module": "auth", "function": "login", "line": 133}
{"timestamp": "2026-01-27T16:55:26.331572Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login attempt for user: admin_user", "module": "auth", "function": "login", "line": 112}
{"timestamp": "2026-01-27T16:55:26.534714Z", "level": "INFO", "logger": "backend.sqliteDb.db", "message": "Authentication successful: admin_user", "module": "db", "function": "authenticate_user", "line": 303}
{"timestamp": "2026-01-27T16:55:26.534855Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login successful for user: admin_user", "module": "auth", "function": "login", "line": 133}
{"timestamp": "2026-01-27T17:07:34.859479Z", "level": "INFO", "logger": "backend.app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-27T17:07:34.859573Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-27T17:07:34.859612Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-27T17:07:34.859700Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-27T17:07:34.875006Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-27T17:07:34.875053Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-27T17:07:36.280611Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-27T17:07:36.280763Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-27T17:07:36.280900Z", "level": "INFO", "logger": "backend.app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-27T17:07:36.280937Z", "level": "INFO", "logger": "backend.app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-27T17:07:43.556621Z", "level": "INFO", "logger": "backend.app", "message": "Shutting down application", "module": "app", "function": "lifespan", "line": 34}
{"timestamp": "2026-01-27T17:07:46.688819Z", "level": "INFO", "logger": "backend.app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-27T17:07:46.688869Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-27T17:07:46.688897Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-27T17:07:46.688978Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-27T17:07:46.703668Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-27T17:07:46.703714Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-27T17:07:47.636798Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-27T17:07:47.637024Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-27T17:07:47.637142Z", "level": "INFO", "logger": "backend.app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-27T17:07:47.637169Z", "level": "INFO", "logger": "backend.app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-27T17:11:16.061668Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Connecting to database at postgresql://admin:admin@localhost:5432/Spice_BD", "module": "sql_service", "function": "__init__", "line": 389}
{"timestamp": "2026-01-27T17:11:16.446780Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Database connection established with view support", "module": "sql_service", "function": "__init__", "line": 417}
{"timestamp": "2026-01-27T17:11:16.592310Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Cached schema for 48 relevant tables out of 125 total", "module": "sql_service", "function": "_cache_schema", "line": 482}
{"timestamp": "2026-01-27T17:11:16.592365Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Relevant tables: bp_log, current_medication, diagnosis, glucose_log, lab_test, lab_test_result, lab_test_result_range, medical_compliance, medication_country_detail, patient...", "module": "sql_service", "function": "_cache_schema", "line": 483}
{"timestamp": "2026-01-27T17:11:16.709766Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "SQL agent initialized successfully with 48 cached tables", "module": "sql_service", "function": "__init__", "line": 444}
{"timestamp": "2026-01-27T17:11:16.709824Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Initializing AgentService", "module": "agent_service", "function": "__init__", "line": 151}
{"timestamp": "2026-01-27T17:11:16.714671Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "AgentService initialized successfully", "module": "agent_service", "function": "__init__", "line": 216}
{"timestamp": "2026-01-27T17:11:31.464512Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login attempt for user: super_admin", "module": "auth", "function": "login", "line": 112}
{"timestamp": "2026-01-27T17:11:31.465127Z", "level": "WARNING", "logger": "backend.sqliteDb.db", "message": "Authentication failed: User not found - super_admin", "module": "db", "function": "authenticate_user", "line": 290}
{"timestamp": "2026-01-27T17:11:31.465187Z", "level": "WARNING", "logger": "backend.api.routes.auth", "message": "Login failed for user: super_admin", "module": "auth", "function": "login", "line": 119}
{"timestamp": "2026-01-27T17:11:37.346538Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login attempt for user: admin_user", "module": "auth", "function": "login", "line": 112}
{"timestamp": "2026-01-27T17:11:37.538098Z", "level": "INFO", "logger": "backend.sqliteDb.db", "message": "Authentication successful: admin_user", "module": "db", "function": "authenticate_user", "line": 303}
{"timestamp": "2026-01-27T17:11:37.538246Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login successful for user: admin_user", "module": "auth", "function": "login", "line": 133}
{"timestamp": "2026-01-27T17:12:46.164069Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Registration attempt for username: superadmin", "module": "auth", "function": "register", "line": 48}
{"timestamp": "2026-01-27T17:12:46.353539Z", "level": "INFO", "logger": "backend.sqliteDb.db", "message": "User created: superadmin with role: super_admin", "module": "db", "function": "create_user", "line": 230}
{"timestamp": "2026-01-27T17:12:46.353578Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "User registered successfully: superadmin", "module": "auth", "function": "register", "line": 60}
{"timestamp": "2026-01-27T17:12:56.041237Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login attempt for user: superadmin", "module": "auth", "function": "login", "line": 112}
{"timestamp": "2026-01-27T17:12:56.232115Z", "level": "INFO", "logger": "backend.sqliteDb.db", "message": "Authentication successful: superadmin", "module": "db", "function": "authenticate_user", "line": 303}
{"timestamp": "2026-01-27T17:12:56.232284Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login successful for user: superadmin", "module": "auth", "function": "login", "line": 133}
{"timestamp": "2026-01-27T17:13:49.360836Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login attempt for user: viewer_user", "module": "auth", "function": "login", "line": 112}
{"timestamp": "2026-01-27T17:13:49.547600Z", "level": "WARNING", "logger": "backend.sqliteDb.db", "message": "Authentication failed: Invalid password - viewer_user", "module": "db", "function": "authenticate_user", "line": 298}
{"timestamp": "2026-01-27T17:13:49.547650Z", "level": "WARNING", "logger": "backend.api.routes.auth", "message": "Login failed for user: viewer_user", "module": "auth", "function": "login", "line": 119}
{"timestamp": "2026-01-27T17:14:55.681955Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login attempt for user: superadmin", "module": "auth", "function": "login", "line": 112}
{"timestamp": "2026-01-27T17:14:55.874487Z", "level": "INFO", "logger": "backend.sqliteDb.db", "message": "Authentication successful: superadmin", "module": "db", "function": "authenticate_user", "line": 303}
{"timestamp": "2026-01-27T17:14:55.874636Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login successful for user: superadmin", "module": "auth", "function": "login", "line": 133}
{"timestamp": "2026-01-27T17:16:55.332920Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login attempt for user: superadmin", "module": "auth", "function": "login", "line": 112}
{"timestamp": "2026-01-27T17:16:55.526458Z", "level": "INFO", "logger": "backend.sqliteDb.db", "message": "Authentication successful: superadmin", "module": "db", "function": "authenticate_user", "line": 303}
{"timestamp": "2026-01-27T17:16:55.526621Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login successful for user: superadmin", "module": "auth", "function": "login", "line": 133}
{"timestamp": "2026-01-27T17:19:34.329035Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login attempt for user: superadmin", "module": "auth", "function": "login", "line": 112}
{"timestamp": "2026-01-27T17:19:34.520459Z", "level": "INFO", "logger": "backend.sqliteDb.db", "message": "Authentication successful: superadmin", "module": "db", "function": "authenticate_user", "line": 303}
{"timestamp": "2026-01-27T17:19:34.520600Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login successful for user: superadmin", "module": "auth", "function": "login", "line": 133}
{"timestamp": "2026-01-27T17:41:14.744608Z", "level": "INFO", "logger": "backend.app", "message": "Shutting down application", "module": "app", "function": "lifespan", "line": 34}
{"timestamp": "2026-01-27T17:41:19.155475Z", "level": "INFO", "logger": "backend.app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-27T17:41:19.155524Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-27T17:41:19.155548Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-27T17:41:19.155644Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-27T17:41:19.177561Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-27T17:41:19.177606Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-27T17:41:21.307165Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-27T17:41:21.307583Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-27T17:41:21.307792Z", "level": "INFO", "logger": "backend.app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-27T17:41:21.307834Z", "level": "INFO", "logger": "backend.app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-27T18:02:47.019523Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Connecting to database at postgresql://admin:admin@localhost:5432/Spice_BD", "module": "sql_service", "function": "__init__", "line": 389}
{"timestamp": "2026-01-27T18:02:47.436645Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Database connection established with view support", "module": "sql_service", "function": "__init__", "line": 417}
{"timestamp": "2026-01-27T18:02:47.582068Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Cached schema for 48 relevant tables out of 125 total", "module": "sql_service", "function": "_cache_schema", "line": 482}
{"timestamp": "2026-01-27T18:02:47.582126Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Relevant tables: bp_log, current_medication, diagnosis, glucose_log, lab_test, lab_test_result, lab_test_result_range, medical_compliance, medication_country_detail, patient...", "module": "sql_service", "function": "_cache_schema", "line": 483}
{"timestamp": "2026-01-27T18:02:47.712898Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "SQL agent initialized successfully with 48 cached tables", "module": "sql_service", "function": "__init__", "line": 444}
{"timestamp": "2026-01-27T18:02:47.712956Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Initializing AgentService", "module": "agent_service", "function": "__init__", "line": 151}
{"timestamp": "2026-01-27T18:02:47.718386Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "AgentService initialized successfully", "module": "agent_service", "function": "__init__", "line": 216}
{"timestamp": "2026-01-27T18:06:02.222733Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login attempt for user: superadmin", "module": "auth", "function": "login", "line": 112}
{"timestamp": "2026-01-27T18:06:02.421998Z", "level": "INFO", "logger": "backend.sqliteDb.db", "message": "Authentication successful: superadmin", "module": "db", "function": "authenticate_user", "line": 303}
{"timestamp": "2026-01-27T18:06:02.422233Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login successful for user: superadmin", "module": "auth", "function": "login", "line": 133}
{"timestamp": "2026-01-27T18:13:59.916277Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login attempt for user: editor_user", "module": "auth", "function": "login", "line": 112}
{"timestamp": "2026-01-27T18:14:00.104212Z", "level": "INFO", "logger": "backend.sqliteDb.db", "message": "Authentication successful: editor_user", "module": "db", "function": "authenticate_user", "line": 303}
{"timestamp": "2026-01-27T18:14:00.104408Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login successful for user: editor_user", "module": "auth", "function": "login", "line": 133}
{"timestamp": "2026-01-27T18:19:50.251830Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-27T18:22:43.469190Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-27T18:24:14.978245Z", "level": "INFO", "logger": "backend.app", "message": "Shutting down application", "module": "app", "function": "lifespan", "line": 34}
{"timestamp": "2026-01-27T18:24:19.242877Z", "level": "INFO", "logger": "backend.app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-27T18:24:19.242934Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-27T18:24:19.242960Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-27T18:24:19.243070Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-27T18:24:19.259052Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-27T18:24:19.259169Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-27T18:24:21.410837Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-27T18:24:21.410996Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-27T18:24:21.411074Z", "level": "INFO", "logger": "backend.app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-27T18:24:21.411097Z", "level": "INFO", "logger": "backend.app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-27T18:24:55.232909Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Connecting to database at postgresql://admin:admin@localhost:5432/Spice_BD", "module": "sql_service", "function": "__init__", "line": 389}
{"timestamp": "2026-01-27T18:24:55.662358Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Database connection established with view support", "module": "sql_service", "function": "__init__", "line": 417}
{"timestamp": "2026-01-27T18:24:55.808625Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Cached schema for 48 relevant tables out of 125 total", "module": "sql_service", "function": "_cache_schema", "line": 482}
{"timestamp": "2026-01-27T18:24:55.808676Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Relevant tables: bp_log, current_medication, diagnosis, glucose_log, lab_test, lab_test_result, lab_test_result_range, medical_compliance, medication_country_detail, patient...", "module": "sql_service", "function": "_cache_schema", "line": 483}
{"timestamp": "2026-01-27T18:24:55.937338Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "SQL agent initialized successfully with 48 cached tables", "module": "sql_service", "function": "__init__", "line": 444}
{"timestamp": "2026-01-27T18:24:55.937396Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Initializing AgentService", "module": "agent_service", "function": "__init__", "line": 151}
{"timestamp": "2026-01-27T18:24:55.942536Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "AgentService initialized successfully", "module": "agent_service", "function": "__init__", "line": 216}
{"timestamp": "2026-01-27T18:26:46.912270Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-27T18:27:16.510575Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-27T18:28:33.415453Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-27T18:30:53.314334Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-27T18:37:17.943233Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-27T18:47:41.675563Z", "level": "INFO", "logger": "backend.services.audit_service", "message": "Audit: prompt.rollback by editor_user on prompt/9", "module": "audit_service", "function": "log", "line": 133}
{"timestamp": "2026-01-27T18:47:41.675773Z", "level": "INFO", "logger": "backend.api.routes.config", "message": "User editor_user rolled back to prompt version 9", "module": "config", "function": "rollback_to_version", "line": 142}
{"timestamp": "2026-01-27T18:48:10.068151Z", "level": "INFO", "logger": "backend.app", "message": "Shutting down application", "module": "app", "function": "lifespan", "line": 34}
{"timestamp": "2026-01-27T18:48:14.744660Z", "level": "INFO", "logger": "backend.app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-27T18:48:14.744714Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-27T18:48:14.744738Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-27T18:48:14.744835Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-27T18:48:14.785648Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-27T18:48:14.785696Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-27T18:48:16.761358Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-27T18:48:16.761681Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-27T18:48:16.761762Z", "level": "INFO", "logger": "backend.app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-27T18:48:16.761783Z", "level": "INFO", "logger": "backend.app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-27T18:49:45.340284Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Connecting to database at postgresql://admin:admin@localhost:5432/Spice_BD", "module": "sql_service", "function": "__init__", "line": 389}
{"timestamp": "2026-01-27T18:49:45.764420Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Database connection established with view support", "module": "sql_service", "function": "__init__", "line": 417}
{"timestamp": "2026-01-27T18:49:45.915226Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Cached schema for 48 relevant tables out of 125 total", "module": "sql_service", "function": "_cache_schema", "line": 482}
{"timestamp": "2026-01-27T18:49:45.915286Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Relevant tables: bp_log, current_medication, diagnosis, glucose_log, lab_test, lab_test_result, lab_test_result_range, medical_compliance, medication_country_detail, patient...", "module": "sql_service", "function": "_cache_schema", "line": 483}
{"timestamp": "2026-01-27T18:49:46.052516Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "SQL agent initialized successfully with 48 cached tables", "module": "sql_service", "function": "__init__", "line": 444}
{"timestamp": "2026-01-27T18:49:46.052582Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Initializing AgentService", "module": "agent_service", "function": "__init__", "line": 151}
{"timestamp": "2026-01-27T18:49:46.057871Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "AgentService initialized successfully", "module": "agent_service", "function": "__init__", "line": 216}
{"timestamp": "2026-01-27T18:51:10.951336Z", "level": "INFO", "logger": "backend.app", "message": "Shutting down application", "module": "app", "function": "lifespan", "line": 34}
{"timestamp": "2026-01-27T18:51:14.608186Z", "level": "INFO", "logger": "backend.app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-27T18:51:14.608247Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-27T18:51:14.608277Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-27T18:51:14.608384Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-27T18:51:14.624239Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-27T18:51:14.624286Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-27T18:51:15.715179Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-27T18:51:15.715358Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-27T18:51:15.715405Z", "level": "INFO", "logger": "backend.app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-27T18:51:15.715430Z", "level": "INFO", "logger": "backend.app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-27T18:52:48.467308Z", "level": "INFO", "logger": "backend.app", "message": "Shutting down application", "module": "app", "function": "lifespan", "line": 34}
{"timestamp": "2026-01-27T18:52:52.471148Z", "level": "INFO", "logger": "backend.app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-27T18:52:52.471205Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-27T18:52:52.471230Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-27T18:52:52.471322Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-27T18:52:52.487615Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-27T18:52:52.487662Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-27T18:52:54.441123Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-27T18:52:54.441298Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-27T18:52:54.441382Z", "level": "INFO", "logger": "backend.app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-27T18:52:54.441445Z", "level": "INFO", "logger": "backend.app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-27T18:53:14.235936Z", "level": "INFO", "logger": "backend.app", "message": "Shutting down application", "module": "app", "function": "lifespan", "line": 34}
{"timestamp": "2026-01-27T18:53:17.611536Z", "level": "INFO", "logger": "backend.app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-27T18:53:17.611591Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-27T18:53:17.611617Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-27T18:53:17.611708Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-27T18:53:17.627119Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-27T18:53:17.627169Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-27T18:53:18.713738Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-27T18:53:18.714145Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-27T18:53:18.714210Z", "level": "INFO", "logger": "backend.app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-27T18:53:18.714231Z", "level": "INFO", "logger": "backend.app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-27T18:53:18.910891Z", "level": "INFO", "logger": "backend.sqliteDb.db", "message": "User created: Aditya with role: user", "module": "db", "function": "create_user", "line": 230}
{"timestamp": "2026-01-27T18:53:18.911970Z", "level": "INFO", "logger": "backend.services.audit_service", "message": "Audit: user.create by superadmin on user/7", "module": "audit_service", "function": "log", "line": 133}
{"timestamp": "2026-01-27T18:54:18.252893Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login attempt for user: aditya@gmail.com", "module": "auth", "function": "login", "line": 112}
{"timestamp": "2026-01-27T18:54:18.253346Z", "level": "WARNING", "logger": "backend.sqliteDb.db", "message": "Authentication failed: User not found - aditya@gmail.com", "module": "db", "function": "authenticate_user", "line": 290}
{"timestamp": "2026-01-27T18:54:18.253377Z", "level": "WARNING", "logger": "backend.api.routes.auth", "message": "Login failed for user: aditya@gmail.com", "module": "auth", "function": "login", "line": 119}
{"timestamp": "2026-01-27T18:54:22.536408Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login attempt for user: aditya", "module": "auth", "function": "login", "line": 112}
{"timestamp": "2026-01-27T18:54:22.537189Z", "level": "WARNING", "logger": "backend.sqliteDb.db", "message": "Authentication failed: User not found - aditya", "module": "db", "function": "authenticate_user", "line": 290}
{"timestamp": "2026-01-27T18:54:22.537263Z", "level": "WARNING", "logger": "backend.api.routes.auth", "message": "Login failed for user: aditya", "module": "auth", "function": "login", "line": 119}
{"timestamp": "2026-01-27T18:54:23.384728Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login attempt for user: aditya", "module": "auth", "function": "login", "line": 112}
{"timestamp": "2026-01-27T18:54:23.385061Z", "level": "WARNING", "logger": "backend.sqliteDb.db", "message": "Authentication failed: User not found - aditya", "module": "db", "function": "authenticate_user", "line": 290}
{"timestamp": "2026-01-27T18:54:23.385090Z", "level": "WARNING", "logger": "backend.api.routes.auth", "message": "Login failed for user: aditya", "module": "auth", "function": "login", "line": 119}
{"timestamp": "2026-01-27T18:54:40.909704Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login attempt for user: Aditya", "module": "auth", "function": "login", "line": 112}
{"timestamp": "2026-01-27T18:54:41.096125Z", "level": "INFO", "logger": "backend.sqliteDb.db", "message": "Authentication successful: Aditya", "module": "db", "function": "authenticate_user", "line": 303}
{"timestamp": "2026-01-27T18:54:41.096295Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login successful for user: Aditya", "module": "auth", "function": "login", "line": 133}
{"timestamp": "2026-01-27T18:54:41.119299Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Connecting to database at postgresql://admin:admin@localhost:5432/Spice_BD", "module": "sql_service", "function": "__init__", "line": 389}
{"timestamp": "2026-01-27T18:54:41.514282Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Database connection established with view support", "module": "sql_service", "function": "__init__", "line": 417}
{"timestamp": "2026-01-27T18:54:41.664746Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Cached schema for 48 relevant tables out of 125 total", "module": "sql_service", "function": "_cache_schema", "line": 482}
{"timestamp": "2026-01-27T18:54:41.664808Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Relevant tables: bp_log, current_medication, diagnosis, glucose_log, lab_test, lab_test_result, lab_test_result_range, medical_compliance, medication_country_detail, patient...", "module": "sql_service", "function": "_cache_schema", "line": 483}
{"timestamp": "2026-01-27T18:54:41.784123Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "SQL agent initialized successfully with 48 cached tables", "module": "sql_service", "function": "__init__", "line": 444}
{"timestamp": "2026-01-27T18:54:41.784193Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Initializing AgentService", "module": "agent_service", "function": "__init__", "line": 151}
{"timestamp": "2026-01-27T18:54:41.789259Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "AgentService initialized successfully", "module": "agent_service", "function": "__init__", "line": 216}
{"timestamp": "2026-01-27T18:55:11.795994Z", "level": "INFO", "logger": "backend.services.audit_service", "message": "Audit: user.delete by superadmin on user/7", "module": "audit_service", "function": "log", "line": 133}
{"timestamp": "2026-01-27T18:55:24.219120Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login attempt for user: Aditya", "module": "auth", "function": "login", "line": 112}
{"timestamp": "2026-01-27T18:55:24.219482Z", "level": "WARNING", "logger": "backend.sqliteDb.db", "message": "Authentication failed: User inactive - Aditya", "module": "db", "function": "authenticate_user", "line": 294}
{"timestamp": "2026-01-27T18:55:24.219507Z", "level": "WARNING", "logger": "backend.api.routes.auth", "message": "Login failed for user: Aditya", "module": "auth", "function": "login", "line": 119}
{"timestamp": "2026-01-27T18:55:26.595769Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login attempt for user: Aditya", "module": "auth", "function": "login", "line": 112}
{"timestamp": "2026-01-27T18:55:26.596336Z", "level": "WARNING", "logger": "backend.sqliteDb.db", "message": "Authentication failed: User inactive - Aditya", "module": "db", "function": "authenticate_user", "line": 294}
{"timestamp": "2026-01-27T18:55:26.596437Z", "level": "WARNING", "logger": "backend.api.routes.auth", "message": "Login failed for user: Aditya", "module": "auth", "function": "login", "line": 119}
{"timestamp": "2026-01-27T18:55:26.921361Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login attempt for user: Aditya", "module": "auth", "function": "login", "line": 112}
{"timestamp": "2026-01-27T18:55:26.921774Z", "level": "WARNING", "logger": "backend.sqliteDb.db", "message": "Authentication failed: User inactive - Aditya", "module": "db", "function": "authenticate_user", "line": 294}
{"timestamp": "2026-01-27T18:55:26.921813Z", "level": "WARNING", "logger": "backend.api.routes.auth", "message": "Login failed for user: Aditya", "module": "auth", "function": "login", "line": 119}
{"timestamp": "2026-01-27T18:55:27.104070Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login attempt for user: Aditya", "module": "auth", "function": "login", "line": 112}
{"timestamp": "2026-01-27T18:55:27.104488Z", "level": "WARNING", "logger": "backend.sqliteDb.db", "message": "Authentication failed: User inactive - Aditya", "module": "db", "function": "authenticate_user", "line": 294}
{"timestamp": "2026-01-27T18:55:27.104544Z", "level": "WARNING", "logger": "backend.api.routes.auth", "message": "Login failed for user: Aditya", "module": "auth", "function": "login", "line": 119}
{"timestamp": "2026-01-27T18:55:27.270491Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login attempt for user: Aditya", "module": "auth", "function": "login", "line": 112}
{"timestamp": "2026-01-27T18:55:27.270854Z", "level": "WARNING", "logger": "backend.sqliteDb.db", "message": "Authentication failed: User inactive - Aditya", "module": "db", "function": "authenticate_user", "line": 294}
{"timestamp": "2026-01-27T18:55:27.270882Z", "level": "WARNING", "logger": "backend.api.routes.auth", "message": "Login failed for user: Aditya", "module": "auth", "function": "login", "line": 119}
{"timestamp": "2026-01-27T18:55:27.438204Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login attempt for user: Aditya", "module": "auth", "function": "login", "line": 112}
{"timestamp": "2026-01-27T18:55:27.438631Z", "level": "WARNING", "logger": "backend.sqliteDb.db", "message": "Authentication failed: User inactive - Aditya", "module": "db", "function": "authenticate_user", "line": 294}
{"timestamp": "2026-01-27T18:55:27.438675Z", "level": "WARNING", "logger": "backend.api.routes.auth", "message": "Login failed for user: Aditya", "module": "auth", "function": "login", "line": 119}
{"timestamp": "2026-01-27T18:55:27.605476Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login attempt for user: Aditya", "module": "auth", "function": "login", "line": 112}
{"timestamp": "2026-01-27T18:55:27.605977Z", "level": "WARNING", "logger": "backend.sqliteDb.db", "message": "Authentication failed: User inactive - Aditya", "module": "db", "function": "authenticate_user", "line": 294}
{"timestamp": "2026-01-27T18:55:27.606019Z", "level": "WARNING", "logger": "backend.api.routes.auth", "message": "Login failed for user: Aditya", "module": "auth", "function": "login", "line": 119}
{"timestamp": "2026-01-27T18:57:59.813384Z", "level": "INFO", "logger": "backend.app", "message": "Shutting down application", "module": "app", "function": "lifespan", "line": 34}
{"timestamp": "2026-01-27T18:58:03.757512Z", "level": "INFO", "logger": "backend.app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-27T18:58:03.757560Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-27T18:58:03.757585Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-27T18:58:03.757671Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-27T18:58:03.773059Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-27T18:58:03.773108Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-27T18:58:05.045540Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-27T18:58:05.045894Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-27T18:58:05.045931Z", "level": "INFO", "logger": "backend.app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-27T18:58:05.045955Z", "level": "INFO", "logger": "backend.app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-27T19:03:17.704888Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login attempt for user: admin", "module": "auth", "function": "login", "line": 112}
{"timestamp": "2026-01-27T19:03:17.900342Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login successful for user: admin", "module": "auth", "function": "login", "line": 151}
{"timestamp": "2026-01-27T19:03:18.056744Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Connecting to database at postgresql://admin:admin@localhost:5432/Spice_BD", "module": "sql_service", "function": "__init__", "line": 389}
{"timestamp": "2026-01-27T19:03:18.491475Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Database connection established with view support", "module": "sql_service", "function": "__init__", "line": 417}
{"timestamp": "2026-01-27T19:03:18.660109Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Cached schema for 48 relevant tables out of 125 total", "module": "sql_service", "function": "_cache_schema", "line": 482}
{"timestamp": "2026-01-27T19:03:18.660163Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Relevant tables: bp_log, current_medication, diagnosis, glucose_log, lab_test, lab_test_result, lab_test_result_range, medical_compliance, medication_country_detail, patient...", "module": "sql_service", "function": "_cache_schema", "line": 483}
{"timestamp": "2026-01-27T19:03:18.797917Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "SQL agent initialized successfully with 48 cached tables", "module": "sql_service", "function": "__init__", "line": 444}
{"timestamp": "2026-01-27T19:03:18.798000Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Initializing AgentService", "module": "agent_service", "function": "__init__", "line": 151}
{"timestamp": "2026-01-27T19:03:18.803543Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "AgentService initialized successfully", "module": "agent_service", "function": "__init__", "line": 216}
{"timestamp": "2026-01-27T19:03:21.557484Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login attempt for user: Aditya", "module": "auth", "function": "login", "line": 112}
{"timestamp": "2026-01-27T19:03:21.558355Z", "level": "WARNING", "logger": "backend.api.routes.auth", "message": "Login failed: User inactive - Aditya", "module": "auth", "function": "login", "line": 128}
{"timestamp": "2026-01-27T19:14:48.424267Z", "level": "INFO", "logger": "backend.sqliteDb.db", "message": "User created: test_deactivate with role: user", "module": "db", "function": "create_user", "line": 230}
{"timestamp": "2026-01-27T19:14:48.425568Z", "level": "INFO", "logger": "backend.services.audit_service", "message": "Audit: user.create by admin on user/8", "module": "audit_service", "function": "log", "line": 133}
{"timestamp": "2026-01-27T19:15:05.647700Z", "level": "INFO", "logger": "backend.services.audit_service", "message": "Audit: user.delete by admin on user/8", "module": "audit_service", "function": "log", "line": 133}
{"timestamp": "2026-01-27T19:16:07.550079Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login attempt for user: test_deactivate", "module": "auth", "function": "login", "line": 112}
{"timestamp": "2026-01-27T19:16:07.551204Z", "level": "WARNING", "logger": "backend.api.routes.auth", "message": "Login failed: User inactive - test_deactivate", "module": "auth", "function": "login", "line": 128}
{"timestamp": "2026-01-27T19:24:08.722787Z", "level": "INFO", "logger": "backend.app", "message": "Shutting down application", "module": "app", "function": "lifespan", "line": 34}
{"timestamp": "2026-01-27T19:24:12.661916Z", "level": "INFO", "logger": "backend.app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-27T19:24:12.661965Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-27T19:24:12.661989Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-27T19:24:12.662074Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-27T19:24:12.677411Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-27T19:24:12.677454Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-27T19:24:14.987948Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-27T19:24:14.988983Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-27T19:24:14.989231Z", "level": "INFO", "logger": "backend.app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-27T19:24:14.989270Z", "level": "INFO", "logger": "backend.app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-27T19:24:31.866217Z", "level": "INFO", "logger": "backend.app", "message": "Shutting down application", "module": "app", "function": "lifespan", "line": 34}
{"timestamp": "2026-01-27T19:24:35.209717Z", "level": "INFO", "logger": "backend.app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-27T19:24:35.209767Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-27T19:24:35.209793Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-27T19:24:35.209877Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-27T19:24:35.224967Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-27T19:24:35.225008Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-27T19:24:36.233284Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-27T19:24:36.233429Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-27T19:24:36.233476Z", "level": "INFO", "logger": "backend.app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-27T19:24:36.233499Z", "level": "INFO", "logger": "backend.app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-27T19:25:48.453907Z", "level": "INFO", "logger": "backend.app", "message": "Shutting down application", "module": "app", "function": "lifespan", "line": 34}
{"timestamp": "2026-01-27T19:25:51.592478Z", "level": "INFO", "logger": "backend.app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-27T19:25:51.592543Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-27T19:25:51.592574Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-27T19:25:51.592684Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-27T19:25:51.611174Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-27T19:25:51.611224Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-27T19:25:52.923435Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-27T19:25:52.923747Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-27T19:25:52.923812Z", "level": "INFO", "logger": "backend.app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-27T19:25:52.923834Z", "level": "INFO", "logger": "backend.app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-27T19:25:56.063006Z", "level": "INFO", "logger": "backend.app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-27T19:25:56.063065Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-27T19:25:56.063093Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-27T19:25:56.063192Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-27T19:25:56.079204Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-27T19:25:56.079249Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-27T19:25:57.282316Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-27T19:25:57.282392Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-27T19:25:57.282421Z", "level": "INFO", "logger": "backend.app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-27T19:25:57.282440Z", "level": "INFO", "logger": "backend.app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-27T19:28:13.720140Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Registration attempt for username: user1", "module": "auth", "function": "register", "line": 48}
{"timestamp": "2026-01-27T19:28:13.910294Z", "level": "INFO", "logger": "backend.sqliteDb.db", "message": "User created: user1 with role: user", "module": "db", "function": "create_user", "line": 230}
{"timestamp": "2026-01-27T19:28:13.910335Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "User registered successfully: user1", "module": "auth", "function": "register", "line": 60}
{"timestamp": "2026-01-27T19:28:23.260700Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login attempt for user: user1", "module": "auth", "function": "login", "line": 112}
{"timestamp": "2026-01-27T19:28:23.453930Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login successful for user: user1", "module": "auth", "function": "login", "line": 151}
{"timestamp": "2026-01-27T19:28:23.472950Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Connecting to database at postgresql://admin:admin@localhost:5432/Spice_BD", "module": "sql_service", "function": "__init__", "line": 389}
{"timestamp": "2026-01-27T19:28:23.858221Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Database connection established with view support", "module": "sql_service", "function": "__init__", "line": 417}
{"timestamp": "2026-01-27T19:28:24.002988Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Cached schema for 48 relevant tables out of 125 total", "module": "sql_service", "function": "_cache_schema", "line": 482}
{"timestamp": "2026-01-27T19:28:24.003045Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Relevant tables: bp_log, current_medication, diagnosis, glucose_log, lab_test, lab_test_result, lab_test_result_range, medical_compliance, medication_country_detail, patient...", "module": "sql_service", "function": "_cache_schema", "line": 483}
{"timestamp": "2026-01-27T19:28:24.125230Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "SQL agent initialized successfully with 48 cached tables", "module": "sql_service", "function": "__init__", "line": 444}
{"timestamp": "2026-01-27T19:28:24.125314Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Initializing AgentService", "module": "agent_service", "function": "__init__", "line": 151}
{"timestamp": "2026-01-27T19:28:24.130622Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "AgentService initialized successfully", "module": "agent_service", "function": "__init__", "line": 216}
{"timestamp": "2026-01-27T19:28:42.275940Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=user1, query_length=33", "module": "chat", "function": "chat", "line": 36, "user_id": "user1"}
{"timestamp": "2026-01-27T19:28:42.276454Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=405dc691-6c1c-4c7f-b3e4-7ced1de3b9ef): 'total patients with hypertension....'", "module": "agent_service", "function": "process_query", "line": 255}
{"timestamp": "2026-01-27T19:28:43.490983Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-27T19:28:43.887879Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Count patients diagnosed with hypertension...'", "module": "sql_service", "function": "query", "line": 626}
{"timestamp": "2026-01-27T19:28:43.888113Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udd0d Analyzing natural language query", "module": "sql_service", "function": "_is_simple_query", "line": 576}
{"timestamp": "2026-01-27T19:28:43.888281Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query classified as COMPLEX (pattern=True, complexity=True, multi_table=False)", "module": "sql_service", "function": "_is_simple_query", "line": 621}
{"timestamp": "2026-01-27T19:28:43.888307Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Complex query detected - using full agent", "module": "sql_service", "function": "query", "line": 638}
{"timestamp": "2026-01-27T19:28:43.888333Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 785}
{"timestamp": "2026-01-27T19:28:43.888353Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL AGENT EXECUTION TRACE:", "module": "sql_service", "function": "_execute_with_agent", "line": 786}
{"timestamp": "2026-01-27T19:28:43.888373Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 787}
{"timestamp": "2026-01-27T19:28:44.847305Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-27T19:28:46.012255Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-27T19:28:47.456352Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-27T19:28:49.392808Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-27T19:28:51.668484Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-27T19:28:52.465367Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-27T19:28:52.612213Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 810}
{"timestamp": "2026-01-27T19:28:52.612428Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL query completed. Result length: 53 chars", "module": "sql_service", "function": "_execute_with_agent", "line": 811}
{"timestamp": "2026-01-27T19:28:52.612543Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: There are 1,130 patients diagnosed with hypertension....", "module": "sql_service", "function": "_execute_with_agent", "line": 813}
{"timestamp": "2026-01-27T19:28:52.612634Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_with_agent", "line": 814}
{"timestamp": "2026-01-27T19:28:53.199514Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-27T19:28:53.397185Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=405dc691-6c1c-4c7f-b3e4-7ced1de3b9ef, duration=11.12s)", "module": "agent_service", "function": "process_query", "line": 353}
{"timestamp": "2026-01-27T19:29:03.344851Z", "level": "INFO", "logger": "backend.api.routes.chat", "message": "Chat request from user=user1, query_length=32", "module": "chat", "function": "chat", "line": 36, "user_id": "user1"}
{"timestamp": "2026-01-27T19:29:03.345056Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Processing query (trace_id=008ead95-8350-49bb-b853-a1453b622a57): 'out of those, how many are male?...'", "module": "agent_service", "function": "process_query", "line": 255}
{"timestamp": "2026-01-27T19:29:04.757249Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-27T19:29:04.895461Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Executing SQL query for: 'Count male patients...'", "module": "sql_service", "function": "query", "line": 626}
{"timestamp": "2026-01-27T19:29:04.895571Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udd0d Analyzing natural language query", "module": "sql_service", "function": "_is_simple_query", "line": 576}
{"timestamp": "2026-01-27T19:29:04.895615Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Query classified as SIMPLE (natural language)", "module": "sql_service", "function": "_is_simple_query", "line": 619}
{"timestamp": "2026-01-27T19:29:04.895655Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Detected simple query - using optimized execution path", "module": "sql_service", "function": "query", "line": 635}
{"timestamp": "2026-01-27T19:29:04.895678Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_optimized", "line": 677}
{"timestamp": "2026-01-27T19:29:04.895698Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\u26a1 OPTIMIZED SQL EXECUTION:", "module": "sql_service", "function": "_execute_optimized", "line": 678}
{"timestamp": "2026-01-27T19:29:04.895717Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_optimized", "line": 679}
{"timestamp": "2026-01-27T19:29:04.895738Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " API Call 1: Generate SQL query with targeted schema", "module": "sql_service", "function": "_execute_optimized", "line": 691}
{"timestamp": "2026-01-27T19:29:04.895787Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "\ud83d\udccb Selected relevant tables for query: patient", "module": "sql_service", "function": "_get_relevant_schema", "line": 524}
{"timestamp": "2026-01-27T19:29:05.576492Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-27T19:29:05.577159Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " SQL to execute: SELECT COUNT(*) \nFROM patient \nWHERE gender = 'Male';...", "module": "sql_service", "function": "_execute_optimized", "line": 723}
{"timestamp": "2026-01-27T19:29:05.577197Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Executing query against database (no API call)", "module": "sql_service", "function": "_execute_optimized", "line": 729}
{"timestamp": "2026-01-27T19:29:05.582388Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Query result: [(1491,)]", "module": "sql_service", "function": "_execute_optimized", "line": 731}
{"timestamp": "2026-01-27T19:29:05.582457Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " API Call 2: Format natural language response", "module": "sql_service", "function": "_execute_optimized", "line": 733}
{"timestamp": "2026-01-27T19:29:06.294810Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-27T19:29:06.297224Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_optimized", "line": 748}
{"timestamp": "2026-01-27T19:29:06.297392Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Optimized execution completed with 2 API call(s) (vs 7 with agent)", "module": "sql_service", "function": "_execute_optimized", "line": 749}
{"timestamp": "2026-01-27T19:29:06.297510Z", "level": "INFO", "logger": "backend.services.sql_service", "message": " Final Answer: There are 1,491 male patients....", "module": "sql_service", "function": "_execute_optimized", "line": 750}
{"timestamp": "2026-01-27T19:29:06.297585Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "================================================================================", "module": "sql_service", "function": "_execute_optimized", "line": 751}
{"timestamp": "2026-01-27T19:29:07.622690Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST https://api.openai.com/v1/chat/completions \"HTTP/1.1 200 OK\"", "module": "_client", "function": "_send_single_request", "line": 1025}
{"timestamp": "2026-01-27T19:29:07.835363Z", "level": "INFO", "logger": "backend.services.agent_service", "message": " Query processed successfully (trace_id=008ead95-8350-49bb-b853-a1453b622a57, duration=4.49s)", "module": "agent_service", "function": "process_query", "line": 353}
{"timestamp": "2026-01-27T19:29:31.612632Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login attempt for user: admin_user", "module": "auth", "function": "login", "line": 112}
{"timestamp": "2026-01-27T19:29:31.804871Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login successful for user: admin_user", "module": "auth", "function": "login", "line": 151}
{"timestamp": "2026-01-27T19:30:04.985240Z", "level": "INFO", "logger": "backend.services.audit_service", "message": "Audit: user.update by admin_user on user/7", "module": "audit_service", "function": "log", "line": 133}
{"timestamp": "2026-01-27T19:30:25.794810Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login attempt for user: Aditya", "module": "auth", "function": "login", "line": 112}
{"timestamp": "2026-01-27T19:30:25.981455Z", "level": "INFO", "logger": "backend.api.routes.auth", "message": "Login successful for user: Aditya", "module": "auth", "function": "login", "line": 151}
{"timestamp": "2026-01-27T19:44:24.774193Z", "level": "INFO", "logger": "backend.app", "message": "Shutting down application", "module": "app", "function": "lifespan", "line": 34}
{"timestamp": "2026-01-27T19:44:41.914035Z", "level": "INFO", "logger": "backend.app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-27T19:44:41.914087Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-27T19:44:41.914112Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-27T19:44:41.914200Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-27T19:44:41.930866Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-27T19:44:41.930910Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-27T19:44:44.866207Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-27T19:44:44.866385Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-27T19:44:44.866489Z", "level": "INFO", "logger": "backend.app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-27T19:44:44.866518Z", "level": "INFO", "logger": "backend.app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-27T19:44:49.539298Z", "level": "INFO", "logger": "backend.app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-27T19:44:49.539354Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-27T19:44:49.539378Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-27T19:44:49.539474Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-27T19:44:49.563547Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-27T19:44:49.563599Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-27T19:44:51.938674Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-27T19:44:51.938917Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-27T19:44:51.938956Z", "level": "INFO", "logger": "backend.app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-27T19:44:51.938977Z", "level": "INFO", "logger": "backend.app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-27T19:44:55.865685Z", "level": "INFO", "logger": "backend.app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-27T19:44:55.865737Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-27T19:44:55.865761Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-27T19:44:55.865852Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-27T19:44:55.882523Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-27T19:44:55.882562Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-27T19:44:57.339500Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-27T19:44:57.339760Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-27T19:44:57.339805Z", "level": "INFO", "logger": "backend.app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-27T19:44:57.339830Z", "level": "INFO", "logger": "backend.app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-27T19:45:00.725046Z", "level": "INFO", "logger": "backend.app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-27T19:45:00.725095Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-27T19:45:00.725119Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-27T19:45:00.725199Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-27T19:45:00.741408Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-27T19:45:00.741458Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-27T19:45:02.341316Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-27T19:45:02.341637Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-27T19:45:02.341781Z", "level": "INFO", "logger": "backend.app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-27T19:45:02.341812Z", "level": "INFO", "logger": "backend.app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-27T19:45:05.604874Z", "level": "INFO", "logger": "backend.app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-27T19:45:05.604917Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-27T19:45:05.604941Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-27T19:45:05.605023Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-27T19:45:05.621244Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-27T19:45:05.621297Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-27T19:45:07.023565Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-27T19:45:07.023687Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-27T19:45:07.023770Z", "level": "INFO", "logger": "backend.app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-27T19:45:07.023797Z", "level": "INFO", "logger": "backend.app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-27T19:45:10.332488Z", "level": "INFO", "logger": "backend.app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-27T19:45:10.332525Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-27T19:45:10.332550Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-27T19:45:10.332630Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-27T19:45:10.349437Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-27T19:45:10.349478Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-27T19:45:11.640145Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-27T19:45:11.640233Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-27T19:45:11.640266Z", "level": "INFO", "logger": "backend.app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-27T19:45:11.640289Z", "level": "INFO", "logger": "backend.app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-27T19:45:14.646262Z", "level": "INFO", "logger": "backend.app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-27T19:45:14.646316Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-27T19:45:14.646344Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-27T19:45:14.646432Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-27T19:45:14.663749Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-27T19:45:14.663794Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-27T19:45:15.764260Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-27T19:45:15.764407Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-27T19:45:15.764476Z", "level": "INFO", "logger": "backend.app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-27T19:45:15.764500Z", "level": "INFO", "logger": "backend.app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-27T19:45:18.791364Z", "level": "INFO", "logger": "backend.app", "message": "Starting FHIR RAG Chatbot API v1.0.0", "module": "app", "function": "lifespan", "line": 26}
{"timestamp": "2026-01-27T19:45:18.791426Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Preloading embedding model...", "module": "embeddings", "function": "preload_embedding_model", "line": 120}
{"timestamp": "2026-01-27T19:45:18.791463Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Loading embedding model from ./models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 35}
{"timestamp": "2026-01-27T19:45:18.791546Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Resolved model path to: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "embeddings", "function": "_load_model", "line": 41}
{"timestamp": "2026-01-27T19:45:18.807022Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Use pytorch device_name: mps", "module": "SentenceTransformer", "function": "__init__", "line": 219}
{"timestamp": "2026-01-27T19:45:18.807070Z", "level": "INFO", "logger": "sentence_transformers.SentenceTransformer", "message": "Load pretrained SentenceTransformer: /Users/adityanbhatt/fhir_rag/backend/models/bge-m3", "module": "SentenceTransformer", "function": "__init__", "line": 227}
{"timestamp": "2026-01-27T19:45:19.740350Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model loaded successfully. Dimension: 1024", "module": "embeddings", "function": "_load_model", "line": 45}
{"timestamp": "2026-01-27T19:45:19.740458Z", "level": "INFO", "logger": "backend.services.embeddings", "message": "Embedding model preloaded.", "module": "embeddings", "function": "preload_embedding_model", "line": 122}
{"timestamp": "2026-01-27T19:45:19.740617Z", "level": "INFO", "logger": "backend.app", "message": "Debug mode: False", "module": "app", "function": "lifespan", "line": 28}
{"timestamp": "2026-01-27T19:45:19.740692Z", "level": "INFO", "logger": "backend.app", "message": "API prefix: /api/v1", "module": "app", "function": "lifespan", "line": 29}
{"timestamp": "2026-01-27T19:45:37.425854Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Connecting to database at postgresql://admin:admin@localhost:5432/Spice_BD", "module": "sql_service", "function": "__init__", "line": 389}
{"timestamp": "2026-01-27T19:45:37.852328Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Database connection established with view support", "module": "sql_service", "function": "__init__", "line": 417}
{"timestamp": "2026-01-27T19:45:37.886224Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Connecting to database at postgresql://admin:admin@localhost:5432/Spice_BD", "module": "sql_service", "function": "__init__", "line": 389}
{"timestamp": "2026-01-27T19:45:38.095589Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Database connection established with view support", "module": "sql_service", "function": "__init__", "line": 417}
{"timestamp": "2026-01-27T19:45:38.106885Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Cached schema for 48 relevant tables out of 125 total", "module": "sql_service", "function": "_cache_schema", "line": 482}
{"timestamp": "2026-01-27T19:45:38.106939Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Relevant tables: bp_log, current_medication, diagnosis, glucose_log, lab_test, lab_test_result, lab_test_result_range, medical_compliance, medication_country_detail, patient...", "module": "sql_service", "function": "_cache_schema", "line": 483}
{"timestamp": "2026-01-27T19:45:38.254685Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Cached schema for 48 relevant tables out of 125 total", "module": "sql_service", "function": "_cache_schema", "line": 482}
{"timestamp": "2026-01-27T19:45:38.254792Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "Relevant tables: bp_log, current_medication, diagnosis, glucose_log, lab_test, lab_test_result, lab_test_result_range, medical_compliance, medication_country_detail, patient...", "module": "sql_service", "function": "_cache_schema", "line": 483}
{"timestamp": "2026-01-27T19:45:38.396237Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "SQL agent initialized successfully with 48 cached tables", "module": "sql_service", "function": "__init__", "line": 444}
{"timestamp": "2026-01-27T19:45:38.396309Z", "level": "INFO", "logger": "backend.services.sql_service", "message": "SQL agent initialized successfully with 48 cached tables", "module": "sql_service", "function": "__init__", "line": 444}
{"timestamp": "2026-01-27T19:45:38.396364Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Initializing AgentService", "module": "agent_service", "function": "__init__", "line": 151}
{"timestamp": "2026-01-27T19:45:38.401587Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "Initializing AgentService", "module": "agent_service", "function": "__init__", "line": 151}
{"timestamp": "2026-01-27T19:45:38.406485Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "AgentService initialized successfully", "module": "agent_service", "function": "__init__", "line": 216}
{"timestamp": "2026-01-27T19:45:38.406558Z", "level": "INFO", "logger": "backend.services.agent_service", "message": "AgentService initialized successfully", "module": "agent_service", "function": "__init__", "line": 216}
