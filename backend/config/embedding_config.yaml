# Table inclusion and exclusion rules
tables:
  # Global column exclusions (applied to all tables)
  global_exclude_columns:
    - "first_name"
    - "last_name"
    - "phone_number"
    - "date_of_birth"
    - "qr_code"
    - "mother_name"
    - "father_name"
    - "mother_occupation"
    - "father_occupation"
    - "mother_educational_qualification"
    - "father_educational_qualification"
    - "password"
    - "national_id"


  # Exclude entire tables (no medical/clinical value)
  exclude_tables:
    - "audit"                               # System audit logs
    - "awsdms_ddl_audit"                    # AWS DMS migration logs
    - "deleted_site_program"                # Soft-deleted records
    - "duplicate_profile"                   # Data quality/deduplication
    - "email_template"                      # Email templates (static)
    - "flyway_schema_history"               # Database migration history
    - "form_meta_ui"                        # UI metadata
    - "offline_log"                         # Offline sync logs
    - "outbound_email"                      # Email delivery logs
    - "outbound_sms"                        # SMS delivery logs
    - "shedlock"                            # Distributed lock management
    - "site_report_log"                     # Report generation logs
    - "sms_template"                        # SMS templates (static)
    - "sms_template_values"                 # SMS template variables
    - "updated_duplicate_patient_profile"   # Data quality fixes
    - "user_token"                          # Auth tokens (security risk)

  # Table-specific column exclusions (overrides global)
  table_specific_exclusions:
    patient:
      - "first_name"
      - "last_name"
      - "phone_number"
      - "date_of_birth"
      - "qr_code"
      - "mother_name"
      - "father_name"
      - "mother_occupation"
      - "father_occupation"
      - "mother_educational_qualification"
      - "father_educational_qualification"
    patient_tracker:
      - "first_name"
      - "last_name"
      - "phone_number"
      - "date_of_birth"
      - "qr_code"
    call_register:
      - "first_name"
      - "last_name"
      - "phone_number"
    user:
      - "first_name"
      - "last_name"
      - "phone_number"
      - "password"
      - "username"

# Embedding configuration
embedding:
  model_name: "BAAI/bge-m3"
  model_path: "./models/bge-m3"
  batch_size: 128

# Advanced Chunking Configuration for Small-to-Big Retrieval
chunking:
  parent_splitter:
    chunk_size: 800       # Reduced from 1000 - better for structured medical data
    chunk_overlap: 150    # Reduced proportionally
  child_splitter:
    chunk_size: 200       # Reduced from 250 - captures single medical concepts better
    chunk_overlap: 50     # Increased from 30 - ensures key medical terms aren't split

# Vector store configuration
vector_store:
  type: "chroma"
  chroma_path: "./data/indexes/chroma_db_advanced"
  collection_name: "spice_healthcare_advanced"

# Advanced Retriever Configuration
retriever:
  # Weights for combining dense (vector) and sparse (keyword) search
  hybrid_search_weights: [0.75, 0.25] # Increased semantic weight - medical concepts are semantic
  # Number of initial documents to fetch before reranking
  top_k_initial: 50      # Increased from 20 - cast wider net for medical data
  # Number of final documents to return after reranking
  top_k_final: 10        # Increased from 5 - provide richer context to LLM
  # Model for the final reranking step
  reranker_model_name: "BAAI/bge-reranker-base"

# Text processing
text_processing:
  chunk_size: 1000
  chunk_overlap: 200
  min_chunk_length: 50

# =============================================================================
# Medical Context Mappings for Clinical Terminology Enrichment
# =============================================================================
# These mappings provide human-readable names for clinical database columns,
# improving embedding quality by adding semantic context for the LLM.
# Format: column_name: "Human Readable Name"
medical_context:
  # Vital Signs
  bp: "Blood Pressure"
  bp_systolic: "Systolic Blood Pressure"
  bp_diastolic: "Diastolic Blood Pressure"
  hr: "Heart Rate"
  pulse: "Pulse Rate"
  rr: "Respiratory Rate"
  spo2: "Oxygen Saturation (SpO2)"
  temp: "Body Temperature"
  temperature: "Body Temperature"
  
  # Anthropometric Measurements
  bmi: "Body Mass Index"
  height: "Height"
  weight: "Weight"
  waist_circumference: "Waist Circumference"
  hip_circumference: "Hip Circumference"
  
  # Diabetes & Glucose Metrics
  hba1c: "Glycated Hemoglobin (HbA1c)"
  fbs: "Fasting Blood Sugar"
  rbs: "Random Blood Sugar"
  ppbs: "Post-Prandial Blood Sugar"
  glucose: "Blood Glucose"
  fasting_glucose: "Fasting Glucose Level"
  
  # Lipid Profile
  cholesterol: "Total Cholesterol"
  hdl: "HDL Cholesterol (Good)"
  ldl: "LDL Cholesterol (Bad)"
  triglycerides: "Triglycerides"
  vldl: "VLDL Cholesterol"
  
  # Renal Function
  creatinine: "Serum Creatinine"
  bun: "Blood Urea Nitrogen"
  egfr: "Estimated Glomerular Filtration Rate (eGFR)"
  uric_acid: "Uric Acid"
  
  # Liver Function
  sgot: "SGOT (AST) Liver Enzyme"
  sgpt: "SGPT (ALT) Liver Enzyme"
  alp: "Alkaline Phosphatase"
  bilirubin: "Bilirubin"
  albumin: "Serum Albumin"
  
  # Hematology
  hb: "Hemoglobin"
  hemoglobin: "Hemoglobin Level"
  wbc: "White Blood Cell Count"
  rbc: "Red Blood Cell Count"
  platelet: "Platelet Count"
  platelets: "Platelet Count"
  pcv: "Packed Cell Volume (Hematocrit)"
  
  # Thyroid
  tsh: "Thyroid Stimulating Hormone"
  t3: "Triiodothyronine (T3)"
  t4: "Thyroxine (T4)"
  ft3: "Free T3"
  ft4: "Free T4"
  
  # Cardiovascular Risk
  cvd_risk: "Cardiovascular Disease Risk Score"
  cvd_risk_score: "CVD Risk Assessment Score"
  risk_level: "Risk Classification Level"
  
  # Clinical Identifiers
  patient_track_id: "Patient Tracking ID"
  encounter_id: "Clinical Encounter ID"
  visit_id: "Visit Identifier"
  screening_id: "Screening Session ID"
  
  # Medication & Treatment
  medication_name: "Medication Name"
  dosage: "Medication Dosage"
  frequency: "Dosing Frequency"
  prescription_id: "Prescription ID"
  
  # Diagnosis & Conditions
  diagnosis_code: "Diagnosis Code"
  icd_code: "ICD Diagnosis Code"
  condition: "Medical Condition"
  comorbidity: "Comorbid Condition"
  
  # Screening Results
  phq9_score: "PHQ-9 Depression Score"
  phq4_score: "PHQ-4 Mental Health Score"
  gad7_score: "GAD-7 Anxiety Score"
  audit_score: "AUDIT Alcohol Use Score"

# =============================================================================
# Clinical Boolean Flag Prefixes
# =============================================================================
# Column prefixes that indicate clinical boolean flags.
# Used by _enrich_medical_content() to provide semantic context.
clinical_flag_prefixes:
  - "is_"           # e.g., is_diabetic, is_hypertensive
  - "has_"          # e.g., has_allergy, has_complication
  - "was_"          # e.g., was_hospitalized, was_referred
  - "history_of_"   # e.g., history_of_smoking, history_of_stroke
  - "flag_"         # e.g., flag_high_risk, flag_follow_up
  - "confirmed_"    # e.g., confirmed_diagnosis, confirmed_pregnancy
  - "requires_"     # e.g., requires_insulin, requires_referral
  - "on_"           # e.g., on_medication, on_insulin

